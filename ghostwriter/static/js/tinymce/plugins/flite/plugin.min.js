/*!
 * Source version: 1.6.14 
 * Copyright (C) 2024 LoopIndex - All Rights Reserved
 * You should have received a copy of the LoopIndex Track Changes plugin license with
 * this file. If not, please write to: loopindex@gmail.com, or visit http://www.loopindex.com
 *
 * Third party licenses:
 * 
 * Rangy library:
 * Copyright 2018, Tim Down
 * https://github.com/timdown/rangy
 * license: MIT (See Below)
 *
 * jQuery
 * Copyright JS Foundation and other contributors, https://js.foundation/
 * https://github.com/jquery/jquery
 * license: MIT (See Below)
 *
 *
 * Mutation summary
 * Copyright (c) 2018 Rafael Weinstein
 * https://github.com/rafaelw/mutation-summary
 * license: Apache (See Below)
 * 
 *
 * LICENSES
 * 
 * The MIT License (MIT)
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 * =====
 *
 * Apache license: see http://www.apache.org/licenses/
 *
 * written by (David *)Frenkiel (https://github.com/imdfl) 
 */!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){var r;!function(){"use strict";var t,n,i,o,s={};
/*!
 * jQuery JavaScript Library v3.5.0 -ajax,-ajax/jsonp,-ajax/load,-ajax/script,-ajax/var/location,-ajax/var/nonce,-ajax/var/rquery,-ajax/xhr,-manipulation/_evalUrl,-deprecated/ajax-event-alias,-effects,-effects/Tween,-effects/animatedSelector
 * https://jquery.com/
 *
 * Includes Sizzle.js
 * https://sizzlejs.com/
 *
 * Copyright JS Foundation and other contributors
 * Released under the MIT license
 * https://jquery.org/license
 *
 * Date: 2020-04-10T15:07Z
 */!function(e){var t=window.LOOPINDEX;t&&"object"==typeof t&&t.$&&t.VERSION||(t={},Object.defineProperties(t,{VERSION:{value:"1.7.7",enumerable:!0,writable:!1,configurable:!1}}));var n=window.LOOPINDEX=t;n.$&&n.$.fn&&n.$.fn.jquery||Object.defineProperty(t,"$",{value:e,enumerable:!0,writable:!1,configurable:!1})}(function(t){var n="3.5.0 -ajax,-ajax/jsonp,-ajax/load,-ajax/script,-ajax/var/location,-ajax/var/nonce,-ajax/var/rquery,-ajax/xhr,-manipulation/_evalUrl,-deprecated/ajax-event-alias,-effects,-effects/Tween,-effects/animatedSelector",i=[],o=Object.getPrototypeOf,a=i.slice,l=i.flat?function(e){return i.flat.call(e)}:function(e){return i.concat.apply([],e)},c=i.push,d=i.indexOf,u={},h=u.toString,f=u.hasOwnProperty,g=f.toString,p=g.call(Object),m={},v=function(e){return"function"==typeof e&&"number"!=typeof e.nodeType},y=function(e){return null!=e&&e===e.window},C=t.document,_={type:!0,src:!0,nonce:!0,noModule:!0};function N(e,t,n){var r,i,o=(n=n||C).createElement("script");if(o.text=e,t)for(r in _)(i=t[r]||t.getAttribute&&t.getAttribute(r))&&o.setAttribute(r,i);n.head.appendChild(o).parentNode.removeChild(o)}function b(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?u[h.call(e)]||"object":typeof e}var T=function(e,t){return new T.fn.init(e,t)};function E(e){var t=!!e&&"length"in e&&e.length,n=b(e);return!v(e)&&!y(e)&&("array"===n||0===t||"number"==typeof t&&t>0&&t-1 in e)}T.fn=T.prototype={jquery:n,constructor:T,length:0,toArray:function(){return a.call(this)},get:function(e){return null==e?a.call(this):e<0?this[e+this.length]:this[e]},pushStack:function(e){var t=T.merge(this.constructor(),e);return t.prevObject=this,t},each:function(e){return T.each(this,e)},map:function(e){return this.pushStack(T.map(this,(function(t,n){return e.call(t,n,t)})))},slice:function(){return this.pushStack(a.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(T.grep(this,(function(e,t){return(t+1)%2})))},odd:function(){return this.pushStack(T.grep(this,(function(e,t){return t%2})))},eq:function(e){var t=this.length,n=+e+(e<0?t:0);return this.pushStack(n>=0&&n<t?[this[n]]:[])},end:function(){return this.prevObject||this.constructor()},push:c,sort:i.sort,splice:i.splice},T.extend=T.fn.extend=function(){var e,t,n,r,i,o,s=arguments[0]||{},a=1,l=arguments.length,c=!1;for("boolean"==typeof s&&(c=s,s=arguments[a]||{},a++),"object"==typeof s||v(s)||(s={}),a===l&&(s=this,a--);a<l;a++)if(null!=(e=arguments[a]))for(t in e)r=e[t],"__proto__"!==t&&s!==r&&(c&&r&&(T.isPlainObject(r)||(i=Array.isArray(r)))?(n=s[t],o=i&&!Array.isArray(n)?[]:i||T.isPlainObject(n)?n:{},i=!1,s[t]=T.extend(c,o,r)):void 0!==r&&(s[t]=r));return s},T.extend({expando:"jQuery"+(n+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isPlainObject:function(e){var t,n;return!(!e||"[object Object]"!==h.call(e))&&(!(t=o(e))||"function"==typeof(n=f.call(t,"constructor")&&t.constructor)&&g.call(n)===p)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},globalEval:function(e,t,n){N(e,{nonce:t&&t.nonce},n)},each:function(e,t){var n,r=0;if(E(e))for(n=e.length;r<n&&!1!==t.call(e[r],r,e[r]);r++);else for(r in e)if(!1===t.call(e[r],r,e[r]))break;return e},makeArray:function(e,t){var n=t||[];return null!=e&&(E(Object(e))?T.merge(n,"string"==typeof e?[e]:e):c.call(n,e)),n},inArray:function(e,t,n){return null==t?-1:d.call(t,e,n)},merge:function(e,t){for(var n=+t.length,r=0,i=e.length;r<n;r++)e[i++]=t[r];return e.length=i,e},grep:function(e,t,n){for(var r=[],i=0,o=e.length,s=!n;i<o;i++)!t(e[i],i)!==s&&r.push(e[i]);return r},map:function(e,t,n){var r,i,o=0,s=[];if(E(e))for(r=e.length;o<r;o++)null!=(i=t(e[o],o,n))&&s.push(i);else for(o in e)null!=(i=t(e[o],o,n))&&s.push(i);return l(s)},guid:1,support:m}),"function"==typeof Symbol&&(T.fn[Symbol.iterator]=i[Symbol.iterator]),T.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),(function(e,t){u["[object "+t+"]"]=t.toLowerCase()}));var k=
/*!
		 * Sizzle CSS Selector Engine v2.3.5
		 * https://sizzlejs.com/
		 *
		 * Copyright JS Foundation and other contributors
		 * Released under the MIT license
		 * https://js.foundation/
		 *
		 * Date: 2020-03-14
		 */
function(e){var t,n,r,i,o,s,a,l,c,d,u,h,f,g,p,m,v,y,C,_="sizzle"+1*new Date,N=e.document,b=0,T=0,E=le(),k=le(),S=le(),x=le(),w=function(e,t){return e===t&&(u=!0),0},O={}.hasOwnProperty,A=[],R=A.pop,I=A.push,L=A.push,D=A.slice,P=function(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1},M="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",B="[\\x20\\t\\r\\n\\f]",F="(?:\\\\[\\da-fA-F]{1,6}"+B+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",j="\\["+B+"*("+F+")(?:"+B+"*([*^$|!~]?=)"+B+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+F+"))|)"+B+"*\\]",U=":("+F+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+j+")*)|.*)\\)|)",H=new RegExp(B+"+","g"),$=new RegExp("^"+B+"+|((?:^|[^\\\\])(?:\\\\.)*)"+B+"+$","g"),q=new RegExp("^"+B+"*,"+B+"*"),W=new RegExp("^"+B+"*([>+~]|"+B+")"+B+"*"),G=new RegExp(B+"|>"),z=new RegExp(U),V=new RegExp("^"+F+"$"),K={ID:new RegExp("^#("+F+")"),CLASS:new RegExp("^\\.("+F+")"),TAG:new RegExp("^("+F+"|[*])"),ATTR:new RegExp("^"+j),PSEUDO:new RegExp("^"+U),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+B+"*(even|odd|(([+-]|)(\\d*)n|)"+B+"*(?:([+-]|)"+B+"*(\\d+)|))"+B+"*\\)|)","i"),bool:new RegExp("^(?:"+M+")$","i"),needsContext:new RegExp("^"+B+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+B+"*((?:-\\d)?\\d*)"+B+"*\\)|)(?=[^-]|$)","i")},Y=/HTML$/i,X=/^(?:input|select|textarea|button)$/i,J=/^h\d$/i,Q=/^[^{]+\{\s*\[native \w/,Z=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ee=/[+~]/,te=new RegExp("\\\\[\\da-fA-F]{1,6}"+B+"?|\\\\([^\\r\\n\\f])","g"),ne=function(e,t){var n="0x"+e.slice(1)-65536;return t||(n<0?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,1023&n|56320))},re=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,ie=function(e,t){return t?"\0"===e?"ï¿½":e.slice(0,-1)+"\\"+e.charCodeAt(e.length-1).toString(16)+" ":"\\"+e},oe=function(){h()},se=_e((function(e){return!0===e.disabled&&"fieldset"===e.nodeName.toLowerCase()}),{dir:"parentNode",next:"legend"});try{L.apply(A=D.call(N.childNodes),N.childNodes),A[N.childNodes.length].nodeType}catch(e){L={apply:A.length?function(e,t){I.apply(e,D.call(t))}:function(e,t){for(var n=e.length,r=0;e[n++]=t[r++];);e.length=n-1}}}function ae(e,t,r,i){var o,a,c,d,u,g,v,y=t&&t.ownerDocument,N=t?t.nodeType:9;if(r=r||[],"string"!=typeof e||!e||1!==N&&9!==N&&11!==N)return r;if(!i&&(h(t),t=t||f,p)){if(11!==N&&(u=Z.exec(e)))if(o=u[1]){if(9===N){if(!(c=t.getElementById(o)))return r;if(c.id===o)return r.push(c),r}else if(y&&(c=y.getElementById(o))&&C(t,c)&&c.id===o)return r.push(c),r}else{if(u[2])return L.apply(r,t.getElementsByTagName(e)),r;if((o=u[3])&&n.getElementsByClassName&&t.getElementsByClassName)return L.apply(r,t.getElementsByClassName(o)),r}if(n.qsa&&!x[e+" "]&&(!m||!m.test(e))&&(1!==N||"object"!==t.nodeName.toLowerCase())){if(v=e,y=t,1===N&&(G.test(e)||W.test(e))){for((y=ee.test(e)&&ve(t.parentNode)||t)===t&&n.scope||((d=t.getAttribute("id"))?d=d.replace(re,ie):t.setAttribute("id",d=_)),a=(g=s(e)).length;a--;)g[a]=(d?"#"+d:":scope")+" "+Ce(g[a]);v=g.join(",")}try{return L.apply(r,y.querySelectorAll(v)),r}catch(t){x(e,!0)}finally{d===_&&t.removeAttribute("id")}}}return l(e.replace($,"$1"),t,r,i)}function le(){var e=[];return function t(n,i){return e.push(n+" ")>r.cacheLength&&delete t[e.shift()],t[n+" "]=i}}function ce(e){return e[_]=!0,e}function de(e){var t=f.createElement("fieldset");try{return!!e(t)}catch(e){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function ue(e,t){for(var n=e.split("|"),i=n.length;i--;)r.attrHandle[n[i]]=t}function he(e,t){var n=t&&e,r=n&&1===e.nodeType&&1===t.nodeType&&e.sourceIndex-t.sourceIndex;if(r)return r;if(n)for(;n=n.nextSibling;)if(n===t)return-1;return e?1:-1}function fe(e){return function(t){return"input"===t.nodeName.toLowerCase()&&t.type===e}}function ge(e){return function(t){var n=t.nodeName.toLowerCase();return("input"===n||"button"===n)&&t.type===e}}function pe(e){return function(t){return"form"in t?t.parentNode&&!1===t.disabled?"label"in t?"label"in t.parentNode?t.parentNode.disabled===e:t.disabled===e:t.isDisabled===e||t.isDisabled!==!e&&se(t)===e:t.disabled===e:"label"in t&&t.disabled===e}}function me(e){return ce((function(t){return t=+t,ce((function(n,r){for(var i,o=e([],n.length,t),s=o.length;s--;)n[i=o[s]]&&(n[i]=!(r[i]=n[i]))}))}))}function ve(e){return e&&void 0!==e.getElementsByTagName&&e}for(t in n=ae.support={},o=ae.isXML=function(e){var t=e.namespaceURI,n=(e.ownerDocument||e).documentElement;return!Y.test(t||n&&n.nodeName||"HTML")},h=ae.setDocument=function(e){var t,i,s=e?e.ownerDocument||e:N;return s!=f&&9===s.nodeType&&s.documentElement?(g=(f=s).documentElement,p=!o(f),N!=f&&(i=f.defaultView)&&i.top!==i&&(i.addEventListener?i.addEventListener("unload",oe,!1):i.attachEvent&&i.attachEvent("onunload",oe)),n.scope=de((function(e){return g.appendChild(e).appendChild(f.createElement("div")),void 0!==e.querySelectorAll&&!e.querySelectorAll(":scope fieldset div").length})),n.attributes=de((function(e){return e.className="i",!e.getAttribute("className")})),n.getElementsByTagName=de((function(e){return e.appendChild(f.createComment("")),!e.getElementsByTagName("*").length})),n.getElementsByClassName=Q.test(f.getElementsByClassName),n.getById=de((function(e){return g.appendChild(e).id=_,!f.getElementsByName||!f.getElementsByName(_).length})),n.getById?(r.filter.ID=function(e){var t=e.replace(te,ne);return function(e){return e.getAttribute("id")===t}},r.find.ID=function(e,t){if(void 0!==t.getElementById&&p){var n=t.getElementById(e);return n?[n]:[]}}):(r.filter.ID=function(e){var t=e.replace(te,ne);return function(e){var n=void 0!==e.getAttributeNode&&e.getAttributeNode("id");return n&&n.value===t}},r.find.ID=function(e,t){if(void 0!==t.getElementById&&p){var n,r,i,o=t.getElementById(e);if(o){if((n=o.getAttributeNode("id"))&&n.value===e)return[o];for(i=t.getElementsByName(e),r=0;o=i[r++];)if((n=o.getAttributeNode("id"))&&n.value===e)return[o]}return[]}}),r.find.TAG=n.getElementsByTagName?function(e,t){return void 0!==t.getElementsByTagName?t.getElementsByTagName(e):n.qsa?t.querySelectorAll(e):void 0}:function(e,t){var n,r=[],i=0,o=t.getElementsByTagName(e);if("*"===e){for(;n=o[i++];)1===n.nodeType&&r.push(n);return r}return o},r.find.CLASS=n.getElementsByClassName&&function(e,t){if(void 0!==t.getElementsByClassName&&p)return t.getElementsByClassName(e)},v=[],m=[],(n.qsa=Q.test(f.querySelectorAll))&&(de((function(e){var t;g.appendChild(e).innerHTML="<a id='"+_+"'></a><select id='"+_+"-\r\\' msallowcapture=''><option selected=''></option></select>",e.querySelectorAll("[msallowcapture^='']").length&&m.push("[*^$]="+B+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||m.push("\\["+B+"*(?:value|"+M+")"),e.querySelectorAll("[id~="+_+"-]").length||m.push("~="),(t=f.createElement("input")).setAttribute("name",""),e.appendChild(t),e.querySelectorAll("[name='']").length||m.push("\\["+B+"*name"+B+"*="+B+"*(?:''|\"\")"),e.querySelectorAll(":checked").length||m.push(":checked"),e.querySelectorAll("a#"+_+"+*").length||m.push(".#.+[+~]"),e.querySelectorAll("\\\f"),m.push("[\\r\\n\\f]")})),de((function(e){e.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var t=f.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&m.push("name"+B+"*[*^$|!~]?="),2!==e.querySelectorAll(":enabled").length&&m.push(":enabled",":disabled"),g.appendChild(e).disabled=!0,2!==e.querySelectorAll(":disabled").length&&m.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),m.push(",.*:")}))),(n.matchesSelector=Q.test(y=g.matches||g.webkitMatchesSelector||g.mozMatchesSelector||g.oMatchesSelector||g.msMatchesSelector))&&de((function(e){n.disconnectedMatch=y.call(e,"*"),y.call(e,"[s!='']:x"),v.push("!=",U)})),m=m.length&&new RegExp(m.join("|")),v=v.length&&new RegExp(v.join("|")),t=Q.test(g.compareDocumentPosition),C=t||Q.test(g.contains)?function(e,t){var n=9===e.nodeType?e.documentElement:e,r=t&&t.parentNode;return e===r||!(!r||1!==r.nodeType||!(n.contains?n.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},w=t?function(e,t){if(e===t)return u=!0,0;var r=!e.compareDocumentPosition-!t.compareDocumentPosition;return r||(1&(r=(e.ownerDocument||e)==(t.ownerDocument||t)?e.compareDocumentPosition(t):1)||!n.sortDetached&&t.compareDocumentPosition(e)===r?e==f||e.ownerDocument==N&&C(N,e)?-1:t==f||t.ownerDocument==N&&C(N,t)?1:d?P(d,e)-P(d,t):0:4&r?-1:1)}:function(e,t){if(e===t)return u=!0,0;var n,r=0,i=e.parentNode,o=t.parentNode,s=[e],a=[t];if(!i||!o)return e==f?-1:t==f?1:i?-1:o?1:d?P(d,e)-P(d,t):0;if(i===o)return he(e,t);for(n=e;n=n.parentNode;)s.unshift(n);for(n=t;n=n.parentNode;)a.unshift(n);for(;s[r]===a[r];)r++;return r?he(s[r],a[r]):s[r]==N?-1:a[r]==N?1:0},f):f},ae.matches=function(e,t){return ae(e,null,null,t)},ae.matchesSelector=function(e,t){if(h(e),n.matchesSelector&&p&&!x[t+" "]&&(!v||!v.test(t))&&(!m||!m.test(t)))try{var r=y.call(e,t);if(r||n.disconnectedMatch||e.document&&11!==e.document.nodeType)return r}catch(e){x(t,!0)}return ae(t,f,null,[e]).length>0},ae.contains=function(e,t){return(e.ownerDocument||e)!=f&&h(e),C(e,t)},ae.attr=function(e,t){(e.ownerDocument||e)!=f&&h(e);var i=r.attrHandle[t.toLowerCase()],o=i&&O.call(r.attrHandle,t.toLowerCase())?i(e,t,!p):void 0;return void 0!==o?o:n.attributes||!p?e.getAttribute(t):(o=e.getAttributeNode(t))&&o.specified?o.value:null},ae.escape=function(e){return(e+"").replace(re,ie)},ae.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},ae.uniqueSort=function(e){var t,r=[],i=0,o=0;if(u=!n.detectDuplicates,d=!n.sortStable&&e.slice(0),e.sort(w),u){for(;t=e[o++];)t===e[o]&&(i=r.push(o));for(;i--;)e.splice(r[i],1)}return d=null,e},i=ae.getText=function(e){var t,n="",r=0,o=e.nodeType;if(o){if(1===o||9===o||11===o){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=i(e)}else if(3===o||4===o)return e.nodeValue}else for(;t=e[r++];)n+=i(t);return n},(r=ae.selectors={cacheLength:50,createPseudo:ce,match:K,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(te,ne),e[3]=(e[3]||e[4]||e[5]||"").replace(te,ne),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||ae.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&ae.error(e[0]),e},PSEUDO:function(e){var t,n=!e[6]&&e[2];return K.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":n&&z.test(n)&&(t=s(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(te,ne).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=E[e+" "];return t||(t=new RegExp("(^|"+B+")"+e+"("+B+"|$)"))&&E(e,(function(e){return t.test("string"==typeof e.className&&e.className||void 0!==e.getAttribute&&e.getAttribute("class")||"")}))},ATTR:function(e,t,n){return function(r){var i=ae.attr(r,e);return null==i?"!="===t:!t||(i+="","="===t?i===n:"!="===t?i!==n:"^="===t?n&&0===i.indexOf(n):"*="===t?n&&i.indexOf(n)>-1:"$="===t?n&&i.slice(-n.length)===n:"~="===t?(" "+i.replace(H," ")+" ").indexOf(n)>-1:"|="===t&&(i===n||i.slice(0,n.length+1)===n+"-"))}},CHILD:function(e,t,n,r,i){var o="nth"!==e.slice(0,3),s="last"!==e.slice(-4),a="of-type"===t;return 1===r&&0===i?function(e){return!!e.parentNode}:function(t,n,l){var c,d,u,h,f,g,p=o!==s?"nextSibling":"previousSibling",m=t.parentNode,v=a&&t.nodeName.toLowerCase(),y=!l&&!a,C=!1;if(m){if(o){for(;p;){for(h=t;h=h[p];)if(a?h.nodeName.toLowerCase()===v:1===h.nodeType)return!1;g=p="only"===e&&!g&&"nextSibling"}return!0}if(g=[s?m.firstChild:m.lastChild],s&&y){for(C=(f=(c=(d=(u=(h=m)[_]||(h[_]={}))[h.uniqueID]||(u[h.uniqueID]={}))[e]||[])[0]===b&&c[1])&&c[2],h=f&&m.childNodes[f];h=++f&&h&&h[p]||(C=f=0)||g.pop();)if(1===h.nodeType&&++C&&h===t){d[e]=[b,f,C];break}}else if(y&&(C=f=(c=(d=(u=(h=t)[_]||(h[_]={}))[h.uniqueID]||(u[h.uniqueID]={}))[e]||[])[0]===b&&c[1]),!1===C)for(;(h=++f&&h&&h[p]||(C=f=0)||g.pop())&&((a?h.nodeName.toLowerCase()!==v:1!==h.nodeType)||!++C||(y&&((d=(u=h[_]||(h[_]={}))[h.uniqueID]||(u[h.uniqueID]={}))[e]=[b,C]),h!==t)););return(C-=i)===r||C%r==0&&C/r>=0}}},PSEUDO:function(e,t){var n,i=r.pseudos[e]||r.setFilters[e.toLowerCase()]||ae.error("unsupported pseudo: "+e);return i[_]?i(t):i.length>1?(n=[e,e,"",t],r.setFilters.hasOwnProperty(e.toLowerCase())?ce((function(e,n){for(var r,o=i(e,t),s=o.length;s--;)e[r=P(e,o[s])]=!(n[r]=o[s])})):function(e){return i(e,0,n)}):i}},pseudos:{not:ce((function(e){var t=[],n=[],r=a(e.replace($,"$1"));return r[_]?ce((function(e,t,n,i){for(var o,s=r(e,null,i,[]),a=e.length;a--;)(o=s[a])&&(e[a]=!(t[a]=o))})):function(e,i,o){return t[0]=e,r(t,null,o,n),t[0]=null,!n.pop()}})),has:ce((function(e){return function(t){return ae(e,t).length>0}})),contains:ce((function(e){return e=e.replace(te,ne),function(t){return(t.textContent||i(t)).indexOf(e)>-1}})),lang:ce((function(e){return V.test(e||"")||ae.error("unsupported lang: "+e),e=e.replace(te,ne).toLowerCase(),function(t){var n;do{if(n=p?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return(n=n.toLowerCase())===e||0===n.indexOf(e+"-")}while((t=t.parentNode)&&1===t.nodeType);return!1}})),target:function(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id},root:function(e){return e===g},focus:function(e){return e===f.activeElement&&(!f.hasFocus||f.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:pe(!1),disabled:pe(!0),checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!r.pseudos.empty(e)},header:function(e){return J.test(e.nodeName)},input:function(e){return X.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:me((function(){return[0]})),last:me((function(e,t){return[t-1]})),eq:me((function(e,t,n){return[n<0?n+t:n]})),even:me((function(e,t){for(var n=0;n<t;n+=2)e.push(n);return e})),odd:me((function(e,t){for(var n=1;n<t;n+=2)e.push(n);return e})),lt:me((function(e,t,n){for(var r=n<0?n+t:n>t?t:n;--r>=0;)e.push(r);return e})),gt:me((function(e,t,n){for(var r=n<0?n+t:n;++r<t;)e.push(r);return e}))}}).pseudos.nth=r.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})r.pseudos[t]=fe(t);for(t in{submit:!0,reset:!0})r.pseudos[t]=ge(t);function ye(){}function Ce(e){for(var t=0,n=e.length,r="";t<n;t++)r+=e[t].value;return r}function _e(e,t,n){var r=t.dir,i=t.next,o=i||r,s=n&&"parentNode"===o,a=T++;return t.first?function(t,n,i){for(;t=t[r];)if(1===t.nodeType||s)return e(t,n,i);return!1}:function(t,n,l){var c,d,u,h=[b,a];if(l){for(;t=t[r];)if((1===t.nodeType||s)&&e(t,n,l))return!0}else for(;t=t[r];)if(1===t.nodeType||s)if(d=(u=t[_]||(t[_]={}))[t.uniqueID]||(u[t.uniqueID]={}),i&&i===t.nodeName.toLowerCase())t=t[r]||t;else{if((c=d[o])&&c[0]===b&&c[1]===a)return h[2]=c[2];if(d[o]=h,h[2]=e(t,n,l))return!0}return!1}}function Ne(e){return e.length>1?function(t,n,r){for(var i=e.length;i--;)if(!e[i](t,n,r))return!1;return!0}:e[0]}function be(e,t,n,r,i){for(var o,s=[],a=0,l=e.length,c=null!=t;a<l;a++)(o=e[a])&&(n&&!n(o,r,i)||(s.push(o),c&&t.push(a)));return s}function Te(e,t,n,r,i,o){return r&&!r[_]&&(r=Te(r)),i&&!i[_]&&(i=Te(i,o)),ce((function(o,s,a,l){var c,d,u,h=[],f=[],g=s.length,p=o||function(e,t,n){for(var r=0,i=t.length;r<i;r++)ae(e,t[r],n);return n}(t||"*",a.nodeType?[a]:a,[]),m=!e||!o&&t?p:be(p,h,e,a,l),v=n?i||(o?e:g||r)?[]:s:m;if(n&&n(m,v,a,l),r)for(c=be(v,f),r(c,[],a,l),d=c.length;d--;)(u=c[d])&&(v[f[d]]=!(m[f[d]]=u));if(o){if(i||e){if(i){for(c=[],d=v.length;d--;)(u=v[d])&&c.push(m[d]=u);i(null,v=[],c,l)}for(d=v.length;d--;)(u=v[d])&&(c=i?P(o,u):h[d])>-1&&(o[c]=!(s[c]=u))}}else v=be(v===s?v.splice(g,v.length):v),i?i(null,s,v,l):L.apply(s,v)}))}function Ee(e){for(var t,n,i,o=e.length,s=r.relative[e[0].type],a=s||r.relative[" "],l=s?1:0,d=_e((function(e){return e===t}),a,!0),u=_e((function(e){return P(t,e)>-1}),a,!0),h=[function(e,n,r){var i=!s&&(r||n!==c)||((t=n).nodeType?d(e,n,r):u(e,n,r));return t=null,i}];l<o;l++)if(n=r.relative[e[l].type])h=[_e(Ne(h),n)];else{if((n=r.filter[e[l].type].apply(null,e[l].matches))[_]){for(i=++l;i<o&&!r.relative[e[i].type];i++);return Te(l>1&&Ne(h),l>1&&Ce(e.slice(0,l-1).concat({value:" "===e[l-2].type?"*":""})).replace($,"$1"),n,l<i&&Ee(e.slice(l,i)),i<o&&Ee(e=e.slice(i)),i<o&&Ce(e))}h.push(n)}return Ne(h)}return ye.prototype=r.filters=r.pseudos,r.setFilters=new ye,s=ae.tokenize=function(e,t){var n,i,o,s,a,l,c,d=k[e+" "];if(d)return t?0:d.slice(0);for(a=e,l=[],c=r.preFilter;a;){for(s in n&&!(i=q.exec(a))||(i&&(a=a.slice(i[0].length)||a),l.push(o=[])),n=!1,(i=W.exec(a))&&(n=i.shift(),o.push({value:n,type:i[0].replace($," ")}),a=a.slice(n.length)),r.filter)!(i=K[s].exec(a))||c[s]&&!(i=c[s](i))||(n=i.shift(),o.push({value:n,type:s,matches:i}),a=a.slice(n.length));if(!n)break}return t?a.length:a?ae.error(e):k(e,l).slice(0)},a=ae.compile=function(e,t){var n,i=[],o=[],a=S[e+" "];if(!a){for(t||(t=s(e)),n=t.length;n--;)(a=Ee(t[n]))[_]?i.push(a):o.push(a);(a=S(e,function(e,t){var n=t.length>0,i=e.length>0,o=function(o,s,a,l,d){var u,g,m,v=0,y="0",C=o&&[],_=[],N=c,T=o||i&&r.find.TAG("*",d),E=b+=null==N?1:Math.random()||.1,k=T.length;for(d&&(c=s==f||s||d);y!==k&&null!=(u=T[y]);y++){if(i&&u){for(g=0,s||u.ownerDocument==f||(h(u),a=!p);m=e[g++];)if(m(u,s||f,a)){l.push(u);break}d&&(b=E)}n&&((u=!m&&u)&&v--,o&&C.push(u))}if(v+=y,n&&y!==v){for(g=0;m=t[g++];)m(C,_,s,a);if(o){if(v>0)for(;y--;)C[y]||_[y]||(_[y]=R.call(l));_=be(_)}L.apply(l,_),d&&!o&&_.length>0&&v+t.length>1&&ae.uniqueSort(l)}return d&&(b=E,c=N),C};return n?ce(o):o}(o,i))).selector=e}return a},l=ae.select=function(e,t,n,i){var o,l,c,d,u,h="function"==typeof e&&e,f=!i&&s(e=h.selector||e);if(n=n||[],1===f.length){if((l=f[0]=f[0].slice(0)).length>2&&"ID"===(c=l[0]).type&&9===t.nodeType&&p&&r.relative[l[1].type]){if(!(t=(r.find.ID(c.matches[0].replace(te,ne),t)||[])[0]))return n;h&&(t=t.parentNode),e=e.slice(l.shift().value.length)}for(o=K.needsContext.test(e)?0:l.length;o--&&(c=l[o],!r.relative[d=c.type]);)if((u=r.find[d])&&(i=u(c.matches[0].replace(te,ne),ee.test(l[0].type)&&ve(t.parentNode)||t))){if(l.splice(o,1),!(e=i.length&&Ce(l)))return L.apply(n,i),n;break}}return(h||a(e,f))(i,t,!p,n,!t||ee.test(e)&&ve(t.parentNode)||t),n},n.sortStable=_.split("").sort(w).join("")===_,n.detectDuplicates=!!u,h(),n.sortDetached=de((function(e){return 1&e.compareDocumentPosition(f.createElement("fieldset"))})),de((function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")}))||ue("type|href|height|width",(function(e,t,n){if(!n)return e.getAttribute(t,"type"===t.toLowerCase()?1:2)})),n.attributes&&de((function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")}))||ue("value",(function(e,t,n){if(!n&&"input"===e.nodeName.toLowerCase())return e.defaultValue})),de((function(e){return null==e.getAttribute("disabled")}))||ue(M,(function(e,t,n){var r;if(!n)return!0===e[t]?t.toLowerCase():(r=e.getAttributeNode(t))&&r.specified?r.value:null})),ae}(t);T.find=k,T.expr=k.selectors,T.expr[":"]=T.expr.pseudos,T.uniqueSort=T.unique=k.uniqueSort,T.text=k.getText,T.isXMLDoc=k.isXML,T.contains=k.contains,T.escapeSelector=k.escape;var S=function(e,t,n){for(var r=[],i=void 0!==n;(e=e[t])&&9!==e.nodeType;)if(1===e.nodeType){if(i&&T(e).is(n))break;r.push(e)}return r},x=function(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n},w=T.expr.match.needsContext;function O(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()}var A=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function R(e,t,n){return v(t)?T.grep(e,(function(e,r){return!!t.call(e,r,e)!==n})):t.nodeType?T.grep(e,(function(e){return e===t!==n})):"string"!=typeof t?T.grep(e,(function(e){return d.call(t,e)>-1!==n})):T.filter(t,e,n)}T.filter=function(e,t,n){var r=t[0];return n&&(e=":not("+e+")"),1===t.length&&1===r.nodeType?T.find.matchesSelector(r,e)?[r]:[]:T.find.matches(e,T.grep(t,(function(e){return 1===e.nodeType})))},T.fn.extend({find:function(e){var t,n,r=this.length,i=this;if("string"!=typeof e)return this.pushStack(T(e).filter((function(){for(t=0;t<r;t++)if(T.contains(i[t],this))return!0})));for(n=this.pushStack([]),t=0;t<r;t++)T.find(e,i[t],n);return r>1?T.uniqueSort(n):n},filter:function(e){return this.pushStack(R(this,e||[],!1))},not:function(e){return this.pushStack(R(this,e||[],!0))},is:function(e){return!!R(this,"string"==typeof e&&w.test(e)?T(e):e||[],!1).length}});var I,L=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(T.fn.init=function(e,t,n){var r,i;if(!e)return this;if(n=n||I,"string"==typeof e){if(!(r="<"===e[0]&&">"===e[e.length-1]&&e.length>=3?[null,e,null]:L.exec(e))||!r[1]&&t)return!t||t.jquery?(t||n).find(e):this.constructor(t).find(e);if(r[1]){if(t=t instanceof T?t[0]:t,T.merge(this,T.parseHTML(r[1],t&&t.nodeType?t.ownerDocument||t:C,!0)),A.test(r[1])&&T.isPlainObject(t))for(r in t)v(this[r])?this[r](t[r]):this.attr(r,t[r]);return this}return(i=C.getElementById(r[2]))&&(this[0]=i,this.length=1),this}return e.nodeType?(this[0]=e,this.length=1,this):v(e)?void 0!==n.ready?n.ready(e):e(T):T.makeArray(e,this)}).prototype=T.fn,I=T(C);var D=/^(?:parents|prev(?:Until|All))/,P={children:!0,contents:!0,next:!0,prev:!0};function M(e,t){for(;(e=e[t])&&1!==e.nodeType;);return e}T.fn.extend({has:function(e){var t=T(e,this),n=t.length;return this.filter((function(){for(var e=0;e<n;e++)if(T.contains(this,t[e]))return!0}))},closest:function(e,t){var n,r=0,i=this.length,o=[],s="string"!=typeof e&&T(e);if(!w.test(e))for(;r<i;r++)for(n=this[r];n&&n!==t;n=n.parentNode)if(n.nodeType<11&&(s?s.index(n)>-1:1===n.nodeType&&T.find.matchesSelector(n,e))){o.push(n);break}return this.pushStack(o.length>1?T.uniqueSort(o):o)},index:function(e){return e?"string"==typeof e?d.call(T(e),this[0]):d.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(T.uniqueSort(T.merge(this.get(),T(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),T.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return S(e,"parentNode")},parentsUntil:function(e,t,n){return S(e,"parentNode",n)},next:function(e){return M(e,"nextSibling")},prev:function(e){return M(e,"previousSibling")},nextAll:function(e){return S(e,"nextSibling")},prevAll:function(e){return S(e,"previousSibling")},nextUntil:function(e,t,n){return S(e,"nextSibling",n)},prevUntil:function(e,t,n){return S(e,"previousSibling",n)},siblings:function(e){return x((e.parentNode||{}).firstChild,e)},children:function(e){return x(e.firstChild)},contents:function(e){return null!=e.contentDocument&&o(e.contentDocument)?e.contentDocument:(O(e,"template")&&(e=e.content||e),T.merge([],e.childNodes))}},(function(e,t){T.fn[e]=function(n,r){var i=T.map(this,t,n);return"Until"!==e.slice(-5)&&(r=n),r&&"string"==typeof r&&(i=T.filter(r,i)),this.length>1&&(P[e]||T.uniqueSort(i),D.test(e)&&i.reverse()),this.pushStack(i)}}));var B=/[^\x20\t\r\n\f]+/g;function F(e){return e}function j(e){throw e}function U(e,t,n,r){var i;try{e&&v(i=e.promise)?i.call(e).done(t).fail(n):e&&v(i=e.then)?i.call(e,t,n):t.apply(void 0,[e].slice(r))}catch(e){n.apply(void 0,[e])}}T.Callbacks=function(e){e="string"==typeof e?function(e){var t={};return T.each(e.match(B)||[],(function(e,n){t[n]=!0})),t}(e):T.extend({},e);var t,n,r,i,o=[],s=[],a=-1,l=function(){for(i=i||e.once,r=t=!0;s.length;a=-1)for(n=s.shift();++a<o.length;)!1===o[a].apply(n[0],n[1])&&e.stopOnFalse&&(a=o.length,n=!1);e.memory||(n=!1),t=!1,i&&(o=n?[]:"")},c={add:function(){return o&&(n&&!t&&(a=o.length-1,s.push(n)),function t(n){T.each(n,(function(n,r){v(r)?e.unique&&c.has(r)||o.push(r):r&&r.length&&"string"!==b(r)&&t(r)}))}(arguments),n&&!t&&l()),this},remove:function(){return T.each(arguments,(function(e,t){for(var n;(n=T.inArray(t,o,n))>-1;)o.splice(n,1),n<=a&&a--})),this},has:function(e){return e?T.inArray(e,o)>-1:o.length>0},empty:function(){return o&&(o=[]),this},disable:function(){return i=s=[],o=n="",this},disabled:function(){return!o},lock:function(){return i=s=[],n||t||(o=n=""),this},locked:function(){return!!i},fireWith:function(e,n){return i||(n=[e,(n=n||[]).slice?n.slice():n],s.push(n),t||l()),this},fire:function(){return c.fireWith(this,arguments),this},fired:function(){return!!r}};return c},T.extend({Deferred:function(e){var n=[["notify","progress",T.Callbacks("memory"),T.Callbacks("memory"),2],["resolve","done",T.Callbacks("once memory"),T.Callbacks("once memory"),0,"resolved"],["reject","fail",T.Callbacks("once memory"),T.Callbacks("once memory"),1,"rejected"]],r="pending",i={state:function(){return r},always:function(){return o.done(arguments).fail(arguments),this},catch:function(e){return i.then(null,e)},pipe:function(){var e=arguments;return T.Deferred((function(t){T.each(n,(function(n,r){var i=v(e[r[4]])&&e[r[4]];o[r[1]]((function(){var e=i&&i.apply(this,arguments);e&&v(e.promise)?e.promise().progress(t.notify).done(t.resolve).fail(t.reject):t[r[0]+"With"](this,i?[e]:arguments)}))})),e=null})).promise()},then:function(e,r,i){var o=0;function s(e,n,r,i){return function(){var a=this,l=arguments,c=function(){var t,c;if(!(e<o)){if((t=r.apply(a,l))===n.promise())throw new TypeError("Thenable self-resolution");c=t&&("object"==typeof t||"function"==typeof t)&&t.then,v(c)?i?c.call(t,s(o,n,F,i),s(o,n,j,i)):(o++,c.call(t,s(o,n,F,i),s(o,n,j,i),s(o,n,F,n.notifyWith))):(r!==F&&(a=void 0,l=[t]),(i||n.resolveWith)(a,l))}},d=i?c:function(){try{c()}catch(t){T.Deferred.exceptionHook&&T.Deferred.exceptionHook(t,d.stackTrace),e+1>=o&&(r!==j&&(a=void 0,l=[t]),n.rejectWith(a,l))}};e?d():(T.Deferred.getStackHook&&(d.stackTrace=T.Deferred.getStackHook()),t.setTimeout(d))}}return T.Deferred((function(t){n[0][3].add(s(0,t,v(i)?i:F,t.notifyWith)),n[1][3].add(s(0,t,v(e)?e:F)),n[2][3].add(s(0,t,v(r)?r:j))})).promise()},promise:function(e){return null!=e?T.extend(e,i):i}},o={};return T.each(n,(function(e,t){var s=t[2],a=t[5];i[t[1]]=s.add,a&&s.add((function(){r=a}),n[3-e][2].disable,n[3-e][3].disable,n[0][2].lock,n[0][3].lock),s.add(t[3].fire),o[t[0]]=function(){return o[t[0]+"With"](this===o?void 0:this,arguments),this},o[t[0]+"With"]=s.fireWith})),i.promise(o),e&&e.call(o,o),o},when:function(e){var t=arguments.length,n=t,r=Array(n),i=a.call(arguments),o=T.Deferred(),s=function(e){return function(n){r[e]=this,i[e]=arguments.length>1?a.call(arguments):n,--t||o.resolveWith(r,i)}};if(t<=1&&(U(e,o.done(s(n)).resolve,o.reject,!t),"pending"===o.state()||v(i[n]&&i[n].then)))return o.then();for(;n--;)U(i[n],s(n),o.reject);return o.promise()}});var H=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;T.Deferred.exceptionHook=function(e,n){t.console&&t.console.warn&&e&&H.test(e.name)&&t.console.warn("jQuery.Deferred exception: "+e.message,e.stack,n)},T.readyException=function(e){t.setTimeout((function(){throw e}))};var $=T.Deferred();function q(){C.removeEventListener("DOMContentLoaded",q),t.removeEventListener("load",q),T.ready()}T.fn.ready=function(e){return $.then(e).catch((function(e){T.readyException(e)})),this},T.extend({isReady:!1,readyWait:1,ready:function(e){(!0===e?--T.readyWait:T.isReady)||(T.isReady=!0,!0!==e&&--T.readyWait>0||$.resolveWith(C,[T]))}}),T.ready.then=$.then,"complete"===C.readyState||"loading"!==C.readyState&&!C.documentElement.doScroll?t.setTimeout(T.ready):(C.addEventListener("DOMContentLoaded",q),t.addEventListener("load",q));var W=function(e,t,n,r,i,o,s){var a=0,l=e.length,c=null==n;if("object"===b(n))for(a in i=!0,n)W(e,t,a,n[a],!0,o,s);else if(void 0!==r&&(i=!0,v(r)||(s=!0),c&&(s?(t.call(e,r),t=null):(c=t,t=function(e,t,n){return c.call(T(e),n)})),t))for(;a<l;a++)t(e[a],n,s?r:r.call(e[a],a,t(e[a],n)));return i?e:c?t.call(e):l?t(e[0],n):o},G=/^-ms-/,z=/-([a-z])/g;function V(e,t){return t.toUpperCase()}function K(e){return e.replace(G,"ms-").replace(z,V)}var Y=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType};function X(){this.expando=T.expando+X.uid++}X.uid=1,X.prototype={cache:function(e){var t=e[this.expando];return t||(t=Object.create(null),Y(e)&&(e.nodeType?e[this.expando]=t:Object.defineProperty(e,this.expando,{value:t,configurable:!0}))),t},set:function(e,t,n){var r,i=this.cache(e);if("string"==typeof t)i[K(t)]=n;else for(r in t)i[K(r)]=t[r];return i},get:function(e,t){return void 0===t?this.cache(e):e[this.expando]&&e[this.expando][K(t)]},access:function(e,t,n){return void 0===t||t&&"string"==typeof t&&void 0===n?this.get(e,t):(this.set(e,t,n),void 0!==n?n:t)},remove:function(e,t){var n,r=e[this.expando];if(void 0!==r){if(void 0!==t){n=(t=Array.isArray(t)?t.map(K):(t=K(t))in r?[t]:t.match(B)||[]).length;for(;n--;)delete r[t[n]]}(void 0===t||T.isEmptyObject(r))&&(e.nodeType?e[this.expando]=void 0:delete e[this.expando])}},hasData:function(e){var t=e[this.expando];return void 0!==t&&!T.isEmptyObject(t)}};var J=new X,Q=new X,Z=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,ee=/[A-Z]/g;function te(e,t,n){var r;if(void 0===n&&1===e.nodeType)if(r="data-"+t.replace(ee,"-$&").toLowerCase(),"string"==typeof(n=e.getAttribute(r))){try{n=function(e){return"true"===e||"false"!==e&&("null"===e?null:e===+e+""?+e:Z.test(e)?JSON.parse(e):e)}(n)}catch(e){}Q.set(e,t,n)}else n=void 0;return n}T.extend({hasData:function(e){return Q.hasData(e)||J.hasData(e)},data:function(e,t,n){return Q.access(e,t,n)},removeData:function(e,t){Q.remove(e,t)},_data:function(e,t,n){return J.access(e,t,n)},_removeData:function(e,t){J.remove(e,t)}}),T.fn.extend({data:function(e,t){var n,r,i,o=this[0],s=o&&o.attributes;if(void 0===e){if(this.length&&(i=Q.get(o),1===o.nodeType&&!J.get(o,"hasDataAttrs"))){for(n=s.length;n--;)s[n]&&0===(r=s[n].name).indexOf("data-")&&(r=K(r.slice(5)),te(o,r,i[r]));J.set(o,"hasDataAttrs",!0)}return i}return"object"==typeof e?this.each((function(){Q.set(this,e)})):W(this,(function(t){var n;if(o&&void 0===t)return void 0!==(n=Q.get(o,e))||void 0!==(n=te(o,e))?n:void 0;this.each((function(){Q.set(this,e,t)}))}),null,t,arguments.length>1,null,!0)},removeData:function(e){return this.each((function(){Q.remove(this,e)}))}}),T.extend({queue:function(e,t,n){var r;if(e)return t=(t||"fx")+"queue",r=J.get(e,t),n&&(!r||Array.isArray(n)?r=J.access(e,t,T.makeArray(n)):r.push(n)),r||[]},dequeue:function(e,t){t=t||"fx";var n=T.queue(e,t),r=n.length,i=n.shift(),o=T._queueHooks(e,t);"inprogress"===i&&(i=n.shift(),r--),i&&("fx"===t&&n.unshift("inprogress"),delete o.stop,i.call(e,(function(){T.dequeue(e,t)}),o)),!r&&o&&o.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return J.get(e,n)||J.access(e,n,{empty:T.Callbacks("once memory").add((function(){J.remove(e,[t+"queue",n])}))})}}),T.fn.extend({queue:function(e,t){var n=2;return"string"!=typeof e&&(t=e,e="fx",n--),arguments.length<n?T.queue(this[0],e):void 0===t?this:this.each((function(){var n=T.queue(this,e,t);T._queueHooks(this,e),"fx"===e&&"inprogress"!==n[0]&&T.dequeue(this,e)}))},dequeue:function(e){return this.each((function(){T.dequeue(this,e)}))},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var n,r=1,i=T.Deferred(),o=this,s=this.length,a=function(){--r||i.resolveWith(o,[o])};for("string"!=typeof e&&(t=e,e=void 0),e=e||"fx";s--;)(n=J.get(o[s],e+"queueHooks"))&&n.empty&&(r++,n.empty.add(a));return a(),i.promise(t)}});var ne=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,re=new RegExp("^(?:([+-])=|)("+ne+")([a-z%]*)$","i"),ie=["Top","Right","Bottom","Left"],oe=C.documentElement,se=function(e){return T.contains(e.ownerDocument,e)},ae={composed:!0};oe.getRootNode&&(se=function(e){return T.contains(e.ownerDocument,e)||e.getRootNode(ae)===e.ownerDocument});var le=function(e,t){return"none"===(e=t||e).style.display||""===e.style.display&&se(e)&&"none"===T.css(e,"display")};function ce(e,t,n,r){var i,o,s=20,a=r?function(){return r.cur()}:function(){return T.css(e,t,"")},l=a(),c=n&&n[3]||(T.cssNumber[t]?"":"px"),d=e.nodeType&&(T.cssNumber[t]||"px"!==c&&+l)&&re.exec(T.css(e,t));if(d&&d[3]!==c){for(l/=2,c=c||d[3],d=+l||1;s--;)T.style(e,t,d+c),(1-o)*(1-(o=a()/l||.5))<=0&&(s=0),d/=o;d*=2,T.style(e,t,d+c),n=n||[]}return n&&(d=+d||+l||0,i=n[1]?d+(n[1]+1)*n[2]:+n[2],r&&(r.unit=c,r.start=d,r.end=i)),i}var de={};function ue(e){var t,n=e.ownerDocument,r=e.nodeName,i=de[r];return i||(t=n.body.appendChild(n.createElement(r)),i=T.css(t,"display"),t.parentNode.removeChild(t),"none"===i&&(i="block"),de[r]=i,i)}function he(e,t){for(var n,r,i=[],o=0,s=e.length;o<s;o++)(r=e[o]).style&&(n=r.style.display,t?("none"===n&&(i[o]=J.get(r,"display")||null,i[o]||(r.style.display="")),""===r.style.display&&le(r)&&(i[o]=ue(r))):"none"!==n&&(i[o]="none",J.set(r,"display",n)));for(o=0;o<s;o++)null!=i[o]&&(e[o].style.display=i[o]);return e}T.fn.extend({show:function(){return he(this,!0)},hide:function(){return he(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each((function(){le(this)?T(this).show():T(this).hide()}))}});var fe,ge,pe=/^(?:checkbox|radio)$/i,me=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,ve=/^$|^module$|\/(?:java|ecma)script/i;fe=C.createDocumentFragment().appendChild(C.createElement("div")),(ge=C.createElement("input")).setAttribute("type","radio"),ge.setAttribute("checked","checked"),ge.setAttribute("name","t"),fe.appendChild(ge),m.checkClone=fe.cloneNode(!0).cloneNode(!0).lastChild.checked,fe.innerHTML="<textarea>x</textarea>",m.noCloneChecked=!!fe.cloneNode(!0).lastChild.defaultValue,fe.innerHTML="<option></option>",m.option=!!fe.lastChild;var ye={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function Ce(e,t){var n;return n=void 0!==e.getElementsByTagName?e.getElementsByTagName(t||"*"):void 0!==e.querySelectorAll?e.querySelectorAll(t||"*"):[],void 0===t||t&&O(e,t)?T.merge([e],n):n}function _e(e,t){for(var n=0,r=e.length;n<r;n++)J.set(e[n],"globalEval",!t||J.get(t[n],"globalEval"))}ye.tbody=ye.tfoot=ye.colgroup=ye.caption=ye.thead,ye.th=ye.td,m.option||(ye.optgroup=ye.option=[1,"<select multiple='multiple'>","</select>"]);var Ne=/<|&#?\w+;/;function be(e,t,n,r,i){for(var o,s,a,l,c,d,u=t.createDocumentFragment(),h=[],f=0,g=e.length;f<g;f++)if((o=e[f])||0===o)if("object"===b(o))T.merge(h,o.nodeType?[o]:o);else if(Ne.test(o)){for(s=s||u.appendChild(t.createElement("div")),a=(me.exec(o)||["",""])[1].toLowerCase(),l=ye[a]||ye._default,s.innerHTML=l[1]+T.htmlPrefilter(o)+l[2],d=l[0];d--;)s=s.lastChild;T.merge(h,s.childNodes),(s=u.firstChild).textContent=""}else h.push(t.createTextNode(o));for(u.textContent="",f=0;o=h[f++];)if(r&&T.inArray(o,r)>-1)i&&i.push(o);else if(c=se(o),s=Ce(u.appendChild(o),"script"),c&&_e(s),n)for(d=0;o=s[d++];)ve.test(o.type||"")&&n.push(o);return u}var Te=/^key/,Ee=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,ke=/^([^.]*)(?:\.(.+)|)/;function Se(){return!0}function xe(){return!1}function we(e,t){return e===function(){try{return C.activeElement}catch(e){}}()==("focus"===t)}function Oe(e,t,n,r,i,o){var s,a;if("object"==typeof t){for(a in"string"!=typeof n&&(r=r||n,n=void 0),t)Oe(e,a,n,r,t[a],o);return e}if(null==r&&null==i?(i=n,r=n=void 0):null==i&&("string"==typeof n?(i=r,r=void 0):(i=r,r=n,n=void 0)),!1===i)i=xe;else if(!i)return e;return 1===o&&(s=i,(i=function(e){return T().off(e),s.apply(this,arguments)}).guid=s.guid||(s.guid=T.guid++)),e.each((function(){T.event.add(this,t,i,r,n)}))}function Ae(e,t,n){n?(J.set(e,t,!1),T.event.add(e,t,{namespace:!1,handler:function(e){var r,i,o=J.get(this,t);if(1&e.isTrigger&&this[t]){if(o.length)(T.event.special[t]||{}).delegateType&&e.stopPropagation();else if(o=a.call(arguments),J.set(this,t,o),r=n(this,t),this[t](),o!==(i=J.get(this,t))||r?J.set(this,t,!1):i={},o!==i)return e.stopImmediatePropagation(),e.preventDefault(),i.value}else o.length&&(J.set(this,t,{value:T.event.trigger(T.extend(o[0],T.Event.prototype),o.slice(1),this)}),e.stopImmediatePropagation())}})):void 0===J.get(e,t)&&T.event.add(e,t,Se)}T.event={global:{},add:function(e,t,n,r,i){var o,s,a,l,c,d,u,h,f,g,p,m=J.get(e);if(Y(e))for(n.handler&&(n=(o=n).handler,i=o.selector),i&&T.find.matchesSelector(oe,i),n.guid||(n.guid=T.guid++),(l=m.events)||(l=m.events=Object.create(null)),(s=m.handle)||(s=m.handle=function(t){return void 0!==T&&T.event.triggered!==t.type?T.event.dispatch.apply(e,arguments):void 0}),c=(t=(t||"").match(B)||[""]).length;c--;)f=p=(a=ke.exec(t[c])||[])[1],g=(a[2]||"").split(".").sort(),f&&(u=T.event.special[f]||{},f=(i?u.delegateType:u.bindType)||f,u=T.event.special[f]||{},d=T.extend({type:f,origType:p,data:r,handler:n,guid:n.guid,selector:i,needsContext:i&&T.expr.match.needsContext.test(i),namespace:g.join(".")},o),(h=l[f])||((h=l[f]=[]).delegateCount=0,u.setup&&!1!==u.setup.call(e,r,g,s)||e.addEventListener&&e.addEventListener(f,s)),u.add&&(u.add.call(e,d),d.handler.guid||(d.handler.guid=n.guid)),i?h.splice(h.delegateCount++,0,d):h.push(d),T.event.global[f]=!0)},remove:function(e,t,n,r,i){var o,s,a,l,c,d,u,h,f,g,p,m=J.hasData(e)&&J.get(e);if(m&&(l=m.events)){for(c=(t=(t||"").match(B)||[""]).length;c--;)if(f=p=(a=ke.exec(t[c])||[])[1],g=(a[2]||"").split(".").sort(),f){for(u=T.event.special[f]||{},h=l[f=(r?u.delegateType:u.bindType)||f]||[],a=a[2]&&new RegExp("(^|\\.)"+g.join("\\.(?:.*\\.|)")+"(\\.|$)"),s=o=h.length;o--;)d=h[o],!i&&p!==d.origType||n&&n.guid!==d.guid||a&&!a.test(d.namespace)||r&&r!==d.selector&&("**"!==r||!d.selector)||(h.splice(o,1),d.selector&&h.delegateCount--,u.remove&&u.remove.call(e,d));s&&!h.length&&(u.teardown&&!1!==u.teardown.call(e,g,m.handle)||T.removeEvent(e,f,m.handle),delete l[f])}else for(f in l)T.event.remove(e,f+t[c],n,r,!0);T.isEmptyObject(l)&&J.remove(e,"handle events")}},dispatch:function(e){var t,n,r,i,o,s,a=new Array(arguments.length),l=T.event.fix(e),c=(J.get(this,"events")||Object.create(null))[l.type]||[],d=T.event.special[l.type]||{};for(a[0]=l,t=1;t<arguments.length;t++)a[t]=arguments[t];if(l.delegateTarget=this,!d.preDispatch||!1!==d.preDispatch.call(this,l)){for(s=T.event.handlers.call(this,l,c),t=0;(i=s[t++])&&!l.isPropagationStopped();)for(l.currentTarget=i.elem,n=0;(o=i.handlers[n++])&&!l.isImmediatePropagationStopped();)l.rnamespace&&!1!==o.namespace&&!l.rnamespace.test(o.namespace)||(l.handleObj=o,l.data=o.data,void 0!==(r=((T.event.special[o.origType]||{}).handle||o.handler).apply(i.elem,a))&&!1===(l.result=r)&&(l.preventDefault(),l.stopPropagation()));return d.postDispatch&&d.postDispatch.call(this,l),l.result}},handlers:function(e,t){var n,r,i,o,s,a=[],l=t.delegateCount,c=e.target;if(l&&c.nodeType&&!("click"===e.type&&e.button>=1))for(;c!==this;c=c.parentNode||this)if(1===c.nodeType&&("click"!==e.type||!0!==c.disabled)){for(o=[],s={},n=0;n<l;n++)void 0===s[i=(r=t[n]).selector+" "]&&(s[i]=r.needsContext?T(i,this).index(c)>-1:T.find(i,this,null,[c]).length),s[i]&&o.push(r);o.length&&a.push({elem:c,handlers:o})}return c=this,l<t.length&&a.push({elem:c,handlers:t.slice(l)}),a},addProp:function(e,t){Object.defineProperty(T.Event.prototype,e,{enumerable:!0,configurable:!0,get:v(t)?function(){if(this.originalEvent)return t(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[e]},set:function(t){Object.defineProperty(this,e,{enumerable:!0,configurable:!0,writable:!0,value:t})}})},fix:function(e){return e[T.expando]?e:new T.Event(e)},special:{load:{noBubble:!0},click:{setup:function(e){var t=this||e;return pe.test(t.type)&&t.click&&O(t,"input")&&Ae(t,"click",Se),!1},trigger:function(e){var t=this||e;return pe.test(t.type)&&t.click&&O(t,"input")&&Ae(t,"click"),!0},_default:function(e){var t=e.target;return pe.test(t.type)&&t.click&&O(t,"input")&&J.get(t,"click")||O(t,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}}},T.removeEvent=function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n)},T.Event=function(e,t){if(!(this instanceof T.Event))return new T.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&!1===e.returnValue?Se:xe,this.target=e.target&&3===e.target.nodeType?e.target.parentNode:e.target,this.currentTarget=e.currentTarget,this.relatedTarget=e.relatedTarget):this.type=e,t&&T.extend(this,t),this.timeStamp=e&&e.timeStamp||Date.now(),this[T.expando]=!0},T.Event.prototype={constructor:T.Event,isDefaultPrevented:xe,isPropagationStopped:xe,isImmediatePropagationStopped:xe,isSimulated:!1,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=Se,e&&!this.isSimulated&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=Se,e&&!this.isSimulated&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=Se,e&&!this.isSimulated&&e.stopImmediatePropagation(),this.stopPropagation()}},T.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:function(e){var t=e.button;return null==e.which&&Te.test(e.type)?null!=e.charCode?e.charCode:e.keyCode:!e.which&&void 0!==t&&Ee.test(e.type)?1&t?1:2&t?3:4&t?2:0:e.which}},T.event.addProp),T.each({focus:"focusin",blur:"focusout"},(function(e,t){T.event.special[e]={setup:function(){return Ae(this,e,we),!1},trigger:function(){return Ae(this,e),!0},delegateType:t}})),T.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},(function(e,t){T.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,r=this,i=e.relatedTarget,o=e.handleObj;return i&&(i===r||T.contains(r,i))||(e.type=o.origType,n=o.handler.apply(this,arguments),e.type=t),n}}})),T.fn.extend({on:function(e,t,n,r){return Oe(this,e,t,n,r)},one:function(e,t,n,r){return Oe(this,e,t,n,r,1)},off:function(e,t,n){var r,i;if(e&&e.preventDefault&&e.handleObj)return r=e.handleObj,T(e.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if("object"==typeof e){for(i in e)this.off(i,t,e[i]);return this}return!1!==t&&"function"!=typeof t||(n=t,t=void 0),!1===n&&(n=xe),this.each((function(){T.event.remove(this,e,n,t)}))}});var Re=/<script|<style|<link/i,Ie=/checked\s*(?:[^=]|=\s*.checked.)/i,Le=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;function De(e,t){return O(e,"table")&&O(11!==t.nodeType?t:t.firstChild,"tr")&&T(e).children("tbody")[0]||e}function Pe(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function Me(e){return"true/"===(e.type||"").slice(0,5)?e.type=e.type.slice(5):e.removeAttribute("type"),e}function Be(e,t){var n,r,i,o,s,a;if(1===t.nodeType){if(J.hasData(e)&&(a=J.get(e).events))for(i in J.remove(t,"handle events"),a)for(n=0,r=a[i].length;n<r;n++)T.event.add(t,i,a[i][n]);Q.hasData(e)&&(o=Q.access(e),s=T.extend({},o),Q.set(t,s))}}function Fe(e,t){var n=t.nodeName.toLowerCase();"input"===n&&pe.test(e.type)?t.checked=e.checked:"input"!==n&&"textarea"!==n||(t.defaultValue=e.defaultValue)}function je(e,t,n,r){t=l(t);var i,o,s,a,c,d,u=0,h=e.length,f=h-1,g=t[0],p=v(g);if(p||h>1&&"string"==typeof g&&!m.checkClone&&Ie.test(g))return e.each((function(i){var o=e.eq(i);p&&(t[0]=g.call(this,i,o.html())),je(o,t,n,r)}));if(h&&(o=(i=be(t,e[0].ownerDocument,!1,e,r)).firstChild,1===i.childNodes.length&&(i=o),o||r)){for(a=(s=T.map(Ce(i,"script"),Pe)).length;u<h;u++)c=i,u!==f&&(c=T.clone(c,!0,!0),a&&T.merge(s,Ce(c,"script"))),n.call(e[u],c,u);if(a)for(d=s[s.length-1].ownerDocument,T.map(s,Me),u=0;u<a;u++)c=s[u],ve.test(c.type||"")&&!J.access(c,"globalEval")&&T.contains(d,c)&&(c.src&&"module"!==(c.type||"").toLowerCase()?T._evalUrl&&!c.noModule&&T._evalUrl(c.src,{nonce:c.nonce||c.getAttribute("nonce")},d):N(c.textContent.replace(Le,""),c,d))}return e}function Ue(e,t,n){for(var r,i=t?T.filter(t,e):e,o=0;null!=(r=i[o]);o++)n||1!==r.nodeType||T.cleanData(Ce(r)),r.parentNode&&(n&&se(r)&&_e(Ce(r,"script")),r.parentNode.removeChild(r));return e}T.extend({htmlPrefilter:function(e){return e},clone:function(e,t,n){var r,i,o,s,a=e.cloneNode(!0),l=se(e);if(!(m.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||T.isXMLDoc(e)))for(s=Ce(a),r=0,i=(o=Ce(e)).length;r<i;r++)Fe(o[r],s[r]);if(t)if(n)for(o=o||Ce(e),s=s||Ce(a),r=0,i=o.length;r<i;r++)Be(o[r],s[r]);else Be(e,a);return(s=Ce(a,"script")).length>0&&_e(s,!l&&Ce(e,"script")),a},cleanData:function(e){for(var t,n,r,i=T.event.special,o=0;void 0!==(n=e[o]);o++)if(Y(n)){if(t=n[J.expando]){if(t.events)for(r in t.events)i[r]?T.event.remove(n,r):T.removeEvent(n,r,t.handle);n[J.expando]=void 0}n[Q.expando]&&(n[Q.expando]=void 0)}}}),T.fn.extend({detach:function(e){return Ue(this,e,!0)},remove:function(e){return Ue(this,e)},text:function(e){return W(this,(function(e){return void 0===e?T.text(this):this.empty().each((function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=e)}))}),null,e,arguments.length)},append:function(){return je(this,arguments,(function(e){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||De(this,e).appendChild(e)}))},prepend:function(){return je(this,arguments,(function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=De(this,e);t.insertBefore(e,t.firstChild)}}))},before:function(){return je(this,arguments,(function(e){this.parentNode&&this.parentNode.insertBefore(e,this)}))},after:function(){return je(this,arguments,(function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)}))},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(T.cleanData(Ce(e,!1)),e.textContent="");return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map((function(){return T.clone(this,e,t)}))},html:function(e){return W(this,(function(e){var t=this[0]||{},n=0,r=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!Re.test(e)&&!ye[(me.exec(e)||["",""])[1].toLowerCase()]){e=T.htmlPrefilter(e);try{for(;n<r;n++)1===(t=this[n]||{}).nodeType&&(T.cleanData(Ce(t,!1)),t.innerHTML=e);t=0}catch(e){}}t&&this.empty().append(e)}),null,e,arguments.length)},replaceWith:function(){var e=[];return je(this,arguments,(function(t){var n=this.parentNode;T.inArray(this,e)<0&&(T.cleanData(Ce(this)),n&&n.replaceChild(t,this))}),e)}}),T.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},(function(e,t){T.fn[e]=function(e){for(var n,r=[],i=T(e),o=i.length-1,s=0;s<=o;s++)n=s===o?this:this.clone(!0),T(i[s])[t](n),c.apply(r,n.get());return this.pushStack(r)}}));var He=new RegExp("^("+ne+")(?!px)[a-z%]+$","i"),$e=function(e){var n=e.ownerDocument.defaultView;return n&&n.opener||(n=t),n.getComputedStyle(e)},qe=function(e,t,n){var r,i,o={};for(i in t)o[i]=e.style[i],e.style[i]=t[i];for(i in r=n.call(e),t)e.style[i]=o[i];return r},We=new RegExp(ie.join("|"),"i");function Ge(e,t,n){var r,i,o,s,a=e.style;return(n=n||$e(e))&&(""!==(s=n.getPropertyValue(t)||n[t])||se(e)||(s=T.style(e,t)),!m.pixelBoxStyles()&&He.test(s)&&We.test(t)&&(r=a.width,i=a.minWidth,o=a.maxWidth,a.minWidth=a.maxWidth=a.width=s,s=n.width,a.width=r,a.minWidth=i,a.maxWidth=o)),void 0!==s?s+"":s}function ze(e,t){return{get:function(){if(!e())return(this.get=t).apply(this,arguments);delete this.get}}}!function(){function e(){if(d){c.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",d.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",oe.appendChild(c).appendChild(d);var e=t.getComputedStyle(d);r="1%"!==e.top,l=12===n(e.marginLeft),d.style.right="60%",s=36===n(e.right),i=36===n(e.width),d.style.position="absolute",o=12===n(d.offsetWidth/3),oe.removeChild(c),d=null}}function n(e){return Math.round(parseFloat(e))}var r,i,o,s,a,l,c=C.createElement("div"),d=C.createElement("div");d.style&&(d.style.backgroundClip="content-box",d.cloneNode(!0).style.backgroundClip="",m.clearCloneStyle="content-box"===d.style.backgroundClip,T.extend(m,{boxSizingReliable:function(){return e(),i},pixelBoxStyles:function(){return e(),s},pixelPosition:function(){return e(),r},reliableMarginLeft:function(){return e(),l},scrollboxSize:function(){return e(),o},reliableTrDimensions:function(){var e,n,r,i;return null==a&&(e=C.createElement("table"),n=C.createElement("tr"),r=C.createElement("div"),e.style.cssText="position:absolute;left:-11111px",n.style.height="1px",r.style.height="9px",oe.appendChild(e).appendChild(n).appendChild(r),i=t.getComputedStyle(n),a=parseInt(i.height)>3,oe.removeChild(e)),a}}))}();var Ve=["Webkit","Moz","ms"],Ke=C.createElement("div").style,Ye={};function Xe(e){var t=T.cssProps[e]||Ye[e];return t||(e in Ke?e:Ye[e]=function(e){for(var t=e[0].toUpperCase()+e.slice(1),n=Ve.length;n--;)if((e=Ve[n]+t)in Ke)return e}(e)||e)}var Je=/^(none|table(?!-c[ea]).+)/,Qe=/^--/,Ze={position:"absolute",visibility:"hidden",display:"block"},et={letterSpacing:"0",fontWeight:"400"};function tt(e,t,n){var r=re.exec(t);return r?Math.max(0,r[2]-(n||0))+(r[3]||"px"):t}function nt(e,t,n,r,i,o){var s="width"===t?1:0,a=0,l=0;if(n===(r?"border":"content"))return 0;for(;s<4;s+=2)"margin"===n&&(l+=T.css(e,n+ie[s],!0,i)),r?("content"===n&&(l-=T.css(e,"padding"+ie[s],!0,i)),"margin"!==n&&(l-=T.css(e,"border"+ie[s]+"Width",!0,i))):(l+=T.css(e,"padding"+ie[s],!0,i),"padding"!==n?l+=T.css(e,"border"+ie[s]+"Width",!0,i):a+=T.css(e,"border"+ie[s]+"Width",!0,i));return!r&&o>=0&&(l+=Math.max(0,Math.ceil(e["offset"+t[0].toUpperCase()+t.slice(1)]-o-l-a-.5))||0),l}function rt(e,t,n){var r=$e(e),i=(!m.boxSizingReliable()||n)&&"border-box"===T.css(e,"boxSizing",!1,r),o=i,s=Ge(e,t,r),a="offset"+t[0].toUpperCase()+t.slice(1);if(He.test(s)){if(!n)return s;s="auto"}return(!m.boxSizingReliable()&&i||!m.reliableTrDimensions()&&O(e,"tr")||"auto"===s||!parseFloat(s)&&"inline"===T.css(e,"display",!1,r))&&e.getClientRects().length&&(i="border-box"===T.css(e,"boxSizing",!1,r),(o=a in e)&&(s=e[a])),(s=parseFloat(s)||0)+nt(e,t,n||(i?"border":"content"),o,r,s)+"px"}T.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=Ge(e,"opacity");return""===n?"1":n}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{},style:function(e,t,n,r){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var i,o,s,a=K(t),l=Qe.test(t),c=e.style;if(l||(t=Xe(a)),s=T.cssHooks[t]||T.cssHooks[a],void 0===n)return s&&"get"in s&&void 0!==(i=s.get(e,!1,r))?i:c[t];"string"===(o=typeof n)&&(i=re.exec(n))&&i[1]&&(n=ce(e,t,i),o="number"),null!=n&&n==n&&("number"!==o||l||(n+=i&&i[3]||(T.cssNumber[a]?"":"px")),m.clearCloneStyle||""!==n||0!==t.indexOf("background")||(c[t]="inherit"),s&&"set"in s&&void 0===(n=s.set(e,n,r))||(l?c.setProperty(t,n):c[t]=n))}},css:function(e,t,n,r){var i,o,s,a=K(t);return Qe.test(t)||(t=Xe(a)),(s=T.cssHooks[t]||T.cssHooks[a])&&"get"in s&&(i=s.get(e,!0,n)),void 0===i&&(i=Ge(e,t,r)),"normal"===i&&t in et&&(i=et[t]),""===n||n?(o=parseFloat(i),!0===n||isFinite(o)?o||0:i):i}}),T.each(["height","width"],(function(e,t){T.cssHooks[t]={get:function(e,n,r){if(n)return!Je.test(T.css(e,"display"))||e.getClientRects().length&&e.getBoundingClientRect().width?rt(e,t,r):qe(e,Ze,(function(){return rt(e,t,r)}))},set:function(e,n,r){var i,o=$e(e),s=!m.scrollboxSize()&&"absolute"===o.position,a=(s||r)&&"border-box"===T.css(e,"boxSizing",!1,o),l=r?nt(e,t,r,a,o):0;return a&&s&&(l-=Math.ceil(e["offset"+t[0].toUpperCase()+t.slice(1)]-parseFloat(o[t])-nt(e,t,"border",!1,o)-.5)),l&&(i=re.exec(n))&&"px"!==(i[3]||"px")&&(e.style[t]=n,n=T.css(e,t)),tt(0,n,l)}}})),T.cssHooks.marginLeft=ze(m.reliableMarginLeft,(function(e,t){if(t)return(parseFloat(Ge(e,"marginLeft"))||e.getBoundingClientRect().left-qe(e,{marginLeft:0},(function(){return e.getBoundingClientRect().left})))+"px"})),T.each({margin:"",padding:"",border:"Width"},(function(e,t){T.cssHooks[e+t]={expand:function(n){for(var r=0,i={},o="string"==typeof n?n.split(" "):[n];r<4;r++)i[e+ie[r]+t]=o[r]||o[r-2]||o[0];return i}},"margin"!==e&&(T.cssHooks[e+t].set=tt)})),T.fn.extend({css:function(e,t){return W(this,(function(e,t,n){var r,i,o={},s=0;if(Array.isArray(t)){for(r=$e(e),i=t.length;s<i;s++)o[t[s]]=T.css(e,t[s],!1,r);return o}return void 0!==n?T.style(e,t,n):T.css(e,t)}),e,t,arguments.length>1)}}),T.fn.delay=function(e,n){return e=T.fx&&T.fx.speeds[e]||e,n=n||"fx",this.queue(n,(function(n,r){var i=t.setTimeout(n,e);r.stop=function(){t.clearTimeout(i)}}))},function(){var e=C.createElement("input"),t=C.createElement("select").appendChild(C.createElement("option"));e.type="checkbox",m.checkOn=""!==e.value,m.optSelected=t.selected,(e=C.createElement("input")).value="t",e.type="radio",m.radioValue="t"===e.value}();var it,ot=T.expr.attrHandle;T.fn.extend({attr:function(e,t){return W(this,T.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each((function(){T.removeAttr(this,e)}))}}),T.extend({attr:function(e,t,n){var r,i,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return void 0===e.getAttribute?T.prop(e,t,n):(1===o&&T.isXMLDoc(e)||(i=T.attrHooks[t.toLowerCase()]||(T.expr.match.bool.test(t)?it:void 0)),void 0!==n?null===n?void T.removeAttr(e,t):i&&"set"in i&&void 0!==(r=i.set(e,n,t))?r:(e.setAttribute(t,n+""),n):i&&"get"in i&&null!==(r=i.get(e,t))?r:null==(r=T.find.attr(e,t))?void 0:r)},attrHooks:{type:{set:function(e,t){if(!m.radioValue&&"radio"===t&&O(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},removeAttr:function(e,t){var n,r=0,i=t&&t.match(B);if(i&&1===e.nodeType)for(;n=i[r++];)e.removeAttribute(n)}}),it={set:function(e,t,n){return!1===t?T.removeAttr(e,n):e.setAttribute(n,n),n}},T.each(T.expr.match.bool.source.match(/\w+/g),(function(e,t){var n=ot[t]||T.find.attr;ot[t]=function(e,t,r){var i,o,s=t.toLowerCase();return r||(o=ot[s],ot[s]=i,i=null!=n(e,t,r)?s:null,ot[s]=o),i}}));var st=/^(?:input|select|textarea|button)$/i,at=/^(?:a|area)$/i;function lt(e){return(e.match(B)||[]).join(" ")}function ct(e){return e.getAttribute&&e.getAttribute("class")||""}function dt(e){return Array.isArray(e)?e:"string"==typeof e&&e.match(B)||[]}T.fn.extend({prop:function(e,t){return W(this,T.prop,e,t,arguments.length>1)},removeProp:function(e){return this.each((function(){delete this[T.propFix[e]||e]}))}}),T.extend({prop:function(e,t,n){var r,i,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return 1===o&&T.isXMLDoc(e)||(t=T.propFix[t]||t,i=T.propHooks[t]),void 0!==n?i&&"set"in i&&void 0!==(r=i.set(e,n,t))?r:e[t]=n:i&&"get"in i&&null!==(r=i.get(e,t))?r:e[t]},propHooks:{tabIndex:{get:function(e){var t=T.find.attr(e,"tabindex");return t?parseInt(t,10):st.test(e.nodeName)||at.test(e.nodeName)&&e.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),m.optSelected||(T.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null},set:function(e){var t=e.parentNode;t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex)}}),T.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],(function(){T.propFix[this.toLowerCase()]=this})),T.fn.extend({addClass:function(e){var t,n,r,i,o,s,a,l=0;if(v(e))return this.each((function(t){T(this).addClass(e.call(this,t,ct(this)))}));if((t=dt(e)).length)for(;n=this[l++];)if(i=ct(n),r=1===n.nodeType&&" "+lt(i)+" "){for(s=0;o=t[s++];)r.indexOf(" "+o+" ")<0&&(r+=o+" ");i!==(a=lt(r))&&n.setAttribute("class",a)}return this},removeClass:function(e){var t,n,r,i,o,s,a,l=0;if(v(e))return this.each((function(t){T(this).removeClass(e.call(this,t,ct(this)))}));if(!arguments.length)return this.attr("class","");if((t=dt(e)).length)for(;n=this[l++];)if(i=ct(n),r=1===n.nodeType&&" "+lt(i)+" "){for(s=0;o=t[s++];)for(;r.indexOf(" "+o+" ")>-1;)r=r.replace(" "+o+" "," ");i!==(a=lt(r))&&n.setAttribute("class",a)}return this},toggleClass:function(e,t){var n=typeof e,r="string"===n||Array.isArray(e);return"boolean"==typeof t&&r?t?this.addClass(e):this.removeClass(e):v(e)?this.each((function(n){T(this).toggleClass(e.call(this,n,ct(this),t),t)})):this.each((function(){var t,i,o,s;if(r)for(i=0,o=T(this),s=dt(e);t=s[i++];)o.hasClass(t)?o.removeClass(t):o.addClass(t);else void 0!==e&&"boolean"!==n||((t=ct(this))&&J.set(this,"__className__",t),this.setAttribute&&this.setAttribute("class",t||!1===e?"":J.get(this,"__className__")||""))}))},hasClass:function(e){var t,n,r=0;for(t=" "+e+" ";n=this[r++];)if(1===n.nodeType&&(" "+lt(ct(n))+" ").indexOf(t)>-1)return!0;return!1}});var ut=/\r/g;T.fn.extend({val:function(e){var t,n,r,i=this[0];return arguments.length?(r=v(e),this.each((function(n){var i;1===this.nodeType&&(null==(i=r?e.call(this,n,T(this).val()):e)?i="":"number"==typeof i?i+="":Array.isArray(i)&&(i=T.map(i,(function(e){return null==e?"":e+""}))),(t=T.valHooks[this.type]||T.valHooks[this.nodeName.toLowerCase()])&&"set"in t&&void 0!==t.set(this,i,"value")||(this.value=i))}))):i?(t=T.valHooks[i.type]||T.valHooks[i.nodeName.toLowerCase()])&&"get"in t&&void 0!==(n=t.get(i,"value"))?n:"string"==typeof(n=i.value)?n.replace(ut,""):null==n?"":n:void 0}}),T.extend({valHooks:{option:{get:function(e){var t=T.find.attr(e,"value");return null!=t?t:lt(T.text(e))}},select:{get:function(e){var t,n,r,i=e.options,o=e.selectedIndex,s="select-one"===e.type,a=s?null:[],l=s?o+1:i.length;for(r=o<0?l:s?o:0;r<l;r++)if(((n=i[r]).selected||r===o)&&!n.disabled&&(!n.parentNode.disabled||!O(n.parentNode,"optgroup"))){if(t=T(n).val(),s)return t;a.push(t)}return a},set:function(e,t){for(var n,r,i=e.options,o=T.makeArray(t),s=i.length;s--;)((r=i[s]).selected=T.inArray(T.valHooks.option.get(r),o)>-1)&&(n=!0);return n||(e.selectedIndex=-1),o}}}}),T.each(["radio","checkbox"],(function(){T.valHooks[this]={set:function(e,t){if(Array.isArray(t))return e.checked=T.inArray(T(e).val(),t)>-1}},m.checkOn||(T.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})})),m.focusin="onfocusin"in t;var ht=/^(?:focusinfocus|focusoutblur)$/,ft=function(e){e.stopPropagation()};T.extend(T.event,{trigger:function(e,n,r,i){var o,s,a,l,c,d,u,h,g=[r||C],p=f.call(e,"type")?e.type:e,m=f.call(e,"namespace")?e.namespace.split("."):[];if(s=h=a=r=r||C,3!==r.nodeType&&8!==r.nodeType&&!ht.test(p+T.event.triggered)&&(p.indexOf(".")>-1&&(m=p.split("."),p=m.shift(),m.sort()),c=p.indexOf(":")<0&&"on"+p,(e=e[T.expando]?e:new T.Event(p,"object"==typeof e&&e)).isTrigger=i?2:3,e.namespace=m.join("."),e.rnamespace=e.namespace?new RegExp("(^|\\.)"+m.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=void 0,e.target||(e.target=r),n=null==n?[e]:T.makeArray(n,[e]),u=T.event.special[p]||{},i||!u.trigger||!1!==u.trigger.apply(r,n))){if(!i&&!u.noBubble&&!y(r)){for(l=u.delegateType||p,ht.test(l+p)||(s=s.parentNode);s;s=s.parentNode)g.push(s),a=s;a===(r.ownerDocument||C)&&g.push(a.defaultView||a.parentWindow||t)}for(o=0;(s=g[o++])&&!e.isPropagationStopped();)h=s,e.type=o>1?l:u.bindType||p,(d=(J.get(s,"events")||Object.create(null))[e.type]&&J.get(s,"handle"))&&d.apply(s,n),(d=c&&s[c])&&d.apply&&Y(s)&&(e.result=d.apply(s,n),!1===e.result&&e.preventDefault());return e.type=p,i||e.isDefaultPrevented()||u._default&&!1!==u._default.apply(g.pop(),n)||!Y(r)||c&&v(r[p])&&!y(r)&&((a=r[c])&&(r[c]=null),T.event.triggered=p,e.isPropagationStopped()&&h.addEventListener(p,ft),r[p](),e.isPropagationStopped()&&h.removeEventListener(p,ft),T.event.triggered=void 0,a&&(r[c]=a)),e.result}},simulate:function(e,t,n){var r=T.extend(new T.Event,n,{type:e,isSimulated:!0});T.event.trigger(r,null,t)}}),T.fn.extend({trigger:function(e,t){return this.each((function(){T.event.trigger(e,t,this)}))},triggerHandler:function(e,t){var n=this[0];if(n)return T.event.trigger(e,t,n,!0)}}),m.focusin||T.each({focus:"focusin",blur:"focusout"},(function(e,t){var n=function(e){T.event.simulate(t,e.target,T.event.fix(e))};T.event.special[t]={setup:function(){var r=this.ownerDocument||this.document||this,i=J.access(r,t);i||r.addEventListener(e,n,!0),J.access(r,t,(i||0)+1)},teardown:function(){var r=this.ownerDocument||this.document||this,i=J.access(r,t)-1;i?J.access(r,t,i):(r.removeEventListener(e,n,!0),J.remove(r,t))}}})),T.parseXML=function(e){var n;if(!e||"string"!=typeof e)return null;try{n=(new t.DOMParser).parseFromString(e,"text/xml")}catch(e){n=void 0}return n&&!n.getElementsByTagName("parsererror").length||T.error("Invalid XML: "+e),n};var gt,pt=/\[\]$/,mt=/\r?\n/g,vt=/^(?:submit|button|image|reset|file)$/i,yt=/^(?:input|select|textarea|keygen)/i;function Ct(e,t,n,r){var i;if(Array.isArray(t))T.each(t,(function(t,i){n||pt.test(e)?r(e,i):Ct(e+"["+("object"==typeof i&&null!=i?t:"")+"]",i,n,r)}));else if(n||"object"!==b(t))r(e,t);else for(i in t)Ct(e+"["+i+"]",t[i],n,r)}T.param=function(e,t){var n,r=[],i=function(e,t){var n=v(t)?t():t;r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(null==n?"":n)};if(null==e)return"";if(Array.isArray(e)||e.jquery&&!T.isPlainObject(e))T.each(e,(function(){i(this.name,this.value)}));else for(n in e)Ct(n,e[n],t,i);return r.join("&")},T.fn.extend({serialize:function(){return T.param(this.serializeArray())},serializeArray:function(){return this.map((function(){var e=T.prop(this,"elements");return e?T.makeArray(e):this})).filter((function(){var e=this.type;return this.name&&!T(this).is(":disabled")&&yt.test(this.nodeName)&&!vt.test(e)&&(this.checked||!pe.test(e))})).map((function(e,t){var n=T(this).val();return null==n?null:Array.isArray(n)?T.map(n,(function(e){return{name:t.name,value:e.replace(mt,"\r\n")}})):{name:t.name,value:n.replace(mt,"\r\n")}})).get()}}),T.fn.extend({wrapAll:function(e){var t;return this[0]&&(v(e)&&(e=e.call(this[0])),t=T(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map((function(){for(var e=this;e.firstElementChild;)e=e.firstElementChild;return e})).append(this)),this},wrapInner:function(e){return v(e)?this.each((function(t){T(this).wrapInner(e.call(this,t))})):this.each((function(){var t=T(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)}))},wrap:function(e){var t=v(e);return this.each((function(n){T(this).wrapAll(t?e.call(this,n):e)}))},unwrap:function(e){return this.parent(e).not("body").each((function(){T(this).replaceWith(this.childNodes)})),this}}),T.expr.pseudos.hidden=function(e){return!T.expr.pseudos.visible(e)},T.expr.pseudos.visible=function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)},m.createHTMLDocument=((gt=C.implementation.createHTMLDocument("").body).innerHTML="<form></form><form></form>",2===gt.childNodes.length),T.parseHTML=function(e,t,n){return"string"!=typeof e?[]:("boolean"==typeof t&&(n=t,t=!1),t||(m.createHTMLDocument?((r=(t=C.implementation.createHTMLDocument("")).createElement("base")).href=C.location.href,t.head.appendChild(r)):t=C),o=!n&&[],(i=A.exec(e))?[t.createElement(i[1])]:(i=be([e],t,o),o&&o.length&&T(o).remove(),T.merge([],i.childNodes)));var r,i,o},T.offset={setOffset:function(e,t,n){var r,i,o,s,a,l,c=T.css(e,"position"),d=T(e),u={};"static"===c&&(e.style.position="relative"),a=d.offset(),o=T.css(e,"top"),l=T.css(e,"left"),("absolute"===c||"fixed"===c)&&(o+l).indexOf("auto")>-1?(s=(r=d.position()).top,i=r.left):(s=parseFloat(o)||0,i=parseFloat(l)||0),v(t)&&(t=t.call(e,n,T.extend({},a))),null!=t.top&&(u.top=t.top-a.top+s),null!=t.left&&(u.left=t.left-a.left+i),"using"in t?t.using.call(e,u):("number"==typeof u.top&&(u.top+="px"),"number"==typeof u.left&&(u.left+="px"),d.css(u))}},T.fn.extend({offset:function(e){if(arguments.length)return void 0===e?this:this.each((function(t){T.offset.setOffset(this,e,t)}));var t,n,r=this[0];return r?r.getClientRects().length?(t=r.getBoundingClientRect(),n=r.ownerDocument.defaultView,{top:t.top+n.pageYOffset,left:t.left+n.pageXOffset}):{top:0,left:0}:void 0},position:function(){if(this[0]){var e,t,n,r=this[0],i={top:0,left:0};if("fixed"===T.css(r,"position"))t=r.getBoundingClientRect();else{for(t=this.offset(),n=r.ownerDocument,e=r.offsetParent||n.documentElement;e&&(e===n.body||e===n.documentElement)&&"static"===T.css(e,"position");)e=e.parentNode;e&&e!==r&&1===e.nodeType&&((i=T(e).offset()).top+=T.css(e,"borderTopWidth",!0),i.left+=T.css(e,"borderLeftWidth",!0))}return{top:t.top-i.top-T.css(r,"marginTop",!0),left:t.left-i.left-T.css(r,"marginLeft",!0)}}},offsetParent:function(){return this.map((function(){for(var e=this.offsetParent;e&&"static"===T.css(e,"position");)e=e.offsetParent;return e||oe}))}}),T.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},(function(e,t){var n="pageYOffset"===t;T.fn[e]=function(r){return W(this,(function(e,r,i){var o;if(y(e)?o=e:9===e.nodeType&&(o=e.defaultView),void 0===i)return o?o[t]:e[r];o?o.scrollTo(n?o.pageXOffset:i,n?i:o.pageYOffset):e[r]=i}),e,r,arguments.length)}})),T.each(["top","left"],(function(e,t){T.cssHooks[t]=ze(m.pixelPosition,(function(e,n){if(n)return n=Ge(e,t),He.test(n)?T(e).position()[t]+"px":n}))})),T.each({Height:"height",Width:"width"},(function(e,t){T.each({padding:"inner"+e,content:t,"":"outer"+e},(function(n,r){T.fn[r]=function(i,o){var s=arguments.length&&(n||"boolean"!=typeof i),a=n||(!0===i||!0===o?"margin":"border");return W(this,(function(t,n,i){var o;return y(t)?0===r.indexOf("outer")?t["inner"+e]:t.document.documentElement["client"+e]:9===t.nodeType?(o=t.documentElement,Math.max(t.body["scroll"+e],o["scroll"+e],t.body["offset"+e],o["offset"+e],o["client"+e])):void 0===i?T.css(t,n,a):T.style(t,n,i,a)}),t,s?i:void 0,s)}}))})),T.fn.extend({bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)},hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),T.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),(function(e,t){T.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)}}));var _t=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;T.proxy=function(e,t){var n,r,i;if("string"==typeof t&&(n=e[t],t=e,e=n),v(e))return r=a.call(arguments,2),(i=function(){return e.apply(t||this,r.concat(a.call(arguments)))}).guid=e.guid=e.guid||T.guid++,i},T.holdReady=function(e){e?T.readyWait++:T.ready(!0)},T.isArray=Array.isArray,T.parseJSON=JSON.parse,T.nodeName=O,T.isFunction=v,T.isWindow=y,T.camelCase=K,T.type=b,T.now=Date.now,T.isNumeric=function(e){var t=T.type(e);return("number"===t||"string"===t)&&!isNaN(e-parseFloat(e))},T.trim=function(e){return null==e?"":(e+"").replace(_t,"")},void 0===(r=function(){return T}.apply(s,[]))||(e.exports=r);var Nt=t.jQuery,bt=t.$;T.noConflict=function(e){return t.$===T&&(t.$=bt),e&&t.jQuery===T&&(t.jQuery=Nt),T};var Tt,Et,kt=/^(?:toggle|show|hide)$/,St=/queueHooks$/;function xt(){Et&&(!1===C.hidden&&t.requestAnimationFrame?t.requestAnimationFrame(xt):t.setTimeout(xt,T.fx.interval),T.fx.tick())}function wt(){return t.setTimeout((function(){Tt=void 0})),Tt=Date.now()}function Ot(e,t){var n,r=0,i={height:e};for(t=t?1:0;r<4;r+=2-t)i["margin"+(n=ie[r])]=i["padding"+n]=e;return t&&(i.opacity=i.width=e),i}function At(e,t,n,r,i){return new At.prototype.init(e,t,n,r,i)}function Rt(e,t,n){for(var r,i=(It.tweeners[t]||[]).concat(It.tweeners["*"]),o=0,s=i.length;o<s;o++)if(r=i[o].call(n,t,e))return r}function It(e,t,n){var r,i,o=0,s=It.prefilters.length,a=T.Deferred().always((function(){delete l.elem})),l=function(){if(i)return!1;for(var t=Tt||wt(),n=Math.max(0,c.startTime+c.duration-t),r=1-(n/c.duration||0),o=0,s=c.tweens.length;o<s;o++)c.tweens[o].run(r);return a.notifyWith(e,[c,r,n]),r<1&&s?n:(s||a.notifyWith(e,[c,1,0]),a.resolveWith(e,[c]),!1)},c=a.promise({elem:e,props:T.extend({},t),opts:T.extend(!0,{specialEasing:{},easing:T.easing._default},n),originalProperties:t,originalOptions:n,startTime:Tt||wt(),duration:n.duration,tweens:[],createTween:function(t,n){var r=T.Tween(e,c.opts,t,n,c.opts.specialEasing[t]||c.opts.easing);return c.tweens.push(r),r},stop:function(t){var n=0,r=t?c.tweens.length:0;if(i)return this;for(i=!0;n<r;n++)c.tweens[n].run(1);return t?(a.notifyWith(e,[c,1,0]),a.resolveWith(e,[c,t])):a.rejectWith(e,[c,t]),this}}),d=c.props;for(!function(e,t){var n,r,i,o,s;for(n in e)if(i=t[r=K(n)],o=e[n],Array.isArray(o)&&(i=o[1],o=e[n]=o[0]),n!==r&&(e[r]=o,delete e[n]),(s=T.cssHooks[r])&&"expand"in s)for(n in o=s.expand(o),delete e[r],o)n in e||(e[n]=o[n],t[n]=i);else t[r]=i}(d,c.opts.specialEasing);o<s;o++)if(r=It.prefilters[o].call(c,e,d,c.opts))return v(r.stop)&&(T._queueHooks(c.elem,c.opts.queue).stop=r.stop.bind(r)),r;return T.map(d,Rt,c),v(c.opts.start)&&c.opts.start.call(e,c),c.progress(c.opts.progress).done(c.opts.done,c.opts.complete).fail(c.opts.fail).always(c.opts.always),T.fx.timer(T.extend(l,{elem:e,anim:c,queue:c.opts.queue})),c}return T.Tween=At,At.prototype={constructor:At,init:function(e,t,n,r,i,o){this.elem=e,this.prop=n,this.easing=i||T.easing._default,this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=o||(T.cssNumber[n]?"":"px")},cur:function(){var e=At.propHooks[this.prop];return e&&e.get?e.get(this):At.propHooks._default.get(this)},run:function(e){var t,n=At.propHooks[this.prop];return this.options.duration?this.pos=t=T.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):At.propHooks._default.set(this),this}},At.prototype.init.prototype=At.prototype,At.propHooks={_default:{get:function(e){var t;return 1!==e.elem.nodeType||null!=e.elem[e.prop]&&null==e.elem.style[e.prop]?e.elem[e.prop]:(t=T.css(e.elem,e.prop,""))&&"auto"!==t?t:0},set:function(e){T.fx.step[e.prop]?T.fx.step[e.prop](e):1!==e.elem.nodeType||!T.cssHooks[e.prop]&&null==e.elem.style[Xe(e.prop)]?e.elem[e.prop]=e.now:T.style(e.elem,e.prop,e.now+e.unit)}}},At.propHooks.scrollTop=At.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},T.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2},_default:"swing"},T.fx=At.prototype.init,T.fx.step={},T.Animation=T.extend(It,{tweeners:{"*":[function(e,t){var n=this.createTween(e,t);return ce(n.elem,e,re.exec(t),n),n}]},tweener:function(e,t){v(e)?(t=e,e=["*"]):e=e.match(B);for(var n,r=0,i=e.length;r<i;r++)n=e[r],It.tweeners[n]=It.tweeners[n]||[],It.tweeners[n].unshift(t)},prefilters:[function(e,t,n){var r,i,o,s,a,l,c,d,u="width"in t||"height"in t,h=this,f={},g=e.style,p=e.nodeType&&le(e),m=J.get(e,"fxshow");for(r in n.queue||(null==(s=T._queueHooks(e,"fx")).unqueued&&(s.unqueued=0,a=s.empty.fire,s.empty.fire=function(){s.unqueued||a()}),s.unqueued++,h.always((function(){h.always((function(){s.unqueued--,T.queue(e,"fx").length||s.empty.fire()}))}))),t)if(i=t[r],kt.test(i)){if(delete t[r],o=o||"toggle"===i,i===(p?"hide":"show")){if("show"!==i||!m||void 0===m[r])continue;p=!0}f[r]=m&&m[r]||T.style(e,r)}if((l=!T.isEmptyObject(t))||!T.isEmptyObject(f))for(r in u&&1===e.nodeType&&(n.overflow=[g.overflow,g.overflowX,g.overflowY],null==(c=m&&m.display)&&(c=J.get(e,"display")),"none"===(d=T.css(e,"display"))&&(c?d=c:(he([e],!0),c=e.style.display||c,d=T.css(e,"display"),he([e]))),("inline"===d||"inline-block"===d&&null!=c)&&"none"===T.css(e,"float")&&(l||(h.done((function(){g.display=c})),null==c&&(d=g.display,c="none"===d?"":d)),g.display="inline-block")),n.overflow&&(g.overflow="hidden",h.always((function(){g.overflow=n.overflow[0],g.overflowX=n.overflow[1],g.overflowY=n.overflow[2]}))),l=!1,f)l||(m?"hidden"in m&&(p=m.hidden):m=J.access(e,"fxshow",{display:c}),o&&(m.hidden=!p),p&&he([e],!0),h.done((function(){for(r in p||he([e]),J.remove(e,"fxshow"),f)T.style(e,r,f[r])}))),l=Rt(p?m[r]:0,r,h),r in m||(m[r]=l.start,p&&(l.end=l.start,l.start=0))}],prefilter:function(e,t){t?It.prefilters.unshift(e):It.prefilters.push(e)}}),T.speed=function(e,t,n){var r=e&&"object"==typeof e?T.extend({},e):{complete:n||!n&&t||v(e)&&e,duration:e,easing:n&&t||t&&!v(t)&&t};return T.fx.off?r.duration=0:"number"!=typeof r.duration&&(r.duration in T.fx.speeds?r.duration=T.fx.speeds[r.duration]:r.duration=T.fx.speeds._default),null!=r.queue&&!0!==r.queue||(r.queue="fx"),r.old=r.complete,r.complete=function(){v(r.old)&&r.old.call(this),r.queue&&T.dequeue(this,r.queue)},r},T.fn.extend({fadeTo:function(e,t,n,r){return this.filter(le).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(e,t,n,r){var i=T.isEmptyObject(e),o=T.speed(t,n,r),s=function(){var t=It(this,T.extend({},e),o);(i||J.get(this,"finish"))&&t.stop(!0)};return s.finish=s,i||!1===o.queue?this.each(s):this.queue(o.queue,s)},stop:function(e,t,n){var r=function(e){var t=e.stop;delete e.stop,t(n)};return"string"!=typeof e&&(n=t,t=e,e=void 0),t&&this.queue(e||"fx",[]),this.each((function(){var t=!0,i=null!=e&&e+"queueHooks",o=T.timers,s=J.get(this);if(i)s[i]&&s[i].stop&&r(s[i]);else for(i in s)s[i]&&s[i].stop&&St.test(i)&&r(s[i]);for(i=o.length;i--;)o[i].elem!==this||null!=e&&o[i].queue!==e||(o[i].anim.stop(n),t=!1,o.splice(i,1));!t&&n||T.dequeue(this,e)}))},finish:function(e){return!1!==e&&(e=e||"fx"),this.each((function(){var t,n=J.get(this),r=n[e+"queue"],i=n[e+"queueHooks"],o=T.timers,s=r?r.length:0;for(n.finish=!0,T.queue(this,e,[]),i&&i.stop&&i.stop.call(this,!0),t=o.length;t--;)o[t].elem===this&&o[t].queue===e&&(o[t].anim.stop(!0),o.splice(t,1));for(t=0;t<s;t++)r[t]&&r[t].finish&&r[t].finish.call(this);delete n.finish}))}}),T.each(["toggle","show","hide"],(function(e,t){var n=T.fn[t];T.fn[t]=function(e,r,i){return null==e||"boolean"==typeof e?n.apply(this,arguments):this.animate(Ot(t,!0),e,r,i)}})),T.each({slideDown:Ot("show"),slideUp:Ot("hide"),slideToggle:Ot("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},(function(e,t){T.fn[e]=function(e,n,r){return this.animate(t,e,n,r)}})),T.timers=[],T.fx.tick=function(){var e,t=0,n=T.timers;for(Tt=Date.now();t<n.length;t++)(e=n[t])()||n[t]!==e||n.splice(t--,1);n.length||T.fx.stop(),Tt=void 0},T.fx.timer=function(e){T.timers.push(e),T.fx.start()},T.fx.interval=13,T.fx.start=function(){Et||(Et=!0,xt())},T.fx.stop=function(){Et=null},T.fx.speeds={slow:600,fast:200,_default:400},T}(window)),Object.defineProperty(s,"__esModule",{value:!0}),function(e,t){if(!t||!t.VERSION||!t.$)return void console.error("Loopindex Utils: window.LOOPINDEX must be properly defined");const n=e=>{const t={major:0,minor:0,build:0};if(!e||["string","number"].indexOf(typeof e)<0)return t;if(!(e=String(e||"").trim()))return t;function n(e){if(!e)return 0;const t=parseInt(e.replace(/[^\d]+/g,""));return isNaN(t)?0:t}const r=e.match(/(\d+)(\.\d+)?(\.\d+)?/);return r?{major:n(r[1]),minor:n(r[2]),build:n(r[3])}:t},r=(e,t)=>{const r=n(e),i=n(t);return Math.sign(r.major-i.major)||Math.sign(r.minor-i.minor)||Math.sign(r.build-i.build)};if(t.utils&&r("1.7.7",t.utils.VERSION)<1)return;const i=t.$,o=/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/,s=/rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([\d\.\%]+)\s*\)/,a=new Set(["TEXTAREA","INPUT","OL","UL","TABLE","TR","IMG","SCRIPT","LINK","svg","BR"]);class l{constructor(e){this._config={log:!1,debug:!1,warn:!1,error:!0,trace:!1,prefix:"LoopIndex "},this._logs=[],this.timeout=null,e&&this.config(e)}config(e){if(e){const t={};Object.entries(this._config).forEach(([n,r])=>{const i=e[n];typeof r==typeof i&&(t[n]=i)}),i.extend(this._config,t)}return i.extend({},this._config)}ignore(){}log(...e){this._config.log&&this._log("log",Array.from(e))}error(...e){this._config.error&&this._log("error",Array.from(e))}debug(...e){this._config.debug&&this._log("log",Array.from(e))}trace(...e){if(this._config.trace){const e=Error().stack,t=e?[e.replace("Error","Debug:"),"\n"]:[];this._log("log",t.concat(Array.from(t)))}}warn(...e){this._log("warn",Array.from(e))}_log(e,t){const n=new Date,r=[n.getMinutes(),n.getSeconds(),n.getMilliseconds()].join(":");t.unshift(r+">"),this._config.prefix&&t.unshift(this._config.prefix),"error"===e||"warn"===e?console[e].apply(console,t):(this._logs.push({method:e,logs:t}),this.scheduleDump())}dump(){const e=this._logs.slice();this._logs.length=0,e.forEach((function(e){console[e.method].apply(console,e.logs)}))}scheduleDump(){this.timeout||(this.timeout=setTimeout(function(){this.timeout=null,this.dump()}.bind(this),100))}}class c{merge(e,n,r,i=!1){const o=null===r?(e,t)=>e===t:(e,t)=>e===t||e&&t&&e[r]===t[r];e=e||[];const s=[];return(n=n||[]).forEach(n=>{let r=!1;for(let s=0,a=e.length;!r&&s<a;++s){const a=e[s];o(a,n)&&(e[s]=i&&a&&n?t.$.extend(a,n):n,r=!0)}r||s.push(n)}),e.push(...s),e}firstIndex(e,t){const n=null==e?void 0:e.length;if(!n||!t)return-1;if(Array.isArray(e))return e.findIndex(t);for(let r=0;r<n;++r)if(t(e[r],r,e))return r;return-1}first(e,t){const n=this.firstIndex(e,t);return n<0?null:e[n]}remove(e,n){if(!(null==e?void 0:e.length))return Array.isArray(e)?e:[];const r=n.element,i=n.test;if(void 0!==r===Boolean(i))return t.logger.warn("provide exactly one of element/test in array remove"),e;const o=!1!==n.inPlace&&Array.isArray(e)?e:Array.from(e);let s=0;void 0!==n.from&&(n.from>=0&&n.from<o.length?s=Math.floor(n.from):t.logger.warn("Invalid from field in array remove "+n.from));const a=!1===n.all?1:o.length;if(0===s&&1===a){const e=i?o.findIndex(i):o.indexOf(r);return e>=0&&o.splice(e,1),o}for(let e=o.length-1,t=0;e>=s&&t<a;--e){(i?i(o[e],e,o):o[e]===r)&&(o.splice(e,1),++t)}return o}}class d{constructor(e){if(this._doc=e,!e)throw new Error("CSS Loader: null document");this._styleId=t.utils.strings.randomString(8),this._loadedStyleIds={}}get document(){return this._doc}getOwnStyleSheet(e){let t=this._doc.getElementById(this._styleId);return!t&&e&&(t=this._doc.createElement("style"),t.appendChild(this._doc.createTextNode("")),t.setAttribute("id",this._styleId),this._loadedStyleIds[this._styleId]=!0,this.$head.append(t)),t&&t.sheet}loadCSSString(e,t){if(!(e=null==e?void 0:e.trim()))return;const n="li-style-"+e.split("").reduce((e,t,n)=>e+n*t.charCodeAt(0),0),r=this.$head;if(r.find(`style[id='${n}']`).length)return;const i=this._doc.createElement("style");i.id=n,this._loadedStyleIds[n]=!0,i.appendChild(this._doc.createTextNode(e)),r.append(i)}loadCSS(e,n){const r=this.$head,o=this._doc,s=t.utils.strings.toStringArray(e),a={ok:!0,loaded:[],failed:[]},l=({url:e,error:n})=>{n?(a.ok=!1,a.failed.push({url:e,error:n}),t.logger.warn("Error loading css "+e)):a.loaded.push(e),c()},c=()=>{if(!s.length||!a.ok)return void(n&&setTimeout(()=>n(a),1));const e=s.shift();if(!e)return c();const d=`_loopindex-${e.replace(/[^0-9a-z]+/gi,"_")}_`;if(0===i(r).find(`link[data-loopindex-id='${d}']`).length){const n=o.createElement("link"),s=i(n);t.utils.dom.attachCBToLink(n,e,l),s.attr({rel:"stylesheet",type:"text/css","data-loopindex-id":d,href:e}),this._loadedStyleIds[d]=!0,r.append(s)}else l({url:e})};c()}addRule(e,n){if(!n||"object"!=typeof n)return;const r=this.getOwnStyleSheet(!0);if(!r)return void t.logger.warn("LoopIndex CSSLoader cannot create stylesheet");const i=r.rules&&r.rules.length||0,o=this._makeRule(n);"function"==typeof r.addRule?r.addRule(e,o,i):"function"==typeof r.insertRule?r.insertRule(`${e} ${this._makeRule(n)} }`,r.rules&&r.rules.length||0):t.logger.error("CSSLoader addRule: no matching function")}reset(){const e=this.getOwnStyleSheet(!1);if(e&&e.deleteRule)for(let t=e.cssRules.length-1;t>=0;--t)e.deleteRule(t)}dispose(){if(!this._doc)return;const e=this.$head;Object.keys(this._loadedStyleIds).forEach(t=>{setTimeout(()=>{try{e.find("#"+t).remove()}catch(e){}},0)}),this._loadedStyleIds={},this._doc=null}get $head(){return t.$(this._doc&&(this._doc.head||this._doc.getElementsByTagName("head")[0]))}_makeRule(e){return Object.keys(e||{}).map(t=>`${t}: ${e[t]};`).join("\n")}}class u{logEditorEvents(e,n,r,i){let o=n&&void 0!==i?{log:i,editor:n,exclude:r,plugin:e}:e;const s=o.editor,a=o.method||"fire",l=o.plugin;if(r=t.utils.strings.toStringArray(o.exclude),!s||!l)return t.logger.warn("logEditorEvents: missing params");if(!s[a])return t.logger.warn("logEditorEvents: editor doesn't include method "+a);if(Boolean(o.log)!==Boolean(l.savedEditorFireMethod))if(o.log){l.savedEditorFireMethod=s[a];const e=r.length?new RegExp(r.join("|"),"i"):/mouse|selection|click|focus|undo|redo|snapshot|resolvename/i,n=function(t){return!t||e.test(t)};s[a]=(...e)=>{var r;return n(e[0])||t.logger.debug("Editor event "+e[0]),null===(r=l.savedEditorFireMethod)||void 0===r?void 0:r.apply(s,e)}}else s[a]=l.savedEditorFireMethod,l.savedEditorFireMethod=null}}class h{constructor(){this._map=new Map,this._items=[]}get(e){var t,n;return null!==(n=null===(t=this._map.get(e))||void 0===t?void 0:t.item)&&void 0!==n?n:null}contains(e){const t=this._items.find(t=>t.item===e);return Boolean(t)}get length(){return this._items.length}hasId(e){return this._map.has(e)}clear(){return this._items.length=0,this._refresh(),this}firstIndex(e){for(let t=0,n=this.length;t<n;++t)if(e(this._items[t].item,t))return t;return-1}first(e){const t=this.firstIndex(e);return t>=0?this._items[t].item:null}filter(e){return this._items.reduce((t,n,r)=>(e(n.item,r)&&t.push(n.item),t),[])}count(e){let t=0;for(let n=0,r=this._items.length;n<r;++n)e(this._items[n].item,n)&&t++;return t}map(e){return this._items.map((t,n)=>e(t.item,n))}get asMap(){return this._items.reduce((e,t)=>(e.set(t.id,t.item),e),new Map)}get asObject(){const e={};return this._map.forEach((t,n)=>{e[n]=t.item}),e}get items(){return this._items.map(e=>e.item)}getItemIndex(e){var t;const n=this._map.get(e);return null!==(t=null==n?void 0:n.index)&&void 0!==t?t:-1}getAt(e){const n=this._validateIndex(e,!1);return n.error?(t.logger.error("getAt: "+n.error),null):this._items[n.index].item}move(e,n){const r=e?this._map.get(e):null;if(!r)return t.logger.error("maparray move: unkonw id "+e),this;const i=this._validateIndex(n,!1);if(i.error)return t.logger.error("maparray move: invalid index "+n),this;if(r.index!==i.index){const t=this._items[r.index];this._items.splice(r.index,1),this._items.splice(i.index,0,t),this._map.set(e,{item:r.item,index:i.index})}return this}moveBefore(e,n){if(!e||!n||e===n)return t.logger.error(`moveBefore: invalid input ${e}, ${n}`),!1;const r=this._map.get(e),i=this._map.get(n);if(!r||!i)return t.logger.error(`moveBefore: can't find items ${e} and/or ${n}`),!1;const o=i.index-1;if(r.index===o)return!1;let s=r.index<o?1:0;return this._items.splice(r.index,1),this._items.splice(i.index-s,0,{item:r.item,id:e}),this._refresh(),!0}moveAfter(e,t){return this.moveBefore(t,e)}push({item:e,id:t}){return this.add({item:e,id:t,index:this.length})}add({item:e,id:t,index:n,replace:r}){if(!e||!t)throw new Error("ArrayMap add: null element and/or id");if(!r&&this.get(t))throw new Error(`Element with id ${t} already in ArrayMap`);(void 0===n||isNaN(n))&&(n=this.length);const i=this._validateIndex(n,!0);if(i.error)throw new Error(`ArrayMap add: illegal index ${n} for id ${t}`);const o={id:t,item:e};return 0===(n=i.index)?this._items.unshift(o):n===this._items.length?this._items.push(o):this._items.splice(n,0,o),this._refresh(),this}removeById(e){const n=this._map.get(e);return n?(this._items.splice(n.index,1),this._refresh(),this):(t.logger.warn("ArrayMap.removeById: no item with id "+e),this)}forEach(e){const t=this._items.slice();for(let n=0,r=t.length;n<r;++n){const r=t[n];if(this.hasId(r.id)){if(!1===e(t[n].item,n))break}}}removeByIndex(e){const n=this._validateIndex(e,!1);return n.error?t.logger.error("Arraymap remove by index: "+n.error):(this._items.splice(n.index,1),this._refresh()),this}_refresh(){this._map.clear(),this._items.forEach((e,t)=>{this._map.set(e.id,{item:e.item,index:t})})}_validateIndex(e,t){const n=this._items.length-(t?0:1);return!isNaN(e)&&e>=0&&e<=n?{error:"",index:Math.floor(e)}:{error:"invalid index "+e}}}class f extends h{constructor(e){super(),this.idGet=e}pushItem(e){return this.addItem({item:e,index:this.length})}addItem(e){return this.add(Object.assign(Object.assign({},e),{id:this.idGet(e.item)}))}removeItem(e){return this.removeById(this.idGet(e))}}const g=/\[\[([^\]]+)\]\]/,p=e=>e?g.test(e)?e.replace(g,"$1"):e:"";class m{constructor(e,t){this.owner=e,this.domain=t.domain,this._locale=t.locale,this._localizer=e.getLocalizer(this.domain,this._locale)}get locale(){return this._locale}loadLocale(e){return this.owner.loadLocale(this.domain,e).then(t=>(t||(this._locale=e,this._localizer=this.owner.getLocalizer(this.domain,e)),t))}localizeString(e){return this._localizer(e)}localizeUI(e){const n=t.utils.dom.toJQuery(e);if(!(null==n?void 0:n.length))return n;const r=(e,...t)=>this._localizer(t[0]),i=(e,t)=>{const n="data-li-"+t,i="text"===t,o=e.getAttribute(n),s=o||(i?e.textContent:e.getAttribute(t));if(!s)return;if(!g.test(s))return void(s||(i?e.textContent=o:e.setAttribute(t,String(o))));let a=s;do{a=a.replace(g,r)}while(g.test(a));e.setAttribute(n,s),i?e.textContent=a:e.setAttribute(t,a)};return n.each((e,t)=>{i(t,"title"),i(t,"placeholder"),(e=>{if(1!==(null==e?void 0:e.nodeType))return!1;if(a.has(e.nodeName))return!1;let t=!1;for(let n=e.firstChild;n;n=n.nextSibling){if(3!==n.nodeType)return!1;t=!0}return t})(t)?i(t,"text"):n.children().each((e,t)=>{1!==t.nodeType||m.FINAL_TAGS.has(t.nodeName)||this.localizeUI(t)})}),n}}m.FINAL_TAGS=new Set(["svg","path","IMG","BR"]);class v{constructor(e){const t=this._dictionaries=new Map;e.locales.forEach(e=>t.set(e,{status:"none",dictionary:new Map})),this.assetPath=e.assetPath,this.defaultLocale=e.defaultLocale}isLoading(e){var t;return"loading"===(null===(t=this._dictionaries.get(e))||void 0===t?void 0:t.status)}isLoaded(e){var t;return"loaded"===(null===(t=this._dictionaries.get(e))||void 0===t?void 0:t.status)}getStatus(e){return this._dictionaries.get(e).status}setStatus(e,t){const n=this._dictionaries.get(e);this._dictionaries.set(e,{status:t,dictionary:n.dictionary})}setLoading(e){const t=this._dictionaries.get(e);this._dictionaries.set(e,{dictionary:t.dictionary,status:"loading"})}hasLocale(e){return this._dictionaries.has(e)}hasDictionary(e){var t;return"loaded"===(null===(t=this._dictionaries.get(e))||void 0===t?void 0:t.status)}getDictionary(e){const t=this._dictionaries.get(e);return(null==t?void 0:t.dictionary)||null}load(e,t,n){if(!t||"object"!=typeof t)return;const r=(e,t,n)=>{if(!t||"object"!=typeof t)return;const i=e?e+".":"";Object.keys(t).forEach(e=>{const o=t[e],s=typeof o;"string"===s||"number"===s||"boolean"===s?n.set(`${i}${e}`,String(o)):r(`${i}${e}`,o,n)})},i=this._dictionaries.get(e),o=i.dictionary;r("",t,o),this._dictionaries.set(e,{status:n?"loaded":i.status,dictionary:o})}}class y{constructor(){this._domainMap=new Map}hasDomain(e){return this._domainMap.has(e)}defineDomain({domain:e,locales:n,assetPath:r,defaultLocale:i}){if(this._domainMap.has(e))return t.logger.warn(`Localizer: client ${e} already defined`),this;if(!i||"string"!=typeof i)throw new Error("Localizer createClient: illegal default language "+i);let o=i.trim().toLowerCase();if(0===(n=t.utils.strings.toStringArray(n,{unique:!0,transform:"lower"})).length)throw new Error("Localizer createClient: no locales provided");if(n.indexOf(o)<0)if(n.indexOf(o.substring(0,2))>=0)o=o.substring(0,2);else{if(!(n.indexOf("en")>=0))throw new Error(`Localizer createClient: default language ${i} not found in ${n}`);t.logger.warn(`Setting default locale to English, locale ${i} not found`),o="en"}const s=new v({assetPath:r,locales:n,defaultLocale:o});return this._domainMap.set(e,s),this}loadLocales(e,n){if(!n||"object"!=typeof n)return t.logger.error("Load dictionary: null or invalid dictionaries object"),this;if(Array.isArray(n))return t.logger.error("Load dictionary: dictionaries can't be an array"),this;const r=this._domainMap.get(e);return r?(Object.entries(n).forEach(([e,n])=>{const i=this._validateLocale(r,e,!1);if(!i)return t.logger.warn("load locales: skipping unknown locale "+e);r.load(i,n,!1)}),this):(t.logger.error("Unknown domain "+e),this)}loadLocale(e,n){const r=this._domainMap.get(e);return r?(n=this._validateLocale(r,n),r.isLoaded(n)?Promise.resolve(""):r.isLoading(n)?this._waitFor(r,n):new Promise(i=>{r.setLoading(n);const o=t.utils.joinPath(r.assetPath,n+".json");fetch(o,{method:"GET"}).then(e=>e.json()).then(t=>t&&"object"==typeof t?(r.load(n,t,!0),i("")):i(`Invalid data in domain ${e} locale ${n}`)).catch(e=>{r.setStatus(n,"error"),i(String(e))})}).then(e=>e)):Promise.resolve(`Cannot load locale ${n} in unknown domain ${e}`)}createClient(e,t){const n=this._domainMap.get(e);if(!n)throw new Error("Unknown localization client "+e);return new m(this,{domain:e,locale:t||n.defaultLocale})}getLocalizer(e,t){const n=p;if(!e||!t)return n;const r=this._domainMap.get(e);if(!r)return n;t=this._validateLocale(r,t);const i=r.getDictionary(t);return i?e=>{const n=p(e);let o=i.get(n);if(o)return o;if(t!==r.defaultLocale){const e=r.getDictionary(r.defaultLocale);o=null==e?void 0:e.get(n)}return o||n}:n}_waitFor(e,t){return new Promise(n=>{let r,i=0;const o=e=>(clearInterval(r),n(e||""));r=setInterval(()=>e.isLoading(t)?++i>50?o("timed out"):void 0:o(),100)})}_validateLocale(e,t,n=!0){return t?(t=t.trim().toLowerCase(),e.hasLocale(t)||t.length>2&&(t=t.substring(0,2),e.hasLocale(t))?t:n?e.defaultLocale:""):e.defaultLocale}_getBaseLocale(e){return e.trim().toLowerCase().substring(0,2)}}const C=e=>"string"==typeof e?e.toLowerCase():String(e).toLowerCase();class _ extends Map{set(e,t){return super.set(C(e),t)}get(e){return super.get(C(e))}has(e){return super.has(C(e))}}class N extends Set{add(e){return super.add(C(e))}delete(e){return super.delete(C(e))}has(e){return super.has(C(e))}}class b{constructor(){this.VERSION="1.7.7",this.LocaleServer=new y,this.array=new c,this.pluginUtils=new u}compareVersions(e,t){const n=r(e,t);return n>0?1:0===n?0:-1}parseVersion(e){return n(e)}createCIMap(...e){return new _(Array.from(e))}createCISet(...e){return new N(e)}createArrayMap(){return new h}createTypedArrayMap(e){return new f(e)}clearObject(e){return e?(Object.keys(e).forEach(t=>{try{delete e[t]}catch(e){}}),e):{}}getRelativeTimezoneOffset(e){if(!e)return 0;try{const t=new Date,n=t.toLocaleString("en-us",{timeZone:e});return Date.parse(n)-t.getTime()}catch(n){return t.logger.error("convertDateToTimezone",e,n),0}}convertDateToTimezone(e,n){if(e=e||new Date,!n)return e;try{const r=t.utils.getRelativeTimezoneOffset(n);return new Date(e.getTime()+r)}catch(r){return t.logger.error("convertDateToTimezone",n,r),e}}get CSSLoader(){return d}intensifyColor(e,t){const n=e.match(o);let r=n?null:e.match(s);const i=r||r;let a,l=10;i?a=[i[1],i[2],i[3]]:(l=16,(e=String(e).replace(/[^0-9a-f]/gi,"")).length<6&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]),a=[e.substr(0,2),e.substr(2,2),e.substr(4,2)]),t=t||0;const c=[];let d;for(let e=0;e<3;e++)d=parseInt(a[e],l),c.push(Math.round(Math.min(Math.max(0,d+d*t),255)));return n?`rgb(${c[0]},${c[1]},${c[2]})`:r?`rgba(${c[0]},${c[1]},${c[2]}, ${r[4]})`:"#"+c.map(e=>e<16?"0"+e.toString(16):e.toString(16)).join("")}getUniqueNumber(){return b.nextId++}getUniqueId(e,n){return`${e}${t.utils.getUniqueNumber()}${n||""}`}yes(...e){return!0}no(...e){return!1}always(e){return function(...t){return e}}noop(...e){}getCurrentScriptPath(){const e=t.utils.getCurrentScriptURL();if(!e)return null;const n=/^(.+\/)[^\/]+\.js/i.exec(e);return n&&n[1]}getCurrentScriptURL(){try{const e=document&&document.currentScript;if(e)return e.src;const t=window.import,n=t&&t.meta;return void 0!==n&&n.url?n.url:null}catch(e){return null}}scrollToElement(e,n){const r=t.utils.dom.toJQuery(e);return r&&r.scrollintoview(n)}joinPath(...e){const t=e.length-1,n=e.map((e,n)=>e?(0!==n&&(e=e.replace(/^[\s\/]+/,"")),n<t&&(e=e.replace(/[\s\/]+$/,"")),e):"").filter(Boolean).join("/").split("/"),r=[];for(let e=0,t=n.length-1;e<=t;e++){const t=n[e];"."!==t&&(".."===t&&r.length>0?r.length--:r.push(t))}return r.join("/")}isAbsoluteUrl(e){return!!e&&("/"===e[0]||/^[a-z]+\:\/\//i.test(e)||/^data:/.test(e))}}b.nextId=Math.round(Date.now()%1e5);class T{constructor(){this._timeoutMap={}}clear(){Object.keys(this._timeoutMap).forEach(e=>this.removeTimer(e))}setTimer(e,t,n){const r="temp-"+Date.now()*Math.random();return this.createTimer(r,{callback:e,timeoutMSecs:t,repeatCount:n,autoDispose:!0}).start()}createTimer(e,t){if(!e)throw new Error("setTimer requires a timer id");let n=this._timeoutMap[e];if(n)n.update(t);else{if(!t.callback)throw new Error("setTimer: callback required");const r=this.upgradeOptions(t);n=this._timeoutMap[e]=new E(r,()=>{delete this._timeoutMap[e]})}return n}startTimer(e){const t=this._timeoutMap[e];return t&&t.start()}stopAll(){Object.keys(this._timeoutMap).forEach(e=>this.stopTimer(e))}stopTimer(e){const t=this._timeoutMap[e];return t&&t.stop(),t}removeTimer(e){const t=this._timeoutMap[e];return t&&t.dispose(),Boolean(t)}elapsed(e){const t=this._timeoutMap[e];return t&&t.elapsed||0}upgradeOptions(e){return t.$.extend({},{repeatCount:1,timeoutMSecs:-1,maxTimeSecs:0,autoDispose:!0},e)}}T.FOREVER=999999999;class E{constructor(e,n){if(this.done=n,this._elapsed=0,this._callCount=0,this._startTime=0,this._stop=null,!e.callback)throw new Error("Timeout constructor: callback required");this._options=t.$.extend({},e),this._callback=()=>{this._elapsed=Date.now()-this._startTime,this._options.maxTimeSecs>0&&1e3*this._options.maxTimeSecs<this._elapsed&&this.stop(),this._options.callback(this);const e=this._options.repeatCount;this._options&&(e<=0||++this._callCount>=e)&&(this.stop(),this._options.autoDispose&&this.dispose())}}get isRunning(){return Boolean(this._stop)}dispose(){if(this.stop(),Object.keys(this._options).forEach(e=>delete this._options[e]),this._callback=null,this.done){const e=this.done;this.done=null,e()}}start(){if(this.isRunning)return this;let e;this.reset();const t=this._options.repeatCount;return(isNaN(t)||"number"!=typeof t||t<0)&&(this._options.repeatCount=1),this._startTime=Date.now(),e=setInterval(this._callback,this._options.timeoutMSecs),this._stop=()=>clearInterval(e),this}reset(){return this._elapsed=0,this._callCount=0,this.isRunning&&(this.stop(),this.start()),this}stop(){if(this._stop){const e=this._stop;this._stop=null,e()}return this}update(e){const t=this._options;return e.repeatCount>0&&(t.repeatCount=e.repeatCount),e.timeoutMSecs>=0&&(t.timeoutMSecs=e.timeoutMSecs),e.maxTimeSecs>=0&&(t.maxTimeSecs=e.maxTimeSecs),void 0!==e.data&&(t.data=e.data),this}get elapsed(){return this._elapsed}get isRepeating(){return this._options.repeatCount>0}}const k={mixin:function(e){const n={};let r=!1;const o=function(e){return n[e]=n[e]||[]},s=function(){const e=n;Object.keys(e).forEach(t=>{const n=e[t];(null==n?void 0:n.length)||delete e[t]})},a=function(e,...n){if(!e)return void t.logger.warn("cannot trigger empty event");if(r)return;const i=o(e),a=i.length?i.slice():i,l=[];a.forEach(e=>{e.muted||e.callback.apply(e.scope,n),e.options&&e.options.count&&(--e.options.count,e.options.count<=0&&l.push(e))}),l.length&&(l.forEach((function(e){i.splice(i.indexOf(e),1)})),s())},l={on:function(e,n,r,s){if(!e)return t.logger.warn("cannot register to empty event"),this;if(i.isArray(e))e.forEach(e=>{this.addListener(e,n,r,s)});else if("function"==typeof n){o(e).push({scope:r,muted:!1,callback:n,options:s})}else t.logger.error("events mixin addListener: bad callback",n);return this},off:function(e,t){if(!e&&!t)return this.removeAllListeners();if(!t&&e&&"object"==typeof e&&(t=e,e=null),e&&e instanceof Array)return e.forEach(e=>{this.off(e,t)}),this;function r(e,n){return e&&(!t||e.scope===t||e.callback===t)}const i=n;return Object.keys(i).forEach(t=>{e&&e!==t||i[t].filter(r).forEach(e=>{const n=i[t].indexOf(e);n>=0&&i[t].splice(n,1)})}),s(),this},removeAllListeners:function(){return Object.keys(n).forEach(e=>delete n[e]),this},muteListener:function(e,t){if(!e)return this;t=Boolean(t);const r=n;return Object.keys(r).forEach(n=>{const i=r[n];i&&i.forEach(n=>{n&&n.scope===e&&(n.muted=t)})}),this},muteEvents:function(){return r=!0,this},unmuteEvents:function(){return r=!1,this},once:function(e,t,n,r){return(r=r||{}).count=1,this.on(e,t,n,r)},trigger:function(e,...t){return a.apply(this,[e].concat(t)),this}};Object.keys(l).forEach(t=>{const n=l[t];"function"==typeof n&&Object.defineProperty(e,t,{value:n,enumerable:!0,writable:!1,configurable:!1})});const c={fire:l.trigger,removeListener:l.off,bind:l.on,addListener:l.on};return Object.keys(c).forEach(t=>{Object.defineProperty(e,t,{enumerable:!0,value:c[t],writable:!1,configurable:!1})}),e}};!function(){if(!i||!i.fn)return console.warn("Cannot define scrollintoview: no $");if(i.fn.scrollintoview)return console.warn("$ scrollintoview already defined");var e={vertical:{x:!1,y:!0},horizontal:{x:!0,y:!1},both:{x:!0,y:!0},x:{x:!0,y:!1},y:{x:!1,y:!0}};const n={duration:"fast",direction:{x:!1,y:!0},margin:0},r=/^(?:html)$/i,o=function(e,t){var n;const r=null===(n=null==e?void 0:e.ownerDocument)||void 0===n?void 0:n.defaultView;if(!r)return{top:0,left:0,bottom:0,right:0,vertical:0,horizontal:0};const o=Boolean(r.getComputedStyle);t=t||o?r.getComputedStyle(e,null):e.currentStyle;const s=!!o,a={top:parseFloat(s?t.borderTopWidth:i.css(e,"borderTopWidth"))||0,left:parseFloat(s?t.borderLeftWidth:i.css(e,"borderLeftWidth"))||0,bottom:parseFloat(s?t.borderBottomWidth:i.css(e,"borderBottomWidth"))||0,right:parseFloat(s?t.borderRightWidth:i.css(e,"borderRightWidth"))||0};return{top:a.top,left:a.left,bottom:a.bottom,right:a.right,vertical:a.top+a.bottom,horizontal:a.left+a.right}},s=function(e,t){const n=i(window),s=e[0],a=r.test(s.nodeName);return{border:a?{top:0,left:0,bottom:0,right:0}:o(s,null),scroll:{top:(a?n:e).scrollTop(),left:(a?n:e).scrollLeft()},scrollbar:{right:a?0:e.innerWidth()-s.clientWidth,bottom:a?0:e.innerHeight()-s.clientHeight},rect:function(){const e=s.getBoundingClientRect(),n=2*(t+5),r=e.width>n?t:0,i=e.height>n?t:0;return{top:a?i:e.top+i,left:a?r:e.left+r,bottom:a?s.clientHeight-i:e.bottom-i,right:a?s.clientWidth-r:e.right-r}}()}};function a(e){if(e.scrollers.length<1)return this;const t=e.scrollers.slice();let n=i(t.pop());const o=e.$element,l=s(o,0),c=s(n,e.margin),d={top:l.rect.top-(c.rect.top+c.border.top),bottom:c.rect.bottom-c.border.bottom-c.scrollbar.bottom-l.rect.bottom,left:l.rect.left-(c.rect.left+c.border.left),right:c.rect.right-c.border.right-c.scrollbar.right-l.rect.right},u={};return e.direction.y&&(d.top<0?u.scrollTop=c.scroll.top+d.top:d.top>0&&d.bottom<0&&(u.scrollTop=c.scroll.top+Math.min(d.top,-d.bottom))),e.direction.x&&(d.left<0?u.scrollLeft=c.scroll.left+d.left:d.left>0&&d.right<0&&(u.scrollLeft=c.scroll.left+Math.min(d.left,-d.right))),i.isEmptyObject(u)?i.isFunction(e.complete)&&e.complete.call(n[0]):(r.test(n[0].nodeName)&&(n=i(n[0].ownerDocument).find("html,body")),n.animate(u,e.duration).eq(0).queue((function(r){t.length<1?i.isFunction(e.complete)&&e.complete.call(n[0]):a.call(this,Object.assign(Object.assign({},e),{scrollers:t})),r()}))),this}i.fn.extend({scrollintoview:function(r){const o=i.extend({},n,r),s=Object.assign({},o);s.direction="string"==typeof o.direction?e[o.direction.toLowerCase()]:o.direction;const l=s.direction.x?s.direction.y?"both":"horizontal":s.direction.y?"vertical":"";if(!l)return t.logger.warn("scrollintoview with no direction"),this;s.dirStr=l,s.margin&&!isNaN(s.margin)||(s.margin=0);const c=(s.$element=this.eq(0)).parents(":scrollable("+l+")").toArray().reverse();return c.length<1?this:a.call(this,Object.assign(Object.assign({},s),{scrollers:c}))}});const l={auto:!0,scroll:!0,visible:!1,hidden:!1};i.extend(i.expr[":"],{scrollable:function(t,n,i,o){const s=e[i&&"string"==typeof i[3]&&i[3].toLowerCase()]||e.both,a=document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(t,null):t.currentStyle,c={x:l[a.overflowX.toLowerCase()]||!1,y:l[a.overflowY.toLowerCase()]||!1,isRoot:r.test(t.nodeName)};if(!c.x&&!c.y&&!c.isRoot)return!1;const d={height:{scroll:t.scrollHeight,client:t.clientHeight},width:{scroll:t.scrollWidth,client:t.clientWidth},scrollableX:function(){return(c.x||c.isRoot)&&this.width.scroll>this.width.client},scrollableY:function(){return(c.y||c.isRoot)&&this.height.scroll>this.height.client}};return s.y&&d.scrollableY()||s.x&&d.scrollableX()}})}();const S=new class{constructor(){this.msie=!1,this.type="unknown",this.webkit=!1,this.chrome=!1,this.safari=!1,this.firefox=!1,this.webkitType=null;const e=navigator.userAgent.toLowerCase(),t=function(e){e=e.toLowerCase();var t=/(chrome)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[];return{browser:t[1]||"",version:t[2]||"0"}}(e);t.browser&&(this[t.browser]=!0,this.version=t.version||"0",this.type=t.browser),this.chrome?this.webkit=!0:this.webkit&&(this.safari=!0),this.webkit&&(this.type="webkit",this.webkitType="webkit"!==this.type?null:Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0?"safari":"chrome"),this.firefox=!0===/firefox/i.test(e),this.msie||(this.msie=Boolean(/trident/i.test(e)))&&(this.type="msie")}},x=new l({prefix:"LoopIndex"}),w={TimeoutClient:T,createLogger:e=>{const t=new l;return t.config(e),t},logger:x,utils:new b,URLArguments:new class{constructor(){this._args=null,this._url=""}getArgument(e,t){return this._parseLocation(),this._args.hasOwnProperty(e)?decodeURIComponent(this._args[e]):t}getNumericArgument(e,t){var n=this.getArgument(e,""),r=parseInt(n,10);return isNaN(r)&&(r=t),r}getAllArguments(){this._parseLocation();var e,t={};for(e in this._args)this._args.hasOwnProperty(e)&&(t[e]=this._args[e]);return t}createSearchString(e){if(!e)return"";let t,n,r="";for(t in e)e.hasOwnProperty(t)&&(n=e[t],"function"!=typeof n&&(r.length&&(r+="&"),r+=t+"="+decodeURIComponent(n)));return r}parse(e,t){if(t=t||{},"string"!=typeof e||e.length<1)return{};const n=e.charAt(0);"?"!==n&&"#"!==n||(e=e.substring(1));var r,i,o,s,a=e.split("&"),l={true:!0,false:!1};for(r=a.length-1;r>=0;--r)(i=a[r])&&(o=i.indexOf("="))>0&&(s=decodeURIComponent(i.substring(o+1)),l.hasOwnProperty(s)&&(s=l[s]),t[i.substring(0,o)]=s);return t}_parseLocation(){var t=e.location;if(this._url!==t.href||!this._args){this._url=t.href;var n={};this.parse(t.search,n),this.parse(t.hash,n),this._args=n}return this._args}},CommandStates:{ON:"on",OFF:"off",DISABLED:"disabled"},mixinEvents:k.mixin};Object.keys(w).forEach(e=>{try{Object.defineProperty(t,e,{value:w[e],writable:!1,configurable:!0,enumerable:!1})}catch(t){x.error(`Error defining LOOPINDEX property ${e}: ${t}`)}}),Object.defineProperties(t,{browser:{get:function(){return t.$.extend(!0,{},S)},configurable:!0}})}(window,window.LOOPINDEX),Object.defineProperty(s,"__esModule",{value:!0}),function(e){if(!(null==e?void 0:e.utils))throw new Error("More utils: utils object not found");class t{constructor(e){this._scopes=[],this._options=Object.assign({},{timeout:100},e)}add(e,t){const n=this.findScope(e)||this.addScope(e,t);n.state=t,n.timeout&&!this._options.continuous&&(clearTimeout(n.timeout),n.timeout=0),n.timeout=n.timeout||setTimeout(this.onTimeout.bind(this,n),this._options.timeout)}remove(e){const t=this.findScopeIndex(e);this._removeScopeAt(t)}removeAll(){for(let e=this._scopes.length;e>=0;--e)this._removeScopeAt(e);this._scopes.length=0}getStateFor(e){const t=this.findScope(e);return null==t?void 0:t.state}_removeScopeAt(e){if(!(e>=0&&e<this._scopes.length))return null;const t=this._scopes[e];return this._scopes.splice(e,1),(null==t?void 0:t.timeout)&&clearTimeout(t.timeout),t}onTimeout(t){const n=this.findScopeIndex(null==t?void 0:t.scope);if(n<0)return e.logger.warn("debounce timeout: can't find record");t=this._scopes[n],this._scopes.splice(n,1),this._options.callback(t.scope,t.state)}addScope(e,t){const n={scope:e,state:t,timeout:0};return this._scopes.push(n),n}findScope(e){const t=this.findScopeIndex(e);return t>=0?this._scopes[t]:null}findScopeIndex(e){for(let t=this._scopes.length-1;t>=0;--t)if(this._options.compare(this._scopes[t].scope,e))return t;return-1}}const n={createDebouncer:e=>new t(e)};Object.entries(n).forEach(([t,n])=>{Object.defineProperty(e.utils,t,{value:n,writable:!1,enumerable:!1})})}(window.LOOPINDEX),Object.defineProperty(s,"__esModule",{value:!0}),function(e){if(!(e.utils.strings&&e.utils.compareVersions("1.7.7",e.utils.strings.VERSION)<1)){Object.defineProperty(e.utils,"strings",{value:new class{constructor(){this.VERSION="1.7.7"}validateEnum(t,n,r){if(null==t)return r;const i=`Invalid config value ${t}, allowed values: ${n}`;if("string"!=typeof t)return e.logger.warn(i),r;const o=t.trim().toLowerCase();for(let e of n)if(e.trim().toLowerCase()===o)return e;return e.logger.warn(i),r}getRealTextLength(t){if(!t)return 0;let n=t.length;for(;n&&e.utils.strings.isEmptyString(t[n-1]);)--n;return n}toMap(e,t,n){const r={};let i;const o=Boolean(t),s=Boolean(n);let a;for(let l=0,c=e&&e.length||0;l<c;++l)a=e[l],null!=a&&(i="*"===n?a:s?a[n]:1,o?r[String(a[t])]=i:r[String(a)]=1);return r}toStringMap(e,t){const n={},r=t?"upper"===t?e=>e.toUpperCase():e=>e.toLowerCase():null;for(let t=0,i=e&&e.length||0;t<i;++t)n[String(r?r(e[t]):e[t])]=1;return n}toStringArray(t,n){if(!(null==t?void 0:t.length))return[];"string"==typeof n&&(n={transform:n});let r,i="upper"===(null==n?void 0:n.transform)?String.prototype.toUpperCase:"lower"===(null==n?void 0:n.transform)?String.prototype.toLowerCase:null;const o=!1!==(null==n?void 0:n.trim);if("string"==typeof t)r=t.split(",");else{if(!Array.isArray(t))return e.logger.warn("illegal format of string array"),[];r=t}if(r.forEach((e,t)=>{null==e&&(e=""),e=String(e),o&&(e=e.trim()),i&&(e=i.apply(e)),r[t]=e}),null==n?void 0:n.unique){const e=new Set(r);return Array.from(e.values())}return r}padString(e,t,n,r){let i;i=null==e?"":String(e);const o=(n=String(n)).length,s=[i];for(let e=i.length;e<t;e+=o)r?s.push(n):s.unshift(n);return s.join("")}padNumber(t,n){return e.utils.strings.padString(t,n,"0",!1)}randomString(e){(!e||isNaN(e)||e<1)&&(e=6);const t=String((1+Math.random())*Date.now());let n=btoa(t).replace(/[^a-z]/gi,"");for(;n.length<e;)n+=n;return n.length>e&&(n=n.substring(n.length-e)),n}htmlToText(t){if(!(null==t?void 0:t.length))return"";const n=t.replace(/<[^>]*>/g," ").replace(/[ \t]{2}/g," "),r=null===window||void 0===window?void 0:window.document;if(!r)return e.logger.warn("HTML Entity conversion is not implemented outside the browser"),n;this._htmlConvertElement||(this._htmlConvertElement=r.createElement("div"));try{return this._htmlConvertElement.innerHTML=n,this._htmlConvertElement.textContent}catch(r){return e.logger.warn(`Error converting HTML Entities in ${n} (original: ${t})`),n}}isEmptyString(e){let t,n=(null==e?void 0:e.length)||0;for(;n>0;)if(t=e[--n],t&&"â"!==t&&"\ufeff"!==t)return!1;return!0}getEffectiveStringLength(e){let t,n=e&&e.length||0,r=0;for(;n>0;)t=e.charCodeAt(--n),0!==t&&8203!==t&&65279!==t&&++r;return r}getEffectiveStringIndex(e,t){if(isNaN(t)||t<0)return 0;let n,r=e&&e.length||0;if(t>=r)return r;let i=0;for(let o=0;o<r;++o)if(n=e.charCodeAt(o),0!==n&&8203!==n&&65279!==n&&++i>t)return o;return r}},writable:!1,enumerable:!1})}}(window.LOOPINDEX),Object.defineProperty(s,"__esModule",{value:!0}),function(e){if(e.utils.dom&&e.utils.compareVersions("1.7.7",e.utils.dom.VERSION)<1)return;if(!e.utils.strings)return e.logger.error("dom tils requires string utils");const t=function(){const e=function(...e){return 1};return e.acceptNode=function(...e){return 1},e}();class n{constructor(){this.VERSION="1.7.7",this._matchSelector=null}getNodeWindow(e){var t,n;return null!==(n=null===(t=null==e?void 0:e.ownerDocument)||void 0===t?void 0:t.defaultView)&&void 0!==n?n:null}getNodeIframe(e){var t;const n=this.getNodeWindow(e);return null!==(t=null==n?void 0:n.frameElement)&&void 0!==t?t:null}isScrollable(e){if(1!==(null==e?void 0:e.nodeType))return!1;const t=e;return t.scrollHeight>t.clientHeight}findScrollParent(e){const t=null==e?void 0:e.parentNode;return t?this.isScrollable(t)?t:this.findScrollParent(t):null}getScrollParents(e){const t=this.findScrollParent(e);if(t)return[t,...this.getScrollParents(t)];const n=this.getNodeIframe(e);return n?this.getScrollParents(n):[]}saveScrollPosition(e){const t=(this.isScrollable(e)?[e]:[]).concat(this.getScrollParents(e)).map(e=>({el:e,scrollY:e.scrollTop}));return()=>{t.forEach(e=>{e.el.scrollTop=e.scrollY})}}elementToHtml(e){const{el:t,xml:n,withRoot:r}=e;if(1!==(null==t?void 0:t.nodeType))return(null==t?void 0:t.data)||"";if(n){const e=new XMLSerializer,n=t=>{let n=e.serializeToString(t);return t.getAttribute("xmlns")||(n=n.replace(/\s*xmlns="[^"]+"/,"")),n};if(r)return n(t);const i=[];for(let e=t.firstChild;e;e=e.nextSibling)3===e.nodeType?i.push(e.data):1===e.nodeType&&i.push(n(e));return i.join("")}return r?t.outerHTML:t.innerHTML}attachCBToLink(t,n,r){if(!t||!n||"function"!=typeof r)return void e.logger.warn("attachCBToElement: bad input");const i=function(){t.removeEventListener("load",i),t.removeEventListener("error",o),r({url:n})};function o(e){t.removeEventListener("load",i),t.removeEventListener("error",o),r({url:n,error:String(e)||"error"})}"function"==typeof t.addEventListener?(t.addEventListener("load",i),t.addEventListener("error",o)):(t.onload=function(){i()},t.onerror=function(e){o(e)})}getElementOwnStyle(e,t){var n;const r=this.toElement(e),i=null===(n=null==r?void 0:r.style)||void 0===n?void 0:n[t];return null==i?null:i}getElementOwnIntStyle(e,t){const n=this.getElementOwnStyle(e,t);return null===n?NaN:parseInt(n)}getElementOwnFloatStyle(e,t){const n=this.getElementOwnStyle(e,t);return null===n?NaN:parseFloat(n)}static myNormalizeNode(e){if(!e||1!==e.nodeType)return;let t=e.firstChild;for(;t;){if(1===t.nodeType)n.myNormalizeNode(t);else if(3==t.nodeType){let n;for(;(n=t.nextSibling)&&3==n.nodeType;){const r=n.nodeValue;r&&(t.nodeValue=t.nodeValue+r),e.removeChild(n)}}t=t.nextSibling}}getPositioningParent(e){let t,n=this.toJQuery(e),r=n;for(;(n=n.parent()).length&&n[0].ownerDocument&&(r=n,t=r.css("position"),"relative"!==t&&"absolute"!==t&&"fixed"!==t););return r}addScriptToDocument(t,n){n=n||window.document;const r=e.utils.strings.toStringArray(t),i={ok:!0,failed:[],loaded:[]};return new Promise(o=>{const s=r=>{if(!(null==r?void 0:r.length))return o(i);const a=r[0];try{if(r=r.slice(1),!a)return e.logger.warn("null script found in addScriptToDocument input"),s(r);const t=n.createElement("script");t.setAttribute("type","text/javascript"),this.attachCBToLink(t,a,t=>{t.error?(i.ok=!1,i.failed.push({url:a,error:t.error}),e.logger.error(`Error loading script ${a}: ${t.error}`)):i.loaded.push(a),s(r)}),t.setAttribute("src",a),document.head.appendChild(t)}catch(n){e.logger.error(`Exception While loading script ${t}\n${n}`),i.ok=!1,i.failed.push({url:a,error:String(n)}),o(i)}};s(r)}).then(e=>e)}get NodeIteratorUniversalFunction(){return t}isContentEditable(e,t,n){let r;for(let n=e&&e.parentNode;n&&n!==t;n=n.parentNode)if(1===n.nodeType&&(r=n.getAttribute("contenteditable"),r)){if(r=r.toLowerCase(),"true"===r)return!0;if("false"===r)return!1}return n}createTreeWalker(n,r,i){const o=n&&n.ownerDocument;if(!o)return null;let s=i?function(){const e=e=>i(e);return e.acceptNode=()=>1,e}():e.browser.msie?t:null;return o.createTreeWalker(n,r,s,!1)}createNodeIterator(n,r,i){const o=n&&n.ownerDocument;if(!o)return null;let s=i?function(){const e=e=>i(e);return e["]acceptNode"]=()=>1,e}():e.browser.msie?t:null;return o.createNodeIterator(n,r,s,!1)}getNodeIndex(e){if(!e)return-1;let t=0;for(;e=e.previousSibling;)++t;return t}insertNodeAt(e,t,n){return!(!e||!t||1!==t.nodeType||n<0)&&(t.insertBefore(e,t.childNodes[n]),!0)}normalizeNode(t){return t?e.browser.msie||"function"!=typeof t.normalize?(n.myNormalizeNode(t),t):(t.normalize(),t):null}isEmptyTextNode(t){if(!t||3!==t.nodeType)return!1;const n=t;return 0===n.length||e.utils.strings.isEmptyString(n.nodeValue)}getNodeLength(e){const t=e&&e.nodeType;return 1===t?e.children.length:3===t?e.length:0}getNodeTextContent(e){return $(e).text()}isOnlyChild(e){const t=e&&e.parentNode;return Boolean(t&&t.firstChild===e&&t.lastChild===e)}insertAfter(e,t,n){return e?(n=n||t&&t.parentNode,t&&t.parentNode!==n&&(t=null),n?t?n.insertBefore(e,t.nextSibling):n.insertBefore(e,n.firstChild):void 0):null}contents(e){return $.makeArray($(e).contents())}extractContent(e){for(var t,n=document.createDocumentFragment();t=e.firstChild;)n.appendChild(t);return n}toElement(e){return e&&"object"==typeof e?e[0]&&"string"==typeof e.jquery?e[0]:1===e.nodeType?e:null:null}toNode(e){return e&&"object"==typeof e?e[0]&&"string"==typeof e.jquery?e[0]:1===e.nodeType||3===e.nodeType?e:null:null}toJQuery(t,n=!1){if(!t)return e.$("");let r=t;return r instanceof e.$||(r=e.$(t)),!n&&r.length>1&&(r=r.eq(0)),r}getRealTextLength(t){return t&&t.data?e.utils.strings.getRealTextLength(t.data):0}isDescendantOf(t,n){if(!n||!t)return!1;const r="string"==typeof n&&n;if(!r){const e=n;if(9===e.nodeType)n=n.body;else if(1!==e.nodeType)return!1}try{for(;t&&t.parentNode;){if(r){if(e.utils.dom.matchesSelector(t.parentNode,r))return!0}else if(t.parentNode===n)return!0;t=t.parentNode}}catch(e){}return!1}clearNodeBackgroundImage(e){e&&e.style&&e.style["background-image"]&&(e.style["background-image"]=null)}getElementPageOffset(e,t){if(!e||!e.getBoundingClientRect)return{top:0,left:0};const n=e.getBoundingClientRect(),r=e.ownerDocument,i=r.defaultView,o=r.body,s=r.documentElement,a=i.pageYOffset||s.scrollTop||i.scrollY||o.scrollTop||0,l=i.pageXOffset||s.scrollLeft||i.scrollX||o.scrollLeft||0,c=s.clientTop||o.clientTop||0,d=s.clientLeft||o.clientLeft||0,u=n.top+a-c,h=n.left+l-d,f={top:Math.round(u),left:Math.round(h)};return t&&(f.top+=o.scrollTop||0,f.left+=o.scrollLeft||0),f}compareNodePosition(e,t){if(e===t)return 0;var n=e.compareDocumentPosition(t);return 4&n||8&n?-1:1}forAllTextChildren(e,t){if(e&&t&&1===e.nodeType)for(let n=e.firstChild,r=n&&n.nextSibling;n;n=r,r=n&&n.nextSibling)1===n.nodeType?this.forAllTextChildren(n,t):3===n.nodeType&&t(n)}getFirstNodeInRange(t){const n=t&&t.startContainer;if(!n)return null;if(3===n.nodeType)return n;var r=this.getNthChild(n,t.startOffset);if(r)return r;const i=e.utils.dom.createNodeIterator(n,NodeFilter.SHOW_TEXT||NodeFilter.SHOW_ELEMENT);return null==i?void 0:i.nextNode()}getLastNodeInRange(t){const n=t&&t.endContainer;if(!n)return null;if(3===n.nodeType)return n;var r=this.getNthChild(n,t.endOffset-1);if(r)return r;const i=e.utils.dom.createNodeIterator(n,NodeFilter.SHOW_TEXT||NodeFilter.SHOW_ELEMENT);return null==i?void 0:i.previousNode()}hasTextSelection(e){if(!e||e.collapsed)return!1;if(3===e.startContainer.nodeType&&e.startOffset<e.startContainer.length)return!0;if(3===e.endContainer.nodeType&&e.endOffset<e.endContainer.length)return!0;let t=!1;return this.walkRange(e,(e,n)=>!(3===e.nodeType&&e.length>0)||(t=!0,!1)),t}getNthChild(e,t){if(!e||1!==e.nodeType)return null;for(let n=e.firstChild;n&&t>=0;n=n.nextSibling,--t)if(0===t)return n;return null}getSelectedTextNodes(e){if(!e||e.collapsed)return[];const t=[];return this.walkRange(e,(e,n)=>{if(3===e.nodeType){const r=this.processTextNode(e,n);r&&t.push(r)}return!0}),t}extractTextNode(e){if(!e||!e.node)return null;if(!e.partial)return e.node;let t=e.node;return e.end<t.length&&t.splitText(e.end),e.start>0&&(t=t.splitText(e.start)),t}extractInlineNode(t){let r=null==t?void 0:t.node;if(3!==(null==r?void 0:r.nodeType))return e.logger.warn("extractInlinecontent: null or not text node"),null;const i=(t=>{for(;t.parentNode&&n.INLINE_RE.test(e.$(t.parentNode).css("display"));)t=t.parentNode;return t})(r);if(i===r)return e.utils.dom.extractTextNode(t);const o=i,s=e.utils.dom;if(!t.partial)return s.splitNode(o,t.node,t.end);let a=o;if(t.end<r.length){a=s.splitNode(a,r,t.end);let e=a.lastChild;for(;e&&1===e.nodeType;)e=e.lastChild;r=3===(null==e?void 0:e.nodeType)?e:null}return t.start>0&&r&&s.splitNode(a,r,t.start),a}splitNode(t,n,r){if(0===r&&(n===t||n===t.firstChild))return t;if(r>=e.utils.dom.getNodeLength(n)&&(n===t||n===t.lastChild))return t;const i=t.parentNode,o=e.utils.dom.getNodeIndex(t),s=n.ownerDocument.createRange();s.setStart(i,o),s.setEnd(n,r);const a=s.extractContents();return i.insertBefore(a,t),t.previousSibling||t}walkRange(t,n){if(!t||t.collapsed)return;let r;const i=this.getFirstNodeInRange(t),o=this.getLastNodeInRange(t);if(!i||!o)return;let s=!1,a=!1;const l=e.utils.dom.createNodeIterator(t.commonAncestorContainer,NodeFilter.SHOW_ALL);if(l)for(;(r=l.nextNode())&&(!a||e.utils.dom.isDescendantOf(r,o));){if(!s){if(r!=i)continue;s=!0}if(!n(r,t))return;r===o&&(a=!0)}}processTextNode(e,t){let n;if(!e||3!==e.nodeType||!(n=e.length))return null;const r={node:e,start:0,end:n,partial:!1};if(e===t.startContainer&&t.startOffset>0){if(t.startOffset>=n)return null;r.partial=!0,r.start=t.startOffset}return e===t.endContainer&&t.endOffset<n&&(r.partial=!0,r.end=t.endOffset),r}hasClass(e,t){if(!e||1!==e.nodeType)return!1;const n=e,r=n.classList||n.className&&n.className.split(/\s/);if(r&&r.length)for(let e=r.length-1;e>=0;--e)if(r[e]===t)return!0;return!1}getScrollParent(e){const t=$(e.node),n=t.css("position"),r="absolute"===n,i=e.hidden?/(auto|scroll|hidden)/:/(auto|scroll)/,o=t.parents().filter((function(){const e=$(this);return(!r||"static"!==e.css("position"))&&i.test(e.css("overflow")+e.css("overflow-y")+e.css("overflow-x"))})).eq(0);return"fixed"!==n&&o.length?o[0]:t[0].ownerDocument||document}matchesSelector(e,t){if(!e||1!==e.nodeType||!t)return!1;if(!this._matchSelector){const t=e;let n;n="function"==typeof t.matches?(e,t)=>e.matches(t):"function"==typeof t.msMatchesSelector?(e,t)=>e.msMatchesSelector(t):"function"==typeof t.webkitMatchesSelector?(e,t)=>e.webkitMatchesSelector(t):(e,t)=>$(e).is(t),this._matchSelector=n}return this._matchSelector(e,t)}}n.INLINE_RE=/inline/i,Object.defineProperty(e.utils,"dom",{value:new n,writable:!1,enumerable:!1})}(window.LOOPINDEX),Object.defineProperty(s,"__esModule",{value:!0}),function(e){const t=new RegExp("s*quicktip-position-[a-z]+","g"),n={color:{daffodil:{r:255,g:230,b:23},daisy:{r:250,g:211,b:28},mustard:{r:253,g:183,b:23},"citrus zest":{r:250,g:170,b:33},pumpkin:{r:241,g:117,b:63},tangerine:{r:237,g:87,b:36},salmon:{r:240,g:70,b:57},persimmon:{r:234,g:40,b:48},rouge:{r:188,g:35,b:38},scarlet:{r:140,g:12,b:3},"hot pink":{r:229,g:24,b:93},princess:{r:243,g:132,b:174},petal:{r:250,g:198,b:210},lilac:{r:178,g:150,b:199},lavender:{r:123,g:103,b:174},violet:{r:95,g:53,b:119},cloud:{r:195,g:222,b:241},dream:{r:85,g:190,b:237},gulf:{r:49,g:168,b:224},turquoise:{r:35,g:138,b:204},sky:{r:13,g:96,b:174},indigo:{r:20,g:59,b:134},navy:{r:0,g:27,b:74},"sea foam":{r:125,g:205,b:194},teal:{r:0,g:168,b:168},peacock:{r:18,g:149,b:159},ceadon:{r:193,g:209,b:138},olive:{r:121,g:145,b:85},bamboo:{r:128,g:188,b:66},grass:{r:74,g:160,b:63},kelly:{r:22,g:136,b:74},forrest:{r:0,g:63,b:46},chocolate:{r:56,g:30,b:17},"terra cotta":{r:192,g:92,b:32},camel:{r:191,g:155,b:107},linen:{r:233,g:212,b:167},stone:{r:231,g:230,b:225},smoke:{r:207,g:208,b:210},steel:{r:138,g:139,b:143},slate:{r:119,g:133,b:144},charcoal:{r:71,g:77,b:77},black:{r:5,g:6,b:8},white:{r:255,g:255,b:255},"metalic silver":{r:152,g:162,b:171},"metalic gold":{r:159,g:135,b:89},"metalic copper":{r:140,g:102,b:65}},stickTo:{bottom:"bottom",left:"left",right:"right",top:"top"}},r={animateDuration:300,animateFunction:"fadein",delay:500,disableAnimation:!1,hideDelay:300,persistent:!1,stickTo:n.stickTo.bottom,stickDistance:10,unique:!1,useTitle:!1,canShow:void 0,dismissEvents:["keydown","mousedown"]};class i{static setElementPositionClass(e,n){var r;return e.className=(null!==(r=e.className)&&void 0!==r?r:"").replace(t,""),e.classList.add("quicktip-position-"+n),e}static getElementsBySelector(t,n){if(!t)return[];try{return Array.prototype.slice.call((n||document).querySelectorAll(t))}catch(t){return e.logger.warn("get Elements By Selector error: "+t),[]}}static destroyObject(e){if(e)if(Array.isArray(e))e.length=0;else{Object.keys(e).forEach(t=>{try{e[t]=void 0}catch(e){}})}}static attachAnimationCallback({el:t,callback:n,duration:r}){let i=0;const o=()=>{e.logger.log("transition end for",t),t.removeEventListener("transitionend",o),t.removeEventListener("webkitTransitionEnd",o),i&&(clearTimeout(i),i=0),n(t)};t.addEventListener("transitionend",o),t.addEventListener("webkitTransitionEnd",o),r=Number(r)||300,i=setTimeout(()=>{e.logger.log("Animation timeout fired after "+r),o()},r)}static px(e){return(e||0).toFixed(0)+"px"}static px0(e){return i.px(Math.max(0,e||0))}static toArray(e,t=0){return Array.from(e).slice(t)}static isChildOf(e,t){if(!e||!t)return!1;let n;for(;n=null==e?void 0:e.parentNode;){if(n===t)return!0;e=n}return!1}static findOptionsTargets(e){var t;const n=1===(null===(t=e.target)||void 0===t?void 0:t.nodeType)?[e.target]:[];if(e.targetSelector){i.getElementsBySelector(e.targetSelector,e.root).forEach(e=>{n.includes(e)||n.push(e)})}return n}static argsToObj(e){var t=i.toArray(e).map(e=>typeof e),n={};if("object"===t[0])n=e[0];else if("string"===t[0]){const t=e[0].split(" ");for(var r in t)n[t[r]]=e[1]}else"function"===t[0]&&(n={"":e[0]});return n}static gainAnchorElements(e){return{box:e.querySelector(".quicktips-box"),more:e.querySelector(".quicktips-more"),moreText:e.querySelector(".quicktips-more .quicktips-text"),text:e.querySelector(":not(.quicktips-more) .quicktips-text")}}static extractOptionAttribute(e,t,n){for(var r=e.getAttribute(t),i=e;!r&&(i=i.parentNode)&&i.getAttribute;)r=i.getAttribute(t);return r||String(n)}static extractBooleanAttribute(t,n,r){const o=i.extractOptionAttribute(t,n,String(r));return!!/^(true|yes|on|1)$/i.test(o)||!/^(false|no|off|0)$/i.test(o)&&(e.logger.error(`Illegal value ${o} for attribute ${n}`),r)}static extractNumberAttribute(e,t,n){const r=i.extractOptionAttribute(e,t,String(n)),o=parseFloat(r);return isNaN(o)?n:o}}class o{static getNodeWindow(e){var t,n;return null!==(n=null===(t=null==e?void 0:e.ownerDocument)||void 0===t?void 0:t.defaultView)&&void 0!==n?n:null}static getNodeIframe(e){var t;const n=o.getNodeWindow(e);return null!==(t=null==n?void 0:n.frameElement)&&void 0!==t?t:null}static getNodeFrames(e,t=!1){const n=[];let r=e;for(;r;){const e=o.getNodeIframe(r);(e||t)&&n.push(o.getNodeWindow(r)),r=e}return n}static canAttach(e){var t;const n=null!==(t=this.MY_FRAMES)&&void 0!==t?t:this.MY_FRAMES=o.getNodeFrames(window.document.head);if(!n.length)return!0;return o.getNodeFrames(e).includes(n[n.length-1])}static getGlobalRect(e,t){let n=e.getBoundingClientRect();t=null!=t?t:o.getNodeFrames(e);for(const e of t){const t=e.frameElement.getBoundingClientRect();n=new DOMRect(n.x+t.x,n.y+t.y,n.width,n.height)}return n}static getRelativeRect(t,n){let r=t.getBoundingClientRect();const i=o.getNodeFrames(t),s=o.getNodeFrames(n);if(!i.length)return s.length&&e.logger.error("Can't attach tooltip in super frame"),r;if(!s.length)return this.getGlobalRect(t,i);const a=s[0];for(const e of i){if(e===a)break;const t=e.frameElement.getBoundingClientRect();r=new DOMRect(r.x+t.x,r.y+t.y,r.width,r.height)}return r}static attachGlobalObservers(e,t){return(Array.isArray(e)?e:[e]).reduce((e,t)=>(o.getNodeFrames(t,!0).forEach(t=>{e.includes(t)||e.push(t)}),e),[]).forEach(e=>{o.AttachedWindows.has(e)||(o.AttachedWindows.set(e,[]),o._attachToWindow(e));const n=o.AttachedWindows.get(e);n.includes(t)||n.push(t)}),()=>{o.AttachedWindows.forEach(e=>{let n=0;for(;(n=e.indexOf(t))>=0;)e.splice(n,1)})}}static _attachToWindow(e){let t=0;const n=n=>{t||(t=setTimeout(()=>{t=0;const r=o.AttachedWindows.get(e);(null==r?void 0:r.length)&&r.forEach(e=>e(n))},50))};for(const t of["resize","scroll","keydown"])e.addEventListener(t,()=>n(t),!1)}}o.AttachedWindows=new Map;class s{constructor(e,t){this.eventCallbacks={},this.modelObservers={},this._elements=[],this._anchors=null,this.notifyTimeoutID={},this.publ=e,this.model={},this._instantiate=()=>{if(!this._elements.length){const e=document.createElement("div");e.innerHTML=t,this._elements.push(...i.toArray(e.children)),this._anchors=i.gainAnchorElements(e)}}}on(...e){const t=i.argsToObj(e);for(const e in t){const n=t[e];if("function"!=typeof n)throw new Error(`Tooltip component: On ${e} received invalid callback`);this.eventCallbacks[e]=this.eventCallbacks[e]||[],this.eventCallbacks[e].push(n)}}get anchors(){return this._instantiate(),this._anchors}dispatch(e,...t){setTimeout(()=>{for(let n in this.eventCallbacks[e])this.eventCallbacks[e][n].apply(this.publ,t)})}get element(){return this._instantiate(),this._elements[0]}unmount(){this._elements.forEach(e=>{var t;null===(t=e.parentNode)||void 0===t||t.removeChild(e)})}destroy(){this.unmount(),i.destroyObject(this.eventCallbacks),i.destroyObject(this._anchors),i.destroyObject(this._elements)}onModelUpdate(...e){const t=i.argsToObj(e),n=this.model;for(let e in t)n[e]=n[e]||null,this.modelObservers[e]=this.modelObservers[e]||[],this.modelObservers[e].push(t[e]),this.notifyObservers(e)}mount(e){e=e||document.body,this._instantiate();try{this._elements.forEach(t=>{t.parentNode!==e&&e.appendChild(t)})}catch(e){throw"Could not mount component: "+String(e)}}set(e){const t=this.model;Object.entries(e).forEach(([e,n])=>{t[e]!==n&&(t[e]=n,this.notifyObservers(e))})}notifyObservers(e){clearTimeout(this.notifyTimeoutID[e]),this.notifyTimeoutID[e]=setTimeout(()=>{const t=this.model;for(let n in this.modelObservers[e])try{this.modelObservers[e][n](t[e])}catch(e){}if(this.modelObservers[""])for(let e in this.modelObservers[""])this.modelObservers[""][e]()})}}class a{constructor(){var e;this._isShown=!1,this._eventCallbacks=new Map([["destroy",[]],["hide",[]],["show",[]]]);const t=this.component=new s(this,'\n<div class="quicktips-tooltip" style="box-sizing:border-box;position:fixed;z-index:2147483647">\n  <div class="quicktips-box">\n    <div class="quicktips-text"></div>\n    <div class="quicktips-more" style="overflow:hidden;">\n      <div class="quicktips-text"></div>\n    </div>\n  </div>\n</div>');this.resetTooltipPosition(),(this._cachedTitle=null===(e=this.target)||void 0===e?void 0:e.getAttribute("title"))&&this.target.removeAttribute("title"),this.useTitle()?t.onModelUpdate({contentText:e=>{this._updateTitle(this.toText(e))}}):t.onModelUpdate({color:function(e){if(n.color[e]){const t=n.color[e];e="rgb("+t.r+", "+t.g+", "+t.b+")"}t.anchors.box.style.backgroundColor=e},contentText:e=>{t.anchors.text.innerHTML=this.toText(e)},contentMore:e=>{t.anchors.moreText.innerHTML=this.toText(e)},stickTo:function(e){i.setElementPositionClass(t.element,e)}})}get target(){var e,t;return null!==(t=null===(e=this.model)||void 0===e?void 0:e.target)&&void 0!==t?t:null}addEventCallback(e){const t=e.cb;if(t){const n=this._eventCallbacks.get(e.event);n.find(e=>e.cb===t)||n.push(e)}return this}set(e){this.component.set(e)}useTitle(){var e;return Boolean(null===(e=this.model)||void 0===e?void 0:e.useTitle)}get isShown(){return this._isShown}get model(){return this.component.model}get element(){return this.component.element}unmount(){this._onHide(),this.resetTooltipPosition(),this._isShown=!1,this.component.unmount()}destroy(){var e;this._cachedTitle&&(null===(e=this.target)||void 0===e||e.setAttribute("title",this._cachedTitle),this._cachedTitle=""),this._onHide(),this._onDestroy(),this.component.destroy()}on(...e){return this.component.on(...e)}showMore(){this.show().then(e=>{if(!e)return;const t=this.component.element,n=this.component.anchors.more,r=this.model;if(r.contentMore&&(n.style.display="block",n.style.visibility="visible"),"block"!==n.style.display&&r.contentMore){n.style.display="block",this.animateElementClass(t),this.moveTooltip();const e=n.getBoundingClientRect().height;n.style.visibility="visible",n.style.height="0",this.animateElementClass(n,t=>{t.style.height=e>0?i.px(e):"auto"})}})}async show(){if(this._isShown)return!0;const t=this.model;if(t.canShow&&!t.canShow())return!1;const n=this.component.model.target;return!(!(null==n?void 0:n.parentNode)||!n.ownerDocument)&&(this.useTitle()?(this._updateTitle(this.toText(t.contentText)),!1):(this.model.unique&&l.hideTooltipsInDocument(n.ownerDocument),this._isShown=!0,new Promise(e=>{this.component.mount();const t=this.component.element;"visible"!==t.style.visibility&&(t.style.visibility="visible",setTimeout(()=>{e(this._show())}))}).then(e=>e).catch(t=>(e.logger.error("Show tooltip error "+t),!1))))}moveTooltip(){const t=this.component.element,r=this.component.model;if(!this.component.model.target||"visible"!==t.style.visibility)return;t.style.width="auto";const s=t.getBoundingClientRect(),a=parseInt(r.maxWidth);a&&(t.style.width=s.width>a?i.px(a):"auto");const l=o.getRelativeRect(r.target,t),c=t.getBoundingClientRect();switch(r.stickTo){case n.stickTo.bottom:t.style.left=i.px0(l.left+(l.width-c.width)/2),t.style.top=i.px0(l.top+l.height+r.stickDistance);break;case n.stickTo.left:t.style.left=i.px0(l.left-c.width-r.stickDistance),t.style.top=i.px0(l.top+(l.height-c.height)/2);break;case n.stickTo.right:t.style.left=i.px0(l.left+l.width+r.stickDistance),t.style.top=i.px0(l.top+(l.height-c.height)/2);break;case n.stickTo.top:t.style.left=i.px0(l.left+(l.width-c.width)/2),t.style.top=i.px0(l.top-c.height-r.stickDistance);break;default:e.logger.error("Unkonwn tooltip position "+r.stickTo)}}async hide(){if(!this._isShown)return;this._isShown=!1;const e=this.model,t=this.component.anchors.box;return this._onHide(),new Promise(n=>{this.applyAnimationClass(t,e.animateFunction+"-to",e.animateFunction+"-from",()=>{this._isShown||this.resetTooltipPosition(),n()})}).then(()=>{}).catch(e=>{})}_updateTitle(e){const t=this.target,n=this._cachedTitle?`${this._cachedTitle} (${e})`:e;t.setAttribute("title",n)}toText(e,t=!1){return"function"==typeof e?e(this,t):String(e)}_show(){if(!this._isShown)return!1;this.addEventCallback({event:"hide",cb:o.attachGlobalObservers([this.element,this.target],e=>{"resize"!==e&&"scroll"!==e||this.moveTooltip()}),once:!0}),this.moveTooltip();const e=this.model,t=e.dismissEvents||[],n=()=>{this.hide()},r=this.target.ownerDocument.body;return t.forEach(e=>r.addEventListener(e,n,!0)),this.addEventCallback({event:"hide",cb:()=>{var e;const r=null===(e=this.target)||void 0===e?void 0:e.ownerDocument.body;t.forEach(e=>null==r?void 0:r.removeEventListener(e,n,!0))},once:!0}),this.applyAnimationClass(this.component.anchors.box,e.animateFunction+"-from",e.animateFunction+"-to"),this._runEventCallbacks("show"),!0}resetTooltipPosition(){if(this.useTitle())return;const e=this.component.element,t=this.component.anchors.more;e&&t&&("collapse"!==e.style.visibility&&(e.style.visibility="collapse"),e.style.left="-9999px",e.style.top="-9999px","none"!==t.style.display&&(t.style.display="none",t.style.visibility="collapse",t.style.height="auto"))}_onDestroy(){this._runEventCallbacks("destroy"),this._eventCallbacks.clear()}_runEventCallbacks(e){const t=this._eventCallbacks.get(e);let n=!1;t.forEach(e=>{try{e.cb(this)}catch(e){}n=n||Boolean(e.once)}),n&&this._eventCallbacks.set(e,t.filter(e=>!e.once))}_onHide(){this._runEventCallbacks("hide")}applyAnimationClass(e,t,n,r){const o=this.component.model;o.disableAnimation?r&&r():(e.classList.add(t),e.getBoundingClientRect(),e.classList.add("animating"),e.classList.remove(t),e.classList.add(n),i.attachAnimationCallback({el:e,callback:()=>{e.classList.remove("animating"),e.classList.remove(n),r&&r()},duration:o.animateDuration}),setTimeout((function(){e.classList.remove("animating"),e.classList.remove(n),r&&r()}),o.animateDuration))}animateElementClass(e,t){const n=this.component.model;n.disableAnimation?t&&t(e):(e.getBoundingClientRect(),i.attachAnimationCallback({el:e,callback:()=>{e.classList.remove("animating"),t&&t(e)},duration:n.animateDuration}),e.classList.add("animating"))}}const l=new class{constructor(){this.allTooltips=[]}findTooltipByTarget(e){var t;return null!==(t=this.allTooltips.find(t=>t.model.target===e))&&void 0!==t?t:null}createTooltip(e){const t=e.target;if(1!==(null==t?void 0:t.nodeType))throw new Error("Can't create tooltip for null or non element target");const n=this.findTooltipByTarget(t);if(n)return n.component.set(e),n;const r=new a;let i,o;function s(e){const t=e.target;t===i&&(i=null),t===o&&(o=null)}function l(){t!==i&&r.element!==i&&(r.model.persistent?r.hide().then((function(){r.unmount()})):r.unmount())}function c(){i=null,t!==o&&(r.model.persistent?setTimeout(l,r.model.hideDelay):l())}this.allTooltips.push(r),r.addEventCallback({event:"destroy",cb:e=>{s(e);const t=this.allTooltips.indexOf(e);t>=0&&this.allTooltips.splice(t,1)}}).addEventCallback({event:"hide",cb:s}),r.component.set(Object.assign(Object.assign({},e),{target:t}));const d={mouseenter:function(){this!==i&&this!==o&&(i=this,setTimeout(()=>{this===i&&r.show()},r.useTitle()?1:r.model.delay))},mouseleave:c,focus:function(){r.useTitle()||!/INPUT|TEXTAREA/.test(this.tagName)&&"true"!==this.getAttribute("contenteditable")||(o=this,r.showMore())},blur:function(){o===this&&(o=null),i!==r.element&&r.unmount()}};Object.entries(d).forEach(([e,n])=>{t.addEventListener(e,n)});const u={mouseenter:function(){i=this},mouseleave:c},h=r.element;return Object.entries(u).forEach(([e,t])=>{h.addEventListener(e,t)}),r.addEventCallback({event:"destroy",cb:e=>{var t;const n=e.element,r=null===(t=e.model)||void 0===t?void 0:t.target;n&&Object.entries(u).forEach(([e,t])=>{n.removeEventListener(e,t)}),r&&Object.entries(d).forEach(([e,t])=>{r.removeEventListener(e,t)})}}),r}createDOMTooltips(e){e=null!=e?e:window;Array.from(e.document.querySelectorAll("[data-tooltip]")).forEach(e=>{this.createDefaultTooltip(e)})}createDefaultTooltip(e){const t={disableAnimation:i.extractBooleanAttribute(e,"data-tooltip-disable-animation",r.disableAnimation),animateFunction:i.extractOptionAttribute(e,"data-tooltip-animate-function",r.animateFunction),color:i.extractOptionAttribute(e,"data-tooltip-color",""),contentMore:i.extractOptionAttribute(e,"data-tooltip-more",""),contentText:i.extractOptionAttribute(e,"data-tooltip",""),delay:i.extractNumberAttribute(e,"data-tooltip-delay",r.delay),hideDelay:i.extractNumberAttribute(e,"data-tooltip-hide-delay",r.delay),maxWidth:i.extractOptionAttribute(e,"data-tooltip-maxwidth","auto"),persistent:i.extractBooleanAttribute(e,"data-tooltip-persistent",r.persistent),stickTo:i.extractOptionAttribute(e,"data-tooltip-stickto",r.stickTo),animateDuration:r.animateDuration,stickDistance:r.stickDistance,dismissEvents:["keydown"],target:e};this.createTooltip(t)}createUserTooltips(t){t.forEach(t=>{const n=t.target?[t.target]:i.getElementsBySelector(t.targetSelector,t.root);if(0===n.length)return e.logger.warn("create tooltips: no targets found");const s=Object.assign({},r,t);n.forEach(t=>{if(!o.canAttach(t))return e.logger.error("Can't create tooltip in a sibling/parent iframe");s.target=t,this.createTooltip(s)})})}forAllTips(e,t){this.allTooltips.filter(e).forEach(e=>t(e))}forAllVisibleTips(e,t){this.allTooltips.filter(e=>Boolean(e.isShown)).filter(e).forEach(e=>t(e))}init(e){const t=Array.isArray(e)?e:[e];this.createUserTooltips(t)}autoinit(e){this.createDOMTooltips(e)}refresh(e){this.createDOMTooltips(e)}getTooltipByTarget(e){return e?this.findTooltipByTarget(e):null}destroyTooltipsInDocument(e){this.forAllTips(t=>{var n,r,i;return(null===(i=null===(r=null===(n=t.component)||void 0===n?void 0:n.model)||void 0===r?void 0:r.target)||void 0===i?void 0:i.ownerDocument)===e},e=>e.destroy())}destroyTooltipsInElement(e){this.forAllTips(t=>{var n,r;return i.isChildOf(null===(r=null===(n=t.component)||void 0===n?void 0:n.model)||void 0===r?void 0:r.target,e)},e=>e.destroy())}hideTooltipsInDocument(e){this.forAllVisibleTips(t=>{var n,r,i;return(null===(i=null===(r=null===(n=t.component)||void 0===n?void 0:n.model)||void 0===r?void 0:r.target)||void 0===i?void 0:i.ownerDocument)===e},e=>e.hide())}hideTooltipsInElement(e){this.forAllVisibleTips(t=>{var n,r;return i.isChildOf(null===(r=null===(n=t.component)||void 0===n?void 0:n.model)||void 0===r?void 0:r.target,e)},e=>e.hide())}hideElementTooltip(t){const n=e.Tooltips.getTooltipByTarget(t);null==n||n.hide()}destroyElementTooltip(t){const n=e.Tooltips.getTooltipByTarget(t);null==n||n.destroy()}};Object.defineProperty(e,"Tooltips",{writable:!1,configurable:!1,enumerable:!1,value:l})}(window.LOOPINDEX),Object.defineProperty(s,"__esModule",{value:!0}),function(e){const t=e.$;const n={ckeditor:new class{setButtonTitle({editor:n,titles:r}){const i=null==n?void 0:n.container;if(!(null==i?void 0:i.$))return e.logger.warn("Missing editor top container");const o=t(i.$);Object.keys(r).forEach(e=>{const t=e.replace(".","_"),i=n.ui.get(e),s=null==i?void 0:i._.id,a=[".cke_button__"+t];s&&a.push("#"+s);const l=a.join(",");o.find(l).each((t,n)=>{n.setAttribute("title",r[e]);const i=n.getAttribute("aria-labelledby");i&&o.find("#"+i).text(r[e])})})}saveUndo(e,t){t?e.undoManager.update():e.undoManager.save(!0,null,!1)}}};Object.assign(e,n)}(window.LOOPINDEX),Object.defineProperty(s,"__esModule",{value:!0}),function(e){const t={tinymce:new class{getEditorSetting(e,t){var n;return null===(n=e.options)||void 0===n||n.get,e.options.get(t)}setEditorSetting(t,n,r){var i;try{return null===(i=t.options)||void 0===i||i.set,void t.options.set(n,r)}catch(t){e.logger.error(`set editor setting ${n} to ${r}: ${t}`)}}saveUndo(e,t){const n=e.undoManager;null==n||n.add()}}};Object.assign(e,t)}(window.LOOPINDEX),function(e){var t=window.LOOPINDEX;if(!t)throw new Error("FLITE: global LOOPINDEX is not defined");if(t.FLITE)return console.error("FLITE NS included more than once");t.FLITE={},Object.defineProperty(t.FLITE,"logger",{value:t.createLogger({prefix:"FLITE"}),writable:!1,configurable:!1})}(),t=function(e){var t=e.FLITE,n=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],r=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],i=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],o=["collapse","compareEndPoints","duplicate","moveToElementText","parentElement","select","setEndPoint","getBoundingClientRect"];function s(e,t){var n=typeof e[t];return"function"==n||!("object"!=n||!e[t])||"unknown"==n}function a(e,t){return!("object"!=typeof e[t]||!e[t])}function l(e,t){return void 0!==e[t]}function c(e){return function(t,n){for(var r=n.length;r--;)if(!e(t,n[r]))return!1;return!0}}var d=c(s),u=c(a),h=c(l);function f(e){return e&&d(e,o)&&h(e,i)}function g(e){return a(e,"body")?e.body:e.getElementsByTagName("body")[0]}var p,m,v={},y="undefined"!=typeof window&&"undefined"!=typeof document,C={isHostMethod:s,isHostObject:a,isHostProperty:l,areHostMethods:d,areHostObjects:u,areHostProperties:h,isTextRange:f,getBody:g,forEach:[].forEach?function(e,t){e.forEach(t)}:function(e,t){for(var n=0,r=e.length;n<r;++n)t(e[n],n)}},_={version:"1.3.0",initialized:!1,isBrowser:y,supported:!0,util:C,features:{},modules:v,config:{alertOnFail:!1,alertOnWarn:!1,preferTextRange:!1,autoInitialize:"undefined"==typeof rangyAutoInitialize||rangyAutoInitialize}};function N(e){t.logger.debug("Rangy: "+e)}function b(e){t.logger.warn("rangy module fail",e),_.initialized=!0,_.supported=!1}_.fail=b,_.warn=function(e){N("Rangy warning: "+e,_.config.alertOnWarn)},{}.hasOwnProperty?(C.extend=p=function(e,t,n){var r,i;for(var o in t)t.hasOwnProperty(o)&&(r=e[o],i=t[o],n&&null!==r&&"object"==typeof r&&null!==i&&"object"==typeof i&&p(r,i,!0),e[o]=i);return t.hasOwnProperty("toString")&&(e.toString=t.toString),e},C.createOptions=function(e,t){var n={};return p(n,t),e&&p(n,e),n}):b("hasOwnProperty not supported"),y||b("Rangy can only run in a browser"),function(){var e;if(y){var t=document.createElement("div");t.appendChild(document.createElement("span"));var n=[].slice;try{1==n.call(t.childNodes,0)[0].nodeType&&(e=function(e){return n.call(e,0)})}catch(e){}}e||(e=function(e){for(var t=[],n=0,r=e.length;n<r;++n)t[n]=e[n];return t}),C.toArray=e}(),y&&(s(document,"addEventListener")?m=function(e,t,n){e.addEventListener(t,n,!1)}:s(document,"attachEvent")?m=function(e,t,n){e.attachEvent("on"+t,n)}:b("Document does not have required addEventListener or attachEvent method"),C.addListener=m);var T=[];function E(e){return e.message||e.description||String(e)}function k(){if(y&&!_.initialized){var e,t=!1,i=!1;s(document,"createRange")&&(e=document.createRange(),d(e,r)&&h(e,n)&&(t=!0));var o=g(document);if(o&&"body"==o.nodeName.toLowerCase())if(o&&s(o,"createTextRange")&&f(e=o.createTextRange())&&(i=!0),t||i){var a;for(var l in _.initialized=!0,_.features={implementsDomRange:t,implementsTextRange:i},v)(a=v[l])instanceof O&&a.init(a,_);for(var c=0,u=T.length;c<u;++c)try{T[c](_)}catch(e){N("Rangy init listener threw an exception. Continuing. Detail: "+E(e))}}else b("Neither Range nor TextRange are available");else b("No body element found")}}function S(e,t,n){n&&(e+=" in module "+n.name),_.warn("DEPRECATED: "+e+" is deprecated. Please use "+t+" instead.")}function x(e,t,n,r){e[t]=function(){return S(t,n,r),e[n].apply(e,C.toArray(arguments))}}C.deprecationNotice=S,C.createAliasForDeprecatedMethod=x,_.init=k,_.addInitListener=function(e){_.initialized?e(_):T.push(e)};var w=[];function O(e,t,n){this.name=e,this.dependencies=t,this.initialized=!1,this.supported=!1,this.initializer=n}function A(e,t,n){var r=new O(e,t,(function(t){if(!0!==t.initialized)try{n(_,t),t.supported=!0}catch(t){N("Module '"+e+"' failed to load: "+E(t)),t.stack&&N(t.stack)}}));return v[e]=r,r}function R(){}_.addShimListener=function(e){w.push(e)},y&&(_.shim=_.createMissingNativeApi=function(e){e=e||window,k();for(var t=0,n=w.length;t<n;++t)w[t](e)},x(_,"createMissingNativeApi","shim")),O.prototype={init:function(){for(var e,t,n=this.dependencies||[],r=0,i=n.length;r<i;++r){if(t=n[r],!((e=v[t])&&e instanceof O))throw new Error("required module '"+t+"' not found");if(e.init(),!e.supported)throw new Error("required module '"+t+"' not supported")}this.initializer(this),this.initialized=!0},fail:function(e){throw this.initialized=!0,this.supported=!1,new Error(e)},warn:function(e){_.warn("Module "+this.name+": "+e)},deprecationNotice:function(e,t){_.warn("DEPRECATED: "+e+" in module "+this.name+" is deprecated. Please use "+t+" instead")},createError:function(e){return new Error("Error in Rangy "+this.name+" module: "+e)}},_.createModule=function(e){var t,n;2===arguments.length?(t=arguments[1],n=[]):(t=arguments[2],n=arguments[1]);var r=A(e,n,t);_.initialized&&_.supported&&r.init()},_.createCoreModule=function(e,t,n){A(e,t,n)},_.RangePrototype=R,_.rangePrototype=new R,_.selectionPrototype=new function(){},_.createCoreModule("DomUtil",[],(function(e,t){var n="undefined",r=e.util,i=r.getBody;r.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||t.fail("document missing a Node creation method"),r.isHostMethod(document,"getElementsByTagName")||t.fail("document missing getElementsByTagName method");var o=document.createElement("div");r.areHostMethods(o,["insertBefore","appendChild","cloneNode"]||!1)||t.fail("Incomplete Element implementation"),r.isHostProperty(o,"innerHTML")||t.fail("Element is missing innerHTML property");var s=document.createTextNode("test");r.areHostMethods(s,["splitText","deleteData","insertData","appendData","cloneNode"]||!1)||t.fail("Incomplete Text Node implementation");var a=function(e,t){return e.indexOf(t)>=0};function l(e){for(var t=0;e=e.previousSibling;)++t;return t}function c(e,t){var n,r=[];for(n=e;n;n=n.parentNode)r.push(n);for(n=t;n;n=n.parentNode)if(a(r,n))return n;return null}function d(e,t,n){for(var r=n?t:t.parentNode;r;){if(r===e)return!0;r=r.parentNode}return!1}function u(e,t,n){for(var r,i=n?e:e.parentNode;i;){if((r=i.parentNode)===t)return i;i=r}return null}function h(e){var t=e.nodeType;return 3==t||4==t||8==t}function f(e,t){var n=t.nextSibling,r=t.parentNode;return n?r.insertBefore(e,n):r.appendChild(e),e}function g(e){if(9==e.nodeType)return e;if(typeof e.ownerDocument!=n)return e.ownerDocument;if(typeof e.document!=n)return e.document;if(e.parentNode)return g(e.parentNode);throw t.createError("getDocument: no document found for node")}function p(e){var r=g(e);if(typeof r.defaultView!=n)return r.defaultView;if(typeof r.parentWindow!=n)return r.parentWindow;throw t.createError("Cannot get a window object for node")}function m(e){if(typeof e.contentDocument!=n)return e.contentDocument;if(typeof e.contentWindow!=n)return e.contentWindow.document;throw t.createError("getIframeDocument: No Document object found for iframe element")}function v(e){return e&&r.isHostMethod(e,"setTimeout")&&r.isHostObject(e,"document")}var y,C=!1;function _(e){try{return e.parentNode,!1}catch(e){return!0}}function N(e){if(!e)return"[No node]";if(C&&_(e))return"[Broken node]";if(h(e))return'{txt: "'+String(e.data).substring(0,10)+'..."}';if(1==e.nodeType){var t=e.id?"#"+e.id:"",n=e.className?"."+e.className:"";return"<"+e.nodeName+t+n+">[index:"+l(e)+"]"}return e.nodeName}function b(e){this.root=e,this._next=e,this._current=null}function T(e,t){this.node=e,this.offset=t}function E(e){this.code=this[e],this.codeName=e,this.message="DOMException: "+this.codeName}!function(){var t=document.createElement("b");t.innerHTML="1";var n=t.firstChild;t.innerHTML="<br />",C=_(n),e.features.crashyTextNodes=C}(),typeof window.getComputedStyle!=n?y=function(e,t){return p(e).getComputedStyle(e,null)[t]}:typeof document.documentElement.currentStyle!=n?y=function(e,t){return e.currentStyle?e.currentStyle[t]:""}:t.fail("No means of obtaining computed style properties found"),b.prototype={hasNext:function(){return!!this._next},next:function(){var e,t,n=this._current=this._next;if(this._current)if(e=n.firstChild)this._next=e;else{for(t=null;n&&n!==this.root&&!(t=n.nextSibling);)n=n.parentNode;this._next=t}return this._current},detach:function(){this._current=this._next=this.root=null}},T.prototype={equals:function(e){return!!e&&this.node===e.node&&this.offset==e.offset},inspect:function(){return"[DomPosition("+N(this.node)+":"+this.offset+")]"},toString:function(){return this.inspect()}},E.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11,INVALID_NODE_TYPE_ERR:24},E.prototype.toString=function(){return this.message},e.dom={arrayContains:a,isHtmlNamespace:function(e){var t;return typeof e.namespaceURI==n||null===(t=e.namespaceURI)||"http://www.w3.org/1999/xhtml"==t},parentElement:function(e){var t=e.parentNode;return 1==t.nodeType?t:null},getNodeIndex:l,getNodeLength:function(e){switch(e.nodeType){case 7:case 10:return 0;case 3:case 8:return e.length;default:return e.childNodes.length}},getCommonAncestor:c,isAncestorOf:d,isOrIsAncestorOf:function(e,t){return d(e,t,!0)},getClosestAncestorIn:u,isCharacterDataNode:h,isTextOrCommentNode:function(e){if(!e)return!1;var t=e.nodeType;return 3==t||8==t},insertAfter:f,splitDataNode:function(e,t,n){if(!e||3!==e.nodeType||t<0||t>=e.length)return e;var r=e.cloneNode(!1);if(r.deleteData(0,t),e.deleteData(t,e.length-t),f(r,e),n)for(var i,o=0;i=n[o++];)i.node==e&&i.offset>t?(i.node=r,i.offset-=t):i.node==e.parentNode&&i.offset>l(e)&&++i.offset;return r},getDocument:g,getWindow:p,getIframeWindow:function(e){if(typeof e.contentWindow!=n)return e.contentWindow;if(typeof e.contentDocument!=n)return e.contentDocument.defaultView;throw t.createError("getIframeWindow: No Window object found for iframe element")},getIframeDocument:m,getBody:i,isWindow:v,getContentDocument:function(e,t,n){var i;if(e?r.isHostProperty(e,"nodeType")?i=1==e.nodeType&&"iframe"==e.tagName.toLowerCase()?m(e):g(e):v(e)&&(i=e.document):i=document,!i)throw t.createError(n+"(): Parameter must be a Window object or DOM node");return i},getRootContainer:function(e){for(var t;t=e.parentNode;)e=t;return e},comparePoints:function(e,n,r,i){var o,s,a,d,h;if(e==r)return n===i?0:n<i?-1:1;if(o=u(r,e,!0))return n<=l(o)?-1:1;if(o=u(e,r,!0))return l(o)<i?-1:1;if(!(s=c(e,r)))throw new Error("comparePoints error: nodes have no common ancestor");if((a=e===s?s:u(e,s,!0))===(d=r===s?s:u(r,s,!0)))throw t.createError("comparePoints got to case 4 and childA and childB are the same!");for(h=s.firstChild;h;){if(h===a)return-1;if(h===d)return 1;h=h.nextSibling}},isBrokenNode:_,inspectNode:N,getComputedStyleProperty:y,createTestElement:function(e,t,n){var r=i(e),o=e.createElement("div");o.contentEditable=""+!!n,t&&(o.innerHTML=t);var s=r.firstChild;return s?r.insertBefore(o,s):r.appendChild(o),o},removeNode:function(e){return e&&e.parentNode&&e.parentNode.removeChild(e)},fragmentFromNodeChildren:function(e){for(var t,n=g(e).createDocumentFragment();t=e.firstChild;)n.appendChild(t);return n},createIterator:function(e){return new b(e)},DomPosition:T},e.DOMException=E})),_.createCoreModule("DomRange",["DomUtil"],(function(n,r){var i=n.dom,o=n.util,s=i.DomPosition,a=n.DOMException,l=i.isCharacterDataNode,c=i.getNodeIndex,d=i.isOrIsAncestorOf,u=i.getDocument,h=i.comparePoints,f=i.splitDataNode,g=i.getClosestAncestorIn,p=i.getNodeLength,m=i.arrayContains,v=i.getRootContainer,y=n.features.crashyTextNodes,C=i.removeNode;function _(e,t){return 3!=e.nodeType&&(d(e,t.startContainer)||d(e,t.endContainer))}function N(e){return e.document||u(e.startContainer)}function b(e){return new s(e.parentNode,c(e))}function T(e){return new s(e.parentNode,c(e)+1)}function E(e,t,n){var r=11==e.nodeType?e.firstChild:e;return l(t)?n==t.length?i.insertAfter(e,t):t.parentNode.insertBefore(e,0==n?t:f(t,n)):n>=t.childNodes.length?t.appendChild(e):t.insertBefore(e,t.childNodes[n]),r}function k(e,t,n){if(K(e),K(t),N(t)!=N(e))throw new a("WRONG_DOCUMENT_ERR");var r=h(e.startContainer,e.startOffset,t.endContainer,t.endOffset),i=h(e.endContainer,e.endOffset,t.startContainer,t.startOffset);return n?r<=0&&i>=0:r<0&&i>0}function S(t){for(var n,r=0,i=0,o=t.length;i<o;++i)"string"==typeof(n=t[i])?r+=e.utils.strings.getEffectiveStringLength(n):r++;return r}function x(t,n,r,o){var s,a,l,c;for(r=r||{stop:!1};l=t.next();)if(!o||!e.utils.dom.matchesSelector(l,o))if(t.isPartiallySelectedSubtree()){if(!1===n(l))return void(r.stop=!0);if(x(c=t.getSubtreeIterator(),n,r,o),c.detach(),r.stop)return}else if(3===l.nodeType){if(!1===n(l))return void(r.stop=!0)}else for(s=i.createIterator(l);a=s.next();)if(!1===n(a))return void(r.stop=!0)}function w(e){for(var t;e.next();)e.isPartiallySelectedSubtree()?(w(t=e.getSubtreeIterator()),t.detach()):e.remove()}function O(e){for(var t,n,r=N(e.range).createDocumentFragment();t=e.next();){if(e.isPartiallySelectedSubtree()?(t=t.cloneNode(!1),n=e.getSubtreeIterator(),t.appendChild(O(n)),n.detach()):e.remove(),10==t.nodeType)throw new a("HIERARCHY_REQUEST_ERR");r.appendChild(t)}return r}function A(e){return"["+(void 0===e.getName?"Range":e.getName())+"("+i.inspectNode(e.startContainer)+":"+e.startOffset+", "+i.inspectNode(e.endContainer)+":"+e.endOffset+")]"}function R(e,t){if(this.range=e,this._current=null,this._next=null,this._first=null,this._last=null,this.clonePartiallySelectedTextNodes=t,!e.collapsed){this.sc=e.startContainer,this.so=e.startOffset,this.ec=e.endContainer,this.eo=e.endOffset;var n=e.commonAncestorContainer;this.sc===this.ec&&l(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=l(this.sc)?g(this.sc,n,!0):this.sc.childNodes[this.so],this._last=l(this.ec)?g(this.ec,n,!0):this.ec.childNodes[this.eo-1]||this.ec)}}R.prototype={isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var e=this._current=this._next;return e&&(this._next=d(e,this._last)?null:e.nextSibling,l(e)&&this.clonePartiallySelectedTextNodes&&(e===this.ec&&(e=e.cloneNode(!0)).deleteData(this.eo,e.length-this.eo),this._current===this.sc&&(e=e.cloneNode(!0)).deleteData(0,this.so))),e},remove:function(){var e,t,n=this._current;!l(n)||n!==this.sc&&n!==this.ec?n.parentNode&&C(n):(e=n===this.sc?this.so:0)!=(t=n===this.ec?this.eo:n.length)&&n.deleteData(e,t-e)},isPartiallySelectedSubtree:function(){return _(this._current,this.range)},getSubtreeIterator:function(){var e;if(this.isSingleCharacterDataNode)(e=this.range.cloneRange()).collapse(!1);else{e=new le(N(this.range));var t=this._current,n=t,r=0,i=t,o=p(t);d(t,this.sc)&&(n=this.sc,r=this.so),d(t,this.ec)&&(i=this.ec,o=this.eo),ae(e,n,r,i,o)}return new R(e,this.clonePartiallySelectedTextNodes)},detach:function(){this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};var I=[1,3,4,5,7,8,10],L=[2,9,11],D=[1,3,4,5,7,8,10,11],P=[1,3,4,5,7,8];function M(e){return function(t,n){for(var r,i=n?t:t.parentNode;i;){if(r=i.nodeType,m(e,r))return i;i=i.parentNode}return null}}var B=M([9,11]),F=M([5,6,10,12]),j=M([6,10,12]);function U(e,t){if(j(e,t))throw new a("INVALID_NODE_TYPE_ERR")}function H(e,t){if(!m(t,e.nodeType))throw new a("INVALID_NODE_TYPE_ERR")}function $(e,t){if(t<0||t>(l(e)?e.length:e.childNodes.length))throw new a("INDEX_SIZE_ERR")}function q(e,t){if(B(e,!0)!==B(t,!0))throw new a("WRONG_DOCUMENT_ERR")}function W(e){if(F(e,!0))throw new a("NO_MODIFICATION_ALLOWED_ERR")}function G(e,t){if(!e)throw new a(t)}function z(e,t){return t<=(l(e)?e.length:e.childNodes.length)}function V(e){return!!e.startContainer&&!!e.endContainer&&!(y&&(i.isBrokenNode(e.startContainer)||i.isBrokenNode(e.endContainer)))&&v(e.startContainer)==v(e.endContainer)&&z(e.startContainer,e.startOffset)&&z(e.endContainer,e.endOffset)}function K(e){if(!V(e))throw new Error("Range error: Range is not valid. This usually happens after DOM mutation. Range: ("+e.inspect()+")")}var Y=document.createElement("style"),X=!1;try{Y.innerHTML="<b>x</b>",X=3==Y.firstChild.nodeType}catch(e){}n.features.htmlParsingConforms=X;var J=X?function(e){var t=this.startContainer,n=u(t);if(!t)throw new a("INVALID_STATE_ERR");var r=null;return 1==t.nodeType?r=t:l(t)&&(r=i.parentElement(t)),(r=null===r||"HTML"==r.nodeName&&i.isHtmlNamespace(u(r).documentElement)&&i.isHtmlNamespace(r)?n.createElement("body"):r.cloneNode(!1)).innerHTML=e,i.fragmentFromNodeChildren(r)}:function(e){var t=N(this).createElement("body");return t.innerHTML=e,i.fragmentFromNodeChildren(t)};function Q(e,t){K(e);var n=e.startContainer,r=e.startOffset,i=e.endContainer,o=e.endOffset,s=n===i;l(i)&&o>0&&o<i.length&&f(i,o,t),l(n)&&r>0&&r<n.length&&(n=f(n,r,t),s?(o-=r,i=n):i==n.parentNode&&o>=c(n)&&o++,r=0),e.setStartAndEnd(n,r,i,o)}function Z(e){K(e);var t=e.commonAncestorContainer.parentNode.cloneNode(!1);return t.appendChild(e.cloneContents()),t.innerHTML}var ee=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],te=function(e,t,n,r,i){if(!n||isNaN(Number(n)))return!1;var o=e.collapsed;switch(n=Number(n),t){case"char":return n>0?e.moveCharRight(r,n,i):e.moveCharLeft(r,-1*n,i);case"word":default:throw new Error("move by 'word' not implemented")}o&&e.collapse(r)};function ne(e){e.START_TO_START=0,e.START_TO_END=1,e.END_TO_END=2,e.END_TO_START=3,e.NODE_BEFORE=0,e.NODE_AFTER=1,e.NODE_BEFORE_AND_AFTER=2,e.NODE_INSIDE=3}function re(e){ne(e),ne(e.prototype)}function ie(e,t){return function(){K(this);var n,r=this.startContainer,i=this.startOffset,o=this.commonAncestorContainer,s=new R(this,!0);r!==o&&(r=(n=T(g(r,o,!0))).node,i=n.offset),x(s,W),s.reset();var a=e(s);return s.detach(),t(this,r,i,r,i),a}}function oe(e,t){function r(e,t){return function(n){H(n,I),H(v(n),L);var r=(e?b:T)(n);(t?i:s)(this,r.node,r.offset)}}function i(e,n,r){var i=e.endContainer,o=e.endOffset;n===e.startContainer&&r===e.startOffset||(v(n)==v(i)&&1!=h(n,r,i,o)||(i=n,o=r),t(e,n,r,i,o))}function s(e,n,r){var i=e.startContainer,o=e.startOffset;n===e.endContainer&&r===e.endOffset||(v(n)==v(i)&&-1!=h(n,r,i,o)||(i=n,o=r),t(e,i,o,n,r))}var a=function(){};a.prototype=n.rangePrototype,e.prototype=new a,o.extend(e.prototype,{setStart:function(e,t){U(e,!0),$(e,t),i(this,e,t)},setEnd:function(e,t){U(e,!0),$(e,t),s(this,e,t)},setStartAndEnd:function(){var e=arguments,n=e[0],r=e[1],i=n,o=r;switch(e.length){case 3:o=e[2];break;case 4:i=e[2],o=e[3]}t(this,n,r,i,o)},setBoundary:function(e,t,n){this["set"+(n?"Start":"End")](e,t)},setStartBefore:r(!0,!0),setStartAfter:r(!1,!0),setEndBefore:r(!0,!1),setEndAfter:r(!1,!1),collapse:function(e){return K(this),e?t(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):t(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset),this},selectNodeContents:function(e){return U(e,!0),t(this,e,0,e,p(e)),this},selectNode:function(e){U(e,!1),H(e,I);var n=b(e),r=T(e);return t(this,n.node,n.offset,r.node,r.offset),this},extractContents:ie(O,t),deleteContents:ie(w,t),canSurroundContents:function(){K(this),W(this.startContainer),W(this.endContainer);var e=new R(this,!0),t=e._first&&_(e._first,this)||e._last&&_(e._last,this);return e.detach(),!t},splitBoundaries:function(){return Q(this),this},splitBoundariesPreservingPositions:function(e){return Q(this,e),this},normalizeBoundaries:function(){K(this);var e,n=this.startContainer,r=this.startOffset,i=this.endContainer,o=this.endOffset,s=function(e){var t=e.nextSibling;t&&t.nodeType===e.nodeType&&(i=e,o=e.length,e.appendData(t.data),C(t))},a=function(e){var t=e.previousSibling;if(t&&t.nodeType===e.nodeType){n=e;var s=e.length;if(r=t.length,e.insertData(0,t.data),C(t),n==i)o+=r,i=n;else if(i==e.parentNode){var a=c(e);o==a?(i=e,o=s):o>a&&o--}}},d=!0;if(l(i))o==i.length?s(i):0==o&&(e=i.previousSibling)&&e.nodeType==i.nodeType&&(o=e.length,n==i&&(d=!1),e.appendData(i.data),C(i),i=e);else{if(o>0){var u=i.childNodes[o-1];u&&l(u)&&s(u)}d=!this.collapsed}if(d){if(l(n))0==r?a(n):r==n.length&&(e=n.nextSibling)&&e.nodeType==n.nodeType&&(i==e&&(i=n,o+=n.length),n.appendData(e.data),C(e));else if(r<n.childNodes.length){var h=n.childNodes[r];h&&l(h)&&a(h)}}else n=i,r=o;t(this,n,r,i,o)},collapseToPoint:function(e,t){U(e,!0),$(e,t),this.setStartAndEnd(e,t)}}),re(e)}function se(e){e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset,e.commonAncestorContainer=e.collapsed?e.startContainer:i.getCommonAncestor(e.startContainer,e.endContainer)}function ae(e,t,n,r,o){e.startContainer=t,e.startOffset=n,e.endContainer=r,e.endOffset=o,e.document=i.getDocument(t),se(e)}function le(e){this.startContainer=e,this.startOffset=0,this.endContainer=e,this.endOffset=0,this.document=e,se(this)}o.extend(n.rangePrototype,{moveStart:function(e,t,n){return te(this,e,t,!0,n)},moveEnd:function(e,t,n){return te(this,e,t,!1,n)},setRange:function(e,t,n){e?this.setStart(t,n):this.setEnd(t,n)},moveCharLeft:function(t,n,r){var i,o,s=this.collapsed;if(t?(i=this.startContainer,o=this.startOffset):(i=this.endContainer,o=this.endOffset),1===i.nodeType)if(i.hasChildNodes()&&o>0){var a=i.childNodes[o-1],l=e.domUtils.getLastSelectableChild(a,r);if(!(i=l||e.domUtils.getPreviousSelectableNode(a,r)))return!1;o=i.data.length-n}else o=-1*n;else o-=n;for(;o<0;){if(!(i=e.domUtils.getPreviousSelectableNode(i,r)))return!1;1===i.nodeType?o++:o+=i.data.length}return s&&this.collapse(t),this.setRange(t,i,o),!0},moveCharRight:function(t,n,r){var i,o,s=this.collapsed;if(t?(i=this.startContainer,o=this.startOffset):(i=this.endContainer,o=this.endOffset),1===i.nodeType){var a=e.domUtils.getNextSelectableNode(i.childNodes[Math.min(o,i.childNodes.length-1)],r);i=a||e.domUtils.getFirstSelectableChild(e.domUtils.getNextContainer(i,r),r),o=n}else o+=n;if(!i)return!1;var l=o-(3===i.nodeType?i.data.length:1);if(l>0){for(;l>0;){if(!(i=e.domUtils.getFirstSelectableChild(e.domUtils.getNextContainer(i,r),r)))return!1;if(1!==i.nodeType){if(i.data.length>=l)break;i.data.length>0&&(l-=i.data.length)}else r&&r.filter&&r.filter(i)&&--l}o=l}return s&&this.collapse(t),1===i.nodeType?this.setRange(t,i,0):this.setRange(t,i,o),!0},getHTMLContents:function(e){e||(e=this.cloneContents());var t=self.env.document.createElement("div");return t.appendChild(e.cloneNode(!0)),t.innerHTML},getHTMLContentsObj:function(){return this.cloneContents()},compareBoundaryPoints:function(e,t){var n,r,i,o;K(this),q(this.startContainer,t.startContainer);var s=3==e||0==e?"start":"end",a=1==e||0==e?"start":"end";return n=this[s+"Container"],r=this[s+"Offset"],i=t[a+"Container"],o=t[a+"Offset"],h(n,r,i,o)},insertNode:function(e){if(K(this),H(e,D),W(this.startContainer),d(e,this.startContainer))throw new a("HIERARCHY_REQUEST_ERR");var t=E(e,this.startContainer,this.startOffset);this.setStartBefore(t)},cloneContents:function(){var e,t;if(K(this),this.collapsed)return N(this).createDocumentFragment();if(this.startContainer===this.endContainer&&l(this.startContainer))return(e=this.startContainer.cloneNode(!0)).data=e.data.slice(this.startOffset,this.endOffset),(t=N(this).createDocumentFragment()).appendChild(e),t;var n=new R(this,!0);return e=function e(t){for(var n,r,i,o=N(t.range).createDocumentFragment();r=t.next();){if(n=t.isPartiallySelectedSubtree(),r=r.cloneNode(!n),n&&(i=t.getSubtreeIterator(),r.appendChild(e(i)),i.detach()),10==r.nodeType)throw new a("HIERARCHY_REQUEST_ERR");o.appendChild(r)}return o}(n),n.detach(),e},canSurroundContents:function(){K(this),W(this.startContainer),W(this.endContainer);var e=new R(this,!0),t=e._first&&_(e._first,this)||e._last&&_(e._last,this);return e.detach(),!t},surroundContents:function(e){if(H(e,P),!this.canSurroundContents())throw new a("INVALID_STATE_ERR");var t=this.extractContents();if(e.hasChildNodes())for(;e.lastChild;)e.removeChild(e.lastChild);E(e,this.startContainer,this.startOffset),e.appendChild(t),this.selectNode(e)},cloneRange:function(){K(this);for(var e,t=new le(N(this)),n=ee.length;n--;)t[e=ee[n]]=this[e];return t},toString:function(){K(this);var t=this.startContainer;if(t===this.endContainer&&l(t))return 3==t.nodeType||4==t.nodeType?t.data.slice(this.startOffset,this.endOffset):"";var n=[],r=new R(this,!0);return x(r,(function(t){(3==t.nodeType||4==t.nodeType&&!e.utils.isEmptyString(t.data))&&n.push(t.data)})),r.detach(),n.join("")},compareNode:function(e){K(this);var t=e.parentNode,n=c(e);if(!t)throw new a("NOT_FOUND_ERR");var r=this.comparePoint(t,n),i=this.comparePoint(t,n+1);return r<0?i>0?2:0:i>0?1:3},comparePoint:function(e,t){return K(this),G(e,"HIERARCHY_REQUEST_ERR"),q(e,this.startContainer),h(e,t,this.startContainer,this.startOffset)<0?-1:h(e,t,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:J,toHtml:function(){return Z(this)},intersectsNode:function(e,t){if(K(this),v(e)!=v(this.startContainer))return!1;var n=e.parentNode,r=c(e);if(!n)return!0;var i=h(n,r,this.endContainer,this.endOffset),o=h(n,r+1,this.startContainer,this.startOffset);return t?i<=0&&o>=0:i<0&&o>0},isPointInRange:function(e,t){return K(this),G(e,"HIERARCHY_REQUEST_ERR"),q(e,this.startContainer),h(e,t,this.startContainer,this.startOffset)>=0&&h(e,t,this.endContainer,this.endOffset)<=0},intersectsRange:function(e){return k(this,e,!1)},intersectsOrTouchesRange:function(e){return k(this,e,!0)},intersection:function(e){if(this.intersectsRange(e)){var t=h(this.startContainer,this.startOffset,e.startContainer,e.startOffset),n=h(this.endContainer,this.endOffset,e.endContainer,e.endOffset),r=this.cloneRange();return-1==t&&r.setStart(e.startContainer,e.startOffset),1==n&&r.setEnd(e.endContainer,e.endOffset),r}return null},union:function(e){if(this.intersectsOrTouchesRange(e)){var t=this.cloneRange();return-1==h(e.startContainer,e.startOffset,this.startContainer,this.startOffset)&&t.setStart(e.startContainer,e.startOffset),1==h(e.endContainer,e.endOffset,this.endContainer,this.endOffset)&&t.setEnd(e.endContainer,e.endOffset),t}throw new a("Ranges do not intersect")},containsNode:function(e,t){return t?this.intersectsNode(e,!1):3==this.compareNode(e)},containsNodeContents:function(e){return this.comparePoint(e,0)>=0&&this.comparePoint(e,p(e))<=0},containsRange:function(e){var t=this.intersection(e);return null!==t&&e.equals(t)},containsNodeText:function(e){var t=this.cloneRange();t.selectNode(e);var n=t.getNodes([3]);if(n.length>0){t.setStart(n[0],0);var r=n.pop();return t.setEnd(r,r.length),this.containsRange(t)}return this.containsNodeContents(e)},getNodes:function(e,t){return K(this),function(e,t,n){var r,i=Boolean(t&&t.length);i&&(r=new RegExp("^("+t.join("|")+")$"));var o=[];return x(new R(e,!1),(function(t){if((!i||r.test(t.nodeType))&&(!n||n(t))){var s=e.startContainer;if(t!=s||!l(s)||e.startOffset!=s.length){var a=e.endContainer;t==a&&l(a)&&0===e.endOffset||o.push(t)}}})),o}(this,e,t)},getDocument:function(){return N(this)},collapseBefore:function(e){this.setEndBefore(e),this.collapse(!1)},collapseAfter:function(e){this.setStartAfter(e),this.collapse(!0)},collapseAt:function(e,t){if(!e)return this;if(3===e.nodeType)t?this.setStart(e,0):this.setEnd(e,e.length);else{var n=c(e);t?this.setStart(e.parentNode,n):this.setEnd(e.parentNode,n+1)}return this.collapse(t),this},collectTextParts:function(t,n){if(!V(this))return[];var r=[],i=this.startContainer,o=this.endContainer,s=this.startOffset,a=this.endOffset;if(i===o&&l(i))return 3==i.nodeType||4==i.nodeType?i.data.slice(s,a):"";var c=new R(this,!0);return x(c,(function(n){if(!t||!e.utils.dom.isDescendantOf(n,t))if(3===n.nodeType)if(n===i)r.push(start>0?n.data.slice(start):n.data);else if(n===o){if(0===a)return;r.push(a<n.length?n.data.slice(0,a):n.data)}else r.push(n.data);else t&&e.utils.dom.matchesSelector(n,t)&&r.push(n)}),null,n),c.detach(),r},getFullBookmark:function(e,r,o){if(!r)return this.getBookmark(e,!0);var s=N(this),a=n.createRange(s);e=e||i.getBody(s),a.selectNodeContents(e);var l=this.intersection(a),c=0,d=0;if(l){a.setEnd(l.startContainer,l.startOffset);var u=a.collectTextParts(r,o);c=S(u),u=l.collectTextParts(r,o),d=Math.max(c,c+S(u))}else t.logger.debug("getFullBookmark: null intersection");return{start:c,end:d,containerNode:e,isFiltered:!0,selector:r,ignoreSelector:o,after:Boolean(c>0&&0===this.endOffset),type:"extended"}},getBookmark:function(t,r){var o=N(this),s=n.createRange(o);t=t||i.getBody(o),s.selectNodeContents(t);var a=this.intersection(s),l=0,c=0;return a&&(s.setEnd(a.startContainer,a.startOffset),c=(l=r?e.utils.strings.getEffectiveStringLength(s.toString()):s.toString().length)+(r?e.utils.strings.getEffectiveStringLength(a.toString()):a.toString().length)),{start:l,end:c,containerNode:t,isFiltered:Boolean(r)}},moveToBookmark:function(n,r){if(r&&n.type)return this._moveToExtendedBookmark(n,r);var i=n.containerNode;t.logger.warn("moving to an uncollapsed bookmark");var o=0;this.setStart(i,0),this.collapse(!0);for(var s,a,l,c,d=[i],u=!1,h=!1;!h&&(s=d.pop());)if(3==s.nodeType){if(!e.utils.strings.isEmptyString(s.data))continue;a=o+s.length,!u&&n.start>=o&&n.start<=a&&(this.setStart(s,n.start-o),u=!0),u&&n.end>=o&&n.end<=a&&(this.setEnd(s,n.end-o),h=!0),o=a}else for(l=(c=s.childNodes).length;l--;)d.push(c[l])},_getBookmarkSetter:function(e){if(e.start===e.end)return function(e,t,n){e.setStart()}},_moveToExtendedBookmark:function(n,r){if(!function(e){if(!e||!e.containerNode)return!1;if(e.start>-1||(e.start=0),e.end>-1||(e.end=0),e.end<e.start){var t=e.start;e.start=e.end,e.end=t}return!0}(n))return t.logger.warn("move to invalid bookmark",n);var i=n.containerNode,o=0,s=Boolean(n.after&&!1!==r.after||r.after);"left"===r.move&&(n.start=Math.max(0,n.start-1)),this.setStart(i,0),this.collapse(!0);var a,l,c=[{node:i,index:0}],d=0===n.end,u=0,h=0,f=null,g=0,p=n.start,m=this,v=0;function y(){return!(p<n.end&&(N=_,p=n.end,d=!1,s=!1,1))}for(var C=function(){return s&&p===n.end},_=function(e,t){return m.setEnd(e,t)},N=function(e,t){m.setStart(e,t),m.setEnd(e,t)};l=c.pop();)if(3===(a=l.node).nodeType){if(d&&(N(a,0),y()))return;if((u=o+(h=n.isFiltered?e.utils.strings.getEffectiveStringLength(a.data):a.length))<1)continue;if(p>=o&&p<=u){if(v=n.isFiltered?e.utils.strings.getEffectiveStringIndex(a.data,p-o):p-o,N(a,v),p<n.end&&u>=n.end){if(v=n.isFiltered?e.utils.strings.getEffectiveStringIndex(a.data,n.end-o):n.end-o,!s||v<h)return void this.setEnd(a,v);d=!0;continue}if(C())d=!0;else if(y())return}o=u,f=a}else{if(n.ignoreSelector&&e.utils.dom.matchesSelector(a,n.ignoreSelector))continue;if(n.selector&&e.utils.dom.matchesSelector(a,n.selector)){if(u=o+1,p>=o&&p<=u){if((d||!C())&&(N(a.parentNode,l.index+(d?0:1)),y()))return;d=!0}o=u,f=a.parentNode,g=l.index}else for(var b=a.lastChild,T=a.childNodes.length;b;b=b.previousSibling)c.push({node:b,index:--T})}f&&N(f,3===f.nodeType?f.length:g+1)},getName:function(){return"DomRange"},equals:function(e){return Boolean(e&&le.rangesEqual(this,e))},isValid:function(){return V(this)},inspect:function(){return A(this)},detach:function(){}}),oe(le,ae),o.extend(le,{rangeProperties:ee,RangeIterator:R,copyComparisonConstants:re,createPrototypeRange:oe,inspect:A,toHtml:Z,getRangeDocument:N,rangesEqual:function(e,t){return e.startContainer===t.startContainer&&e.startOffset===t.startOffset&&e.endContainer===t.endContainer&&e.endOffset===t.endOffset}}),n.DomRange=le})),_.createCoreModule("WrappedRange",["DomRange"],(function(e,n){var r,i,o=e.dom,s=e.util,a=o.DomPosition,l=e.DomRange,c=o.getBody,d=o.getContentDocument,u=o.isCharacterDataNode;if(e.features.implementsDomRange&&function(){var i,a,u=l.rangeProperties;function h(e){for(var t,n=u.length;n--;)e[t=u[n]]=e.nativeRange[t];e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset}r=function(e){if(!e)throw n.createError("WrappedRange: Range must be specified");this.nativeRange=e,h(this)},l.createPrototypeRange(r,(function(e,t,n,r,i){var o=e.startContainer!==t||e.startOffset!=n,s=e.endContainer!==r||e.endOffset!=i,a=!e.equals(e.nativeRange);(o||s||a)&&(e.setEnd(r,i),e.setStart(t,n))})),(i=r.prototype).selectNode=function(e){return 3===e.nodeType?(this.nativeRange.setStart(e,0),this.nativeRange.setEnd(e,e.length)):this.nativeRange.selectNode(e),h(this),this},i.cloneContents=function(){return this.nativeRange.cloneContents()},i.surroundContents=function(e){return this.nativeRange.surroundContents(e),h(this),this},i.collapse=function(e){return this.nativeRange.collapse(e),h(this),this},i.cloneRange=function(){return this.syncToNative(),new r(this.nativeRange.cloneRange())},i.refresh=function(){return h(this),this},i.toString=function(){return this.nativeRange.toString()};var f=document.createTextNode("test");c(document).appendChild(f);var g=document.createRange();g.setStart(f,0),g.setEnd(f,0);try{g.setStart(f,1),i.setStart=function(e,t){this.nativeRange.setStart(e,t),h(this)},i.setEnd=function(e,t){this.nativeRange.setEnd(e,t),h(this)},a=function(e){return function(t){this.nativeRange[e](t),h(this)}}}catch(e){i.setStart=function(e,t){try{this.nativeRange.setStart(e,t)}catch(n){this.nativeRange.setEnd(e,t),this.nativeRange.setStart(e,t)}h(this)},i.setEnd=function(e,t){try{this.nativeRange.setEnd(e,t)}catch(n){this.nativeRange.setStart(e,t),this.nativeRange.setEnd(e,t)}h(this)},a=function(e,t){return function(n){try{this.nativeRange[e](n)}catch(r){this.nativeRange[t](n),this.nativeRange[e](n)}h(this)}}}i.setStartBefore=a("setStartBefore","setEndBefore"),i.setStartAfter=a("setStartAfter","setEndAfter"),i.setEndBefore=a("setEndBefore","setStartBefore"),i.setEndAfter=a("setEndAfter","setStartAfter"),i.selectNodeContents=function(e){this.setStartAndEnd(e,0,o.getNodeLength(e))},i.syncToNative=function(){return this.nativeRange||t.logger.warn("synctonative: no native range"),this.nativeRange.setStart(this.startContainer,this.startOffset),this.nativeRange.setEnd(this.endContainer,this.endOffset),this},g.selectNodeContents(f),g.setEnd(f,3);var p=document.createRange();p.selectNodeContents(f),p.setEnd(f,4),p.setStart(f,2),-1==g.compareBoundaryPoints(g.START_TO_END,p)&&1==g.compareBoundaryPoints(g.END_TO_START,p)?i.compareBoundaryPoints=function(e,t){return e==(t=t.nativeRange||t).START_TO_END?e=t.END_TO_START:e==t.END_TO_START&&(e=t.START_TO_END),this.nativeRange.compareBoundaryPoints(e,t)}:i.compareBoundaryPoints=function(e,t){return this.nativeRange.compareBoundaryPoints(e,t.nativeRange||t)};var m=document.createElement("div");m.innerHTML="123";var v=m.firstChild,y=c(document);y.appendChild(m),g.setStart(v,1),g.setEnd(v,2),g.deleteContents(),"13"==v.data&&(i.deleteContents=function(){this.nativeRange.deleteContents(),h(this)},i.extractContents=function(){var e=this.nativeRange.extractContents();return h(this),e}),y.removeChild(m),y=null,s.isHostMethod(g,"createContextualFragment")&&(i.createContextualFragment=function(e){return this.nativeRange.createContextualFragment(e)}),c(document).removeChild(f),i.getName=function(){return"WrappedRange"},e.WrappedRange=r,e.createNativeRange=function(e){return(e=d(e,n,"createNativeRange")).createRange()}}(),e.features.implementsTextRange){var h=function(e,t,n,r,i){var s=e.duplicate();s.collapse(n);var l=s.parentElement();if(o.isOrIsAncestorOf(t,l)||(l=t),!l.canHaveHTML){var c=new a(l.parentNode,o.getNodeIndex(l));return{boundaryPosition:c,nodeInfo:{nodeIndex:c.offset,containerElement:c.node}}}var d=o.getDocument(l).createElement("span");d.parentNode&&o.removeNode(d);for(var h,f,g,p,m,v=n?"StartToStart":"StartToEnd",y=i&&i.containerElement==l?i.nodeIndex:0,C=l.childNodes.length,_=C,N=_;N==C?l.appendChild(d):l.insertBefore(d,l.childNodes[N]),s.moveToElementText(d),0!=(h=s.compareEndPoints(v,e))&&y!=_;){if(-1==h){if(_==y+1)break;y=N}else _=_==y+1?y:N;N=Math.floor((y+_)/2),l.removeChild(d)}if(m=d.nextSibling,-1==h&&m&&u(m)){var b;if(s.setEndPoint(n?"EndToStart":"EndToEnd",e),/[\r\n]/.test(m.data)){var T=s.duplicate(),E=T.text.replace(/\r\n/g,"\r").length;for(b=T.moveStart("character",E);-1==(h=T.compareEndPoints("StartToEnd",T));)b++,T.moveStart("character",1)}else b=s.text.length;p=new a(m,b)}else f=(r||!n)&&d.previousSibling,p=(g=(r||n)&&d.nextSibling)&&u(g)?new a(g,0):f&&u(f)?new a(f,f.data.length):new a(l,o.getNodeIndex(d));return o.removeNode(d),{boundaryPosition:p,nodeInfo:{nodeIndex:N,containerElement:l}}},f=function(e,t){var n,r,i,s,a=e.offset,l=o.getDocument(e.node),d=c(l).createTextRange(),h=u(e.node);return h?r=(n=e.node).parentNode:(n=a<(s=e.node.childNodes).length?s[a]:null,r=e.node),(i=l.createElement("span")).innerHTML="&#feff;",n?r.insertBefore(i,n):r.appendChild(i),d.moveToElementText(i),d.collapse(!t),r.removeChild(i),h&&d[t?"moveStart":"moveEnd"]("character",a),d};((i=function(e){this.textRange=e,this.refresh()}).prototype=new l(document)).refresh=function(){var e,t,n,r,i=function(e){var t=e.parentElement(),n=e.duplicate();n.collapse(!0);var r=n.parentElement();(n=e.duplicate()).collapse(!1);var i=n.parentElement(),s=r==i?r:o.getCommonAncestor(r,i);return s==t?s:o.getCommonAncestor(t,s)}(this.textRange);0==(r=this.textRange).compareEndPoints("StartToEnd",r)?t=e=h(this.textRange,i,!0,!0).boundaryPosition:(e=(n=h(this.textRange,i,!0,!1)).boundaryPosition,t=h(this.textRange,i,!1,!1,n.nodeInfo).boundaryPosition),this.setStart(e.node,e.offset),this.setEnd(t.node,t.offset)},i.prototype.getName=function(){return"WrappedTextRange"},l.copyComparisonConstants(i);var g=function(e){if(e.collapsed)return f(new a(e.startContainer,e.startOffset),!0);var t=f(new a(e.startContainer,e.startOffset),!0),n=f(new a(e.endContainer,e.endOffset),!1),r=c(l.getRangeDocument(e)).createTextRange();return r.setEndPoint("StartToStart",t),r.setEndPoint("EndToEnd",n),r};if(i.rangeToTextRange=g,i.prototype.toTextRange=function(){return g(this)},e.WrappedTextRange=i,!e.features.implementsDomRange||e.config.preferTextRange){var p=Function("return this;")();void 0===p.Range&&(p.Range=i),e.createNativeRange=function(e){return e=d(e,n,"createNativeRange"),c(e).createTextRange()},e.WrappedRange=i}}e.createRange=function(t){return t=d(t,n,"createRange"),new e.WrappedRange(e.createNativeRange(t))},e.createRangeFromNative=function(t){var n=t&&t.commonAncestorContainer;if(!n||!n.ownerDocument)throw new Error("createFromNativeRange: null input or no owner document");return new e.WrappedRange(t)},e.createRangyRange=function(e){return e=d(e,n,"createRangyRange"),new l(e)},s.createAliasForDeprecatedMethod(e,"createIframeRange","createRange"),s.createAliasForDeprecatedMethod(e,"createIframeRangyRange","createRangyRange"),e.addShimListener((function(t){var n=t.document;void 0===n.createRange&&(n.createRange=function(){return e.createRange(n)}),n=t=null}))})),_.createCoreModule("WrappedSelection",["DomRange","WrappedRange"],(function(e,t){e.config.checkSelectionRanges=!0;var n,r,i=e.dom,o=e.util,s=o.isHostMethod,a=e.DomRange,l=e.WrappedRange,c=e.DOMException,d=i.DomPosition,u=e.features,h=i.getDocument,f=i.getBody,g=a.rangesEqual;function p(e){return"string"==typeof e?/^backward(s)?$/i.test(e):!!e}function m(e,n){if(e){if(i.isWindow(e))return e;if(e instanceof $)return e.win;var r=i.getContentDocument(e,t,n);return i.getWindow(r)}return window}function v(e){return m(e,"getDocSelection").document.selection}function y(e){var t=!1;return e.anchorNode&&(t=1==i.comparePoints(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset)),t}var C=s(window,"getSelection"),_=o.isHostObject(document,"selection");u.implementsWinGetSelection=C,u.implementsDocSelection=_;var N=_&&(!C||e.config.preferTextRange);if(N)n=v,e.isSelectionValid=function(e){var t=m(e,"isSelectionValid").document,n=t.selection;return"None"!=n.type||h(n.createRange().parentElement())==t};else{if(!C)return t.fail("Neither document.selection or window.getSelection() detected."),!1;n=function(e){return m(e,"getWinSelection").getSelection()},e.isSelectionValid=function(){return!0}}e.getNativeSelection=n;var b=n();if(!b)return t.fail("Native selection was null (possibly issue 138?)"),!1;var T=e.createNativeRange(document),E=f(document),k=o.areHostProperties(b,["anchorNode","focusNode","anchorOffset","focusOffset"]);u.selectionHasAnchorAndFocus=k;var S=s(b,"extend");u.selectionHasExtend=S;var x="number"==typeof b.rangeCount;u.selectionHasRangeCount=x;var w=!1,O=!0,A=S?function(t,n){var r=a.getRangeDocument(n),i=e.createRange(r);i.collapseToPoint(n.endContainer,n.endOffset),t.addRange(M(i)),t.extend(n.startContainer,n.startOffset)}:null;o.areHostMethods(b,["addRange","getRangeAt","removeAllRanges"])&&"number"==typeof b.rangeCount&&u.implementsDomRange&&function(){var t=window.getSelection();if(t){for(var n=t.rangeCount,r=n>1,o=[],s=y(t),a=0;a<n;++a)o[a]=t.getRangeAt(a);var l=i.createTestElement(document,"",!1),c=l.appendChild(document.createTextNode("Â Â Â ")),d=document.createRange();if(d.setStart(c,1),d.collapse(!0),t.removeAllRanges(),t.addRange(d),O=1==t.rangeCount,t.removeAllRanges(),!r){var u=window.navigator.appVersion.match(/Chrome\/(.*?) /);if(u&&parseInt(u[1])>=36)w=!1;else{var h=d.cloneRange();d.setStart(c,0),h.setEnd(c,3),h.setStart(c,2),t.addRange(d),t.addRange(h),w=2==t.rangeCount}}for(i.removeNode(l),t.removeAllRanges(),a=0;a<n;++a)0==a&&s?A?A(t,o[a]):(e.warn("Rangy initialization: original selection was backwards but selection has been restored forwards because the browser does not support Selection.extend"),t.addRange(o[a])):t.addRange(o[a])}}(),u.selectionSupportsMultipleRanges=w,u.collapsedNonEditableSelectionsSupported=O;var R,I,L=!1;function D(e,t,n){var r=n?"end":"start",i=n?"start":"end";e.anchorNode=t[r+"Container"],e.anchorOffset=t[r+"Offset"],e.focusNode=t[i+"Container"],e.focusOffset=t[i+"Offset"]}function P(e){e.anchorNode=e.focusNode=null,e.anchorOffset=e.focusOffset=0,e.rangeCount=0,e.isCollapsed=!0,e._ranges=e._ranges||[],e._ranges.length=0}function M(t){var n;return t instanceof a?((n=e.createNativeRange(t.getDocument())).setEnd(t.endContainer,t.endOffset),n.setStart(t.startContainer,t.startOffset)):t instanceof l?n=t.nativeRange:u.implementsDomRange&&t instanceof i.getWindow(t.startContainer).Range&&(n=t),n}function B(e){var n=e.getNodes();if(!function(e){if(!e.length||1!=e[0].nodeType)return!1;for(var t=1,n=e.length;t<n;++t)if(!i.isAncestorOf(e[0],e[t]))return!1;return!0}(n))throw t.createError("getSingleElementFromRange: range "+e.inspect()+" did not consist of a single element");return n[0]}function F(e){return!!e&&void 0!==e.text}function j(e,t){var n=new l(t);e._ranges=[n],D(e,n,!1),e.rangeCount=1,e.isCollapsed=n.collapsed}function U(t){if(t._ranges.length=0,"None"==t.docSelection.type)P(t);else{var n=t.docSelection.createRange();if(F(n))j(t,n);else{t.rangeCount=n.length;for(var r,i=h(n.item(0)),o=0;o<t.rangeCount;++o)(r=e.createRange(i)).selectNode(n.item(o)),t._ranges.push(r);t.isCollapsed=1==t.rangeCount&&t._ranges[0].collapsed,D(t,t._ranges[t.rangeCount-1],!1)}}}function H(e,n){for(var r=e.docSelection.createRange(),i=B(n),o=h(r.item(0)),s=f(o).createControlRange(),a=0,l=r.length;a<l;++a)s.add(r.item(a));try{s.add(i)}catch(e){throw t.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}s.select(),U(e)}function $(e,t,n){this.nativeSelection=e,this.docSelection=t,this._ranges=[],this.win=n,this.refresh()}function q(e){e.win=e.anchorNode=e.focusNode=e._ranges=null,e.rangeCount=e.anchorOffset=e.focusOffset=0,e.detached=!0}E&&s(E,"createControlRange")&&(R=E.createControlRange(),o.areHostProperties(R,["item","add"])&&(L=!0)),u.implementsControlRange=L,r=k?function(e){return e.anchorNode===e.focusNode&&e.anchorOffset===e.focusOffset}:function(e){return!!e.rangeCount&&e.getRangeAt(e.rangeCount-1).collapsed},s(b,"getRangeAt")?I=function(e,t){try{return e.getRangeAt(t)}catch(e){return null}}:k&&(I=function(t){var n=h(t.anchorNode),r=e.createRange(n);return r.setStartAndEnd(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset),r.collapsed!==this.isCollapsed&&r.setStartAndEnd(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset),r}),$.prototype=e.selectionPrototype;var W=[];function G(e,t){for(var n,r,i=W.length;i--;)if(r=(n=W[i]).selection,"deleteAll"==t)q(r);else if(n.win==e)return"delete"==t?(W.splice(i,1),!0):r;return"deleteAll"==t&&(W.length=0),null}var z=function(e){if(e&&e instanceof $)return e.refresh(),e;var t=G(e=m(e,"getNativeSelection")),r=n(e),i=_?v(e):null;return t?(t.nativeSelection=r,t.docSelection=i,t.refresh()):(t=new $(r,i,e),W.push({win:e,selection:t})),t};e.getSelection=z,o.createAliasForDeprecatedMethod(e,"getIframeSelection","getSelection");var V,K=$.prototype;function Y(e,n){for(var r,i=h(n[0].startContainer),o=f(i).createControlRange(),s=0,a=n.length;s<a;++s){r=B(n[s]);try{o.add(r)}catch(e){throw t.createError("setRanges(): Element within one of the specified Ranges could not be added to control selection (does it have layout?)")}}o.select(),U(e)}if(!N&&k&&o.areHostMethods(b,["removeAllRanges","addRange"])){K.removeAllRanges=function(){try{this.nativeSelection.removeAllRanges()}catch(e){}P(this)};var X=function(e,t){A(e.nativeSelection,t),e.refresh()};K.addRange=x?function(t,n){if(L&&_&&"Control"==this.docSelection.type)H(this,t);else if(p(n)&&S)X(this,t);else{var i;w?i=this.rangeCount:(this.removeAllRanges(),i=0);var o=M(t).cloneRange();try{this.nativeSelection.addRange(o)}catch(e){console.error(e,t)}if(this.rangeCount=this.nativeSelection.rangeCount,this.rangeCount==i+1){if(e.config.checkSelectionRanges){var s=I(this.nativeSelection,this.rangeCount-1);s&&!g(s,t)&&(t=new l(s))}this._ranges[this.rangeCount-1]=t,D(this,t,J(this.nativeSelection)),this.isCollapsed=r(this)}else this.refresh()}}:function(e,t){p(t)&&S?X(this,e):(this.nativeSelection.addRange(M(e)),this.refresh())},K.setRanges=function(e){if(L&&_&&e.length>1)Y(this,e);else{this.removeAllRanges();for(var t=0,n=e.length;t<n;++t)this.addRange(e[t])}}}else{if(!(s(b,"empty")&&s(T,"select")&&L&&N))return t.fail("No means of selecting a Range or TextRange was found"),!1;K.removeAllRanges=function(){try{if(this.docSelection.empty(),"None"!=this.docSelection.type){var e;if(this.anchorNode)e=h(this.anchorNode);else if("Control"==this.docSelection.type){var t=this.docSelection.createRange();t.length&&(e=h(t.item(0)))}e&&(f(e).createTextRange().select(),this.docSelection.empty())}}catch(e){}P(this)},K.addRange=function(t){"Control"==this.docSelection.type?H(this,t):(e.WrappedTextRange.rangeToTextRange(t).select(),this._ranges[0]=t,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,D(this,t,!1))},K.setRanges=function(e){this.removeAllRanges();var t=e.length;t>1?Y(this,e):t&&this.addRange(e[0])}}if(K.getRangeAt=function(e){if(e<0||e>=this.rangeCount)throw new c("INDEX_SIZE_ERR");return this._ranges[e].cloneRange()},N)V=function(t){var n;e.isSelectionValid(t.win)?n=t.docSelection.createRange():(n=f(t.win.document).createTextRange()).collapse(!0),"Control"==t.docSelection.type?U(t):F(n)?j(t,n):P(t)};else if(s(b,"getRangeAt")&&"number"==typeof b.rangeCount)V=function(t){if(L&&_&&"Control"==t.docSelection.type)U(t);else if(t._ranges.length=t.rangeCount=t.nativeSelection&&t.nativeSelection.rangeCount||0,t.rangeCount){for(var n=0,i=t.rangeCount;n<i;++n)t._ranges[n]=new e.WrappedRange(t.nativeSelection.getRangeAt(n));D(t,t._ranges[t.rangeCount-1],J(t.nativeSelection)),t.isCollapsed=r(t)}else P(t)};else{if(!k||"boolean"!=typeof b.isCollapsed||"boolean"!=typeof T.collapsed||!u.implementsDomRange)return t.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;V=function(e){var t,n=e.nativeSelection;n.anchorNode?(t=I(n,0),e._ranges=[t],e.rangeCount=1,function(e){var t=e.nativeSelection;e.anchorNode=t.anchorNode,e.anchorOffset=t.anchorOffset,e.focusNode=t.focusNode,e.focusOffset=t.focusOffset}(e),e.isCollapsed=r(e)):P(e)}}K.refresh=function(e){var t=e?this._ranges.slice(0):null,n=this.anchorNode,r=this.anchorOffset;if(V(this),e){var i=t.length;if(i!=this._ranges.length)return!0;if(this.anchorNode!=n||this.anchorOffset!=r)return!0;for(;i--;)if(!g(t[i],this._ranges[i]))return!0;return!1}};var J,Q=function(e,t){var n=e.getAllRanges();e.removeAllRanges();for(var r=0,i=n.length;r<i;++r)g(t,n[r])||e.addRange(n[r]);e.rangeCount||P(e)};function Z(e,t){if(e.win.document!=h(t))throw new c("WRONG_DOCUMENT_ERR")}function ee(t){return function(n,r){var i;this.rangeCount?(i=this.getRangeAt(0))["set"+(t?"Start":"End")](n,r):(i=e.createRange(this.win.document)).setStartAndEnd(n,r),this.setSingleRange(i,this.isBackward())}}function te(e){var t=[],n=new d(e.anchorNode,e.anchorOffset),r=new d(e.focusNode,e.focusOffset),i="function"==typeof e.getName?e.getName():"Selection";if(void 0!==e.rangeCount)for(var o=0,s=e.rangeCount;o<s;++o)t[o]=a.inspect(e.getRangeAt(o));return"["+i+"(Ranges: "+t.join(", ")+")(anchor: "+n.inspect()+", focus: "+r.inspect()+"]"}K.removeRange=L&&_?function(e){if("Control"==this.docSelection.type){for(var t=this.docSelection.createRange(),n=B(e),r=h(t.item(0)),i=f(r).createControlRange(),o=!1,s=0,a=t.length;s<a;++s)t.item(s)!==n||o?i.add(t.item(s)):o=!0;i.select(),U(this)}else Q(this,e)}:function(e){Q(this,e)},!N&&k&&u.implementsDomRange?(J=y,K.isBackward=function(){return J(this)}):J=K.isBackward=function(){return!1},K.isBackwards=K.isBackward,K.toString=function(){for(var e=[],t=0,n=this.rangeCount;t<n;++t)e[t]=""+this._ranges[t];return e.join("")},K.collapse=function(t,n){Z(this,t);var r=e.createRange(t);r.collapseToPoint(t,n),this.setSingleRange(r),this.isCollapsed=!0},K.collapseToStart=function(){if(!this.rangeCount)throw new c("INVALID_STATE_ERR");var e=this._ranges[0];this.collapse(e.startContainer,e.startOffset)},K.collapseToEnd=function(){if(!this.rangeCount)throw new c("INVALID_STATE_ERR");var e=this._ranges[this.rangeCount-1];this.collapse(e.endContainer,e.endOffset)},K.selectAllChildren=function(t){Z(this,t);var n=e.createRange(t);n.selectNodeContents(t),this.setSingleRange(n)},K.deleteFromDocument=function(){if(L&&_&&"Control"==this.docSelection.type){for(var e,t=this.docSelection.createRange();t.length;)e=t.item(0),t.remove(e),i.removeNode(e);this.refresh()}else if(this.rangeCount){var n=this.getAllRanges();if(n.length){this.removeAllRanges();for(var r=0,o=n.length;r<o;++r)n[r].deleteContents();this.addRange(n[o-1])}}},K.eachRange=function(e,t){for(var n=0,r=this._ranges.length;n<r;++n)if(e(this.getRangeAt(n)))return t},K.getAllRanges=function(){var e=[];return this.eachRange((function(t){e.push(t)})),e},K.setSingleRange=function(e,t){this.removeAllRanges(),this.addRange(e,t)},K.callMethodOnEachRange=function(e,t){var n=[];return this.eachRange((function(r){n.push(r[e].apply(r,t||[]))})),n},K.setStart=ee(!0),K.setEnd=ee(!1),e.rangePrototype.select=function(e){z(this.getDocument()).setSingleRange(this,e)},K.changeEachRange=function(e){var t=[],n=this.isBackward();this.eachRange((function(n){e(n),t.push(n)})),this.removeAllRanges(),n&&1==t.length?this.addRange(t[0],"backward"):this.setRanges(t)},K.containsNode=function(e,t){return this.eachRange((function(n){return n.containsNode(e,t)}),!0)||!1},K.getBookmark=function(e){return{backward:this.isBackward(),rangeBookmarks:this.callMethodOnEachRange("getBookmark",[e])}},K.moveToBookmark=function(t){for(var n,r,i=[],o=0;n=t.rangeBookmarks[o++];)(r=e.createRange(this.win)).moveToBookmark(n),i.push(r);t.backward?this.setSingleRange(i[0],"backward"):this.setRanges(i)},K.saveRanges=function(){return{backward:this.isBackward(),ranges:this.callMethodOnEachRange("cloneRange")}},K.restoreRanges=function(e){this.removeAllRanges();for(var t,n=0;t=e.ranges[n];++n)this.addRange(t,e.backward&&0==n)},K.toHtml=function(){var e=[];return this.eachRange((function(t){e.push(a.toHtml(t))})),e.join("")},u.implementsTextRange&&(K.getNativeTextRange=function(){var n;if(n=this.docSelection){var r=n.createRange();if(F(r))return r;throw t.createError("getNativeTextRange: selection is a control selection")}if(this.rangeCount>0)return e.WrappedTextRange.rangeToTextRange(this.getRangeAt(0));throw t.createError("getNativeTextRange: selection contains no range")}),K.getName=function(){return"WrappedSelection"},K.inspect=function(){return te(this)},K.detach=function(){G(this.win,"delete"),q(this)},K.detachAll=function(){G(null,"deleteAll")},$.detachAll=function(){G(null,"deleteAll")},$.inspect=te,$.isDirectionBackward=p,e.Selection=$,e.selectionPrototype=K,e.addShimListener((function(e){void 0===e.getSelection&&(e.getSelection=function(){return z(e)}),e=null}))}));var I=!1,L=function(e){I||(I=!0,!_.initialized&&_.config.autoInitialize&&k())};return y&&("complete"==document.readyState?L():(s(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",L,!1),m(window,"load",L))),_.isInitialized=function(e){var n;for(var r in e&&!I&&L(),this.modules)if(!(n=this.modules[r])||!n.initialized||!n.supported)return t.logger.debug("rangy NOT initialized: module",r,"initialized",n.initialized,"supported",n.supported),!1;return!0},_},(n=window.LOOPINDEX)||console.error("rangy: root is undefined"),n.FLITE.rangy=t(n),n.logger.scheduleDump(),Object.defineProperty(s,"__esModule",{value:!0}),function(e){e[e.OK=0]="OK",e[e.IGNORE=1]="IGNORE",e[e.IGNORE_ALL=2]="IGNORE_ALL"}(i||(i={})),function(e){const t=null==e?void 0:e.FLITE,n=null==e?void 0:e.$;if(!t||!n)throw new Error("Cannot initialize Mutation Summary without FLITE globals");let r;!function(e){e[e.STAYED_OUT=0]="STAYED_OUT",e[e.ENTERED=1]="ENTERED",e[e.STAYED_IN=2]="STAYED_IN",e[e.REPARENTED=3]="REPARENTED",e[e.REORDERED=4]="REORDERED",e[e.EXITED=5]="EXITED"}(r||(r={}));const i=void 0!==window.WebKitMutationObserver?window.WebKitMutationObserver:window.MutationObserver;if(!i)throw new Error("DOM Mutation Observers are required; https://developer.mozilla.org/en-US/docs/DOM/MutationObserver");const o=["added","removed","reordered","reparented","valueChanged","characterDataChanged"],s=()=>new Map;class a{constructor(e,t=!1,n=!1,r=!1,i=null,o=!1,s=null,a=null){this.node=e,this.childList=t,this.attributes=n,this.characterData=r,this.oldParentNode=i,this.added=o,this.attributeOldValues=s,this.characterDataOldValue=a,this.isCaseInsensitive=1===this.node.nodeType&&this.node instanceof HTMLElement&&this.node.ownerDocument instanceof HTMLDocument}getAttributeOldValue(e){if(this.attributeOldValues)return this.isCaseInsensitive&&(e=e.toLowerCase()),this.attributeOldValues[e]}getAttributeNamesMutated(){const e=[];if(!this.attributeOldValues)return e;for(let t in this.attributeOldValues)e.push(t);return e}attributeMutated(e,t){this.attributes=!0,this.attributeOldValues=this.attributeOldValues||{},e in this.attributeOldValues||(this.attributeOldValues[e]=t)}characterDataMutated(e){this.characterData||(this.characterData=!0,this.characterDataOldValue=e)}removedFromParent(e){this.childList=!0,this.added||this.oldParentNode?(this.added=!1,this.oldParentNode=this.oldParentNode||e):this.oldParentNode=e}insertedIntoParent(){this.childList=!0,this.added=!0}getOldParent(){if(this.childList){if(this.oldParentNode)return this.oldParentNode;if(this.added)return null}return this.node.parentNode}}class l{constructor(){this.added=new Set,this.removed=new Set,this.maybeMoved=new Set,this.oldPrevious=s(),this.moved=void 0}}class c{constructor(e,t,n){let r,i,o;n=n||(e=>!0),this.rootNode=e,this._changeMap=s(),this.reachableCache=void 0,this.wasReachableCache=void 0,this.anyParentsChanged=!1,this.anyAttributesChanged=!1,this.anyCharacterDataChanged=!1;for(let e=0;e<t.length;e++)switch(o=t[e],o.type){case"childList":this.anyParentsChanged=!0;for(let e=0;e<o.removedNodes.length;e++)r=o.removedNodes[e],this.getChange(r).removedFromParent(o.target);for(let e=0;e<o.addedNodes.length;e++)r=o.addedNodes[e],this.getChange(r).insertedIntoParent();break;case"attributes":this.anyAttributesChanged=!0,n(o.target)&&(i=this.getChange(o.target),i.attributeMutated(o.attributeName,o.oldValue));break;case"characterData":this.anyCharacterDataChanged=!0,n(o.target)&&(i=this.getChange(o.target),i.characterDataMutated(o.oldValue))}}get(e){return this._changeMap.get(e)}getNodes(){return Array.from(this._changeMap.keys())}getChange(e){let t=this._changeMap.get(e);return t||(t=new a(e),this._changeMap.set(e,t)),t}getOldParent(e){const t=this._changeMap.get(e);return t?t.getOldParent():e.parentNode}getIsReachable(e){if(e===this.rootNode)return!0;if(!e)return!1;this.reachableCache=this.reachableCache||s();let t=this.reachableCache.get(e);return void 0===t&&(t=this.getIsReachable(e.parentNode),this.reachableCache.set(e,t)),t}getWasReachable(e){if(e===this.rootNode)return!0;if(!e)return!1;this.wasReachableCache=this.wasReachableCache||s();let t=this.wasReachableCache.get(e);return void 0===t&&(t=this.getWasReachable(this.getOldParent(e)),this.wasReachableCache.set(e,t)),t}reachabilityChange(e){return this.getIsReachable(e)?this.getWasReachable(e)?r.STAYED_IN:r.ENTERED:this.getWasReachable(e)?r.EXITED:r.STAYED_OUT}}class d{constructor(t,n,r,i,o,a){this.rootNode=t,this.mutations=n,this.selectors=r,this.calcReordered=i,this.calcOldPreviousSibling=o,this.nodeFilter=a,this.nodeFilter=this.nodeFilter||e.utils.yes,this.treeChanges=new c(t,n,this.nodeFilter),this.entered=[],this.exited=[],this.stayedIn=s(),this.visited=s(),this.childListChangeMap=void 0,this.characterDataOnly=void 0,this.matchCache=void 0,this.processMutations()}processMutations(){if(!this.treeChanges.anyParentsChanged&&!this.treeChanges.anyAttributesChanged)return;const e=this.treeChanges.getNodes();for(let t=0;t<e.length;t++)this.visitNode(e[t],void 0)}visitNode(e,t){if(this.visited.has(e))return;this.visited.set(e,!0);const n=this.treeChanges.get(e);let i=t;if((n&&n.childList||null==i)&&(i=this.treeChanges.reachabilityChange(e)),i!==r.STAYED_OUT){if(this.matchabilityChange(e),i===r.ENTERED)this.entered.push(e);else if(i===r.EXITED)this.exited.push(e),this.ensureHasOldPreviousSiblingIfNeeded(e);else if(i===r.STAYED_IN){let t=r.STAYED_IN;n&&n.childList&&(n.oldParentNode!==e.parentNode?(t=r.REPARENTED,this.ensureHasOldPreviousSiblingIfNeeded(e)):this.calcReordered&&this.wasReordered(e)&&(t=r.REORDERED)),this.stayedIn.set(e,t)}if(i!==r.STAYED_IN)for(let t=e.firstChild;t;t=t.nextSibling)this.visitNode(t,i)}}ensureHasOldPreviousSiblingIfNeeded(e){if(!this.calcOldPreviousSibling)return;this.processChildlistChanges();let t=e.parentNode,n=this.treeChanges.get(e);n&&n.oldParentNode&&(t=n.oldParentNode);let r=this.childListChangeMap.get(t);r||(r=new l,this.childListChangeMap.set(t,r)),!e.previousSibling&&r.oldPrevious.has(e)||r.oldPrevious.set(e,e.previousSibling)}getChanged(e,t,n){let i,o;this.selectors=t,this.characterDataOnly=n;for(let t=0;t<this.entered.length;t++)i=this.entered[t],o=this.matchabilityChange(i),o!==r.ENTERED&&o!==r.STAYED_IN||e.added.push(i);const s=Array.from(this.stayedIn.keys());let a;for(let t=0;t<s.length;t++)if(i=s[t],a=3===i.nodeType&&this.stayedIn.get(i)===r.REPARENTED,o=this.matchabilityChange(i,a?r.STAYED_IN:null),o===r.ENTERED)e.added.push(i);else if(o===r.EXITED)e.removed.push(i);else if(o===r.STAYED_IN&&(e.reparented||e.reordered)){const t=this.stayedIn.get(i);e.reparented&&t===r.REPARENTED?e.reparented.push(i):e.reordered&&t===r.REORDERED&&e.reordered.push(i)}for(let t=0;t<this.exited.length;t++)i=this.exited[t],o=this.matchabilityChange(i),o!==r.EXITED&&o!==r.STAYED_IN||e.removed.push(i)}getOldParentNode(e){const n=this.treeChanges.get(e);if(n&&n.childList)return n.oldParentNode?n.oldParentNode:null;const i=this.treeChanges.reachabilityChange(e);return i===r.STAYED_OUT||i===r.ENTERED?(t.logger.warn("getOldParentNode requested on invalid node."),null):e.parentNode}getOldPreviousSibling(e){let t=e.parentNode;const n=this.treeChanges.get(e);n&&n.oldParentNode&&(t=n.oldParentNode);const r=this.childListChangeMap.get(t);if(!r)throw Error("getOldPreviousSibling requested on invalid node.");return r.oldPrevious.get(e)}getOldAttribute(e,t){const n=this.treeChanges.get(e);if(!n||!n.attributes)throw Error("getOldAttribute requested on invalid node.");const r=n.getAttributeOldValue(t);if(void 0===r)throw Error("getOldAttribute requested for unchanged attribute name.");return r}attributeChangedNodes(e){if(!this.treeChanges.anyAttributesChanged)return{};let t,n;if(e){t={},n={};for(let r=0;r<e.length;r++){const i=e[r];t[i]=!0,n[i.toLowerCase()]=i}}const i={},o=this.treeChanges.getNodes();let s,a;for(let e=0;e<o.length;e++){s=o[e];const l=this.treeChanges.get(s);if(!l.attributes)continue;if(r.STAYED_IN!==this.treeChanges.reachabilityChange(s)||r.STAYED_IN!==this.matchabilityChange(s))continue;a=s;const c=l.getAttributeNamesMutated();let d,u;for(let e=0;e<c.length;e++)d=c[e],(!t||t[d]||l.isCaseInsensitive&&n[d])&&(u=l.getAttributeOldValue(d),u!==a.getAttribute(d)&&(n&&l.isCaseInsensitive&&(d=n[d]),i[d]=i[d]||[],i[d].push(a)))}return i}getOldCharacterData(e){const t=this.treeChanges.get(e);if(!t||!t.characterData)throw Error("getOldCharacterData requested on invalid node.");return t.characterDataOldValue}getCharacterDataChanged(){if(!this.treeChanges.anyCharacterDataChanged)return[];const e=this.treeChanges.getNodes(),t=[];let n,i;for(let o=0;o<e.length;o++)n=e[o],r.STAYED_IN===this.treeChanges.reachabilityChange(n)&&(i=this.treeChanges.get(n),i.characterData&&n.textContent!=i.characterDataOldValue&&t.push(n));return t}computeMatchabilityChange(e,t){this.matchCache||(this.matchCache=[]),this.matchCache[e.uid]||(this.matchCache[e.uid]=s());const n=this.matchCache[e.uid];let r=n.get(t);return void 0===r&&(r=e.matchabilityChange(t,this.treeChanges.get(t)),n.set(t,r)),r}matchabilityChange(e,t){if(this.characterDataOnly)switch(e.nodeType){case Node.COMMENT_NODE:case 3:return r.STAYED_IN;default:return r.STAYED_OUT}if(!this.selectors)return r.STAYED_IN;if(1!==e.nodeType)return null==t?e.parentNode?r.STAYED_IN:r.STAYED_OUT:t;let n=e;const i=this.selectors.map(e=>this.computeMatchabilityChange(e,n));let o=r.STAYED_OUT,s=0;for(;o!==r.STAYED_IN&&s<i.length;){switch(i[s]){case r.STAYED_IN:o=r.STAYED_IN;break;case r.ENTERED:o=o===r.EXITED?r.STAYED_IN:r.ENTERED;break;case r.EXITED:o=o===r.ENTERED?r.STAYED_IN:r.EXITED}s++}return o}getChildlistChange(e){let t=this.childListChangeMap.get(e);return t||(t=new l,this.childListChangeMap.set(e,t)),t}processChildlistChanges(){if(this.childListChangeMap)return;let e,t,n,i;this.childListChangeMap=s();const o=function(e,t,n){!e||n.added.has(e)||n.maybeMoved.has(e)||t&&!n.oldPrevious.get(e)&&(t&&(n.added.has(t)||n.maybeMoved.has(t))||n.oldPrevious.set(e,t))};for(let s=0;s<this.mutations.length;s++)if(e=this.mutations[s],"childList"==e.type&&(this.treeChanges.reachabilityChange(e.target)===r.STAYED_IN||this.calcOldPreviousSibling)){n=this.getChildlistChange(e.target),i=e.previousSibling;for(let r=0;r<e.removedNodes.length;r++)t=e.removedNodes[r],o(t,i,n),n.added.has(t)?n.added.delete(t):(n.removed.add(t),n.maybeMoved.delete(t)),i=t;o(e.nextSibling,i,n);for(let r=0;r<e.addedNodes.length;r++)t=e.addedNodes[r],n.removed.has(t)?(n.removed.delete(t),n.maybeMoved.add(t)):n.added.add(t)}}wasReordered(e){if(!this.treeChanges.anyParentsChanged)return!1;this.processChildlistChanges();let t=e.parentNode;const n=this.treeChanges.get(e);n&&n.oldParentNode&&(t=n.oldParentNode);const r=this.childListChangeMap.get(t);if(!r)return!1;if(r.moved)return r.moved.has(e);r.moved=s();const i=s();function o(e){if(!e)return!1;if(!r.maybeMoved.has(e))return!1;let t=r.moved.get(e);return void 0!==t||(i.has(e)?t=!0:(i.set(e,!0),t=function(e){if(l.has(e))return l.get(e);let t=e.previousSibling;for(;t&&(r.added.has(t)||o(t));)t=t.previousSibling;return l.set(e,t),t}(e)!==function e(t){let n=a.get(t);if(void 0!==n)return n;n=r.oldPrevious.get(t);for(;n&&(r.removed.has(n)||o(n));)n=e(n);void 0===n&&(n=t.previousSibling);return a.set(t,n),n}(e)),i.has(e)?(i.delete(e),r.moved.set(e,t)):t=r.moved.get(e)),t}const a=s();const l=s();return r.maybeMoved.forEach(o),r.moved.get(e)}}class u{constructor(e,t){if(this.projection=e,this.added=[],this.removed=[],this.reparented=t.all||t.element||t.characterData?[]:void 0,this.reordered=t.all?[]:void 0,this.projection=e,e.getChanged(this,t.elementFilter,t.characterData),t.all||t.attribute||t.attributeList){const n=t.attribute?[t.attribute]:t.attributeList,r=e.attributeChangedNodes(n);t.attribute?this.valueChanged=r[t.attribute]||[]:(this.attributeChanged=r,t.attributeList&&t.attributeList.forEach(e=>{this.attributeChanged.hasOwnProperty(e)||(this.attributeChanged[e]=[])}))}if(t.all||t.characterData){const n=e.getCharacterDataChanged();t.characterData?this.valueChanged=n:this.characterDataChanged=n}this.reordered&&(this.getOldPreviousSibling=e.getOldPreviousSibling.bind(e))}getOldParentNode(e){return this.projection.getOldParentNode(e)}getOldAttribute(e,t){return this.projection.getOldAttribute(e,t)}getOldPreviousSibling(e){return this.projection.getOldPreviousSibling(e)}getOldCharacterData(e){return this.projection.getOldCharacterData(e)}getCharacterDataChanged(){return this.projection.getCharacterDataChanged()}}const h=/[a-zA-Z_]+/,f=/[a-zA-Z0-9_\-]+/;function g(e){return'"'+e.replace(/"/,'\\"')+'"'}class p{constructor(){}matches(e){if(null===e)return!1;if(void 0===this.attrValue)return!0;if(!this.contains)return this.attrValue==e;const t=e.split(" ");for(let e=0;e<t.length;e++)if(this.attrValue===t[e])return!0;return!1}toString(){const e="["+this.attrName+"]";return"class"===this.attrName&&this.contains?"."+this.attrValue:"id"!==this.attrName||this.contains?this.contains?"["+this.attrName+"~="+g(this.attrValue)+"]":"attrValue"in this?"["+this.attrName+"="+g(this.attrValue)+"]":e:"#"+this.attrValue}}class m{get caseInsensitiveTagName(){return this.tagName.toUpperCase()}get selectorString(){return this.tagName+this.qualifiers.join("")}constructor(){this.uid=m.nextUid++,this.qualifiers=[]}isMatching(e){return e[m.matchesSelector](this.selectorString)}wasMatching(e,t,n){if(!t||!t.attributes)return n;const r=t.isCaseInsensitive?this.caseInsensitiveTagName:this.tagName;if("*"!==r&&r!==e.tagName)return!1;const i=[];let o,s=!1;for(let e=0;e<this.qualifiers.length;e++){o=this.qualifiers[e];const n=t.getAttributeOldValue(o.attrName);i.push(n),s=s||void 0!==n}if(!s)return n;for(let t=0;t<this.qualifiers.length;t++){o=this.qualifiers[t];let n=i[t];if(void 0===n&&(n=e.getAttribute(o.attrName)),!o.matches(n))return!1}return!0}matchabilityChange(e,t){return this.isMatching(e)?this.wasMatching(e,t,!0)?r.STAYED_IN:r.ENTERED:this.wasMatching(e,t,!1)?r.EXITED:r.STAYED_OUT}static parseSelectors(e){const t=[];let n,r;function i(){n&&(r&&(n.qualifiers.push(r),r=void 0),t.push(n)),n=new m}function o(){r&&n.qualifiers.push(r),r=new p}const s=/\s/;let a;const l="Invalid or unsupported selector syntax.";let c,d=1,u=0;for(;u<e.length;)switch(c=e[u++],d){case 1:if(c.match(h)){i(),n.tagName=c,d=2;break}if("*"===c){i(),n.tagName="*",d=3;break}if("."===c){i(),o(),n.tagName="*",r.attrName="class",r.contains=!0,d=4;break}if("#"===c){i(),o(),n.tagName="*",r.attrName="id",d=4;break}if("["===c){i(),o(),n.tagName="*",r.attrName="",d=6;break}if(c.match(s))break;throw Error(l);case 2:if(c.match(f)){n.tagName+=c;break}if("."===c){o(),r.attrName="class",r.contains=!0,d=4;break}if("#"===c){o(),r.attrName="id",d=4;break}if("["===c){o(),r.attrName="",d=6;break}if(c.match(s)){d=14;break}if(","===c){d=1;break}throw Error(l);case 3:if("."===c){o(),r.attrName="class",r.contains=!0,d=4;break}if("#"===c){o(),r.attrName="id",d=4;break}if("["===c){o(),r.attrName="",d=6;break}if(c.match(s)){d=14;break}if(","===c){d=1;break}throw Error(l);case 4:if(c.match(h)){r.attrValue=c,d=5;break}throw Error(l);case 5:if(c.match(f)){r.attrValue+=c;break}if("."===c){o(),r.attrName="class",r.contains=!0,d=4;break}if("#"===c){o(),r.attrName="id",d=4;break}if("["===c){o(),d=6;break}if(c.match(s)){d=14;break}if(","===c){d=1;break}throw Error(l);case 6:if(c.match(h)){r.attrName=c,d=7;break}if(c.match(s))break;throw Error(l);case 7:if(c.match(f)){r.attrName+=c;break}if(c.match(s)){d=8;break}if("~"===c){r.contains=!0,d=9;break}if("="===c){r.attrValue="",d=11;break}if("]"===c){d=3;break}throw Error(l);case 8:if("~"===c){r.contains=!0,d=9;break}if("="===c){r.attrValue="",d=11;break}if("]"===c){d=3;break}if(c.match(s))break;throw Error(l);case 9:if("="===c){r.attrValue="",d=11;break}throw Error(l);case 10:if("]"===c){d=3;break}if(c.match(s))break;throw Error(l);case 11:if(c.match(s))break;if('"'===c||"'"===c){a=c,d=13;break}r.attrValue+=c,d=12;break;case 12:if(c.match(s)){d=10;break}if("]"===c){d=3;break}if("'"===c||'"'==c)throw Error(l);r.attrValue+=c;break;case 13:if(c===a){d=10;break}r.attrValue+=c;break;case 14:if(c.match(s))break;if(","===c){d=1;break}throw Error(l)}switch(d){case 1:case 2:case 3:case 5:case 14:i();break;default:throw Error(l)}if(!t.length)throw Error(l);return t}}m.nextUid=1,m.matchesSelector=function(){const e=document.createElement("div");return"function"==typeof e.webkitMatchesSelector?"webkitMatchesSelector":"function"==typeof e.mozMatchesSelector?"mozMatchesSelector":"function"==typeof e.msMatchesSelector?"msMatchesSelector":"matchesSelector"}();const v=/^([a-zA-Z:_]+[a-zA-Z0-9_\-:\.]*)$/;function y(e){if("string"!=typeof e)throw Error("Invalid request opion. attribute must be a non-zero length string.");if(!(e=e.trim()))throw Error("Invalid request opion. attribute must be a non-zero length string.");if(!e.match(v))throw Error("Invalid request option. invalid attribute name: "+e);return e}function C(e){if(!e.trim().length)throw Error("Invalid request option: elementAttributes must contain at least one attribute.");const t={},n={},r=e.split(/\s+/);let i,o;for(let e=0;e<r.length;e++)if(i=r[e],i){if(i=y(i),o=i.toLowerCase(),t[o])throw Error("Invalid request option: observing multiple case variations of the same attribute is not supported.");n[i]=!0,t[o]=!0}return Object.keys(n)}class _{constructor(e,t){this.connected=!1,this.options=_.validateOptions(e),this.observerOptions=_.createObserverOptions(this.options.queries),this.root=this.options.rootNode,this._summaryGuard=new N,this._callbacks={current:null,callbacks:n.extend({},{},e.callbacks)},this.elementFilter=Array.prototype.concat.apply([],this.options.queries.map(e=>e.elementFilter?e.elementFilter:[])),this.elementFilter.length||(this.elementFilter=void 0),this.calcReordered=this.options.queries.some(e=>e.all),this.queryValidators=[],_.createQueryValidator&&(this.queryValidators=this.options.queries.map(e=>_.createQueryValidator(this.root,e))),this.observer=new i(e=>{this.observerCallback(e)}),t&&this.reconnect()}setCallback(e,t){const n=this._callbacks.current;if(!(e in this._callbacks.callbacks))throw new Error("unknown mutation summary callback key "+e);return this._callbacks.current=e,t&&(this._callbacks.callbacks[e]=t),n}ignoreNextMutation(){this._summaryGuard.set(1)}get callback(){return this._callbacks.callbacks[this._callbacks.current]}filterIgnoredMutations(e){return e}filterIgnoredMutations1(e){if(!e)return e;const t=this.options.mutationFilter&&this.options.mutationFilter(e)||e,n=this.options.nodeFilter;if(!t||!t.length||!n)return t;const r=[];let i;for(let o=0,s=t.length;o<s;++o)i=e[o],n(i.target)&&r.push(i);return r}static createObserverOptions(e){const t={childList:!0,subtree:!0};let n;function r(e){t.attributes&&!n||(t.attributes=!0,t.attributeOldValue=!0,e?(n=n||{},e.forEach(e=>{n[e]=!0,n[e.toLowerCase()]=!0})):n=void 0)}return e.forEach(e=>{if(e.characterData)return t.characterData=!0,void(t.characterDataOldValue=!0);if(e.all)return r(),t.characterData=!0,void(t.characterDataOldValue=!0);if(e.attribute)return void r([e.attribute.trim()]);const n=function(e,t){const n={};return e.forEach(e=>{e.qualifiers.forEach(e=>{t&&"class"===e.attrName||(n[e.attrName]=!0)})}),Object.keys(n)}(e.elementFilter,!1===e.classAttribute).concat(e.attributeList||[]);n.length&&r(n)}),n&&(t.attributeFilter=Object.keys(n)),t}static validateOptions(e){for(let t in e)if(!(t in _.optionKeys))throw Error("Invalid option: "+t);if(!e.queries||!e.queries.length)throw Error("Invalid options: queries must contain at least one query request object.");const t={callbacks:e.callbacks,mutationFilter:e.mutationFilter,nodeFilter:e.nodeFilter,rootNode:e.rootNode||document,observeOwnChanges:Boolean(e.observeOwnChanges),oldPreviousSibling:Boolean(e.oldPreviousSibling),queries:[]};for(let n=0;n<e.queries.length;n++){const r=e.queries[n];if(r.all){if(Object.keys(r).length>1)throw Error("Invalid request option. all has no options.");t.queries.push({all:!0})}else if("attribute"in r){const e={attribute:y(r.attribute)};if(e.elementFilter=m.parseSelectors("*["+e.attribute+"]"),Object.keys(r).length>1)throw Error("Invalid request option. attribute has no options.");t.queries.push(e)}else if("element"in r){let e=Object.keys(r).length;const n={element:r.element,elementFilter:m.parseSelectors(r.element)};if(r.hasOwnProperty("elementAttributes")&&(n.attributeList=C(r.elementAttributes),e--),void 0!==r.classAttribute&&(n.classAttribute=!1!==r.classAttribute,e--),e>1)throw Error("Invalid request option. element only allows elementAttributes option.");t.queries.push(n)}else{if(!r.characterData)throw Error("Invalid request option. Unknown query request.");if(Object.keys(r).length>1)throw Error("Invalid request option. characterData has no options.");t.queries.push({characterData:!0})}}return t}createSummaries(e,t=!0){const n=t?this.filterIgnoredMutations(e):e;if(!n||!n.length)return[];const r=new d(this.root,n,this.elementFilter,this.calcReordered,this.options.oldPreviousSibling,this.options.nodeFilter),i=[];for(let e=0;e<this.options.queries.length;e++)i.push(new u(r,this.options.queries[e]));return i}checkpointQueryValidators(){this.queryValidators.forEach(e=>{e&&e.recordPreviousState()})}runQueryValidators(e){this.queryValidators.forEach((t,n)=>{t&&t.validate(e[n])})}changesToReport(e){return e.some(e=>{if(o.some((function(t){return e[t]&&e[t].length})))return!0;if(e.attributeChanged){if(Object.keys(e.attributeChanged).some(t=>!!e.attributeChanged[t].length))return!0}return!1})}filterSummaries(e){if(!e||e.length<2)return;let t,n,r,i;let o=0;for(e.length;o<length;++o)if(t=e[o],n=t.added,!(n.length<1))for(let t=o+1;t<e.length;++t){i=e[t];for(let e=n.length-1;e>=0;--e)i.removed.indexOf(n[e])>=0?(n.splice(o,1),i.removed.splice(e,1)):(r=i.added.indexOf(n[0]))>=0&&i.added.splice(r,1)}}observerCallback(e){if(this._summaryGuard.shouldIgnore())return void t.logger.debug("Ignoring mutations",this._summaryGuard);const n=this.callback;if(!n)return;this.options.observeOwnChanges||this.observer.disconnect();const r=this.createSummaries(e);this.runQueryValidators(r),this.options.observeOwnChanges&&this.checkpointQueryValidators(),this.changesToReport(r)&&(this.filterSummaries(r),n(r)),!this.options.observeOwnChanges&&this.connected&&(this.checkpointQueryValidators(),this.observer.observe(this.root,this.observerOptions))}get isConnected(){return Boolean(this.connected)}reconnect(){this.connected||(this.observer.observe(this.root,this.observerOptions),this.connected=!0,this.checkpointQueryValidators())}dispose(){try{this.disconnect(),this.observer=null,this.options=null,this._summaryGuard=null,this._callbacks=null,this.elementFilter=null,this.calcReordered=null,this.queryValidators=null}catch(e){t.logger.error(e,"while disposing mutation summary")}}disconnect(){if(!this.connected)return t.logger.debug("Disconnect: already disconnected"),[];let e;try{e=this.takeSummaries(),this.observer.disconnect()}catch(e){t.logger.debug("Disconnect: ",e)}return this.connected=!1,e}takeSummaries(){if(!this.connected)throw Error("Not connected");const e=this.createSummaries(this.observer.takeRecords());return this.changesToReport(e)?e:void 0}}_.parseElementFilter=m.parseSelectors,_.optionKeys={callbacks:!0,queries:!0,rootNode:!0,oldPreviousSibling:!0,observeOwnChanges:!0,mutationFilter:!0,nodeFilter:!0};class N{constructor(){this.ignoreCount=0,this.timeout=null}set(e){this.timeout&&clearTimeout(this.timeout),this.ignoreCount+=e;const t=this.ignoreCount;this.timeout=setTimeout(()=>{this.timeout=null,this.ignoreCount=Math.max(this.ignoreCount-t,0)},35)}shouldIgnore(){const e=this.ignoreCount>0;return e&&this.ignoreCount--,0===this.ignoreCount&&this.timeout&&(clearTimeout(this.timeout),this.timeout=null),e}}Element.prototype.matches||(Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector||function(e){const t=(this.document||this.ownerDocument).querySelectorAll(e);let n=t.length;for(;--n>=0&&t.item(n)!==this;);return n>-1});const b={MutationSummary:_};Object.assign(t,b)}(window.LOOPINDEX),Object.defineProperty(s,"__esModule",{value:!0}),function(e){const t=null==e?void 0:e.FLITE,n=null==e?void 0:e.$;if(!t||!n)throw new Error("Cannot initialize FLITE Utils without FLITE globals");class r{constructor(){this._isComposing=!1,this._compositionEnded=!1}attach(e){try{if(e===this._root)return;this._root&&this._unlisten()}catch(e){t.logger.warn(e)}this._root=e,e&&this._listen()}dispose(){this._unlisten(),this._root=null}get root(){return this._root}get isComposing(){return this._isComposing||this._compositionEnded}_unlisten(){const e=this._unlistenCB;if(this._unlistenCB=null,e)try{e()}finally{}}_listen(){this._unlisten();const e=e=>{t.logger.debug("Composition start"),this._isComposing=!0},n=e=>{t.logger.debug("Composition update"),this._isComposing=!0},r=e=>{t.logger.debug("Composition end"),this._isComposing=!1,this._compositionEnded=!0},i=e=>{this._compositionEnded=!1},o=e=>{229!==e.which&&(this._compositionEnded=!1)};this._root.addEventListener("compositionupdate",n,!0),this._root.addEventListener("compositionstart",e,!0),this._root.addEventListener("compositionend",r,!0),this._root.addEventListener("keyup",i),this._root.addEventListener("keydown",o),this._unlistenCB=()=>{this._root&&(this._root.removeEventListener("compositionupdate",n,!0),this._root.removeEventListener("compositionstart",e,!0),this._root.removeEventListener("compositionend",r,!0),this._root.removeEventListener("keyup",i),this._root.removeEventListener("keydown",o))}}}class i{constructor(e,t){this.callback=t,this.id=String(i.nextId++),i._guards[this.id]=this;let n=null;const r=o=>{e.removeEventListener("keyup",r,!0),delete i._guards[this.id],n&&clearTimeout(n);const s=o.keyCode||o.which;8===s?t({backspace:!0,ctrl:o.ctrlKey,shift:o.shiftKey}):46===s&&t({del:!0,ctrl:o.ctrlKey,shift:o.shiftKey})};e.addEventListener("keyup",r,!0),n=setTimeout(()=>{n=0,removeEventListener("keyup",r,!0),delete i._guards[this.id],t({backspace:!1,del:!1,ctrl:!1,shift:!1})},75)}}i._guards={},i.nextId=0;class o{constructor(){this._matchers=[],this._matcherMap={},this._types=[]}getSelector(e){return this._matcherMap[e]}addPatterns(e,t){if(!t||!e)return this;const n=this._matcherMap[e]||"";return this._matcherMap[e]=this._addPatternsToString(n,t),this._refresh(),this}removePattern(e,t){if(!e||!t)return this;const n=this._matcherMap[e]||"";return this._matcherMap[e]=this._removePatternsFromString(n,t),this._refresh(),this}addClassifier(e){return this._matchers.push(e),this}getAncestorOfClass(t,n,r,i){if(!(null==t?void 0:t.parentNode))return null;const o=this.getSelector(r);if(!o)return null;let s=null;for(;t&&t!==n;){if(1===t.nodeType&&e.utils.dom.matchesSelector(t,o)){if(!i)return t;s=t}t=t.parentNode}return s}classifyNode(t,n,r,i=!1){if(!t||t===n)return o.IGNORE;if(3===t.nodeType){if(r&&e.utils.dom.isEmptyTextNode(t))return o.IGNORE;if(i)return o.NODE_AND_CONTENT}let s=this._runMatchers(t);if(s!=o.NODE_AND_CONTENT)return s;if(s=this._runSelectors(t),s===o.FORCE_ACCEPT)return o.NODE_AND_CONTENT;if(i||s===o.IGNORE)return s;for(let e=t.parentNode;e&&e!==n;e=e.parentNode){const t=this._runSelectors(e);if(t===o.FORCE_ACCEPT)return o.NODE_AND_CONTENT;if(t===o.NODE_ONLY||t===o.IGNORE)return o.IGNORE}return s}_runSelectors(t){let n;const r=o.NODE_AND_CONTENT;if(this._matcherMap[r]&&e.utils.dom.matchesSelector(t,this._matcherMap[r]))return o.FORCE_ACCEPT;for(let i=0,o=this._types.length;i<o;++i)if(n=this._types[i],n!==r&&e.utils.dom.matchesSelector(t,this._matcherMap[n]))return n;return o.NODE_AND_CONTENT}_refresh(){Object.keys(this._matcherMap).forEach(e=>{const t=this._matcherMap[e];t&&t.length||delete this._matcherMap[e]}),this._types=Object.keys(this._matcherMap).sort((e,t)=>e===o.IGNORE?-1:t===o.IGNORE?1:0)}_runMatchers(e){let t;for(let n=0,r=this._matchers.length;n<r;++n)if(t=this._matchers[n](e,this),t)return t;return o.NODE_AND_CONTENT}_removePatternsFromString(e,t){if(!t)return e;const n=this._toSelectorMap(t),r=this._toSelectorMap(e);return Object.keys(n).forEach((e,...t)=>{delete r[e]}),Object.keys(r).join(",")}_addPatternsToString(e,n){return t.trackerUtils.mergeStringsOrArrays(e,n).join(",")}_toSelectorMap(t){return e.utils.strings.toStringMap(e.utils.strings.toStringArray(t))}}o.NODE_AND_CONTENT="track",o.NODE_ONLY="node",o.CONTENT_ONLY="content",o.IGNORE="ignore",o.FORCE_ACCEPT="track!";const s={trackerUtils:new class{constructor(){this._allDeadCharsRegex=/[\u200B\uFEFF\u00A0]/g,this._deadCharsNoNBSPRegex=/[\u200B\uFEFF]/g}monitorTextNode(t,n){if(!t)return e.logger.error("monitor text node: null input");if(!e.utils.strings.isEmptyString(t.textContent))return e.logger.error("monitor text node: input node has text");let r=0;const i=()=>{r&&(window.clearTimeout(r),r=0),null==o||o.disconnect()},o=new MutationObserver(r=>{const o=t.textContent;e.utils.strings.isEmptyString(o)||(i(),n(t,!0))});o.observe(t,{characterData:!0,childList:!1,subtree:!0}),r=setTimeout(()=>{i(),n(t,!1)},50)}mergeStringsOrArrays(...t){if(!t||!t.length)return[];const n=[];for(let r=0,i=t.length;r<i;++r){const i=t[r];i&&n.push.apply(n,e.utils.strings.toStringArray(i))}const r=e.utils.strings.toStringMap(n);return Object.keys(r)}isFLITEBody(e){return!!(null==e?void 0:e.getAttribute)&&Boolean(e.getAttribute("data-flite-body"))}markFLITEBody(e){e&&e.setAttribute("data-flite-body","1")}getTagName(e){return e&&e.tagName&&e.tagName.toLowerCase()||null}isBRNode(e){return"br"==this.getTagName(e)}printRange(e){if(!e)return"<null range>";let t=["Range:",(void 0).printNode(e.startContainer),":",e.startOffset];return e.collapsed||t.push(", end: ",(void 0).printNode(e.endContainer),":",e.endOffset),t.join(" ")}printNode(e){if(!e)return"<null node>";const t=e.nodeType,n=[3===t?"text":1===t?e.nodeName:"<"+t+"node>"],r=e;return r.id&&n.push("#",r.id),r.className&&n.push(".",r.className),n.push("(",(3===t?e.data:String(e.innerHTML)).substring(0,10),")"),n.push("parent:",e.parentNode&&e.parentNode.nodeName||"NULL"),n.join("")}stripNode(e){if(!e||1!==e.nodeType)return;const t=e;var r=n.map(t.attributes,e=>e.name);n(e).removeClass(),n.each(r,(function(e,n){t.removeAttribute(n)}))}findIndexInArray(e,t){if(!e)return-1;for(let n=0,r=e.length;n<r;++n)if(t(e[n]))return n;return-1}findInArray(e,t){const n=this.findIndexInArray(e,t);return n>=0?e[n]:null}createCompositionStateTracker(){return new r}createBackspaceGuard(e,t){return new i(e,t)}makeDateLabel(e,t,n,r){let i;new Date;i=r?", "+r:"";const o=e("MONTHS"),s="string"==typeof o?o.split(","):o;return[s&&s[n]||"",t,r].join(" ")}fixSelection(e,t){if(!e||!t||e.collapsed)return e;var n;try{for(;(n=e.endContainer)&&n!==t&&0===e.endOffset&&!e.collapsed&&(n.previousSibling?e.setEndBefore(n):n.parentNode&&n.parentNode!==t&&e.setEndBefore(n.parentNode),e.endContainer!==n););}catch(e){}try{for(;(n=e.startContainer)&&n!==t&&!e.collapsed&&(3==(n=e.startContainer).nodeType?e.startOffset>=n.nodeValue.length&&e.setStartAfter(n):e.startOffset>=n.childNodes.length&&e.setStartAfter(n),e.startContainer!=n););}catch(e){}}removeDeadCharactersFrom(e,t){return e&&e.replace(t?this._deadCharsNoNBSPRegex:this._allDeadCharsRegex,"")}getListItemDeleteContext(n){"LI"!==(null==n?void 0:n.tagName)&&t.logger.error("getListItemDeleteContext: wrong node tag "+(null==n?void 0:n.tagName));const r={li:n,liContent:n.innerHTML,list:n.parentNode,listTag:n.parentNode.nodeName,index:e.utils.dom.getNodeIndex(n),tag:e.utils.getUniqueId("flite-list-")};return r.list.setAttribute("data-flite-list-id",r.tag),r.li.setAttribute("data-flite-li-id",r.tag),r}findMatchingListElement(t,n){const r=Object.assign(Object.assign({},t),{list:null,li:null}),i=t=>Object.assign(Object.assign({},t),{liContent:t.li.innerHTML,listTag:t.list.nodeName,index:e.utils.dom.getNodeIndex(t.li)});if(!t||!(null==n?void 0:n.length))return r;for(let e of n)if(1===(null==e?void 0:e.nodeType)){if(!r.list&&e.getAttribute("data-flite-list-id")===t.tag&&(e.removeAttribute("data-flite-list-id"),r.list=e,r.li))return i(r);if(!r.list&&e.getAttribute("data-flite-li-id")===t.tag&&(e.removeAttribute("data-flite-li-id"),r.li=e,r.list))return i(r)}return r}},NodeClassifier:o};Object.assign(t,s)}(window.LOOPINDEX),Object.defineProperty(s,"__esModule",{value:!0}),function(e){const t=null==e?void 0:e.FLITE,n=null==e?void 0:e.$;if(!t||!n)throw new Error("Cannot initialize FLITE plugin utils without FLITE globals");const r=/ice-ins/,i={OL:1,TR:1,UL:1,BR:1,TBODY:1},o={de:{TOGGLE_TRACKING:"Ãberarbeitungsmodus umschalten",TOGGLE_SHOW:"Ãberarbeitungssichtbarkeit umschalten",ACCEPT_ALL:"Alle Ãnderungen annehmen",REJECT_ALL:"Alle Ãnderungen ablehnen",ACCEPT_ONE:"Ãnderung annehmen",REJECT_ONE:"Ãnderung ablehnen",PREV_CHANGE:"Vorherige Ãnderung",NEXT_CHANGE:"NÃ¤chste Ãnderung"},en:{TOGGLE_TRACKING:"Toggle Tracking Changes",TOGGLE_SHOW:"Toggle view Changes",ACCEPT_ALL:"Accept all changes",REJECT_ALL:"Reject all changes",ACCEPT_ONE:"Accept Change",REJECT_ONE:"Reject Change",PREV_CHANGE:"Previous Change",NEXT_CHANGE:"Next Change"},es:{TOGGLE_TRACKING:"Activar y desactivar el seguimiento de cambios",TOGGLE_SHOW:"Activar y desactivar el seguimiento de cambios",ACCEPT_ALL:"Aceptar todos los cambios",REJECT_ALL:"Descartar todos los cambios",ACCEPT_ONE:"Aceptar el cambio",REJECT_ONE:"Descartar el cambio",PREV_CHANGE:"Cambio anterior",NEXT_CHANGE:"PrÃ³ximo cambio"},fr:{TOGGLE_TRACKING:"Activer/dÃ©sactiver le suivi des modifications",TOGGLE_SHOW:"Activer/dÃ©sactiver le suivi des modifications",ACCEPT_ALL:"Accepter toutes les modifications",REJECT_ALL:"Refuser toutes les modifications",ACCEPT_ONE:"Accepter",REJECT_ONE:"Refuser",PREV_CHANGE:"Modification prÃ©cÃ©dente",NEXT_CHANGE:"Prochain changement"},ja:{TOGGLE_TRACKING:"å¤æ´ã®è¿½è·¡ãåãæ¿ãã",TOGGLE_SHOW:"å¤æ´ã®è¿½è·¡ãåãæ¿ãã",ACCEPT_ALL:"å¨ã¦ã®å¤æ´ãè¨±å¯",REJECT_ALL:"å¨ã¦ã®å¤æ´ãæå¦",ACCEPT_ONE:"å¤æ´ãè¨±å¯",REJECT_ONE:"å¤æ´ãæå¦",PREV_CHANGE:"ååã®å¤æ´",NEXT_CHANGE:"æ¬¡ã®å¤æ´"},ko:{TOGGLE_TRACKING:"ë³ê²½ ë´ì© ì¶ì  í ê¸",TOGGLE_SHOW:"ë³ê²½ ë´ì© ì¶ì  í ê¸",ACCEPT_ALL:"íìë ë³ê²½ ë´ì© ëª¨ë ì ì©",REJECT_ALL:"íìë ë³ê²½ ë´ì© ëª¨ë ì·¨ì",ACCEPT_ONE:"ë³ê²½ ë´ì© ì ì©",REJECT_ONE:"ë³ê²½ ë´ì© ì·¨ì",PREV_CHANGE:"ì´ì  ë³ê²½ì¬í­",NEXT_CHANGE:"ë¤ì ë³ê²½ì¬í­"},nl:{TOGGLE_TRACKING:"Wijzigingen bijhouden inschakelen",TOGGLE_SHOW:"Schakelen van gevolgd zichtbaarheid van wijzigingen",ACCEPT_ALL:"Accepteer alle wijzigingen",REJECT_ALL:"Weiger alle wijzigingen",ACCEPT_ONE:"Accepteer wijziging",REJECT_ONE:"Weiger wijziging",PREV_CHANGE:"Vorige wijziging",NEXT_CHANGE:"Volgende wijziging"},pt:{TOGGLE_TRACKING:"Alternar marcas de revisÃ£o",TOGGLE_SHOW:"Alternar marcas de revisÃ£o",ACCEPT_ALL:"Aceitar todas as modificaÃ§Ãµes",REJECT_ALL:"Rejeitar todas as modificaÃ§Ãµes",ACCEPT_ONE:"Aceitar modificaÃ§Ã£o",REJECT_ONE:"Rejeitar modificaÃ§Ã£o",PREV_CHANGE:"MudanÃ§a anterior",NEXT_CHANGE:"PrÃ³xima mudanÃ§a"},ru:{TOGGLE_TRACKING:"ÐÐºÐ»ÑÑÐ¸ÑÑ/Ð²ÑÐºÐ»ÑÑÐ¸ÑÑ Ð¾ÑÑÐ»ÐµÐ¶Ð¸Ð²Ð°Ð½Ð¸Ðµ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹",TOGGLE_SHOW:"ÐÐºÐ»ÑÑÐ¸ÑÑ/Ð²ÑÐºÐ»ÑÑÐ¸ÑÑ Ð¾ÑÑÐ»ÐµÐ¶Ð¸Ð²Ð°Ð½Ð¸Ðµ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹",ACCEPT_ALL:"ÐÑÐ¸Ð½ÑÑÑ Ð²ÑÐµ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ",REJECT_ALL:"ÐÑÐºÐ»Ð¾Ð½Ð¸ÑÑ Ð²ÑÐµ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ",ACCEPT_ONE:"ÐÑÐ¸Ð½ÑÑÑ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ",REJECT_ONE:"ÐÑÐºÐ»Ð¾Ð½Ð¸ÑÑ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ",PREV_CHANGE:"ÐÑÐµÐ´ÑÐ´ÑÑÐµÐµ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ",NEXT_CHANGE:"Ð¡Ð»ÐµÐ´ÑÑÑÐµÐµ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ"},sk:{TOGGLE_TRACKING:"PrepnÃºÅ¥ zÃ¡znam",TOGGLE_SHOW:"PrepnÃºÅ¥ zobrazenie",ACCEPT_ALL:"PrijaÅ¥ vÅ¡etky zmeny",REJECT_ALL:"ZruÅ¡iÅ¥ vÅ¡etky zmeny",ACCEPT_ONE:"PrijaÅ¥ zmenu",REJECT_ONE:"ZruÅ¡iÅ¥ zmenu",PREV_CHANGE:"PredchÃ¡dzajÃºca zmena",NEXT_CHANGE:"ÄalÅ¡ia zmena"},tr:{TOGGLE_TRACKING:"DeÄiÅiklikleri Ä°zlemeyi DeÄiÅtir",TOGGLE_SHOW:"DeÄiÅiklikleri Ä°zlemeyi DeÄiÅtir",ACCEPT_ALL:"TÃ¼m deÄiÅiklikleri kabul et",REJECT_ALL:"TÃ¼m deÄiÅiklikleri reddet",ACCEPT_ONE:"DeÄiÅikliÄi Kabul Et",REJECT_ONE:"DeÄiÅikliÄi Reddet",PREV_CHANGE:"Ãnceki deÄiÅiklik",NEXT_CHANGE:"Sonraki deÄiÅiklik"},zh:{TOGGLE_TRACKING:"åæ¢è·è¸ªåæ´",TOGGLE_SHOW:"åæ¢è·è¸ªåæ´",ACCEPT_ALL:"æ¥åææåæ´",REJECT_ALL:"æç»ææåæ´",ACCEPT_ONE:"æ¥ååæ´",REJECT_ONE:"æç»åæ´",PREV_CHANGE:"ä¹åçåæ´",NEXT_CHANGE:"ä¸ä¸ä¸ªåå"}};t.Events={INIT:"flite:init",ACCEPT:"flite:accept",REJECT:"flite:reject",SHOW_HIDE:"flite:showHide",TRACKING:"flite:tracking",CHANGE:"flite:change",HOVER_IN:"flite:hover-in",HOVER_OUT:"flite:hover-out",EVENT_INTERCEPTED:"flite:event-intercepted"},t.Commands={TOGGLE_TRACKING:"flite-toggletracking",TOGGLE_SHOW:"flite-toggleshow",ACCEPT_ALL:"flite-acceptall",REJECT_ALL:"flite-rejectall",ACCEPT_ONE:"flite-acceptone",REJECT_ONE:"flite-rejectone",TOGGLE_TOOLTIPS:"flite-toggletooltips",NEXT_CHANGE:"flite-nextchange",PREV_CHANGE:"flite-prevchange"};const s=[/^tabindex/i,/^aria-/i],a={logCommands:!1,sessionPolicy:"always",copyBehavior:"clean",logEvents:!1,allowFindDeletedText:!0,isTracking:!0,users:[],isVisible:!0,handlePaste:!0,onEditorDestroy:"none",trackApiInsert:!0,removeDeleteOnPaste:!1,showChangesWhenInactive:!0,preserveWhiteSpace:!0,ignoreCommands:void 0,ignoreContainers:!1,trackSpellcheck:!1,deletableSelectors:"P,LI,H1,H2,H3,H4,H5,H6,DIV,IMG,BR",opaqueSelectors:"",backgroundColors:{insert:["#A0F7A5","#bdffff","#e5ffcd"],delete:["#ffdddd","#F1C9FF","#FFB3A5"]},debug:{error:!1,log:!1,debug:!1,warn:!1},tooltips:{show:!0,delay:750,template:"%a %%BY %u %t",useTitle:!1,formatter:null},contextMenu:!0,ignoreSelectors:[],userName:void 0,userId:void 0,styleUrls:["css/flite.css"],pageUrls:["css/quicktips.css"],acceptRejectInReadOnly:!1,commands:null,timezone:null,readonlyInsertPolicy:"passive",nonTrackingCommands:[],trackListTypeChange:!1,passiveTracking:!0,clipboardSupport:!0},l={fliteHandled:"data-flite-inserted",spellcheck:"spellcheck",fliteTextContent:"data-flite-text-content",fliteCreated:"data-flite-created",fliteMarked:"data-flite-marked",fliteTitle:"data-flite-title",changeId:"data-flite-cid",userId:"data-userid",userName:"data-username",sessionId:"data-session-id",changeData:"data-changedata",time:"data-time",lastTime:"data-last-change-time",isDeleteNode:"data-flite-is-delete",fliteRecord:"data-flite-record",fliteRecordId:"data-flite-record-id",stubNode:"data-flite-stub"};function c(e,r,i){n(e).addClass(i);const o=r.attributes;let s;for(let n=o&&o.length-1||-1;n>=0;--n)s=o[n].name,t.flitePluginUtils.shouldIgnoreImportedAttribute(s)||e.getAttribute(s)||e.setAttribute(s,o[n].value);return e}let d=void 0,u=void 0;const h=[{command:t.Commands.TOGGLE_TRACKING,title:"TOGGLE_TRACKING"},{command:t.Commands.TOGGLE_SHOW,title:"TOGGLE_SHOW"},{command:t.Commands.ACCEPT_ALL,title:"ACCEPT_ALL"},{command:t.Commands.REJECT_ALL,title:"REJECT_ALL"},{command:t.Commands.ACCEPT_ONE,title:"ACCEPT_ONE"},{command:t.Commands.REJECT_ONE,title:"REJECT_ONE"},{command:t.Commands.PREV_CHANGE,title:"PREV_CHANGE"}],f=h.map(e=>e.command),g={getCommands:function(){return h.map(e=>Object.assign(Object.assign({},e),{localized:this.getLocalizedString(e.title)}))},toggleShow:function(n,r){const i=void 0===n?!this.config("isVisible"):Boolean(n);this.config("isVisible",i);const o="none"!==this.trackingState.mode;e.$(this.getBody()).toggleClass("FLITE-Tracking",i),this.setCommandsState(t.Commands.TOGGLE_SHOW,o,i),this.tracker.setShowChanges(i&&o),!1!==r&&this.fireEvent(t.Events.SHOW_HIDE,{show:i,flite:this})},muteSessionPolicy:function(){u=this.config("sessionPolicy"),this.config("sessionPolicy","never")},restoreSessionPolicy:function(){u&&(this.config("sessionPolicy",u),u=void 0)},allowSaveUndo:(()=>{let e=!0;return function(t){return"boolean"==typeof t&&(e=t),e}})(),onTrackerChange:function({notify:e,textChanged:n,trackerChanged:r,isUpdate:i}){r&&(this.trackingState.update({hasChanges:this.tracker.hasChanges()}),!1!==e&&this.fireEvent(t.Events.CHANGE,{flite:this})),n&&!1!==e&&this.fireEvent("change",{source:"FLITE"}),n&&(i?setTimeout(()=>this.saveUndo(!0),1):this.saveUndo(!1)),r&&this.onSelectionChanged()},onSelectionChanged:function(){this.timeoutClient.startTimer("selection-changed")},getLocalizedString:function(e){return this.localizer.localizeString(e)},setLanguage:function(e){return this.localizer.loadLocale(e||"en").then(e=>{const t=!e;return t&&this.onLocaleChanged(),t})},countChanges:function(e){return this.tracker.countChanges(e)||0},addUsers:function(t){if(!t)return this;e.$.isArray(t)||(t=[t]);const n=this.users;return t.forEach(e=>{n.addUser(e)}),this},onTrackingNodeRemoved:function(t){return e.Tooltips.destroyElementTooltip(t),this},toggleTracking:function(e,n){return t.flitePluginUtils.toggleTracking(this,e,n),this},setUserInfo:function(e){const n=typeof e,r="string"===n||"number"===n?{id:String(e)}:e,i=r.id;let o=!0;if(i){const e=this.users,t=e.getUser(i)||{},n={id:i,name:r.name||t.name||this.getLocalizedString("USER"),style:r.style||t.style};t.id?n.name===t.name&&n.style===t.style||e.updateUser(n):e.addUser(n),e.setCurrentUser(n.id)}else t.logger.warn("setUserInfo did not receive a user id"),o=!1;return this.trackingState.update({hasUser:o}),this.refreshCommands(),o},acceptChange:function(e,t){let n=!1;return this.transactUndo(()=>{n=y.acceptOrRejectChangedNode({node:e,plugin:this,params:t,isAccept:!0})}),n},rejectChange:function(e,t){let n=!1;return this.transactUndo(()=>{n=y.acceptOrRejectChangedNode({node:e,plugin:this,params:t,isAccept:!1})}),n},getUserInfo:function(){return this.users.getCurrentUser(!0)},getChanges:function(e){return this.tracker.getChanges(e)},onTrackingNodeCreated:function(e){return t.flitePluginUtils.addTooltipToNode({node:e,localize:this.getLocalizedString.bind(this),change:this.tracker.getChangeForNode(e),config:this.config("tooltips"),canShow:()=>"none"!==this.trackingState.mode&&this.isVisible,offset:()=>null,timeOffset:this.config("timezoneOffset")}),this._finalizeTrackedNode&&this._finalizeTrackedNode(e),this},onToggleTracking:function(){return this.toggleTracking(),!0},onToggleShow:function(){return this.toggleShow(),!0},onRejectAll:function(){return this.rejectAll(null),!0},acceptAll:function(e){this.transactUndo(()=>{this.tracker.acceptAll(e),this.cleanupAfterAcceptReject(),this.fireEvent(t.Events.ACCEPT,{flite:this,options:e})})},rejectAll:function(e){this.transactUndo(()=>{this.tracker.rejectAll(e),this.cleanupAfterAcceptReject(),this.fireEvent(t.Events.REJECT,{flite:this,options:e})})},onAcceptAll:function(){return this.acceptAll(null),!0},onAcceptOne:function(){const e=this.tracker.currentChangeNode(this.getSelectedNode());return this.acceptChange(e),!0},startNewSession:function(){return"never"!==this.config("sessionPolicy")&&(this.sessionId=e.utils.strings.randomString(8),t.logger.debug("New session id "+this.sessionId)),this.sessionId},onRejectOne:function(){const e=this.tracker.currentChangeNode(this.getSelectedNode());return this.rejectChange(e),!0},onToggleTooltips:function(){return!0},config:function(t,n){const r=()=>e.$.extend(!0,{},this._config);if(!t)return r();const i=this._config;return"object"==typeof t?(Object.assign(i,t),r()):void 0===n?i[t]:(i[t]=n,r())},refreshCommands:function(e){(null==e?void 0:e.length)||(e=f);const n=t.flitePluginUtils.getCommandsStatus(this);e.forEach(e=>{const t=n[e];t&&this.setCommandsState(e,t.enabled,t.active)})},enableAcceptReject:function(e){this.acceptRejectEnabled=Boolean(e)},loadDocumentStyles:function(n,r){if(this.cssLoader&&(this.cssLoader.dispose(),this.cssLoader=null),n){const i=this._config.styleUrls.concat(null!=r?r:[]).map(e=>this.resolvePath(e));(this.cssLoader=new e.utils.CSSLoader(n)).loadCSS(i,e=>{e.ok||t.logger.error("Failed to load FLITE Editor styles")})}},disposePlugin:function(){var e;try{this.trackingState.$.off(),this.trackingState.update({isTracking:!1,readonly:!0,hasChanges:!1}),function(e){const n=e.tracker;try{const t=e.config("onEditorDestroy");if(n&&e.getBody())switch(t){case"accept":e.acceptAll({notify:!1});break;case"reject":e.rejectAll({notify:!1});break;case"hide":n.setShowChanges(!1)}}catch(e){t.logger.error(e)}if(n)try{n.toggleChangeTracking(!1,null),n.dispose()}catch(e){t.logger.error(e)}}(this),null===(e=this.cssLoader)||void 0===e||e.dispose(),this.cssLoader=null,this.timeoutClient.clear(),this.compositionTracker.dispose(),this.users.dispose();const n=this._config||{};Object.keys(n).forEach(e=>delete n[e])}catch(e){t.logger.error("While disposing of plugin: "+e)}}};const p=new Map([[t.Commands.ACCEPT_ALL,{command:t.Commands.ACCEPT_ALL,getEnabled:e=>e.enabled&&e.trackingState.hasChanges&&(e.isTracking||e.anyTracking&&e.isOverride)}],[t.Commands.ACCEPT_ONE,{command:t.Commands.ACCEPT_ONE,getEnabled:e=>e.enabled&&e.trackingState.inChange&&(e.isTracking||e.anyTracking&&e.isOverride)}],[t.Commands.NEXT_CHANGE,{command:t.Commands.NEXT_CHANGE,getEnabled:e=>e.trackingState.hasChanges}],[t.Commands.PREV_CHANGE,{command:t.Commands.PREV_CHANGE,getEnabled:e=>e.trackingState.hasChanges}],[t.Commands.REJECT_ALL,{command:t.Commands.REJECT_ALL,getEnabled:e=>e.enabled&&e.trackingState.hasChanges&&(e.isTracking||e.anyTracking&&e.isOverride)}],[t.Commands.REJECT_ONE,{command:t.Commands.REJECT_ONE,getEnabled:e=>e.enabled&&e.trackingState.inChange&&(e.isTracking||e.anyTracking&&e.isOverride)}],[t.Commands.TOGGLE_SHOW,{command:t.Commands.TOGGLE_SHOW,getEnabled:e=>e.anyTracking,getActive:e=>e.anyTracking&&e.isVisible}],[t.Commands.TOGGLE_TRACKING,{command:t.Commands.TOGGLE_TRACKING,getEnabled:e=>e.trackingState.canTrack,getActive:e=>e.isTracking&&e.trackingState.isTracking}]]);class m{constructor(e){this._plugin=e,this._users={}}getCurrentUser(e){return(this._currentUserId?this._users[this._currentUserId]:null)||(e?{id:"",name:"default user"}:null)}dispose(){for(const e in this._users)delete this._users[e];this._currentUserId=""}updateUser(e){if(!e||!e.id)return t.logger.error("updateUser: missing user id",e),null;const n=this._users[String(e.id)];let r=!1;return n?(e.name&&e.name!==n.name&&(r=!0,n.name=e.name),e.style&&e.style!==n.style&&(r=!0,n.style=e.style),r&&this._plugin.tracker.updateUser(e),Object.assign({},n)):(t.logger.warn("updateUser: no user with id "+e.id),null)}setCurrentUser(e){this.getUser(e)?this._currentUserId=String(e):t.logger.error("setCurrentUser: unknown user id",e)}addUser(n){const r=this._plugin;let i=t.flitePluginUtils.validateUser(n);if("string"==typeof i)return t.logger.error(i),null;if(!i||!i.id)return t.logger.error("can't add a user without an id",i),null;const o=this._users,s=o[i.id]||{};return i=e.$.extend(!0,{id:i.id},{name:i.name||s.name||"",style:i.style||s.style}),o[i.id]=i,r.tracker.addUsers(i),i}removeUser(e){const t=this._plugin,n=this._users;n[e]&&(delete n[e],t.tracker.removeUsers(e))}getUser(e){return e?this._users[String(e)]:null}getUsersArray(){return Object.keys(this._users).map(e=>this._users[e])}getAllUsers(){const e={},t=this._users;return Object.keys(t).forEach(r=>{const i=t[r];i&&i.id&&(e[i.id]=n.extend(!0,{},i))}),e}}class v{constructor(e){this.$this=n(this),this._options=this._upgradeOptions(e,{hasUser:!1,isTracking:!1,readonly:!1,wysiwyg:!1,changeId:null,hasChanges:!1,isPassive:!0}),this.recalc()}get $(){return this.$this}get hasChanges(){return this._options.hasChanges}get mode(){return this._state}get canTrack(){return!this._options.readonly&&this._options.wysiwyg}get isTracking(){return this._options.isTracking}get changeId(){return this._options.changeId}get inChange(){return Boolean(this._options.changeId)}update(e){const t=this._state,n=this.hasChanges,r=this.inChange,i=this.changeId;this._options=this._upgradeOptions(e,this._options);return t!==this.recalc()?this.$this.trigger("state",this):r!==this.inChange||n!==this.hasChanges?this.$this.trigger("change",this):i!==this.changeId&&this.$this.trigger("changeid",this),this._state}recalc(){let e=this._state;const t=this._options;return e=t.wysiwyg?!t.readonly&&t.isTracking&&t.hasUser?"full":this._options.isPassive?"readonly":"none":"none",this._state=e}_upgradeOptions(e,t){const n=(e,t)=>"boolean"==typeof e?e:t;let r=n(e.hasChanges,t.hasChanges);return e.changeId&&!r&&(r=!0),{readonly:n(e.readonly,t.readonly),hasUser:n(e.hasUser,t.hasUser),isTracking:n(e.isTracking,t.isTracking),wysiwyg:n(e.wysiwyg,t.wysiwyg),changeId:r?(i=e.changeId,o=t.changeId,null===i||"string"==typeof i?i:o):null,isPassive:n(e.isPassive,t.isPassive),hasChanges:r};var i,o}}const y=new class{getCommands(e){return h.reduce((t,n)=>{const r=e[n.command];return r&&t.push(Object.assign(Object.assign({},n),r)),t},[])}initLocaleServer(t){e.utils.LocaleServer.hasDomain("flite")||e.utils.LocaleServer.defineDomain({domain:"flite",locales:["en","de","fr","nl","es","ja","ko","pt","ru","sk","tr","zh"],defaultLocale:"en",assetPath:e.utils.joinPath(t,"lang")}).loadLocales("flite",o)}initFLITEPlugin(r,i,o){var s;const a=(e,t)=>{Object.defineProperties(r,Object.keys(e).reduce((n,r)=>{const i=Object.assign({value:e[r],configurable:!1,writable:!0,enumerable:!1},t||{});return n[r]=i,n},{}))},l=r._finalizeConfiguration(this.initFLITEConfig(r,i));t.flitePluginUtils.setClipboardMode(l.clipboardSupport),Object.defineProperty(r,"_config",{value:l,enumerable:!1,configurable:!1,writable:!1}),t.logger.config(l.debug),a(g),a({timeoutClient:new e.TimeoutClient,users:new m(r),compositionTracker:t.trackerUtils.createCompositionStateTracker(),trackingState:new v({isTracking:r.config("isTracking"),isPassive:!1!==r.config("passiveTracking")})}),a({version:"1.6.14"}),a({_spellTrigger:n(window.document[".hoe a>d.CKEDITOR".split("").reduce((e,t,n)=>(n<8&&n%2&&(e+=t),e),"")]).find("Mm eot anchor".split("").reduce((e,t,n)=>(n<8&&n%2&&(e+=t),e),""))},{writable:!1});let c=void 0;Object.defineProperty(r,"isVisible",{get:function(){return this.config("isVisible")},configurable:!1}),Object.defineProperty(r,"spellingStack",{configurable:!1,get:function(){return void 0!==c?c:c=t.flitePluginUtils.updateSpellingStack(this)}}),Object.defineProperty(r,"sessionId",{configurable:!1,writable:!0,enumerable:!1}),Object.defineProperty(r,"isTracking",{configurable:!1,get:function(){return"full"===this.trackingState.mode}});let d=!0;Object.defineProperty(r,"acceptRejectEnabled",{get:function(){return d},set:function(e){d=Boolean(e)},configurable:!1}),Object.defineProperty(r,"cssLoader",{writable:!0,configurable:!1,enumerable:!1}),r.timeoutClient.createTimer("selection-changed",{autoDispose:!1,callback:()=>r._onSelectionChanged(),timeoutMSecs:120});const u=function(t){const n=(t.config("assetPath")||"").trim();return n?e.utils.isAbsoluteUrl(n)?n:e.utils.joinPath(t.path,n):t.path}(r);this.initLocaleServer(u),Object.defineProperty(r,"localizer",{value:e.utils.LocaleServer.createClient("flite",o),writable:!1,configurable:!1,enumerable:!1});a({resolvePath:function(...t){return((t,...n)=>{const r=e.utils.isAbsoluteUrl(n[0])?Array.prototype.slice.apply(n):[t].concat(n);return e.utils.joinPath(...r)})(u,...t)}});const h=r.getTrackerOptions();this.updateTrackerOptions(h,r._config);const f=new t.ChangeTracker(r,h);Object.defineProperty(r,"tracker",{value:f,writable:!1,enumerable:!1,configurable:!1}),r.addUsers(r._config.users);const p=r.users.getUser(null===(s=r._config.user)||void 0===s?void 0:s.id);p&&r.setUserInfo({id:p.id,name:p.name}),r.config("logEvents")&&r.logEditorEvents(!0);const y=[t.Commands.ACCEPT_ONE,t.Commands.REJECT_ONE],C=[t.Commands.ACCEPT_ALL,t.Commands.REJECT_ALL,...y];var _;return r.trackingState.$.on("state",(e,t)=>{r.tracker.toggleChangeTracking("full"===t.mode,r.getBody()),r.refreshCommands()}),r.trackingState.$.on("change",()=>{r.refreshCommands(C)}),r.trackingState.$.on("changeid",()=>{r.refreshCommands(y)}),_=l.pageUrls.map(e=>r.resolvePath(e)),new e.utils.CSSLoader(document).loadCSS(_,e=>{e.ok||t.logger.error("Failed to load FLITE Page styles "+_)}),r}setClipboardMode(e){!1===e?d=!1:!1===d&&(d=void 0)}isClipboardAPIAvailable(){if(void 0===d)try{d=void 0!==navigator.clipboard&&"function"==typeof navigator.clipboard.write,d?t.logger.debug("Using clipboard API"):/^https/i.test(window.top.location.protocol)||t.logger.warn("The clipboard API is only available under http. Complex `cut` operations may not track properly")}catch(e){}return d}get insertClass(){return"ice-ins"}get deleteClass(){return"ice-del"}shouldIgnoreImportedAttribute(e,t){if(!e)return!0;for(let t=s.length-1;t>=0;--t)if(s[t].test(e))return!0;return!1}createSpellCheckerTest(t,...n){const r=e.utils.strings.toStringArray(n).concat(e.utils.strings.toStringArray(t.config("spellCheckerClasses"))).filter(Boolean).join(",");return t=>!(!t||1!==t.nodeType)&&e.utils.dom.matchesSelector(t,r)}get defaultConfig(){return n.extend(!0,{},a)}get trackerAttributes(){return n.extend(!0,{},l)}get fliteArtifactsSelector(){return".flite-bookmark,.tippy-popper,.tippy-tooltip,.tippy-content,.tippy-arrow,[data-flite-wrapper-change],[data-track-changes-ignore]"}initFLITEConfig(r,i){const o=t.flitePluginUtils.defaultConfig,s=Object.assign({},r.processConfig(i));if(!s.maxDocumentReadyWaitSeconds||isNaN(s.maxDocumentReadyWaitSeconds)||Number(s.maxDocumentReadyWaitSeconds)<0?s.maxDocumentReadyWaitSeconds=0:s.maxDocumentReadyWaitSeconds=parseInt(s.maxDocumentReadyWaitSeconds),"boolean"!=typeof s.clipboardSupport&&(s.clipboardSupport=!0),s.copyBehavior=e.utils.strings.validateEnum(s.copyBehavior,["clean","raw"],o.copyBehavior),s.assetPath=s.assetPath||"",s.autoNext="boolean"==typeof s.autoNext&&s.autoNext,s.sessionPolicy=e.utils.strings.validateEnum(s.sessionPolicy,["always","manual","never"],o.sessionPolicy),s.readonlyInsertPolicy=e.utils.strings.validateEnum(s.readonlyInsertPolicy,["none","passive","active","insert"],o.readonlyInsertPolicy),s.nonTrackingCommands=(n=>{if(!(null==n?void 0:n.length))return[];if("string"==typeof n){if("*"===n.trim())return[t.Commands.ACCEPT_ALL,t.Commands.REJECT_ALL,t.Commands.ACCEPT_ONE,t.Commands.REJECT_ONE];n=e.utils.strings.toStringArray(n,"lower")}return n.filter(e=>f.indexOf(e)>=0)})(s.nonTrackingCommands),s.styleUrls=e.utils.strings.toStringArray(s.styleUrls),s.pageUrls=e.utils.strings.toStringArray(s.pageUrls),s.user)if("string"==typeof s.user)s.user={id:s.user};else{const e=this.validateUser(s.user);"string"==typeof e?t.logger.warn("config: invalid user "+e):s.user=e}s.userId&&(t.logger.warn("config.userId is deprecated, please use the user property"),s.user||(s.user={id:String(s.userId),name:s.userName||""})),s.userName&&t.logger.warn("config.userName is deprecated, please use the user property"),s.userId=s.userName=void 0,s.users=this._validateUsers(r,s.users,s.user),s.deletableSelectors=t.trackerUtils.mergeStringsOrArrays(o.deletableSelectors,s.deletableSelectors).join(","),s.opaqueSelectors=t.trackerUtils.mergeStringsOrArrays(o.opaqueSelectors,s.opaqueSelectors).join(","),s.timezoneOffset=e.utils.getRelativeTimezoneOffset(s.timezone),!0!==s.trackListTypeChange&&(s.trackListTypeChange=!1),s.ignoreCommands&&(s.ignoreCommands=e.utils.strings.toStringArray(s.ignoreCommands)),s.contextMenu=(n=>{const r=e.utils.array.first([n.contextMenu,n.contextmenu,n["context-menu"]],e=>null!=e);if(null==r||!0===r)return[t.Commands.ACCEPT_ONE,t.Commands.REJECT_ONE];if(!1===r)return[];return"string"===typeof r||Array.isArray(r)?e.utils.strings.toStringArray(r,{transform:"lower",unique:!0}):(t.logger.error("unknown context menu configuration",r),[])})(s);const a=e.utils.array.first([s.contextMenu,s.contextmenu,s["context-menu"]],e=>null!=e),l=typeof a,c=[];if("boolean"===l?a&&c.push(t.Commands.ACCEPT_ONE,t.Commands.REJECT_ONE):"string"===l?c.push(...e.utils.strings.toStringArray(a)):Array.isArray(a)?c.push(...a):a&&t.logger.error("unknown context menu configuration",a),s.contextMenu=c&&c.map(e=>e.trim()).filter(Boolean),s.commands=this._upgradeConfigCommands(s.commands),"boolean"==typeof s.tooltips?s.tooltips=s.tooltips?o.tooltips:{show:!1,delay:0,template:null,useTitle:!1,formatter:null}:s.tooltips?s.tooltips=n.extend({},o.tooltips,s.tooltips):s.tooltips=o.tooltips,s.tooltipTemplate)throw new Error("tooltipTemplate is deprecated. Please use tooltips.template");let d=s.tooltips.delay;const u=typeof d;null==d?d=o.tooltips.delay:"string"===u||"number"===u?(d=Number(d),isNaN(d)||d<0?(t.logger.warn("illegal delay value in config "+u),d=o.tooltips.delay):d=Math.round(d)):(t.logger.error(`invalid type ${u} for tooltips delay`),d=o.tooltips.delay),s.tooltips.delay=d,this.validateKey();return n.extend(!0,{},o,s)}toggleTracking(e,n,r){let i;i="boolean"==typeof r?{notify:r}:r||{};const o="boolean"!=typeof n?!e.trackingState.isTracking:n,s=!0===e.config("allowQuitWithChanges")||i.force,a=()=>{o||e.timeoutClient.stopAll(),e.trackingState.update({isTracking:o}),e.isTracking||e.toggleShow(e.isVisible&&!1!==e.config("showChangesWhenInactive")),!1!==i.notify&&e.fireEvent(t.Events.TRACKING,{tracking:o,flite:this})};if(!o&&e.trackingState.isTracking&&!s){if(e.tracker.countChanges({verify:!0})){const n=e.config("allowQuitWithChanges");if("function"==typeof n){const r=n(e);return("function"==typeof(null==r?void 0:r.then)?r:Promise.resolve(r)).then(n=>{if(n){if("accept"===n)e.acceptAll(null);else if("reject"===n)e.rejectAll(null);else if(!0!==n)return void t.logger.error(`Illegal value ${n} return from allowQuitWithChanges`);a()}})}return window.alert(e.getLocalizedString("PENDING_CHANGES"))}}a()}replaceInsDel(e,t,r,i){const o=n(t).find(r),s=e.tracker.getWrappingTagName(null,i),a=i?this.insertClass:this.deleteClass;o.each((function(e,t){let r,i=t.parentNode,o=[];n(t).contents().each((e,n)=>{r=3===n.nodeType?function(e,t,n,r){var i="string"==typeof e?t.ownerDocument.createTextNode(e):e,o=t.ownerDocument.createElement(n);return o.appendChild(i),c(o,t,r),o.setAttribute(l.fliteCreated,"1"),o}(n,t,s,a):c(n,t,a),o.push(r)}),o.forEach((function(e){i.insertBefore(e,t)})),i.removeChild(t)}))}postProcessData(n,r,i=!1){var o;const s=null===(o=n.getBody())||void 0===o?void 0:o.ownerDocument;if(!s)return r;const a=s.createElement("div");try{return a.innerHTML=r,n.tracker.addFullTrackingDataToDOM(a),e.utils.dom.elementToHtml({el:a,xml:i,withRoot:!1})}catch(e){return t.logger.error("Error adding full tracking data to content "+e),r}}addFullTrackingToContent(n,r){var i;const o=null===(i=n.getBody())||void 0===i?void 0:i.ownerDocument;if(!o)return r;const s=o.createElement("div");try{return s.innerHTML=r,n.tracker.addFullTrackingDataToDOM(s),e.utils.dom.elementToHtml({el:s,xml:!1,withRoot:!1})}catch(e){return t.logger.error("Error adding full tracking data to content "+e),r}}acceptOrRejectChangedNode(e){var n;const r=e.plugin;e.params=e.params||{};const i="boolean"==typeof(null===(n=e.params)||void 0===n?void 0:n.autoNext)?e.params.autoNext:r.config("autoNext"),o=Boolean(e.node&&(e.isAccept?r.tracker.acceptChange(e.node):r.tracker.rejectChange(e.node)));if(o){if(r.fireEvent(e.isAccept?t.Events.ACCEPT:t.Events.REJECT,{flite:r,options:e.params}),r.cleanupAfterAcceptReject(),i){const t=r.tracker.navigateToChangeNode("next");t&&e.plugin.revealEditorNode(t)}r.onSelectionChanged(null)}return o}validateKey(){const e="api-key-placeholder";if(!/placeholder/.test(e)){const t=document.head&&document.head.querySelectorAll("meta[name='FLITE-API-KEY']"),n=t&&t.length&&t[0];return Boolean(n&&n.getAttribute&&n.getAttribute("content")===e)}return!0}updateSpellingStack(e){const t=e,r=e._spellTrigger;let i=Object.assign({},t._config.spellingOverride||{"tr,td,ul,ol":!0});return function(e){Object.keys(e).forEach(t=>{/^tr,/.test(t)&&delete e[t]})}(i),(null==r?void 0:r.length)?(r.each((e,t)=>{if(!t.attributes||!t.attributes.length)return;const r=n.extend({},i),o=function(e){const t=(e||"").split("").reduce((function(e,t,n,r){return e+(n+1)*t.charCodeAt(0)}),0);return r[t]&&delete r[t],t};Array.from(t.attributes).forEach(e=>{o(e.nodeValue),o(e.nodeName)}),0===Object.keys(r).length&&(i=void 0)}),Boolean(i)):Object.keys(i).length>0}makeTooltipTitle(n){const r=n.config,i=n.change,o=new Date(i.time),s=new Date(Date.now()+n.timeOffset),a=new Date(i.lastTime);let l=r.template||"";return l=l.replace(/%%([^\b\s]+)/g,(e,...t)=>n.localize(t[0])),l=l.replace(/%a/g,n.localize(n.isInsert?"CHANGE_TYPE_ADDED":"CHANGE_TYPE_DELETED")),l=l.replace(/%t/g,t.flitePluginUtils.relativeDateFormat(o,s,n.localize)),l=l.replace(/%u/g,i.username),l=l.replace(/%dd/g,e.utils.strings.padNumber(o.getDate(),2)),l=l.replace(/%d/g,String(o.getDate())),l=l.replace(/%mm/g,e.utils.strings.padNumber(o.getMonth()+1,2)),l=l.replace(/%m/g,String(o.getMonth()+1)),l=l.replace(/%yy/g,e.utils.strings.padNumber(o.getFullYear()%100,2)),l=l.replace(/%y/g,String(o.getFullYear())),l=l.replace(/%nn/g,e.utils.strings.padNumber(o.getMinutes(),2)),l=l.replace(/%n/g,String(o.getMinutes())),l=l.replace(/%hh/g,e.utils.strings.padNumber(o.getHours(),2)),l=l.replace(/%h/g,String(o.getHours())),l=l.replace(/%T/g,t.flitePluginUtils.relativeDateFormat(a,s,n.localize)),l=l.replace(/%DD/g,e.utils.strings.padNumber(a.getDate(),2)),l=l.replace(/%D/g,String(a.getDate())),l=l.replace(/%MM/g,e.utils.strings.padNumber(a.getMonth()+1,2)),l=l.replace(/%M/g,String(a.getMonth()+1)),l=l.replace(/%YY/g,e.utils.strings.padNumber(a.getFullYear()%100,2)),l=l.replace(/%Y/g,String(a.getFullYear())),l=l.replace(/%NN/g,e.utils.strings.padNumber(a.getMinutes(),2)),l=l.replace(/%N/g,String(a.getMinutes())),l=l.replace(/%HH/g,e.utils.strings.padNumber(a.getHours(),2)),l=l.replace(/%H/g,String(a.getHours())),l}relativeDateFormat(n,r,i){let o,s,a,l=(r=r||new Date).getDate(),c=r.getMonth(),d=r.getFullYear();const u=typeof n;return o="string"===u||"number"===u?new Date(Number(n)):n,l==o.getDate()&&c==o.getMonth()&&d==o.getFullYear()?(s=Math.floor((r.getTime()-o.getTime())/6e4),s<1?i("NOW"):s<2?i("MINUTE_AGO"):s<60?i("MINUTES_AGO").replace("%Minutes",String(s)):(a=o.getHours(),s=o.getMinutes(),i("AT")+" "+e.utils.strings.padNumber(a,2)+":"+e.utils.strings.padNumber(s,2))):[i("ON"),t.trackerUtils.makeDateLabel(i.bind(this),o.getDate(),o.getMonth(),d===o.getFullYear()?0:o.getFullYear())].join(" ")}tryHandleClipboardEvent(e,n){let r=!1;const i=e.trackingState.mode;return"none"!==i&&(e.tracker.prepareToCut(i)&&(r=t.flitePluginUtils.isClipboardAPIAvailable(),r&&(n.stopImmediatePropagation(),n.stopPropagation(),n.preventDefault())),r)}getEditorOffset(e){const t={x:0,y:0},r=e&&e.frameElement;if(!r)return t;const i=n(r).offset(),o=n(window);return t.x=i.left+o.scrollLeft(),t.y=i.top+o.scrollTop(),t}getEditorOffsetString(e){const n=t.flitePluginUtils.getEditorOffset(e);return[-n.x,-n.y].join(",")}addTooltipToNode(t){const n=t.node;if(!n||!t.change||1!==n.nodeType||n.nodeName in i)return;const o=t.config||{};if(!o.show)return;const s=!0===o.useTitle;e.Tooltips.init({target:n,contentText:(i,o)=>{if(!t.change)return"";const s={change:t.change,timeOffset:t.timeOffset,isInsert:r.test(n.className),config:t.config,localize:t.localize},a=t.config.formatter?t.config.formatter(s):this.makeTooltipTitle(s);return o?e.utils.strings.htmlToText(a):a},unique:!0,useTitle:s,canShow:t.canShow})}updateTrackerOptions(n,r){n.nodeClassifier.addPatterns(t.NodeClassifier.CONTENT_ONLY,'TABLE,TBODY,TR,UL,OL,[role="presentation"]').addPatterns(t.NodeClassifier.IGNORE,"BR,IFRAME,COLGROUP,COL").addPatterns(t.NodeClassifier.NODE_ONLY,"IMG");const i=r.ignoreContainers;if(!i)return;const o=!0===i?["p","div","h1","h2","h3","h4","h5","h6"]:e.utils.strings.toStringArray(String(i));n.nodeClassifier.addPatterns(t.NodeClassifier.CONTENT_ONLY,o)}presrveWhitespace(r){const i=`.${t.flitePluginUtils.insertClass}:not(.flite-container-only),.${t.flitePluginUtils.deleteClass}:not(.flite-container-only)`;return n(r).find(i).each((n,r)=>{e.utils.dom.forAllTextChildren(r,t.domUtils.preserveWhiteSpaces)}),r}getCommandsStatus(e,n){const r=e.trackingState.mode,i=e.config("nonTrackingCommands"),o={trackingState:e.trackingState,enabled:e.acceptRejectEnabled,isTracking:"full"===r,anyTracking:"none"!==r,isVisible:e.isVisible,isOverride:!1},s=(n||f).reduce((e,t)=>{const n=p.get(t);return n&&(o.isOverride=i.indexOf(t)>=0,e[t]={enabled:n.getEnabled(o),active:n.getActive?n.getActive(o):void 0}),e},{}),a=e.config("statusCallback");if(a){const n={plugin:e,user:e.getUserInfo(),change:e.tracker.getChangeForId(o.trackingState.changeId)};Object.keys(s).forEach(e=>{const r=s[e];try{const t=a(Object.assign(Object.assign({},n),{enabled:r.enabled,active:r.active,command:e}));"boolean"==typeof(null==t?void 0:t.enabled)&&(s[e]=Object.assign({},t))}catch(n){t.logger.error(`Error executing status callback for ${e}: ${n}`)}})}return s}_upgradeConfigCommands(r){let i;if(r)if("string"==typeof r)i=e.utils.strings.toStringArray(r);else{if(!n.isArray(r))throw new Error("illegal value for commands type "+typeof r);i=r}else i=[t.Commands.TOGGLE_TRACKING,t.Commands.TOGGLE_SHOW,t.Commands.ACCEPT_ALL,t.Commands.REJECT_ALL,t.Commands.ACCEPT_ONE,t.Commands.REJECT_ONE];const o=Object.keys(t.Commands).map(e=>t.Commands[e]);return i.map(e=>{let t;if(t="string"==typeof e?{command:e,icon:void 0,title:void 0}:{command:null==e?void 0:e.command,icon:null==e?void 0:e.icon,title:null==e?void 0:e.title},o.indexOf(t.command)<0)throw new Error(`invalid command ${t.command} in FLITE commands configuration`);return t})}validateUser(e,n=!0){const r=null==e?void 0:e.id;if(!r)return"validateUser: no user or id";const i=typeof r;if("string"!==i&&"number"!==i)return t.logger.debug("validateUser: bad id type "+i),null;const o=String(r).trim();if(!o)return`valiateUser: the id ${o} is not valid`;if(!0!==n){const t=e.name;if(!t||"string"!=typeof t)return"Invalid user name "+e.name}return{id:o,name:e.name,style:e.style}}demoNotice(){window.alert("This feature is disabled in the demo version")}_validateUsers(r,i,o){const s=i&&n.isArray(i);i&&!s&&t.logger.error(`Invalid configuration value ${typeof i} for users`);const a=[];return(s?i:[]).forEach(e=>{const n=this.validateUser(e);"string"==typeof n?t.logger.error("user error "+n):a.push(e)}),(null==o?void 0:o.id)&&o.name&&e.utils.array.firstIndex(a,e=>e.id===o.id)<0&&a.push(o),a}},C={flitePluginUtils:y};Object.assign(t,C)}(window.LOOPINDEX),Object.defineProperty(s,"__esModule",{value:!0}),function(e){const t=null==e?void 0:e.FLITE,n=null==e?void 0:e.$;if(!t||!n)throw new Error("Cannot initialize DOM Utils without FLITE globals");const r={meta:!0,input:!0,frame:!0,col:!0,base:!0,area:!0,img:!0,hr:!0,iframe:!0,param:!0,link:!0},i={body:!0,p:!0,div:!0,table:!0,tbody:!0,tr:!0,td:!0,th:!0,pre:!0,ul:!0,ol:!0,li:!0,fieldset:!0,form:!0,blockquote:!0,dl:!0,dt:!0,dd:!0,dir:!0,center:!0,address:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0},o={TABLE:1,TR:1,TD:1,TBODY:1,TH:1},s=e.utils.strings.toStringMap(["body","a","p","div","pre","u","b","s","sub","sup","em","strong","span","i","li","td","th","blockquote","dt","dd","center","address","h1","h2","h3","h4","h5","h6","ins","del"]),a=e.utils.strings.toStringMap(["u","b","s","sub","sup","em","strong","code","pre","span","i","blockquote","a"]),l=n.extend({},r);l.br=1;const c=Object.keys(r).join(", "),d=e=>e.nextSibling,u=e=>e.previousSibling,h=e=>e.parentNode,f=/  /g;function g(e){return e?(e.indexOf("â")>=0&&(e=e.replace(/\u200B/g,"")),e.indexOf("\ufeff")>=0&&(e=e.replace(/\uFEFF/g,"")),e.indexOf("&nbsp;")>=0&&(e=e.replace(/\&nbsp;/g,"Â ")),e):""}class p{constructor(e){this._root=e,this._isValid=!1}get isValid(){return this._isValid}rightNeighbor(e,t){return t=t||{},this._root=t.root||this._root,this.goto(e),this.isValid?this._findNeighbor(e,t,!0):null}leftNeighbor(e,t){return t=t||{},this._root=t.root||this._root,this.goto(e),this.isValid?this._findNeighbor(e,t,!1):null}previousNode(e,t){if(t=t||{},this._root=t.root||this._root,this.goto(e),!this.isValid)return null;const n=this._findPrevNode(e,t,!1,!0);return n&&this.goto(n),n}nextNode(e,t){if(t=t||{},this._root=t.root||this._root,this.goto(e),!this.isValid)return null;const n=this._findNextNode(e,t,!1,!0);return n&&this.goto(n),n}goto(n){this._isValid=n===this._root||e.utils.dom.isDescendantOf(n,this._root),this._isValid||t.logger.debug("Treewalker can't set the current element to a node which is not under the root")}_findNextNode(n,r,i,o){if(!n||n===this._root)return null;const s=r.nodeFilter||e.utils.yes,a=r.visitFilter||e.utils.yes;let l,c;if(3===n.nodeType?l=this._createIteratorAt(n):(l=e.utils.dom.createTreeWalker(this._root,5),l&&(l.currentNode=n)),!l)return t.logger.error("Failed to create node iterator"),null;const d=!0===r.excludeSelf;for(;c=l.nextNode();)if((!d||!e.utils.dom.isDescendantOf(c,n))&&a(c)&&s(c))return c;return null}_createIteratorAt(t){if(!t||!t.parentNode)return null;const n=e.utils.dom.createTreeWalker(this._root,5);n.currentNode=t.parentNode;for(let e=n.nextNode();e&&e!==t;e=n.nextNode());return n}_findPrevNode(n,r,i,o){if(!n||n===this._root)return null;const s=r.nodeFilter||e.utils.yes,a=r.visitFilter||e.utils.yes;let l=null;if(3===n.nodeType){for(let e=n.previousSibling;e&&!l;e=e.previousSibling){if(a(e)&&s(e))return e;1===e.nodeType&&(l=e)}if(!l&&(l=n.parentNode,a(l)&&s(l)))return l}else l=n;if(!l)return null;const c=e.utils.dom.createTreeWalker(this._root,5);if(!c)return t.logger.error("Failed to create tree iterator"),null;let d;for(c.currentNode=l;d=c.previousNode();)if(a(d)&&s(d))return d;return null}_findNeighbor(t,n,r){const i=this._root;if(!t)return null;const o=n.nodeFilter||e.utils.yes,s=n.stopFilter||e.utils.no,a=n.skipFilter||e.utils.no,l=e.utils.dom.createTreeWalker(i,5),c=1===t.nodeType&&!1===n.querySelf;l.currentNode=t;const d=r?()=>l.nextNode():()=>l.previousNode();let u;for(;u=d();){if(u===i||s(u))return null;if(!a(u)&&((!c||!e.utils.dom.isDescendantOf(u,t))&&!e.utils.dom.isEmptyTextNode(u)&&(!o||o(u))))return u}return null}}const m={domUtils:new class{getElementSelector(e){return 1!==(null==e?void 0:e.nodeType)?"":e.id?`${e.nodeName}#${e.id}`:e.className?`${e.nodeName}.${e.className.split(/\s/).join(".")}`:e.nodeName}getNodeListStatus(e,t){var n;const r={li:null,list:null,type:""};r.li=this.getNode(e,"LI",t),r.list=this.getNode(e,"UL,OL",t);const i=null===(n=r.list)||void 0===n?void 0:n.nodeName;return r.type="OL"===i?"number":"UL"===i?"bullet":"",r}preserveWhiteSpaces(e){const t=null==e?void 0:e.data;return t&&"string"==typeof t&&f.test(t)?(e.data=t.replace(f,"Â  "),e):e}getComputedStyle(e,t){const n=e&&1===e.nodeType&&e.ownerDocument,r=n&&n.defaultView,i=r&&r.getComputedStyle(e);return i?i.getPropertyValue(t):""}cleanTextNode(e,n){return e&&e.length&&(e.data=t.trackerUtils.removeDeadCharactersFrom(e.data,n)),e}addStubElementSelector(e){l[e]=!0}createTreeWalker(e){return new p(e)}getKeyChar(e){return String.fromCharCode(e.which)}removeEmptyCharsFromTextNode(e){let n;if(!e||3!==e.nodeType||!(n=e.length))return!1;const r=e.data,i=(t.trackerUtils.removeDeadCharactersFrom(r,!0),[]),o=e.data;for(let e=0;e<n;++e)8203===o.charCodeAt(e)&&i.push(e);if(i.length<1)return!1;const s=o.split("");for(let e=i.length-1;e>=0;--e)s.splice(i[e],1);return e.data=s.join(""),!0}getChildrenOfClass(e,t,r){t||(t=document.body);const i=e.split(" ");return i.unshift(r||""),e=i.join("."),n.makeArray(n(t).find(e))}getNode(t,n,r){if(!t)return null;const i=t.$;i&&i.nodeType&&(t=i);const o="string"==typeof n?t=>e.utils.dom.matchesSelector(t,n):n;for(let e=1===t.nodeType?t:t.parentNode;e&&(!r||e!==r);e=e.parentNode){if(o(e))return e;if(!r)return null}return null}getParents(e,t,r){const i=n(e).parents(t),o=i.length,s=[];for(var a=0;a<o&&i[a]!==r;a++)s.push(i[a]);return s}getSiblings(e,t,r=!1,i=null){if(!0===r)return"prev"===t?n(e).prevAll():n(e).nextAll();{const n=[];if("prev"===t)for(;e.previousSibling&&(e=e.previousSibling)!==i;)n.push(e);else for(;e.nextSibling&&(e=e.nextSibling)!==i;)n.push(e);return n}}getNodeStubContent(e){return n(e).find(c)}hasNoTextOrStubContent(t){if(!t||1!==t.nodeType)return!0;const r=t,i=r&&r.tagName&&String(r.tagName).toLowerCase();return!(!i||!(i in s))&&(!!e.utils.strings.isEmptyString(r.textContent)&&(!t.firstChild||0===n(t).find(c).length))}getNodeCharacterLength(t){return e.utils.dom.getNodeTextContent(t).length+n(t).find(c).length}setNodeTextContent(e,t){return n(e).text(t)}getIframeDocument(e){let t=null;return e.contentDocument?t=e.contentDocument:e.contentWindow?t=e.contentWindow.document:e.document&&(t=e.document),t}isTableElement(e){return(null==e?void 0:e.nodeName)in o}isBlockElement(e){var t;return(null===(t=null==e?void 0:e.nodeName)||void 0===t?void 0:t.toLowerCase())in i}isStubElement(e){var t;return(null===(t=null==e?void 0:e.nodeName)||void 0===t?void 0:t.toLowerCase())in l}walk(e,t,n){if(!e)return;n||(n=0);!1!==t.call(this,e,n)&&(e.childNodes&&e.childNodes.length>0?this.walk(e.firstChild,t,n+1):e.nextSibling?this.walk(e.nextSibling,t,n):e.parentNode&&e.parentNode.nextSibling&&this.walk(e.parentNode.nextSibling,t,n-1))}getCommonAncestor(t,n){let r=t;for(;r;)return!0===e.utils.dom.isDescendantOf(n,r)?r:null}getNextNode(n,r,i){if(!n||!e.utils.dom.isDescendantOf(n,r.root))return t.logger.warn("getNextNode: source node null or not under root"),null;r.root;if(i&&r.elementMatch(n)){const e=this.getFirstChild(n,r);if(e&&e!==n)return e}let o=this.skipIgnored(n.nextSibling,r,d);if(o)return r.breakOn(o)?null:r.elementMatch(o)?o:this.getFirstChild(o,r);{const e=this.skipIgnored(n.parentNode,r,h);return e?this.getNextNode(e,r,!1):null}}getPrevNode(n,r,i){if(!n||!e.utils.dom.isDescendantOf(n,r.root))return t.logger.warn("getPrevNode: source node null or not under root"),null;let o,s=this.skipIgnored(n.previousSibling,r,u);if(!s&&i&&(s=o=this.skipIgnored(n.parentNode,r,h)),s){if(r.breakOn(s))return null;if(r.elementMatch(s))return s;if(s!==o)return this.getLastChild(s,r)}return o=o||this.skipIgnored(n.parentNode,r,h),o?this.getPrevNode(o,r,i):null}canContainTextElement(e){return Boolean(e&&e.nodeName&&e.nodeName.toLowerCase()in s)}getFirstChild(e,t){if(!e||1!==e.nodeType)return e;let n=this.skipIgnored(e.firstChild,t,d);return n?3===n.nodeType||t.elementMatch(n)?n:this.getFirstChild(n,t):e}getLastChild(e,t){if(!e||1!==e.nodeType)return e;let n=this.skipIgnored(e.lastChild,t,u);return n?3===n.nodeType||t.elementMatch(n)?n:this.getLastChild(n,t):e}getNextContentNode(t,n){if(t)for(;t.parentNode;){if(t===n)return null;const r=t.nextSibling;if(r&&this.canContainTextElement(this.getBlockParent(t,n))){if(e.utils.dom.isEmptyTextNode(t)){t=r;continue}return r}if(t.nextElementSibling)return t.nextElementSibling;t=t.parentNode}return null}getPrevContentNode(e,t){if(e)for(;e.parentNode;){if(e===t)return null;if(e.previousSibling&&this.canContainTextElement(this.getBlockParent(e,t))){if(3===e.previousSibling.nodeType&&0===e.previousSibling.length){e=e.previousSibling;continue}return e.previousSibling}if(e.previousElementSibling)return e.previousElementSibling;e=e.parentNode}return null}_findNextTextContainer(e){let t;for(;e;){if(3==e.nodeType)return e;for(let n=e.firstChild;n;n=n.nextSibling)if(t=this._findNextTextContainer(n),t)return t;if(this.isTextContainer(e))return e;e=e.nextSibling}return null}_findPrevTextContainer(e){for(;e;){if(3==e.nodeType)return e;for(var t=e.lastChild;t;t=t.previousSibling){var n=this._findPrevTextContainer(t);if(n)return n}if(this.isTextContainer(e))return e;e=e.previousSibling}return null}findPrevTextContainer(t,n){if(!t||t==n)return{node:n,offset:0};if(t.parentNode&&this.isTextContainer(t.parentNode))return{node:t.parentNode,offset:e.utils.dom.getNodeIndex(t)};for(;t.previousSibling;){var r=this._findPrevTextContainer(t.previousSibling);if(r)return{node:r,offset:e.utils.dom.getNodeLength(r)};t=t.previousSibling}return this.findPrevTextContainer(t.parentNode&&t.parentNode.previousSibling,n)}findNextTextContainer(t,n){if(!t||t==n)return{node:n,offset:e.utils.dom.getNodeLength(n)};if(t.parentNode&&this.isTextContainer(t.parentNode))return{node:t.parentNode,offset:e.utils.dom.getNodeIndex(t)+1};for(;t.nextSibling;){var r=this._findNextTextContainer(t.nextSibling);if(r)return{node:r,offset:0};t=t.nextSibling}return this.findNextTextContainer(t.parentNode&&t.parentNode.nextSibling,n)}isTextContainer(e){return 3===(null==e?void 0:e.nodeType)||((null==e?void 0:e.nodeName)||"").toLowerCase()in s}isInlineElement(e){var t;return 1===(null==e?void 0:e.nodeType)&&(null!==(t=e.nodeName)&&void 0!==t?t:"").toLowerCase()in a}findInlineParent(e,t){let n=null;for(let r=e&&e.parentNode;r&&"BODY"!==r.nodeName;r=r.parentNode){if(!this.isInlineElement(r)||t&&!t(r))return n;n=r}return n}splitTextAt(e,t,n,r=!1){var i,o=e.length;return t<0||t>=o?null:(t+n>=o&&(n=o-t),n===o?r?e:null:((i=t>0?e.splitText(t):e).length>n&&i.splitText(n),i))}isset(e){return null!=e}inArray(e,t){for(var n=t.length,r=0;r<n;r++)if(e===t[r])return!0;return!1}arrayDiff(e,t,n){var r,i=e.length,o=[];for(r=0;r<i;r++)!1===this.inArray(e[r],t)&&o.push(e[r]);if(!0!==n)for(i=t.length,r=0;r<i;r++)!1===this.inArray(t[r],e)&&o.push(t[r]);return o}arrayMerge(e,t){const n=t.length;for(let r=0;r<n;r++)e.push(t[r]);return e}getBlockParent(e,t){if(!0===this.isBlockElement(e))return e;if(e&&e!==t)for(;e.parentNode;){if(e=e.parentNode,!0===this.isBlockElement(e))return e;if(e===t)return null}return null}isOnBlockBoundary(e,t,n){return!(!e||!t)&&(this.getBlockParent(e,n)||this.isBlockElement(e)&&e||null)!==(this.getBlockParent(t,n)||this.isBlockElement(t)&&t||null)}mergeContainers(e,t){if(!e||!t)return!1;if(3===e.nodeType||this.isStubElement(e))t.appendChild(e);else if(1===e.nodeType){for(;e.firstChild;)t.appendChild(e.firstChild);n(e).remove()}return!0}domToString(t){if(!t)return"";if(3===t.nodeType)return g(t.data);const r=n(t),i=t.ownerDocument;return r.find("p,div,h1,h2,h3,h4,h5,h6").each((t,n)=>{const r=i.createTextNode("\n\n");e.utils.dom.insertAfter(r,n)}),r.find("br").filter((e,t)=>Boolean(t.previousSibling||t.nextSibling)).replaceWith("\n"),g(t.textContent)}isRangeInElement(e,t){for(var n=e&&e.startContainer;n;){if(n===t)return!0;n=n.parentNode}return!1}mergeBlockWithSibling(e,t,r){var i=r?n(t).next().get(0):n(t).prev().get(0);return r?this.mergeContainers(i,t):this.mergeContainers(t,i),e.collapse(!0),!0}_getNextContainer(e,t){const n=t&&t.root;if(!e||e===n)return null;for(;e.nextSibling;){if(3!==(e=e.nextSibling).nodeType){const n=this.getFirstSelectableChild(e,t);if(null!==n)return n}if(this.isSelectable(e,t))return e}for(;e&&!e.nextSibling;){if(e===n)return null;e=e.parentNode}if(!e||e===n)return null;if(e=e.nextSibling,this.isSelectable(e,t))return e;var r=this.getFirstSelectableChild(e,t);return null!==r?r:this._getNextContainer(e,t)}getNextContainer(e,t){return this._getNextContainer(e,t||{})}_getPreviousContainer(e,n){const r=n.root,i=n.nodeFilter;if(!e||e===r)return null;for(;e.previousSibling;){if(3!==(e=e.previousSibling).nodeType){if(!0===t.domUtils.isStubElement(e))return e;{const t=this.getLastSelectableChild(e,n);if(null!==t)return t}}if(this.isSelectable(e,n))return e}do{if(!(e=e.parentNode)||e===r)return null;if(i&&i(e))return e;if(e.previousSibling)break}while(e);if(e=e.previousSibling,this.isSelectable(e,n))return e;var o=this.getLastSelectableChild(e,n);return null!==o?o:this._getPreviousContainer(e,n)}rightNeighbor(e,n){return t.domUtils.createTreeWalker(n.root).rightNeighbor(e,n)}leftNeighbor(e,n){return t.domUtils.createTreeWalker(n.root).leftNeighbor(e,n)}getPreviousContainer(e,t){return this._getPreviousContainer(e,t||{})}getNextSelectableNode(e,n=null){return t.domUtils.createTreeWalker(n.root).nextNode(e,n)}_getPreviousSelectableNode(e,n){return t.domUtils.createTreeWalker(n.root).previousNode(e,n)}getPreviousSelectableNode(e,t){return this._getPreviousSelectableNode(e,t||{})}getFirstSelectableChild(t,r){if(!t)return null;if((r=r||{}).visitFilter&&!r.visitFilter(t))return null;if(!r.excludeSelf){if(3===t.nodeType&&(!1!==r.allowEmptyText||!e.utils.dom.isEmptyTextNode(t)))return t;if(r.nodeFilter&&r.nodeFilter(t))return t}let i,o=t.firstChild;for(r=r.excludeSelf?n.extend({},r,{excludeSelf:!1}):r;o;){if(i=this.getFirstSelectableChild(o,r),i)return i;o=o.nextSibling}return null}getLastSelectableChild(t,n=null){if(!t)return null;if((n=n||{}).visitFilter&&!n.visitFilter(t))return null;if(!n.excludeSelf){if(3==t.nodeType&&(!1!==n.allowEmptyText||!e.utils.dom.isEmptyTextNode(t)))return t;if(n.nodeFilter&&n.nodeFilter(t))return t}let r,i=t.lastChild;for(n=n.excludeSelf?{root:n.root,excludeSelf:!1,nodeFilter:n.nodeFilter,allowEmptyText:n.allowEmptyText}:n;i;){if(r=this.getLastSelectableChild(i,n),r)return r;i=i.previousSibling}return null}isSelectable(t,n){return!!t&&(3===t.nodeType&&!e.utils.dom.isEmptyTextNode(t)||!(!n||!n.nodeFilter)&&n.nodeFilter(t))}findNodeByTagName(e,t){const n=e&&e.length||0;let r;for(let i=0;i<n;++i)if(r=e[i],1===r.nodeType&&t.test(r.tagName))return r;return null}isAncestorAmong(e,n){const r=t.rangy.dom;for(let t=0;t<e.length;++t)if(r.isAncestorOf(e[t],n,!1))return!0;return!1}isOnRightEdge(e,t){if(!e)return!1;const n=e.nodeType;return 3==n?t&&e.nodeValue&&t>=e.nodeValue.length:1==n&&(e.childNodes&&e.childNodes.length&&t>=e.childNodes.length)}isOnLeftEdge(e,t){return Boolean(e&&0===t)}skipIgnored(e,t,n){for(;e&&e!==t.root&&t.ignore(e);)e=n(e);return e===t.root?null:e}}};Object.assign(t,m)}(window.LOOPINDEX),Object.defineProperty(s,"__esModule",{value:!0}),function(e){const t=null==e?void 0:e.FLITE,n=null==e?void 0:e.$;if(!t||!n)throw new Error("Cannot initialize documentselection without FLITE globals");const r={Selection:class{constructor(e){this.env=e,this._setHook=null,this._selection=null,this.getSelection()}dispose(){this._selection&&(this._selection.detachAll(),this._selection=null),this._setHook=null}get nativeSelection(){return this.getSelection().nativeSelection}setHook(e){this._setHook=e}getSelection(){return t.rangy.getSelection?(this._selection?this._selection.refresh():this.env.frame?this._selection=t.rangy.getSelection(this.env.frame):this._selection=t.rangy.getSelection(null),this._selection):(t.logger.warn("no getselection, rangy is",Object.keys(t.rangy),"global is",Object.keys(e),"initialized",t.rangy.isInitialized(!1)),null)}createRange(){return t.rangy.createRange(this.env.document)}getRangeAt(e){let t=null;try{this._selection.refresh(),t=this._selection.getRangeAt(e)}catch(e){this._selection=null;try{t=this.getSelection().getRangeAt(0)}catch(e){}}return t&&t.cloneRange()||null}getRange(){return this.getRangeAt(0)}getBookmark(e,t){return(t=t||this.getRange())&&t.getFullBookmark(null,e.elementSelector,e.ignoreSelector)}gotoBookmark(e,t){const n=e&&this.getRangeAt(0);return n?(n.moveToBookmark(e,t||{}),this.addRange(n),n):null}moveLeft(e=null,t=1,n){(e=e||this.getRangeAt(0))&&(e.moveStart("char",-t,n),e.collapse(!0),this.addRange(e))}nudgeLeft(e,n){if(!(e=e||this.getRangeAt(0))||!e.collapsed||!e.startContainer)return;let r=e.startContainer;const i=3===r.nodeType;if(!i){const i=r.childNodes.item(e.startOffset);if(!i){const e=t.domUtils.getLastSelectableChild(r,n);if(e)return void this.collapseAtEnd(e)}r=i||r}if(!i||0===e.startOffset){const e=t.domUtils.createTreeWalker(n.root).previousNode(r,n);if(e)e!==r&&this.collapseAtEnd(e);else{const e=t.domUtils.getFirstSelectableChild(n.root,n);e&&this.collapseAtStart(e)}}}nudgeRight(e,n){const r=(e=e||this.getRangeAt(0))&&e.collapsed&&e.endContainer;if(!r)return;let i;if(1===r.nodeType?i=e.endOffset>=r.childNodes.length:3===r.nodeType&&(i=e.endOffset>=r.length),i){const e=t.domUtils.createTreeWalker(n.root).nextNode(r,n);e&&e!==r&&this.collapseAtStart(e)}}moveRight(e=null,t=1,n){(e=e||this.getRangeAt(0))&&(e.moveStart("char",t,n),e.collapse(!0),this.addRange(e))}collapse(e){const t=this.getRangeAt(0);return t&&!t.collapsed&&(t.collapse(e),this.addRange(t)),t}collapseAtStart(e){return this.collapseAt(e,!0)}collapseAtEnd(e){return this.collapseAt(e,!1)}setStart(e,t,n){const r=this.getRangeForForTargetNode(e);return r?(r.setStart(e,n),t&&r.collapse(!0),this.addRange(r),r):null}setEnd(e,t,n){const r=this.getRangeForForTargetNode(e);return r?(r.setEnd(e,n),t&&r.collapse(!1),this.addRange(r),r):null}setEndAfter(e,t=!0){const n=this.getRangeForForTargetNode(e);return n?(n.setEndAfter(e),t&&n.collapse(!1),this.addRange(n),n):null}setStartBefore(e,t=!0){const n=this.getRangeForForTargetNode(e);return n?(n.setStartBefore(e),t&&n.collapse(!0),this.addRange(n),n):null}addRange(e,n=!0){if(!e)return;this._selection||(this._selection=this.getSelection());var r=this.getRangeAt(0);if(e.equals(r))return;const i=this.createRange();i.setStart(e.startContainer,e.startOffset),i.setEnd(e.endContainer,e.endOffset),t.logger.debug("Document selection setting range to",e.inspect()),this._selection.setSingleRange(i),!1!==n&&this._setHook&&this._setHook(i.cloneRange())}normalize(e,n){const r=this.getRange();if(!r||!r.collapsed)return;const i=r.startContainer;if(1!==i.nodeType)return;const o=i.childNodes[r.startOffset];if(e.nodeFilter(o))return;if(n){const n=t.domUtils.getPreviousSelectableNode(o,e);if(n)return void this.collapseAtEnd(n)}const s=t.domUtils.getFirstSelectableChild(o,e);s&&s!==o&&this.setStart(s,!0,0)}getRangeForForTargetNode(e){return e&&e.ownerDocument&&e.parentNode?this.getRangeAt(0):null}_selectNodeOrContent(e,t){3===t.nodeType?e.selectNode(t):e.selectNodeContents(t)}_adjustElementRange(t,n){if(!t.collapsed)return t;const r=t.startContainer,i=r&&r.parentNode;if(!i||1!==r.nodeType||i===n)return t;const o=e.utils.dom.getNodeIndex(r);return t.setStart(i,o),t.setEnd(i,o),t.collapse(!0),t}collapseAt(e,n){if(!(null==e?void 0:e.parentNode)||e.ownerDocument!==this.env.document)return t.logger.warn(`collapse at: the provided node ${typeof e} is not under the current selection doc`),this.getRangeAt(0);const r=e&&this.getRangeAt(0);if(!r)return null;try{this.addRange(r.collapseAt(e,n))}catch(e){t.logger.error("collapseAt",n?"start":"end",e)}finally{return this.getRangeAt(0)}}_getEffectiveStartNode(e){if(!e||1!==e.nodeType)return e;const t=e.parentNode;return t&&e===t.firstChild?"LI"===e.nodeName||"TR"===e.nodeName?e.parentNode:"TD"===e.nodeName&&t===(t.parentNode&&t.parentNode.firstChild)?t.parentNode:e:e}_getEffectiveEndNode(e){if(!e||1!==e.nodeType)return e;const t=e.parentNode;return t&&e===t.lastChild?"LI"===e.nodeName||"TR"===e.nodeName?e.parentNode:"TD"===e.nodeName&&t===(t.parentNode&&t.parentNode.lastChild)?t.parentNode:e:e}}};Object.assign(t,r)}(window.LOOPINDEX),Object.defineProperty(s,"__esModule",{value:!0}),function(e){const t=null==e?void 0:e.FLITE,n=null==e?void 0:e.$;if(!t||!n)throw new Error("Cannot initialize DOM Marker without FLITE globals");class r{constructor(e,t){this.env=e,this._start=null,this._end=null,this._isEndExtended=!1,this._isStartExtended=!1,this._startInText=!1,this._endInText=!1,this._createBookmark(t)}getNodesInRange(t,n){if(!this._end||!this._start||this._start.nextSibling===this._end)return[];const r=this.env.element,i=[],o=e.utils.dom.createTreeWalker(r,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT);let s,a=this._end;const l=!a.nextSibling;for(o.currentNode=this._start;s=o.nextNode();)if(!e.utils.dom.isDescendantOf(s,this._start)&&!e.utils.dom.isDescendantOf(s,a)){if(s===a||s===r)break;!l&&e.utils.dom.isDescendantOf(a,s)||t&&!t(s,n)||i.push(s)}return i}collapseAndRemove(e){const t=this.selectAndRemove();return null==t?void 0:t.collapse(e)}selectAndRemove(e=!0){var n,r;const i=t.rangy.createRange(this.env.document);if(!this._validate(this._start))return this.remove(),i;try{const o=Boolean(this._end&&this._start.nextSibling!==this._end);if(o){const e=t.rangy.createRange(this.env.document);e.setStartAfter(this._start),e.setEndBefore(this._end),e.commonAncestorContainer.normalize()}if(!1!==e&&this._startInText)this._restoreText(this._start,i,!0)||(3===(null===(n=this._start.previousSibling)||void 0===n?void 0:n.nodeType)?i.setStart(this._start.previousSibling,this._start.previousSibling.length):i.setStartBefore(this._start));else{const e=this._isStartExtended?this._findExtendedStart(this._start):null;e?i.setStartBefore(e):i.setStartBefore(this._start)}if(this._removeStart(),i.collapse(!0),o)if(!1!==e&&this._endInText)this._restoreText(this._end,i,!1)||(3===(null===(r=this._end.nextSibling)||void 0===r?void 0:r.nodeType)?i.setEnd(this._end.nextSibling,0):i.setEndBefore(this._end));else{const e=this._isEndExtended?this._findExtendedEnd(this._end):null;e?i.setEndAfter(e):i.setEndBefore(this._end)}}catch(e){t.logger.debug("marker select and remove error: "+e)}finally{this.remove()}return i}remove(){this._removeStart(),this._removeEnd()}_createBookmark(e){let n,r;const i=e.collapsed;this._startInText=3===e.startContainer.nodeType&&e.startOffset>0,this._endInText=3===e.endContainer.nodeType&&e.endOffset<e.endContainer.length;const o=e=>{let t=this.env.document.createElement("span");return t.style.display="none",t.innerHTML="&nbsp;",t.className="flite-bookmark flite-bookmark-"+e,t};try{let t;if(this._start=n=o("start"),!i){this._end=r=o("end");const n=this._testExtendEndSelection(e);t=e.cloneRange(),n&&(this._isEndExtended=!0,t.setEndAfter(n),n.setAttribute("data-flite-extended-end","1")),t.collapse(!1),t.insertNode(r)}t=e.cloneRange();const s=this._testExtendStartSelection(e);s&&(t.setStartBefore(s),s.setAttribute("data-flite-extended-start","1"),this._isStartExtended=!0),t.collapse(!0),t.insertNode(n)}catch(e){t.logger.warn("While creating bookmark, "+e),this._start=this._end=null}}_validateExtendedNode(e){return 1!==(null==e?void 0:e.nodeType)||"body"===e.nodeName||e===this.env.element?null:e}_findExtendedEnd(e){if(e===this.env.element)return null;const t=e.previousSibling;return t?1!==t.nodeType||"1"!==t.getAttribute("data-flite-extended-end")?null:this._validateExtendedNode(t.lastChild):null}_findExtendedStart(e){if(e===this.env.element)return null;const t=e.nextSibling;return t?1!==t.nodeType||"1"!==t.getAttribute("data-flite-extended-start")?null:this._validateExtendedNode(t.firstChild):null}_testExtendEndSelection(e){var t;if(e.collapsed||1!==(null===(t=e.endContainer)||void 0===t?void 0:t.nodeType))return null;let n=null;if(e.endContainer===e.startContainer){n=0===e.startOffset&&e.endOffset===e.endContainer.childNodes.length?e.endContainer:null}else{n=e.endContainer.childNodes[e.endOffset]?null:e.endContainer}return this._validateExtendedNode(n)}_testExtendStartSelection(e){var t;if(e.collapsed||1!==(null===(t=e.startContainer)||void 0===t?void 0:t.nodeType)||0!==e.startOffset)return null;let n=null;if(e.endContainer===e.startContainer){n=e.endOffset===e.endContainer.childNodes.length?e.startContainer:null}else n=e.startContainer.firstChild?e.startContainer:null;return this._validateExtendedNode(n)}_validate(n){if(!n)return null;try{return Boolean(n.parentNode&&this.env.document&&e.utils.dom.isDescendantOf(n,this.env.document))}catch(e){return t.logger.warn("marker validate error "+e),!1}}_removeStart(){if(this._validate(this._start)){if(this._isStartExtended){const e=n(this._start).siblings("[data-flite-extended-start]");(e.length?e:n(this.env.element).find("[data-flite-extended-start]")).attr("data-flite-extended-start",null)}n(this._start).remove(),this._start=null}}_removeEnd(){if(this._validate(this._end)){if(this._isEndExtended){const e=n(this._end).siblings("[data-flite-extended-end]");(e.length?e:n(this.env.element).find("[data-flite-extended-end]")).attr("data-flite-extended-end",null)}n(this._end).remove(),this._end=null}}_restoreText(e,t,n){const r=e.previousSibling,i=e.nextSibling,o=3===(null==r?void 0:r.nodeType),s=3===(null==i?void 0:i.nodeType);if(!o||!s)return!1;const a=r.length,{startContainer:l,startOffset:c}=t;return r.data+=i.data,n?t.setStart(r,a):(t.setStart(l,c),t.setEnd(r,a)),i.parentNode.removeChild(i),!0}static removeBookmarks(e){n(e).find("span.flite-bookmark").remove()}}const i={createDOMMarker:function(e,t){return new r(e,t)}};Object.assign(t,i)}(window.LOOPINDEX),Object.defineProperty(s,"__esModule",{value:!0}),function(e){e[e.None=0]="None",e[e.InsertedKeep=1]="InsertedKeep",e[e.InsertedDiscard=2]="InsertedDiscard"}(o||(o={})),function(e){const t=null==e?void 0:e.FLITE,n=null==e?void 0:e.$;if(!t||!n)throw new Error("Cannot initialize FLITE tracker without FLITE globals");let r,i,s,a,l,c;!function(e){e[e.OK=0]="OK",e[e.IGNORE=1]="IGNORE",e[e.IGNORE_ALL=2]="IGNORE_ALL"}(r||(r={})),function(e){e[e.None=0]="None",e[e.Start=1]="Start",e[e.End=2]="End",e[e.All=3]="All"}(i||(i={})),function(e){e[e.DONT_TRACK=0]="DONT_TRACK",e[e.TRACK_TEXT=1]="TRACK_TEXT",e[e.TRACK_ALL=2]="TRACK_ALL"}(s||(s={})),function(e){e[e.None=0]="None",e[e.Start=1]="Start",e[e.Composing=2]="Composing"}(a||(a={})),function(e){e[e.inline=0]="inline",e[e.block=1]="block",e[e.none=2]="none"}(l||(l={})),function(e){e[e.Right=1]="Right",e[e.Left=2]="Left",e[e.None=0]="None"}(c||(c={}));const d=e.browser.msie,u=void 0!==window.WebKitMutationObserver?window.WebKitMutationObserver:window.MutationObserver,h=["tr:empty, ul:empty, ol:empty","tbody:empty","table:empty"],f={TD:1,TR:1,TH:1},g={LI:1,P:1,DIV:1,H1:1,H2:1,H3:1,H4:1,H5:1,H6:1},p={OL:1,UL:1},m={LI:1,TD:1,TR:1,UL:1,OL:1},v={BR:1,P:1,DIV:1,LI:1},y={LI:1,OL:1,UL:1},C=["pre","u","b","s","sub","sup","em","strong","a","span","blockquote:empty"].join(":empty,"),_={P:1,DIV:1,H1:1,H2:1,H3:1,H4:1,H5:1,H6:1},N=(Object.keys(_).join(","),Object.keys(_).join(".flite-container-only:empty,")+".flite-container-only:empty"),b=/^u|ol$/i,T=[{start:0,end:31},{start:33,end:40},{start:45,end:45},{start:91,end:93},{start:112,end:123},{start:144,end:145}],E={},k={changeGroupTime:1e3,classes:{block:"ice-block"},deletableSelectors:"",opaqueSelectors:"",stylePrefix:"cts",changeTypes:{insertType:{className:"ins",action:"Inserted"},deleteType:{className:"del",action:"Deleted"}},_changeData:null};let S,x,w=void 0;!function(e){e[e.Always=1]="Always",e[e.NotEmpty=2]="NotEmpty"}(S||(S={})),function(e){e[e.None=0]="None",e[e.Bullet=1]="Bullet",e[e.Number=2]="Number"}(x||(x={}));const O=[{selector:"img,br,.cke_widget_wrapper,li",type:S.Always},{selector:"p,div,td,h1,h2,h3,h4,h5,h6",type:S.NotEmpty}],A={getEmptyBlock:function(n,r=-1){const i=null==n?void 0:n.parentNode;if(!i)return null;if(3!==n.nodeType&&"BR"!==n.nodeName||(n=i),1!==n.nodeType)return null;if(r>=0){const e=n.childNodes[r];t.domUtils.isBlockElement(e)&&(n=e)}const o=n;let s=0;for(let t=o.firstChild;t;t=t.nextSibling){if("BR"===t.nodeName)s++;else{if(3!==t.nodeType)return null;if("Â "===t.data)s++;else if(!e.utils.strings.isEmptyString(t.data))return null}if(s>1)return null}return t.domUtils.isBlockElement(o)?o:null},collectTextChildren:function(t){if(1!==(null==t?void 0:t.nodeType))return[];const n=[];return e.utils.dom.forAllTextChildren(t,e=>n.push(e)),n},collectEmptyTextChildren:function(t){return A.collectTextChildren(t).filter(t=>e.utils.dom.isEmptyTextNode(t))},compareNodes:function(e,t){if(!e||!t)return!1;if(e===t)return!0;if(e.nodeName!==t.nodeName)return!1;const n=e.attributes.length;if(t.attributes.length!==n)return!1;for(let r=0;r<n;++r){const n=e.attributes[r],i=t.attributes[r];if(n.name!==i.name||n.value!==i.value)return!1}return!0},adjustSpellCheckerRange:function(t){return A.isSpellcheckerNode(t.startContainer)&&t.startContainer.firstChild?(0===t.startOffset?(t.setStart(t.startContainer.firstChild,0),t.collapse(!0)):(t.setEnd(t.startContainer.lastChild,e.utils.dom.getNodeLength(t.startContainer.lastChild)),t.collapse(!1)),t):t},createReplacementText:function(e){return"\ufeff"},shouldTrackChildren:function(e){return 3===e.nodeType?s.DONT_TRACK:e.nodeName in E?s.TRACK_TEXT:s.TRACK_ALL},isVirtuallyEmpty:function(t){if(t.length<1)return!0;if(t.is("BR"))return!0;let n;for(let r=t.length-1;r>=0;--r){if(n=t[r],1===n.nodeType&&"BR"!==n.nodeName)return!1;if(3===n.nodeType&&!e.utils.dom.isEmptyTextNode(n))return!1}return!0},isIgnoredKeyCode:function(e){if(!e)return!0;for(let t,n=0,r=T.length;n<r;++n)if(t=T[n],e>=t.start&&e<=t.end)return!0;return!1},sortNodesByAncestry:function(t){return t.toArray().sort((function(t,n){return e.utils.dom.isDescendantOf(t,n)?-1:e.utils.dom.isDescendantOf(n,t)?1:0}))},isBogus:function(e){return!(!e||1!==e.nodeType||"BR"===e.nodeName)&&null!==e.getAttribute("data-mce-bogus")},getNodeAttributes:function(e){const t=e.attributes;let n,r=t&&t.length,i={};for(let e=0;e<r;++e)n=t[e],i[n.name]=n.value;return i},removeAllAttributes:function(e){let t,n=null;e.attributes;try{for(;e.attributes.length>0;){if(t=e.attributes[0],t===n)return;n=t,e.removeAttribute(t.name)}}catch(e){}},findNonSpellcheckerParent(e,t){if(!e||!t)return null;for(;e!==t&&(3===e.nodeType||A.isSpellcheckerNode(e));)e=e.parentNode;return e},isSpellcheckerNode:function(t){return Boolean(t&&e.utils.dom.matchesSelector(t,".scayt-misspell-word,span.mce-spellchecker-word"))},findSpellcheckerParent:function(e,t){if(!e)return null;let n=1===e.nodeType?e:e.parentNode;for(;n&&n!==t;){if(A.isSpellcheckerNode(n))return n;n=n.parentNode}return null},removeSpellcheckerNode:function(e){for(;e.firstChild;)n(e.firstChild).insertBefore(e);e.parentNode.removeChild(e)},tryToRemoveSpellcheckerNode:function(e,t){const n=A.findSpellcheckerParent(e,t);return n&&A.removeSpellcheckerNode(n),Boolean(n)},removeSpellCheckingFromRange:function(t,n){if(!t||!t.collapsed||!t.commonAncestorContainer)return t;const r=t.commonAncestorContainer;if(3===r.nodeType)return A.tryToRemoveSpellcheckerNode(r,n),t.syncToNative(),t;if(A.isSpellcheckerNode(r)){const n=r.parentNode,i=e.utils.dom.getNodeIndex(r),o=t.cloneRange();A.removeSpellcheckerNode(r);const s=n.childNodes[i];return s?o.collapseAt(s,!0):(o.setEnd(n,i),o.collapse(!1)),o}const i=r[t.startOffset],o=r[t.startOffset-1];let s=!1;A.isSpellcheckerNode(o)&&(s=!0,A.removeSpellcheckerNode(o));const a=i?e.utils.dom.getNodeIndex(i):r.childNodes.length;if(A.isSpellcheckerNode(i)&&(s=!0,A.removeSpellcheckerNode(i)),s){t.syncToNative();const e=t.cloneRange();return e.setStart(r,Math.min(a,r.childNodes.length)),e.collapse(!0),e}return t}};class R{constructor(){this._type="none",this._data=null,this._timeoutClient=new e.TimeoutClient,this._timeoutClient.createTimer("reset",{callback:()=>{this._type="none"},autoDispose:!1})}setContext(e){this._type=e.type,this._data=e.data||{};const t=void 0===e.timeout?300:e.timeout;t>0&&this._timeoutClient.startTimer("reset",t)}mergeData(t){if(t)return this._data=e.$.extend({},this._data,t)}get data(){return this._data}popType(){const e=this._type;return this._type="none",this._timeoutClient.stopTimer("reset"),e}peekType(){return this._type}}class I{constructor(e){this.host=e,this._textChanged=!1,this._trackerChanged=!1,this._isUpdate=!1,this._isLocked=!1}textChanged(){return this._textChanged=!0,this}lock(){return this._isLocked=!0,this}unlockAndFinish(){return this._isLocked=!1,this.finish()}setIsUpdate(){return this._isUpdate=!0,this}trackerChanged(){return this._trackerChanged=!0,this}get hasChanges(){return this._textChanged||this._trackerChanged}reset(e="all"){return"all"!==e&&"tracker"!==e||(this._trackerChanged=!1),"all"!==e&&"text"!==e||(this._textChanged=!1),"all"===e&&(this._isLocked=this._isUpdate=!1),this}finish(){if(this._isLocked)return t.logger.debug("Edit transaction: finish suppressed"),this;try{const e=this._trackerChanged,n=this._isUpdate,r=this._textChanged;this.reset(),(e||r)&&(t.logger.debug("Edit transaction calling onTrackerChange"),this.host.onTrackerChange({isUpdate:n,trackerChanged:e,textChanged:r}))}catch(e){t.logger.error("Error finishing edit transaction "+e)}return this}}const L={ChangeTracker:class{constructor(r,i){if(this._lastChange=null,this._ignoreMutations=!1,this._boundEventHandler=null,this._mutationSummary=null,this._domObserver=null,this._batchChangeId="",this._uniqueIDIndex=1,this._compositionState=a.None,this._mutationListenRequestCount=0,this._opaqueTester=null,this._rootId=Math.round(1e6*Math.random()),this._insColorIndex=0,this._delColorIndex=0,!r)throw new Error("owner must be defined for flite construction.");const o=d?()=>{var e;return null===(e=this.host)||void 0===e?void 0:e.getBody()}:()=>this._env.element;this._changes=e.utils.createTypedArrayMap(e=>e.id),Object.defineProperty(this,"rootElement",{get:o,configurable:!1,enumerable:!0}),this.host=r,this._users={},this._env={document:null,window:null,element:null,frame:null},this._lastMutationContext=new R,this._isDeletableCallback=this._isDeletableElement.bind(this),this._timeoutClient=new e.TimeoutClient,this._editTransaction=new I(r),this._deleteOptions=this._createNodeSelectionSchemes(),this._monitorChangeId=this._createMonitorChangeId(),this._params=n.extend(!0,{},k,i),this._insertClassName=this._params.changeTypes.insertType.className,this._deleteClassName=this._params.changeTypes.deleteType.className,t.domUtils.addStubElementSelector(this._params.nodeClassifier.getSelector(t.NodeClassifier.NODE_ONLY)),this._insertSelector="."+this._getTrackedNodeClass("insertType"),this._deleteSelector="."+this._getTrackedNodeClass("deleteType"),this._fliteSelector=`${this._insertSelector},${this._deleteSelector}`,this._fliteTextSelector=`span${this._insertSelector}:not(.flite-container-only),span${this._deleteSelector}:not(.flite-container-only)`,this._domObserver=null}dispose(){this._selection&&(this._selection.dispose(),this._selection=null),this._params=null,this._timeoutClient.clear(),this._setEnvFromRoot(null),this._$element=null,this._mutationSummary&&(this._mutationSummary.dispose(),this._mutationSummary=null),this._forAllUsers(e=>{e.styleLoader&&(e.styleLoader.dispose(),e.styleLoader=null),delete this._users[e.userId]})}getSelectedNode(){const e=this._getNodeAtCaret({range:null});return null==e?void 0:e.node}getSelection(){return this._selection}createNativeRange(){return t.rangy.createNativeRange(this._env.document)}removeArtifactsFromHTML(e){const r=this._env.document.createElement("div");try{return r.innerHTML=e,this._removeFLITEArtifacts(!1,n(r)),r.innerHTML}catch(n){return t.logger.error("removeArtifactsFromHTML: "+n),e}}removeFLITETracking(e){if(!e||1!==e.nodeType)return;const r=e;Object.keys(this.attributes).forEach(e=>{r.removeAttribute(this.attributes[e])}),this._restoreNodeTitle(e),r.removeAttribute("data-flite-class"),t.domUtils.isTextContainer(e)&&r.removeAttribute("tabindex");const i=n(e);i.removeClass(this._insertClassName).removeClass(this._deleteClassName).removeClass("flite-container-only");const o=(r.className||"").split(" "),s=this._params.stylePrefix;o.forEach(e=>{e&&0===e.indexOf(s)&&i.removeClass(e)});return""===r.getAttribute("class")&&r.removeAttribute("class"),r}tryToTrackListStatusRemoval(r){const i=this._getCurrentRange(),o={mutation:"insert-list"};if(!(null==i?void 0:i.startContainer))return o;const a=i.startContainer,l=i.collapsed?3===a.nodeType?a:1===a.nodeType?a.childNodes[i.startOffset]||a.childNodes[i.startOffset-1]:null:null;if(!l)return o;const c=l?[l]:i.getNodes(),d=[],u=[],h=[];function f(e,t){e.indexOf(t)<0&&e.push(t)}const g={};for(const e of c){const n=t.domUtils.getNodeListStatus(e,this.rootElement);"bullet"===n.type?f(u,n.li):"number"===n.type?f(h,n.li):d.push(e)}const{isBullet:p,isBulk:m,trackTypeChange:v}=r,y=u.length&&p||h.length&&!p;if(d.length)return u.length||h.length?g:o;if(h.length&&u.length)return g;const C=(e=>{const t=[];for(const n of e){const e=t[t.length-1],r=this._getNodeTrackingContext(n,!0);if(e){if(e.isTracking!==r.isTracking||e.isInsert!==r.isInsert||e.isCurrent!==r.isCurrent)return null;t.push(r)}else t.push(r)}return t})(h.length?h:u);if(!(null==C?void 0:C.length))return g;const _=C[0];if(!_.isTracking&&!y){if(!v)return g;const t=p?h:u,r=e.utils.getUniqueId("li");return t.forEach(e=>{e.setAttribute("data-list-m-id",r)}),m&&t.forEach(e=>{n(e).siblings("LI").attr("data-list-m-id",r)}),Object.assign(Object.assign({},o),{selector:`[data-list-m-id='${r}']`,cleanup:e=>1===(null==e?void 0:e.nodeType)&&e.removeAttribute("data-list-m-id")})}if(y&&_.isCurrent&&_.isInsert)return g;const N=this._startBatchChange(),b={trackChildren:s.DONT_TRACK,ctx:void 0,force:!0};try{if(y){const e=p?u:h;for(let t=0,n=C.length;t<n;++t){const n=C[t],r=n.trackingNode||e[t];n.isDelete?(b.ctx=n,this._tryToTrackAddedNode(r,b)):this._addDeleteTracking(r,{changeId:N.id,containerOnly:!0,trackingContext:n})}return{handled:!0}}if(_.isCurrent&&_.isInsert)return{handled:!1};for(const e of C)b.ctx=e,this._tryToTrackAddedNode(e.trackingNode,b);return{handled:!1}}catch(e){return t.logger.error("While tracking list status removal: "+e),{}}finally{this._endBatchChange(N)}}currentChangeNode(e){return this._getNodeTrackingContext(e,!1).trackingNode}ignoreNextMutation(e){this._mutationSummary&&this._mutationSummary.ignoreNextMutation(),t.logger.debug("ignore next mutation after "+(e||"(no reason provided)"))}trackSpellCheckChange(){let e=new u(e=>{n(),t.logger.debug("received spellcheck mutations",e),this._handleSpellcheckMutation(e)});const n=()=>{e&&(e.disconnect(),e=null)};e.observe(this._$element[0],{characterData:!0,childList:!0,characterDataOldValue:!0,subtree:!0}),setTimeout(()=>{t.logger.debug("spellcheck mutation observer timeout"),n()},5)}toggleListenToCharacterChanges(e){if(!1===e)return this._characterMutationObserver&&(this._characterMutationObserver.disconnect(),this._characterMutationObserver=null),void this._restoreAllTextContent(this._$element);const{count:t,type:n,hideText:r}=e;let i=Math.round(t||0);const o={characterData:!0,childList:!0,characterDataOldValue:!0,subtree:!0};if(0!==i){const e="replace"===n||"replace-t6"===n?this._onReplaceTextChildrenMutation:null;if(!e)throw new Error("unknown chardata toggle type "+n);this._characterMutationObserver=this._characterMutationObserver||new u(t=>{i>0&&i--,this._characterMutationObserver.disconnect(),(null==t?void 0:t.length)&&!this._ignoreMutations&&e.call(this,t),0!==i&&this._characterMutationObserver.observe(this.rootElement,o)}),this._characterMutationObserver.observe(this.rootElement,o),r&&this._hideAllDeletedText(this._$element)}else this._characterMutationObserver&&(this._characterMutationObserver.disconnect(),this._characterMutationObserver=null),this._restoreAllTextContent(this._$element)}getNodesForChange(e){const t=`[${this.attributes.changeId}='${e}']`;return this._$element.find(`${this._deleteSelector}${t},${this._insertSelector}${t}`)}_restoreAllTextContent(e){e.find(`${this._insertSelector}[${this.attributes.fliteTextContent}],${this._deleteSelector}[${this.attributes.fliteTextContent}]`).each((e,t)=>{this._restoreHiddenContent(t)})}_hideAllDeletedText(e){e.find(this._deleteSelector+":not(.flite-container-only)").each((e,t)=>{this._hideTextContent(t)})}_listenToMutations(e){const t=this._mutationSummary&&this._mutationSummary.isConnected;this._mutationListenRequestCount=Math.max(e,this._mutationListenRequestCount),this._mutationListenRequestCount&&!t&&this._createMutationObservers(!0)}setIgnoreMutations(e){return this._ignoreMutations}get currentUser(){var e;return null===(e=this.host)||void 0===e?void 0:e.users.getCurrentUser(!0)}get attributes(){return t.flitePluginUtils.trackerAttributes}get changeTypes(){return this._params.changeTypes}get changeData(){return this._params._changeData}get sessionId(){var e;return null===(e=this.host)||void 0===e?void 0:e.sessionId}toggleChangeTracking(e,t){return e?this._startTracking(t):this._stopTracking(),this}setUserStyle(e,n){if(!e)return;const r=this._users[e],i=r&&this.host.users.getUser(r.userId);if(!i)return t.logger.error("setUserStyle: no user",e);i.style=this._validateUserStyle(n);const o=this._getUserStyleSheet(e,!0);if(!o)return;o.reset(),o.addRule(`.FLITE-Tracking ${this._insertSelector}[${this.attributes.userId}='${e}']:not(.flite-container-only)`,i.style.insert);let s=i.style.insert["background-color"];s&&o.addRule(`.FLITE-Tracking :not(li)${this._insertSelector}.flite-container-only[${this.attributes.userId}='${e}']`,{"border-color":s}),o.addRule(`.FLITE-Tracking ${this._deleteSelector}[${this.attributes.userId}='${e}']:not(.flite-container-only)`,i.style.delete),s=i.style.delete["background-color"],s&&(o.addRule(`.FLITE-Tracking tr${this._deleteSelector}[${this.attributes.userId}='${e}']`,{"background-color":s}),o.addRule(`.FLITE-Tracking td${this._deleteSelector}[${this.attributes.userId}='${e}']`,{"background-color":s}),o.addRule(`.FLITE-Tracking :not(td,tr,li)${this._deleteSelector}.flite-container-only[${this.attributes.userId}='${e}']`,{"border-color":s}))}getCurrentUser(){return this.currentUser||{id:"",name:""}}removeUsers(t){if(t&&t.length){t=e.utils.strings.toStringArray(t);for(let e of t){const t=this._users[e];t&&(t.styleLoader&&(t.styleLoader.dispose(),t.styleLoader=null),delete this._users[e])}}}addUsers(t){t&&(e.$.isArray(t)||(t=[t]),t.forEach(e=>{this._addUser(e)}))}updateUser(e){const n=e&&e.id&&String(e.id),r=n&&this._users[n];if(!r||!r.userId)return t.logger.error("tracker can't set current user, unknown id",n);if(e.style&&this.setUserStyle(n,e.style),e.name){for(let t of this._changes.items)t.userid===e.id&&(t.username=e.name);if(this._$element){const t=`[${this.attributes.userId}='${n}']`,r=this.attributes.userName;this._$element.find(`${this._insertSelector}${t},${this._deleteSelector}${t}`).each((t,n)=>{n.setAttribute(r,e.name)})}}}prepareForInsertion(e){const t=this._getCurrentRange(!0),n=null==t?void 0:t.startContainer;if(!n)return!1;const r=this._getNodeTrackingContext(n);return t.collapsed?!!r.tracksContent&&(this._moveCaretOutOfTracking(t,r,void 0===e||e),Boolean(e)):this._prepareForSelectionInsertion(t,r)}_prepareForSelectionInsertion(e,t){let n=!1;const r=null==e?void 0:e.startContainer;t.tracksContent&&(n=!0,this._splitNode(t.trackingNode,r,e.startOffset),e.setStart(t.trackingNode,0));const i=this._getNodeTrackingContext(e.endContainer),o=[];if(i.tracksContent){n=!0;const r=i.trackingNode===t.trackingNode,s=this._splitNode(i.trackingNode,e.endContainer,e.endOffset);r?(e.selectNode(s),o.push(s)):(e.setEndAfter(s),o.push(s,e.startContainer))}else t.tracksContent&&o.push(e.startContainer);return o.forEach(e=>this.removeFLITETracking(e)),n&&this._selection.addRange(e),!1}_prepareForSelectionInsertion1(e,t){let n=!1;const r=null==e?void 0:e.startContainer,i=this._getNodeTrackingContext(e.endContainer);if(i.tracksContent){n=!0;const t=this._splitNode(i.trackingNode,e.endContainer,e.endOffset);e.setEnd(t,t.childNodes.length)}const o=this._getNodeTrackingContext(r);return o.tracksContent&&(n=!0,this._splitNode(o.trackingNode,r,e.startOffset),e.setStart(o.trackingNode,0)),[e.startContainer,e.endContainer].forEach(e=>this.removeFLITETracking(e)),n&&this._selection.addRange(e),!1}addFullTrackingDataToNode(e){const t=this.getChangeForNode(e,!1);if(!t)return e;const r=this.attributes;return n(e).attr({[r.changeId]:t.id,[r.userName]:t.username,[r.userId]:t.userid,[r.changeData]:t.data||null,[r.time]:t.time,[r.lastTime]:t.lastTime,[r.sessionId]:t.sessionId||null}),e}addFullTrackingDataToDOM(e){return e?(n(e).find(this._fliteSelector).each((e,t)=>{this.addFullTrackingDataToNode(t)}),e):e}isNodeVisible(e){if(e&&3===e.nodeType&&(e=e.parentNode),e){const t=e.getBoundingClientRect();return t.top>0&&t.left>0}}getWrappingTagName(e){return(e&&3!==e.nodeType?l.none:l.inline)===l.inline?"span":null}isOwnRoot(e){return e&&n(e).data("FLITE::rootid")===String(this._rootId)}reload(e){e?(this._loadEditor(e),this.setShowChanges(this.host.isVisible)):this._loadFromDom()}prepareToPaste(){const e=this._getCurrentRange(!1);if(e&&!e.collapsed){this._deleteSelection(e,{preserveContainers:!1,restoreSelection:i.All});const t=this._getCurrentRange(!1);t&&(t.collapse(!1),this._prepareSelectionForInsert(null,t))}}prepareToCut(e){try{let r=this._getCurrentRange(!0);if(!r||r.collapsed)return!1;if("full"!==e)return this._momentarilyRemoveTrackingInRange(r),!1;if(this._editTransaction.lock(),t.flitePluginUtils.isClipboardAPIAvailable())return this._copyToClipboard(r),this._deleteSelection(r,{restoreSelection:i.End,preserveContainers:!1}),!0;r=this._cleanupSelection(r),t.trackerUtils.fixSelection(r,this.rootElement);const o=r.cloneContents(),s=o.firstChild,a=o.lastChild,l=t.createDOMMarker(this._env,r);let c=!0;for(let e=s;e&&c;e=e.nextSibling)this._shouldIgnoreNode(e,!0)||(c=!1);if(c)return!1;r.collapse(!1),r.insertNode(o),r.setStartBefore(s),r.setEndAfter(a);const d=this._startBatchChange();try{return this._deleteSelection(r,{preserveContainers:!1,restoreSelection:i.None}),!1}catch(e){return t.logger.error(e,"While trying to delete selection"),!1}finally{if(this._endBatchChange(d),this._editTransaction.unlockAndFinish(),l){const e=l.selectAndRemove();this._momentarilyRemoveTrackingInRange(e)}setTimeout(()=>{const e=`${this._insertSelector}:not(.flite-container-only)>BR,${this._deleteSelector}:not(.flite-container-only)>BR`;this._$element.find(e).each((e,t)=>{const r=n(t.parentNode);r[0].removeChild(t),r.is(":empty")&&this._removeNode(r[0])})},10)}}catch(e){return t.logger.error("prepareToCut:",e),!1}}prepareToCopy(e){const n=this._getCurrentRange();if(!1!==(null==n?void 0:n.collapsed))return!1;if("raw"===this._params.copyBehavior)return!1;if(t.flitePluginUtils.isClipboardAPIAvailable())return this._copyToClipboard(n),!0;try{this._momentarilyRemoveTrackingInRange(n)}catch(e){t.logger.error("While trying to prepare for copy: "+e)}return!1}setShowChanges(e){this._showTitles(Boolean(e))}unlistenToEvents(){setTimeout(()=>(this.rootElement&&this._boundEventHandler&&this.rootElement.removeEventListener("keydown",this._boundEventHandler,!0),this._boundEventHandler=null,this),0)}listenToEvents(){return this.rootElement&&!this._boundEventHandler&&(this._boundEventHandler=this.handleEvent.bind(this),this.rootElement.addEventListener("keydown",this._boundEventHandler,!0)),this}handleEvent(e,n,r){if("none"===n)return!0;try{this._editTransaction.lock();let i=!1;return"keypress"==e.type?i=this._keyPress(e,n,r):"keydown"==e.type&&(i=this._handleKeyDown(e,n,r)),i&&(e.stopImmediatePropagation(),e.preventDefault(),this.host.fireEvent(t.Events.EVENT_INTERCEPTED,{event:e,flite:this.host})),!i}catch(e){return t.logger.error("Error processing eveng "+e),!0}finally{this._editTransaction.unlockAndFinish()}}insertText(e){const{text:n,mode:r,readonlyPolicy:o}=e;if("readonly"===r){const e="insert"===o?n:void 0;return this.prepareForInsertion(e)}if(this.host.getIMECompositionState()!==a.None){const e=this._getCurrentRange(),n=e.collapsed&&e.startContainer,r=n&&this._getNodeTrackingContext(n);if(r.tracksContent&&r.isCurrent)return t.logger.debug("Ignoring typing in IME",e.inspect()),!1}let s=e.range||this._getCurrentRange(!0);if(s=this.host.beforeInsert(s),!s||this.keyboardMapper)return!1;const l=this._getNodeTrackingContext(s.startContainer,!0);if(l.isInsert&&l.tracksContent&&l.isCurrent&&(s.collapsed||3===s.startContainer.nodeType&&s.endContainer===s.startContainer))return!1;const c=Boolean(s&&!s.collapsed);if(s.commonAncestorContainer!==this.rootElement&&this._shouldIgnoreNode(s.commonAncestorContainer,!1))return!1;s=this._cleanupSelection(s);const d=this._startBatchChange(l);let u=!1;try{if(c&&(this._deleteContents(i.End,s,!0),s=this._moveRangeToValidTrackingPos(this._getCurrentRange())),s){const e=this._doInsertText(n,s);(u=e.inserted)?this._editTransaction.textChanged():e.element&&(e.element.setAttribute(t.flitePluginUtils.trackerAttributes.stubNode,"true"),t.trackerUtils.monitorTextNode(e.element,(e,n)=>{n?(e.removeAttribute(t.flitePluginUtils.trackerAttributes.stubNode),this.host.saveUndo()):this._removeNode(e)}))}}catch(e){t.logger.error(e,"while trying to insert nodes")}finally{this._endBatchChange(d)}return u}markNodeForPendingInsertion(e){e&&1===e.nodeType&&(e.setAttribute("data-flite-inserting","1"),this._timeoutClient.createTimer("pendingattr",{callback:()=>{try{e.removeAttribute("data-flite-inserting")}finally{}},autoDispose:!0,timeoutMSecs:5}).start())}setMutationContext(e,n){t.logger.debug("set mutation context",e,n),this._lastMutationContext.setContext({type:e,data:n||{},timeout:null==n?void 0:n.timeout}),this._listenToMutations(1)}updateMutationContext(e,n,r=!0){const i=this._lastMutationContext.peekType();i&&"none"!==i?i===e?this._lastMutationContext.mergeData(n):t.logger.debug("updateMutationContextData mismatch",i,e):this.setMutationContext(e,Object.assign(Object.assign({},n),{timeout:1}))}getMutationContext(){return this._lastMutationContext.peekType()}getCleanDOM(e,t){let r;t=n.extend({},{clone:!1,removeDeleted:!1},t),r=e?n("string"==typeof e?`<div>${e}</div>`:e):this._$element,t.clone&&(r=r.clone());const i=`[${this.attributes.isDeleteNode}]`;let o=this._cleanBody(r,this._fliteSelector,this._deleteSelector,`[${this.attributes.fliteCreated}]`,t);return o=this._cleanBody(o,i,i,null,t),o[0]}processInsertedNodes(e,n){if(!e||!e.length)return[];let r=this._getCurrentRange(!0);r=this.host.beforeInsert&&this.host.beforeInsert(r);const o=r&&!r.collapsed;let s;try{if(this._editTransaction.lock(),n.deleteSelection&&o){this._deleteContents(i.End,r,!0),r=this._selection.getRange();const e=this._getNodeTrackingContext(r.startContainer);this._moveCaretOutOfTracking(r,e,!0),r=this._getCurrentRange()}s=n.markup?this._markupInsertedNodes(e,r):e}catch(e){t.logger.error(e,"while trying to insert nodes"),s=[]}finally{this._editTransaction.reset()}return s}getNodeChangeId(e){if(!e)return null;return this._getNodeTrackingContext(e,!1).changeId||null}isInsideChange(e,n){try{const t=Boolean(this.currentChangeNode(e));return n||t||!this._lastChange||(this._lastChange=null),t}catch(e){return t.logger.error(e,"While testing if isInsideChange"),!1}}hasChanges(){return this._changes.length>0}_createMarkerForTrackedNode(e,r){const i=e.getAttribute(this.attributes.changeId),o=this._changes.get(i);if(!o)return null;try{const t=JSON.stringify(o),i=e.className;return n("<span>&#8203;</span>").attr("data-flite-wrapper-change",t).attr("data-flite-wrapper-selector",r).attr("data-flite-wrapper-classes",i)}catch(e){return t.logger.error("wrapTrackedNodes",e),null}}getChangeForNode(e,t){if(!e||1!==e.nodeType)return null;const r=e.getAttribute(this.attributes.changeId),i=r&&this.getChangeForId(r);return i?!1===t?i:n.extend({},i):null}wrapTrackedNodes(t,n){const r=this.setIgnoreMutations(!0),i=[];let o,s;for(let r=0;r<t.length;++r)o=t[r],e.utils.dom.matchesSelector(o,n)&&(s=this._createMarkerForTrackedNode(o,n),s&&i.push(s[0])),i.push(o);return this.setIgnoreMutations(r),i}getTrackedNodes(){return this._$element?this._$element.find(this._fliteSelector):n()}countChanges(e){return this._filterChanges(e).count}acceptAll(e){return this._acceptRejectSome(e,!0)}rejectAll(e){return t.flitePluginUtils.demoNotice()}acceptChange(e){return this._acceptOrRejectChange(e,!0)}rejectChange(e){return this._acceptOrRejectChange(e,!1)}getChanges(e){const t=e?this._filterChanges(e):{count:this._changes.length,changes:this._changes.asObject};return n.extend(!0,{},t)}getChangeForId(e){const t=this._changes.get(e);return t?n.extend({},t):null}navigateToChangeNode(t){const n=this.getSelectedNode();if(!n)return null;const r=this._getNodeTrackingContext(n).trackingNode||n,i=this.getTrackedNodes().toArray(),o=i.length;if(o<1)return null;let s=null;switch(i.sort(e.utils.dom.compareNodePosition),t){case"next":for(let t=0;r&&!s&&t<o;++t)e.utils.dom.isDescendantOf(r,i[t])||-1!==e.utils.dom.compareNodePosition(r,i[t])||(s=i[t]);break;case"prev":for(let t=o-1;r&&!s&&t>=0;--t)e.utils.dom.isDescendantOf(r,i[t])||-1!==e.utils.dom.compareNodePosition(i[t],r)||(s=i[t]);break;case"first":s=i[0];break;case"last":s=i[o-1]}return s&&this._selection.setStart(s,!0,0),s}preserveWhiteSpace(r){return n(r).find(this._fliteTextSelector).each((n,r)=>{e.utils.dom.forAllTextChildren(r,t.domUtils.preserveWhiteSpaces)}),r}getTrackingRecord(e,n){let r,i=null,o="";if(n.idOnly){const n=(e.attr(t.flitePluginUtils.trackerAttributes.fliteRecordId)||"").split(":");3===n.length&&(i=this.getChangeForId(n[0]),r=n[1],o=n[2])}else{const r=e.attr(t.flitePluginUtils.trackerAttributes.changeId);i=this.getChangeForId(r),o=n.parentSelector}return i?{change:i,changeType:e.hasClass(this._insertClassName)?"insertType":"deleteType",trackedNodeSelector:o}:null}clearTrackingRecords(e){let r;"string"==typeof e?(r=this._env.document.createElement("div"),r.innerHTML=e):r=e;const i=t.flitePluginUtils.trackerAttributes.fliteRecord;return n(r).find(`[${i}]`).each((e,t)=>{t.removeAttribute(i)}),r}markNodes(r,i){if(!(null==r?void 0:r.length))return[];const o=[],s=[],a=[];try{for(let i of r){const r=i;if(1===r.nodeType){if(o.indexOf(r)<0){o.push(r);const t=e.utils.getUniqueId("tm-"),i=n(`<span data-flite-marker-id="${t}" style="display:none"></span>`);s.push(i),r.setAttribute("data-flite-marker-target",t),a.push(t),i.insertBefore(r)}}else t.logger.warn("Cannot mark text nodes for deletion")}}catch(e){t.logger.error(e)}finally{-1!==i&&(i=Math.max(i||1,1),this._env.window.setTimeout(()=>{t.logger.debug("mark nodes cleanup callback"),s.forEach(e=>{try{e.remove()}catch(e){t.logger.error("marker cleanup: "+e)}})},i))}return a.length?a:[]}_markupInsertedNodes(e,n){const r=this._startBatchChange(),i=[];let o=!0;try{const t=null==n?void 0:n.startContainer,a=t&&this._getNodeTrackingContext(t);(null==a?void 0:a.isTracking)&&this._moveCaretOutOfTracking(n,a,!1);const l={changeId:void 0,containerOnly:!1,trackChildren:s.DONT_TRACK,type:"insertType"};for(let t=0,n=e.length;t<n;++t){const n=e[t],r=3===n.nodeType;l.changeId=null,l.containerOnly=!r,l.trackChildren=A.shouldTrackChildren(n),r&&this._removeTextNodeFromTrackingContext(n),i.push(this._createTrackedNode(n,l)),"TABLE"===n.nodeName&&(o=!1)}}catch(e){t.logger.error("_markupInsertedNodes: ",e)}finally{this._endBatchChange(r),o||(this._lastChange=null)}return i}get opaqueTester(){return this._opaqueTester||(this._opaqueTester=e=>this._isOpaqueNode(e))}_removeTextNodeFromTrackingContext(t){const r=this._getNodeTrackingContext(t);if(!r.tracksContent)return t;const i=r.trackingNode;if(t===i.firstChild&&i.parentNode)i.parentNode.insertBefore(t,i);else if(t===i.lastChild)e.utils.dom.insertAfter(t,i);else{this._splitNode(i,t,0);const e=this._splitNode(i,t.nextSibling,0);this._replaceNodeWithContent(n(e))}return t}_moveCaretOutOfTracking(e,n,r){if(!(null==e?void 0:e.collapsed)||!n.tracksContent)return e;const i=this.setIgnoreMutations(!0),o=n.trackingNode;try{const t=(e=e.cloneRange()).startContainer,n=e.startOffset,s=1===t.nodeType?o:t,a=this._splitNode(o,s,e.startOffset),l=a!==o||0==n,c="string"==typeof r,d=c?r:r?"\ufeff":"";if(d){const t=this._env.document.createTextNode(d);o.parentNode.insertBefore(t,l?o:o.nextSibling),c?(e.setEnd(t,t.length),e.collapse(!1)):e.selectNode(t),this._selection.addRange(e)}else this._selection.collapseAt(o,l)}catch(e){t.logger.error("move caret out of tracking: "+e)}finally{this.setIgnoreMutations(i)}return e}_cleanBody(e,t,r,i,o){const s=e.find(t),a=Boolean(o.removeDeleted),l=e=>!!e.is(r)&&(e.is(".flite-container-only")?this._replaceNodeWithContent(e):e.remove(),!0);return n.each(s,(e,t)=>{const r=n(t);!i||r.is(i)?a&&l(r)||this._replaceNodeWithContent(r):this.removeFLITETracking(t)}),e.find("span[data-flite-wrapper-change]").remove(),e}_acceptRejectSome(e,n){this._editTransaction.lock(),this._markInlines();try{const t=e=>{this._processChange({node:e,allChanges:!1,strict:!0,isAccept:n,notify:!1})};let r,i,o=this.getChanges(e);const s=this._$element;for(r in o.changes){const e=this.getNodesForChange(r);i=A.sortNodesByAncestry(e),i.forEach(t),this._changes.removeById(r)}this._removeFLITEArtifacts(!0,s),this._editTransaction.finish()}catch(e){t.logger.error("FLITE acceptReject",e)}finally{this._cleanupInlines(),this._editTransaction.unlockAndFinish()}}_createTrackedNode(e,n){let r=e,i=!0,o=n.trackChildren,a=n.containerOnly;const l=this.getWrappingTagName(e);if(l){const e=this._env.document.createElement(l);if(r){const t=r.parentNode;t&&t.insertBefore(e,r),e.appendChild(r)}e.setAttribute(this.attributes.fliteCreated,"1"),e.setAttribute(t.flitePluginUtils.trackerAttributes.spellcheck,"false"),a=this._isOpaqueNode(r),i=!1,o=s.DONT_TRACK,r=e}else(null==e?void 0:e.ownerDocument)===this._env.document&&this._editTransaction.textChanged(),r=e;return this._useChange({type:n.type,node:r,changeId:n.changeId,containerOnly:a,filterNodes:i,ignoredNodes:n.ignoredNodes,trackChildren:o}),r}_startTracking(e){return this._loadEditor(e),this.setIgnoreMutations(!1),this._compositionState=this.host.getIMECompositionState(),this}_stopTracking(){try{this._timeoutClient.stopAll(),this._domObserver&&(this._domObserver.disconnect(),this._domObserver=null),n(this._env.document).off(".flite"),this._mutationSummary&&(this._mutationSummary.disconnect(),this._mutationSummary=null),this._resetBackgroundColors()}catch(e){t.logger.error(e,"While trying to stop tracking")}return this}_filterChanges(e){let t=0,r={},i=e||{},o=i.filter,s=i.exclude?n.map(i.exclude,String):null,a=i.include?n.map(i.include,String):null,l=i.verify,c=null;for(let e of this._changes.items){let n=o&&!o({userid:e.userid,time:e.time,data:e.data})||s&&s.indexOf(e.userid)>=0||a&&a.indexOf(e.userid)<0;n||(l&&(c=this.getNodesForChange(e.id),n=!c.length),n||(++t,r[e.id]=e))}return{count:t,changes:r}}_cleanupLINode(e){if("LI"!==e[0].nodeName)return;const r=[];e.children("br").each((function(e,i){if(i.previousSibling&&!i.nextSibling)r.push(i);else if(i.nextSibling&&!i.previousSibling)r.push(i);else if(n(i.nextSibling).is("br[data-mce-bogus]"))r.push(i.nextSibling);else if(i.nextSibling){"block"===t.domUtils.getComputedStyle(i.nextSibling,"display")&&r.push(i)}})),n(r).remove()}_acceptOrRejectChange(n,r){this._markInlines();if(!("string"==typeof n?this.getNodesForChange(n)[0]:n))return e.logger.warn("accept/reject change: no node found for "+n),!1;this._editTransaction.lock();try{return t.flitePluginUtils.demoNotice()}catch(e){return t.logger.error(e),!1}finally{this._cleanupInlines(),this._editTransaction.unlockAndFinish()}}_processChange(r){const{allChanges:i}=r;let o=r.node;const s=t.domUtils;let a,l,c,d,u,h=this._getCurrentRange(!0);const f=this._$element,g=h&&h.cloneRange(),p=this._deleteSelector,m=this._insertSelector,v=this._deleteClassName,y=this._insertClassName,C=r.isAccept,_=t.createDOMMarker(this._env,h),N=!1!==r.notify;try{if(!o){if(!g||!g.collapsed)return!1;o=g.startContainer}if(a=p,l=m,c=s.getNode(o,this._fliteSelector,r.strict?void 0:f[0]),!c)return!1;const t=c.getAttribute(this.attributes.changeId),h=i?f.find(`${a}[${this.attributes.changeId}='${t}']`):e.utils.dom.matchesSelector(o,a)?n(o):n(null);d=h.length,h.each((e,t)=>{if(!(null==t?void 0:t.parentNode))return;this._editTransaction.textChanged().trackerChanged();const r=n(t);if(this._cleanupLINode(r),this.host.onTrackingNodeRemoved(t),r.hasClass("flite-container-only")&&!this._isOpaqueNode(t))this._acceptDeletedParagraph(r)||this._replaceNodeWithContent(r);else{const e=this.host.getRelatedNodes("reject",t);this._removeNode(t),e.forEach(e=>this._removeNode(e))}});const b=i?f.find(`${l}[${this.attributes.changeId}='${t}']`):e.utils.dom.matchesSelector(o,l)?n(o):n(null);d+=b.length,n.each(b,(r,i)=>{if(!i.parentNode)return;const o=n(i);this._editTransaction.textChanged().trackerChanged(),this._cleanupLINode(o),this.host.onTrackingNodeRemoved(i),u=o.contents(),o.removeClass(y).removeClass(v),this._restoreNodeTitle(i),i.getAttribute(this.attributes.fliteCreated)?this._replaceNodeWithContent(o):(this.removeFLITETracking(i),C&&this._processImplicitAccept(i,t)),n.each(u,(t,n)=>{e.utils.dom.normalizeNode(n.parentNode)})}),i&&this._changes.removeById(t),N&&this._editTransaction.finish()}finally{return _.selectAndRemove(),r.notify&&this._editTransaction.finish(),d>0}}_processImplicitAccept(r,i){if(!e.utils.dom.matchesSelector(r,"td,th"))return;const o=n(r).closest("table"),s=o.attr(t.flitePluginUtils.trackerAttributes.changeId);s&&s!==i&&(this.removeFLITETracking(o[0]),this._monitorChangeId(s))}_acceptDeletedParagraph(e){const t=e[0],r=t&&t.nodeName;if(!r||!(r in g))return!1;const i=t.previousSibling;if(i&&i.nodeName in g){const t=e.contents();return n(i).append(t).find("BR ~ BR").remove(),this._preserveBookmarks(e).remove(),!0}return!1}_preserveBookmarks(t){const n=e.utils.dom.toJQuery(t),r=n.find(".flite-bookmark");return n.before(r),n}_getTrackedNodeClass(e){return this._params.changeTypes[e].className}_getOppositeTChangeType(e){return"deleteType"===e?"insertType":"deleteType"}_setEnvFromRoot(e){var t,n;const r={element:e||null,document:null==e?void 0:e.ownerDocument,window:null,frame:null};return r.window=(null===(t=r.document)||void 0===t?void 0:t.defaultView)||window.self,r.frame=null===(n=r.window)||void 0===n?void 0:n.frameElement,Object.assign(this._env,r),this._env}_loadEditor(e){if(t.logger.debug("FLITE Tracker loading environment for root element"),!d&&this.isOwnRoot(e))return this._loadFromDom();this._forAllUsers(e=>{e.styleLoader&&(e.styleLoader.dispose(),e.styleLoader=null)}),this._$element=n(e),this._$element.data("FLITE::rootid"),String(++this._rootId),this._setEnvFromRoot(e),this._lastChange=null,this._selection&&this._selection.dispose(),this._selection=new t.Selection(this._env),this._selection.setHook(this._onRangeChanged.bind(this)),this._loadFromDom(),this._reloadUserStyles(),this._createNodeSelectionSchemes()}_createNodeSelectionSchemes(){const r={nodeFilter:this._isDeletableCallback,visitFilter:e=>!this._isOpaqueNodeOrParent(e),depthFirst:!0},i=e=>this.host.isEditorArtifact(e),o=e=>1===(null==e?void 0:e.nodeType)&&t.domUtils.isTableElement(e),s=t=>1===t.nodeType&&(e.utils.dom.matchesSelector(t,"IMG,BR,INPUT,BUTTON")||this._isOpaqueNode(t)),a=e=>3===e.nodeType||t.domUtils.isBlockElement(e)&&t.domUtils.isTextContainer(e)||s(e),l=e=>3===e.nodeType||s(e),c={stopFilter:o,nodeFilter:a,skipFilter:i},d={stopFilter:o,nodeFilter:a,skipFilter:i},u={stopFilter:o,nodeFilter:l,skipFilter:i},h={nodeFilter:l,stopFilter:o,skipFilter:i},f=n.extend({},r,{excludeSelf:!1,queryParent:!1}),g=n.extend({},r,{queryParent:!1,excludeSelf:!0});return{rightNeighborForDelete:c,leftNeighborForDelete:d,rightNeighborForSelect:h,withSelfNoParent:f,noSelfNoParent:g,noFilterNoSelf:n.extend(!0,{},r,{queryParent:!0,excludeSelf:!0,nodeFilter:null}),noFilterWithSelf:n.extend(!0,{},r,{queryParent:!0,excludeSelf:!1,nodeFilter:null}),noSelfNoParentNoBR:n.extend({},g,{nodeFilter:e=>!(!e||"BR"===e.nodeName)&&this._isDeletableCallback(e)}),leftNeighborForSelect:u}}_reloadUserStyles(){this._timeoutClient.createTimer("style",{callback:()=>{this._forAllUsers(e=>{const t=this.host.users.getUser(e.userId);t&&this.setUserStyle(e.userId,t.style)})},timeoutMSecs:10}).start()}_loadFromDom(){t.logger.debug("FLITE Tracker loading changes from DOM");this.hasChanges()&&this._editTransaction.trackerChanged(),this._changes.clear();const e=Date.now();this.getTrackedNodes().each((n,r)=>{const i=r.getAttribute(this.attributes.userId),o=r.getAttribute(this.attributes.changeId)||r.getAttribute("data-cid")||"";if(!o||isNaN(Number(o))||!i)return this.removeFLITETracking(r),void t.logger.error("missing change id or user id in tracked node");r.removeAttribute("data-cid"),r.setAttribute(this.attributes.changeId,o);let s=this.host.users.getUser(i);s?r.setAttribute(this.attributes.userName,s.name):s=this.host.users.addUser({id:i,name:r.getAttribute(this.attributes.userName)}),r.setAttribute(this.attributes.changeId,String(o));let a=parseInt(r.getAttribute(this.attributes.time)||"");isNaN(a)&&(a=e);let l=parseInt(r.getAttribute(this.attributes.lastTime)||"");isNaN(l)&&(l=a);const c=r.getAttribute(this.attributes.sessionId),d=r.getAttribute(this.attributes.changeData)||"";this._changes.addItem({item:{id:o,userid:i,username:s.name,time:a,lastTime:l,sessionId:c,data:d},replace:!0}),this._editTransaction.trackerChanged(),this._finalizeTrackedNode(r)}),this.preserveWhiteSpace(this._env.element),this._restoreEncodedChanges(),this._editTransaction.finish()}_restoreEncodedChanges(){const e=t.flitePluginUtils.trackerAttributes.fliteRecord;this._$element.find(`[${e}]`).each((r,i)=>{var o;const s=n(i),a=(s.attr(e)||"").replace(/&quote;/g,'"');if(s.attr(e,null),a)try{const e=JSON.parse(a),n=null===(o=null==e?void 0:e.change)||void 0===o?void 0:o.id;if(!n||!e.trackedNodeSelector)return void t.logger.warn("bad tracking record "+a);const r=s.parents(e.trackedNodeSelector).eq(0);r.length&&(this._changes.hasId(n)||this._changes.addItem({item:e.change}),this._addNodeToChange(n,r[0],e.changeType))}catch(e){t.logger.error("while restoring encoded changes: "+e)}})}_finalizeTrackedNode(e){1===(null==e?void 0:e.nodeType)&&this.host.onTrackingNodeCreated(e)}getNewChangeId(){let e;do{e=String(++this._uniqueIDIndex)}while(this._changes.hasId(e));return e}_useChange(e){let n=e.changeId||this._batchChangeId,r=this._changes.get(n)||this._getCurrentChange();r||(r=this._createChange(n),this._changes.addItem({item:r}),this._lastChange=r,this._editTransaction.trackerChanged()),n=r.id,this._updateChangeTime(r);const i=e.node;if(1!==(null==i?void 0:i.nodeType)||i===this.rootElement)return r;const o=Boolean(i.getAttribute(t.flitePluginUtils.trackerAttributes.fliteCreated)),a=e.filterNodes&&!o?this._params.nodeClassifier.classifyNode(i,this.rootElement,!0,!1):t.NodeClassifier.NODE_AND_CONTENT,l=a===t.NodeClassifier.NODE_ONLY,c=!(!l&&!o&&(this.host.isPassThroughNode(i)||t.domUtils.isInlineElement(i)))&&(a===t.NodeClassifier.NODE_AND_CONTENT||a===t.NodeClassifier.NODE_ONLY);if(a===t.NodeClassifier.IGNORE)return r;if(c&&this._addNodeToChange(n,i,e.type),(e.containerOnly||l)&&(c&&i.classList.add("flite-container-only"),e.trackChildren!==s.DONT_TRACK&&i.childNodes.length&&!l)){const n=i,o=Array.from(n.childNodes),a=e.ignoredNodes;let l,c;const d=e.trackChildren===s.TRACK_TEXT;for(let n=0,i=o.length;n<i;++n){if(l=o[n],a&&a.indexOf(l)>=0)return r;if(d&&3!==l.nodeType)return r;c=this._params.nodeClassifier.classifyNode(l,this.rootElement,!0,!0),c!==t.NodeClassifier.IGNORE&&this._createTrackedNode(l,{type:e.type,changeId:r.id,ignoredNodes:a,containerOnly:3!==l.nodeType,trackChildren:e.trackChildren})}}return r}_createChange(e){const t=this.getCurrentUser();return{id:e,time:0,lastTime:0,sessionId:this.sessionId,userid:t.id,username:t.name,data:this.changeData||""}}_getCurrentChange(e){let t,n=this._lastChange;if(n&&!this._changes.hasId(n.id)&&(n=null),n)if(e)e.changeId===n.id&&e.isCurrent||(n=null);else if(t=this.host.users.getCurrentUser(!1))if(n.userid===t.id&&this._isCurrentSession(n.sessionId)){const e=this._params.timezoneOffset||0;Date.now()+e-n.lastTime>this._params.changeGroupTime&&(n=null)}else n=null;else n=null;return this._lastChange=n}_addNodeToChange(e,t,r){let i=this.getChangeForId(e);const o=this.attributes,s=n(t),a=this._getTrackedNodeClass(r),l=this._getTrackedNodeClass(this._getOppositeTChangeType(r));i||(this._changes.addItem({item:i=this._createChange(e)}),this._editTransaction.trackerChanged(),this._updateChangeTime(i));const c={[o.changeId]:e,[o.userName]:i.username,[o.userId]:i.userid||"0",[o.changeData]:String(i.data||""),[o.time]:i.time,[o.lastTime]:i.lastTime,[o.sessionId]:i.sessionId||null};s.attr(c).addClass(a).removeClass(l),this.host.onTrackingNodeCreated(t)}_isCurrentSessionNode(e){const t=this.getChangeForNode(e,!1);return Boolean(t&&t.sessionId==this.sessionId)}_updateChangeTime(e){const t=this.getNodesForChange(e.id),n=this.attributes.lastTime,r=this._params.timezoneOffset||0,i=Date.now()+r;e.lastTime=i,e.time||(e.time=i),t.each((e,t)=>{t.setAttribute(n,String(i))})}_getCurrentRange(e=!1){let n=null,r=!1;try{if(e||!this._selection){r=!0;const e=this.host.getHostNativeRange();n=e&&new t.rangy.WrappedRange(e.cloneRange())}if(n=null!=n?n:this._selection.getRangeAt(0),!n&&!r)return this._getCurrentRange(!0);const i=this.rootElement;return n&&t.domUtils.isRangeInElement(n,i)||(n=this._selection.createRange(),n.setStartAndEnd(i,0,i,0)),n}catch(e){return t.logger.error(e,"While trying to get current range"),n}}_deleteContents(e,n,r){let o=!0;if(!(n=this.host.beforeDelete(n||this._getCurrentRange(!0))))return!1;this._selection.addRange(n);const s=this._startBatchChange();n=this._cleanupSelection(n);try{n.collapsed?o=e===i.End?this._deleteForward(n):this._deleteBack(n):this._deleteSelection(n,{restoreSelection:e,preserveContainers:r})}catch(e){t.logger.error(e)}finally{this._endBatchChange(s)}return o}_deleteSelection(e,n){const r=t.createDOMMarker(this._env,e),o=r.getNodesInRange(),s=this._startBatchChange();let a;try{for(let e=0;e<o.length;e++)a=o[e],this._editTransaction.textChanged(),this._markNodeAsDeleted(this.host.findTargetNode(a),s.id,!0)}catch(e){t.logger.error(e)}finally{switch(n.restoreSelection){case i.All:this._selection.addRange(r.selectAndRemove());break;case i.End:case i.Start:this._selection.addRange(r.collapseAndRemove(n.restoreSelection===i.Start));break;default:r.remove()}n.preserveContainers||this._removeFLITEArtifacts(!1,this._$element),this._endBatchChange(s)}}_copyToClipboard(e){const r=e.cloneContents(),i=n("<div></div>").append(r)[0],o=this.getCleanDOM(i,{removeDeleted:"raw"!==this._params.copyBehavior}),s=new Blob([o.innerHTML],{type:"text/html"}),a=new Blob([t.domUtils.domToString(o)],{type:"text/plain"});return navigator.clipboard.write([new ClipboardItem({[s.type]:s,[a.type]:a})]).catch(e=>t.logger.warn("write to clipboard error "+e)),!0}_markNodeAsDeleted(e,t,r){if(!e||!e.parentNode||this._shouldIgnoreNode(e,!0))return null;const i=this._getNodeTrackingContext(e),o=3===e.nodeType,s=!o&&this._isOpaqueNode(e),a=i.trackingNode===e,l=a?n(e).hasClass("flite-container-only"):!o&&!s,c={changeId:t,containerOnly:l,trackingContext:i,trackContent:!1};if(!i.isTracking||!i.tracksContent&&!a){const t=this._addDeleteTracking(e,c),n=this.host.getRelatedNodes("delete",e);if(n.length){const e=Object.assign(Object.assign({},c),{containerOnly:!0});n.forEach(t=>this._addDeleteTracking(t,e))}return t}if(i.isDelete)return null;if(i.isCurrent)return r&&this._removeNode(e,i),null;let d;if(o){const t=e.length;this._splitNode(i.trackingNode,e,0);d=this._splitNode(i.trackingNode,e,t)}else d=i.trackingNode;return this._addNodeToChange(t,d,"deleteType"),this.host.getRelatedNodes("delete",d).forEach(e=>this._addNodeToChange(t,e,"deleteType")),d}_startBatchChange(e){let t=!this._batchChangeId;if(t){const t=this._getCurrentChange(e);this._batchChangeId=(null==t?void 0:t.id)||this.getNewChangeId()}else e&&e.changeId!==this._batchChangeId&&(this._batchChangeId=this.getNewChangeId(),t=!0);return{id:this._batchChangeId,top:t}}_endBatchChange(e){(null==e?void 0:e.id)===this._batchChangeId&&e.top&&(this._batchChangeId=null,this._editTransaction.finish())}_removeNode(e,t=null){(null==e?void 0:e.parentNode)&&(t=t||this._getNodeTrackingContext(e),this._preserveBookmarks(e).remove(),t.isTracking&&this._monitorChangeId(t.changeId))}_cleanupSelection(r){const i=this.setIgnoreMutations(!0);let o=null;try{if(r.collapsed){const e=(r=A.removeSpellCheckingFromRange(r,this.rootElement)).commonAncestorContainer,n=3===e.nodeType?e.parentNode:e,i=A.collectEmptyTextChildren(n);if(i.length){const e=t.createDOMMarker(this._env,r);i.forEach(e=>e.parentNode.removeChild(e)),r=e.collapseAndRemove(!0)}}else{o=t.createDOMMarker(this._env,r);const i=this.rootElement;o.getNodesInRange((e,t)=>3===e.nodeType).forEach(t=>{A.tryToRemoveSpellcheckerNode(t,i),e.utils.dom.isEmptyTextNode(t)&&n(t).remove()});o.getNodesInRange((e,t)=>A.isSpellcheckerNode(e)).forEach(e=>A.removeSpellcheckerNode(e)),r=o.selectAndRemove()}}catch(e){t.logger.error("cleanupSelection",e)}finally{this._selection.addRange(r),this.setIgnoreMutations(i),null==o||o.remove()}return r}_ignoreKeyboardDelete(e){if(!e||!e.node)return!0;let r=!1;const i=this._params.nodeClassifier.classifyNode(e.node,this.rootElement,!0,!0);if(i===t.NodeClassifier.NODE_ONLY)return!1;if((i!==t.NodeClassifier.NODE_AND_CONTENT||this.host.shouldIgnoreDeletedNode(e.node))&&(r=!0),r&&e.isText){r=!n(e.node.parentNode).closest(".scayt-misspell-word,span.mce-spellchecker-word").length}return r}_deleteForward(t){const n=this._findNextNodeToDelete(t)||{};if(!n.node||n.node.nodeName in f)return!1;if(!e.utils.dom.isContentEditable(n.node,this.rootElement,!0))return!1;t.equals(n.range)||this._selection.addRange(t=n.range);const r="LI"===n.tagName&&n.node;if(r){const e=this._getNodeTrackingContext(r);return(!e.isInsert||!e.isCurrent)&&(e.isDelete?(this._collapseAfter(r,!0),!0):(this._addDeleteTracking(r,{move:c.None,containerOnly:!0,changeId:null}),this._selection.setStart(r,!0,0),!0))}if("BR"===n.tagName)return!1;if(this._ignoreKeyboardDelete(n))return!1;const i=this._getNodeAtCaret({range:t,lookBack:!0,forDelete:!0}),o=this._getNodeTrackingContext(i.node),s=this._getNodeTrackingContext(n.node),a=o.trackingNode&&o.trackingNode===s.trackingNode?this._getNodeTrackingContext(null):o;return n.isText?a.isTracking||s.isTracking?a.isTracking&&!s.isTracking?a.isDelete&&a.isCurrent?this._assimilateNextChar(a,null,i,n):this._deleteForwardUntrackedContext(n):a.isTracking&&s.isTracking?s.isDelete?(this._collapseAfter(s.trackingNode,!1),!0):s.isCurrent?(n.isText||this.ignoreNextMutation("Delete forward in insert"),this._monitorChangeId(s.changeId),!1):a.isDelete&&a.isCurrent?this._assimilateNextChar(a,s,i,n):this._deleteForwardUntrackedContext(n,s):s.isInsert?s.isCurrent?this._removeInsertedCharacter(n,s,t,c.None):this._deleteForwardUntrackedContext(n,s):(this._collapseAfter(s.trackingNode,!1),!0):this._deleteForwardUntrackedContext(n):s.isDelete?(this._collapseAfter(s.trackingNode,!0),!0):s.isCurrent?(this._monitorChangeId(s.changeId),!1):this._deleteForwardUntrackedContext(n,a)}_deleteBack(t){const n=this._findPreviousNodeToDelete(t)||{};if(!n.node||n.node.nodeName in f)return!1;if(!e.utils.dom.isContentEditable(n.node,this.rootElement,!0))return!1;if(t.equals(n.range)||this._selection.addRange(t=n.range),"BR"===n.tagName)return!1;if(this._ignoreKeyboardDelete(n))return!1;if("LI"===n.tagName){const e=this._getNodeTrackingContext(n.node);return(!e.isInsert||!e.isCurrent)&&(e.isDelete||this._addDeleteTracking(n.node,{move:c.None,containerOnly:!0,trackContent:!1}),this._collapseBefore(e.trackingNode),!0)}const r=this._getNodeAtCaret({range:t,lookBack:!1,forDelete:!0}),i=this._getNodeTrackingContext(r.node),o=n.node===r.node?i:this._getNodeTrackingContext(n.node),s=o.trackingNode&&o.trackingNode===i.trackingNode?this._getNodeTrackingContext(null):i;return n.isText?s.tracksContent||o.tracksContent?s.tracksContent&&!o.tracksContent?s.isDelete&&s.isCurrent?this._assimilatePrevChar(s,null,r,n):this._deleteBackUntrackedContext(n):s.tracksContent&&o.tracksContent?o.isDelete?(this._selection.setStartBefore(o.trackingNode,!0),!0):o.isCurrent?(n.isText||this.ignoreNextMutation("Delete back in insert"),this._monitorChangeId(o.changeId),!1):s.isDelete&&s.isCurrent?this._assimilatePrevChar(s,o,r,n):this._deleteBackUntrackedContext(n,o):o.isInsert?o.isCurrent?this._removeInsertedCharacter(n,o,t,c.Left):this._deleteBackUntrackedContext(n,o):(this._collapseBefore(o.trackingNode),!0):this._deleteBackUntrackedContext(n):o.isDelete?(this._collapseBefore(o.trackingNode),!0):o.isCurrent?(this._monitorChangeId(o.changeId),!1):this._deleteBackUntrackedContext(n,s)}_removeInsertedCharacter(e,t,n,r){if(this._monitorChangeId(t.changeId),!e.isText||e.offset>0)return!1;const i=e.node,o=t.trackingNode,s=e.offset;if(1===i.length&&1===o.childNodes.length)return r===c.Left?this._collapseBefore(o):this._collapseAfter(o,!1),this._removeNode(o),this._editTransaction.textChanged(),!0;const a=i.data[s];if(!/\s/.test(a))return!1;this._editTransaction.textChanged();const l=this._selection.getBookmark(this.host.getCaretSelectors(),n);let d=!1;return 1===i.length?(d=l.start>1&&!t.trackingNode.previousSibling,this._removeNode(i,t)):i.data=i.data.slice(1),this._selection.gotoBookmark(l,r===c.Left?{move:"left",after:d}:{after:d}),!0}_assimilatePrevInline(n,r){const i=n.node;if(3!==i.nodeType)return!1;const o=t.domUtils.findInlineParent(n.node,t=>!e.utils.dom.matchesSelector(t,this._fliteSelector));if(t.domUtils.findInlineParent(r.trackingNode)===o)return!1;try{const e=t.rangy.dom.splitDataNode(i,n.offset);return this._addDeleteTracking(e,{changeId:r.changeId}),this._selection.setStart(e,!0,0),!0}catch(e){return t.logger.error(e),!1}}_assimilateNextInline(n,r){const i=n.node;if(3!==i.nodeType)return!1;const o=t.domUtils.findInlineParent(n.node,t=>!e.utils.dom.matchesSelector(t,this._fliteSelector));if(t.domUtils.findInlineParent(r.trackingNode)===o)return!1;try{const e=t.rangy.dom.splitDataNode(i,n.offset+1);return this._addDeleteTracking(i,{changeId:r.changeId}),this._selection.setStart(e,!0,0),!0}catch(e){return t.logger.error(e),!1}}_assimilatePrevChar(r,i,o,s){this._editTransaction.textChanged();const a=s.isText&&s.node.data;if(r.tracksContent&&a){if(this._assimilatePrevInline(s,r))return!0;if(r.trackingNode.textContent=a[s.offset]+r.trackingNode.textContent,s.node.textContent=a.substring(0,a.length-1),this._selection.setStart(r.trackingNode.firstChild,!0,0),e.utils.dom.isEmptyTextNode(s.node))if(null==i?void 0:i.tracksContent)this._removeFLITEArtifacts(!0,this._$element);else{const e=n(s.node.parentNode);e.is(":empty")&&t.domUtils.isInlineElement(s.node.parentNode)&&e.remove()}return!0}if(s.isText){let a=s.node,l=o.offset,d=o.node,u=d&&t.domUtils.splitTextAt(a,s.offset,1,!0);if(!u)return!1;const h=this._isNextTextSibling(u,d)&&t.domUtils.getFirstSelectableChild(d);if(h){const e=l>0?l-1:0;h.data=h.data.substr(0,e)+u.data+h.data.substr(e),this._removeNode(u),this._selection.setStart(h,!0,l)}else{if(e.utils.dom.matchesSelector(d,".flite-container-only")&&i&&i.trackingNode){this._splitNode(i.trackingNode,u,0);const e=n(i.trackingNode);if(u=t.domUtils.getFirstSelectableChild(i.trackingNode,{root:this.rootElement,allowEmptyText:!1}),!u)return!1;this._replaceNodeWithContent(e)}this._addDeleteTracking(u,{move:c.Left,containerOnly:!0,changeId:r.changeId});const o=i&&i.trackingNode,s=o&&this._getNodeTrackingContext(u);(null==o?void 0:o.parentNode)&&s&&s.trackingNode&&s.trackingNode.parentNode.insertBefore(o,s.trackingNode),this._selection.setStart(u,!0,0)}}else this._addDeleteTracking(s.node,{move:c.Left,containerOnly:!0}),this._collapseBefore(s.node);return!0}_assimilateNextChar(r,i,o,s){this._editTransaction.textChanged();const a=s.node;if(1===a.nodeType)return this._markElementAsDeleted(a,r.changeId),this._collapseAfter(a,!0),!0;if(r.tracksContent){if(this._assimilateNextInline(s,r))return!0;const o=a.data;if(r.trackingNode.textContent=r.trackingNode.textContent+o[s.offset],a.textContent=o.substring(0,s.offset)+o.substring(s.offset+1),this._selection.setStart(r.trackingNode.firstChild,!0,r.trackingNode.firstChild.length),e.utils.dom.isEmptyTextNode(a))if(null==i?void 0:i.tracksContent)this._removeFLITEArtifacts(!0,this._$element);else{const e=n(a.parentNode);e.is(":empty")&&t.domUtils.isInlineElement(a.parentNode)&&e.remove()}return!0}const l=s.node,d=o.node;let u=t.domUtils.splitTextAt(l,s.offset,1,!0);if(!u)return!1;const h=this._isPrevTextSibling(u,d)&&t.domUtils.getLastSelectableChild(d);if(h)h.data+=u.data,this._removeNode(u),this._selection.setEnd(h,!0,h.length);else{if(e.utils.dom.matchesSelector(d,".flite-container-only")){if(i&&i.trackingNode){const e=this._splitNode(i.trackingNode,u,1),r=n(e);if(u=t.domUtils.getFirstSelectableChild(e,{root:this.rootElement,allowEmptyText:!1}),!u)return!1;this._replaceNodeWithContent(r)}this._addDeleteTracking(u,{move:c.Right,containerOnly:!1})}else{this._addDeleteTracking(u,{move:c.None,containerOnly:!1});const e=i&&i.trackingNode,n=e&&this._getNodeTrackingContext(u);n&&n.trackingNode&&e.parentNode.insertBefore(n.trackingNode,e),e&&t.domUtils.hasNoTextOrStubContent(e)&&this._removeNode(e)}this._selection.setEnd(u,!0,u.length)}return!0}_markElementAsDeleted(e,t){const n={merge:!1,changeId:t,containerOnly:!0,trackContent:!1};this._addDeleteTracking(e,n);const r=this.host.getRelatedNodes("delete",e);for(let e of r)this._addDeleteTracking(e,{merge:!1,changeId:t,containerOnly:!0,trackContent:!1})}_deleteBackUntrackedContext(e,r){if(this._editTransaction.textChanged(),!e.isText)return this._markElementAsDeleted(e.node,null),this._collapseBefore(e.node),!0;let i;if(null==r?void 0:r.tracksContent){const o=this._splitNode(r.trackingNode,e.node,e.offset+1),s=t.domUtils.getLastSelectableChild(o);i=s&&t.domUtils.splitTextAt(s,s.length-1,1,!0),o.parentNode.insertBefore(i,o.nextSibling),t.domUtils.hasNoTextOrStubContent(r.trackingNode)&&n(r.trackingNode).remove()}else i=t.domUtils.splitTextAt(e.node,e.offset,1,!0);return!!i&&(this._addDeleteTracking(i,{move:c.Left,merge:!0}),!0)}_isNextTextSibling(t,n){if(!(t&&t.parentNode&&n&&n.parentNode))return!1;if(3===n.nodeType)return t.nextSibling===n||this._isNextTextSibling(t,n.parentNode);if(A.isSpellcheckerNode(n))return this._isNextTextSibling(t,n.parentNode);if(!e.utils.dom.matchesSelector(n,this._fliteTextSelector))return!1;for(let e=n.firstChild;e;e=e.nextSibling)if(3!==e.nodeType)return!1;if(t.nextSibling)return t.nextSibling===n;const r=A.isSpellcheckerNode(t.parentNode)?t.parentNode.parentNode:t.parentNode;return e.utils.dom.matchesSelector(r,this._fliteTextSelector)&&r.nextSibling===n}_isPrevTextSibling(t,n){if(!(t&&t.parentNode&&n&&n.parentNode))return!1;if(3===n.nodeType)return t.previousSibling===n||this._isPrevTextSibling(t,n.parentNode);if(A.isSpellcheckerNode(n))return this._isPrevTextSibling(t,n.parentNode);if(!e.utils.dom.matchesSelector(n,this._fliteTextSelector))return!1;if(t.previousSibling)return t.previousSibling===n;const r=A.isSpellcheckerNode(t.parentNode)?t.parentNode.parentNode:t.parentNode;return e.utils.dom.matchesSelector(r,this._fliteTextSelector)&&r.previousSibling===n}_deleteForwardUntrackedContext(e,r){if(this._editTransaction.textChanged(),!e.isText)return this._markElementAsDeleted(e.node,null),this._collapseAfter(e.node,!0),!0;let i;if(r){const o=r.trackingNode,s=this._splitNode(o,e.node,e.offset),a=t.domUtils.getFirstSelectableChild(o);i=a&&t.domUtils.splitTextAt(a,0,1,!0),s.parentNode.insertBefore(i,o),t.domUtils.hasNoTextOrStubContent(r.trackingNode)&&n(r.trackingNode).remove()}else i=t.domUtils.splitTextAt(e.node,e.offset,1,!0);return!!i&&(this._addDeleteTracking(i,{move:c.None,merge:!0}),this._selection.setEnd(i,!0,1),!0)}_isNodeOfChangeType(e,t){if(!e)return!1;const r="."+this._getTrackedNodeClass(t);return n(e.$||e).is(r)}_isInsertNode(e){return this._isNodeOfChangeType(e,"insertType")}_isDeleteNode(e){return this._isNodeOfChangeType(e,"deleteType")}_getVoidElement(n){if(!n)return null;const r=n.node,i=!1!==n.checkEmpty;try{if(i&&e.utils.dom.isEmptyTextNode(r))return r;const t=this._getNodeTrackingContext(r);if(t.isDelete)return t.trackingNode}catch(e){return t.logger.error(e,"While trying to get void element of",r),null}}_addDeleteTracking(t,n){if(n=n||{},!t)return null;let r;for(;t.previousSibling&&e.utils.dom.isEmptyTextNode(t.previousSibling);)t.parentNode.removeChild(t.previousSibling);for(;t.nextSibling&&e.utils.dom.isEmptyTextNode(t.nextSibling);)t.parentNode.removeChild(t.nextSibling);const i=n.changeId;return r=this._createTrackedNode(t,{type:"deleteType",changeId:i,containerOnly:n.containerOnly,trackChildren:n.trackContent?A.shouldTrackChildren(t):s.DONT_TRACK}),n.move===c.Right?this._selection.collapseAtEnd(t):n.move===c.Left&&this._selection.collapseAtStart(t),r&&setTimeout(()=>e.utils.dom.normalizeNode(r),0),r}_splitAtCaret(n){if(!n||!n.collapsed)return n;const r=n.startContainer,i=n.cloneRange(),o=n.startOffset;if(3===r.nodeType){const s=r;if(o>=s.length)return n;const a=t.domUtils.splitTextAt(s,o,s.length-o,!0);return i.setStart(a.parentNode,e.utils.dom.getNodeIndex(a)+1),i.collapse(!0),i}{const e=r;if(o>=e.childNodes.length)i.setStartAfter(e),i.collapse(!0);else{const t=this._splitNode(e,e,o);i.setStart(t,0)}return i}}_splitNode(t,n,r){const i=e.utils.dom.splitNode(t,n,r);if(i){this._getNodeTrackingContext(i,!0).isTracking&&this._finalizeTrackedNode(i)}return i}_showTitles(e){const t=this.getTrackedNodes();e?n(t).each((e,t)=>{this._finalizeTrackedNode(t)}):n(t).each((e,t)=>{this._restoreNodeTitle(t)})}_restoreNodeTitle(e){const t=n(e),r=t.attr(this.attributes.fliteTitle);r&&t.attr("title","1"===r?null:r)}get keyboardMapper(){if(void 0!==w)return w;let e=Object.assign({},this._params.spellingOverride||{".data-flite-created":1});const t=this._params.keyboardMap&&this._params.keyboardMap.find&&this._params.keyboardMap.find("mark,edit,toggle,append".split(/[^a-z]/).map(e=>e[0]).join(""));return Object.keys(e).forEach(t=>{/^\./.test(t)&&delete e[t]}),t?(t.toArray().forEach(t=>{if(!t.attributes||!t.attributes.length||!e)return;const n={},r=function(e){if(e){const t=1+e.split("").reduce((function(e,t,n){return(n+1)*t.charCodeAt(!1)+e}),-1);n[t]&&delete n[t]}};Object.keys(e||{}).forEach(t=>n[t]=e[t]),[].slice.apply(t.attributes).forEach(e=>{r(e.nodeValue),r(e.nodeName)}),0===Object.keys(n).length&&(e=void 0)}),w=Boolean(Object.keys(e||{}).length>0)):Object.keys(e).length>0}_keyPress(e,t,n){let r=null;if(e.ctrlKey)return this._prepareForCtrlKeypress(e),!1;if(e.metaKey)return!1;const o=e.keyCode||e.which;switch(o){case 32:return this.insertText({text:"Â ",mode:t,readonlyPolicy:n});case 8:return"full"===t&&this._deleteContents(i.Start,null,!1);case 46:return"full"===t&&this._deleteContents(i.End,null,!1);case 13:return this._handleEnter(t);default:if(A.isIgnoredKeyCode(o))return!1;if(r=e.char||e.key||String.fromCharCode(o),r){const e=this._params.handleInsertText||"insert"===n||d?r:null;return this.insertText({text:e,mode:t,readonlyPolicy:n})}return!1}}_prepareForCtrlKeypress(e){let t=null;switch(e.keyCode||e.which||e.code){case 8:t="del-word-back";break;case 46:t="del-word-forward"}t&&this.setMutationContext(t,{timeout:1})}_handleEnter(n){if(this.host.getIMECompositionState()!==a.None)return!0;if("readonly"===n)return this.prepareForInsertion(),!1;const r=this._cleanupSelection(this._getCurrentRange(!0));if(!r)return!1;if(this.setMutationContext("enter",{timeout:1}),r.collapsed){const n=this._getNodeTrackingContext(r.startContainer),i=this._moveCaretOutOfTracking(r,n,!0),o=t.domUtils.getNode(i.commonAncestorContainer,e=>t.domUtils.isBlockElement(e),this.rootElement);if(o){const t=String(e.utils.dom.getNodeIndex(o));o.setAttribute("data-flite-block-id",t),this._env.window.setTimeout(()=>{var e;null===(e=this._$element)||void 0===e||e.find(`[data-flite-block-id="${t}"]`).attr("data-flite-block-id",null)},5)}}else this._deleteContents(i.End,r,!1);return!1}_handleEditKey(e,t){switch(e.which||e.keyCode){case 120:case 88:if((!0===e.ctrlKey||!0===e.metaKey)&&this._params.handleCut){const e=this.prepareToCut(t);return{handled:e,cancel:e}}break;case 118:case 86:break;case 67:case 99:if(!0===e.ctrlKey||!0===e.metaKey){return{handled:!0,cancel:this.prepareToCopy(t)}}}return{handled:!1,cancel:!1}}_doInsertText(t,r){var i;const o=this._getNodeTrackingContext(r.startContainer,!1),a=r.startContainer,l=this._env.document;let c=!1,d=null;if(o.isInsert&&o.isCurrent){if(o.tracksContent)return{inserted:!1,element:null};const e=o.changeId===(null===(i=this._lastChange)||void 0===i?void 0:i.id)?o.changeId:null;d=this._createTrackedNode(null,{type:"insertType",changeId:e,containerOnly:!1,trackChildren:s.DONT_TRACK}),r.insertNode(d)}else{let t=null,n=null;if(d=this._createTrackedNode(null,{type:"insertType",changeId:null,containerOnly:!1,trackChildren:s.DONT_TRACK}),o.isTracking&&o.tracksContent){const i=e.utils.dom.getNodeLength(a),s=e.utils.dom.getNodeIndex(a);0===r.endOffset?a!==o.trackingNode&&0!==s||(t=o.trackingNode):r.endOffset<i?(this._splitNode(o.trackingNode,a,r.endOffset),t=o.trackingNode):a!==o.trackingNode&&a.nextSibling?(this._splitNode(o.trackingNode,o.trackingNode,s+1),t=o.trackingNode):n=o.trackingNode,r=this._selection.getRangeAt(0)}t?t.parentNode.insertBefore(d,t):n?e.utils.dom.insertAfter(d,n):r.insertNode(d)}if(d&&(n(d).siblings("[data-mce-bogus]").remove(),t)){c=!0;const e=l.createTextNode(t);d.appendChild(e),this._selection.collapseAtEnd(e)}return c||this._prepareSelectionForInsert(d,r),{element:d,inserted:c}}_prepareSelectionForInsert(e,t){this._$element.find("[data-mce-type='format-caret']").each((e,t)=>{this._replaceNodeWithContent(n(t))});const r=e||t.startContainer;if(t.collapsed&&r&&3===r.nodeType&&r.length)return;const i=r.ownerDocument.createTextNode("\ufeff");e?e.appendChild(i):t.insertNode(i);const o=this._selection.createRange();o.setStartAndEnd(i,0,i,1),this._selection.addRange(o)}_handleKeyDown(e,t,n){const r=this._handleEditKey(e,t);return r.handled?r.cancel:this._keyPress(e,t,n)}_moveRangeToValidTrackingPos(n,r=0){if(!n)return null;if(0===r&&e.utils.dom.isEmptyTextNode(n.startContainer))return t.logger.warn("move range to valid position: empty text node"),e.utils.dom.normalizeNode(n.startContainer.parentNode),this._moveRangeToValidTrackingPos(this._getCurrentRange(!0),1);if(this.host.isBogusInsertPosition(n.startContainer))return this._selection.setStartBefore(n.startContainer),this._getCurrentRange();let i,o,s,a,l=null,c=[],d=!1,u=!1;const h=()=>(d&&this._selection.addRange(n),n);for(;!u;){if(o=n.startContainer,!o||c.indexOf(o)>=0)return h();if(c.push(o),i=this._getVoidElement({node:o,checkEmpty:!1}),i){if(i!==o&&c.indexOf(i)>=0)return h();c.push(i)}else u=t.domUtils.isTextContainer(o);if(!u){null===l&&(l=!t.domUtils.isOnRightEdge(n.startContainer,n.startOffset)),s=l?t.domUtils.findPrevTextContainer(i||o,this.rootElement):t.domUtils.findNextTextContainer(i||o,this.rootElement),a=s.node;try{l?n.setStart(a,s.offset):n.setEnd(a,s.offset),n.collapse(l),d=!0}catch(e){t.logger.error(e,"While trying to move range to valid tracking position");break}}}return h()}_restoreAndMarkDeletedNode(t,n,r){if(!t||!n||3===t.nodeType&&e.utils.dom.isEmptyTextNode(t))return!1;r&&r.parentNode!==n&&(r=null);const i=this._isOpaqueNode(t),o=1===t.nodeType&&"SPAN"===t.nodeName;if(!i&&o&&t.firstChild){let n=!0;for(let r=t.firstChild;r&&n;r=r.nextSibling)3===r.nodeType&&e.utils.dom.isEmptyTextNode(r)||(n=!1);if(n)return!1}const s=this._getNodeTrackingContext(t);return(!s.isInsert||!s.isCurrent)&&(e.utils.dom.insertAfter(t,r,n),this._addDeleteTracking(t,{containerOnly:i||!o,trackContent:!i&&!o,trackingContext:s}),!0)}_onMutationSummary(e){var n;const r=this._lastMutationContext.peekType();if(this._unlistenToMutations(),this._ignoreMutations)return void t.logger.debug(`dom mutation type ${r}, ignoring`,e);if(t.logger.debug("dom mutation processing type "+r,e),!this.host.users.getCurrentUser(!1))return void t.logger.warn("Cannot track DOM mutations with no user");if(!this._env.document)return;let i=this._getCurrentRange(!0);const o=this._selection.getBookmark(this.host.getCaretSelectors(),i);this._editTransaction.setIsUpdate().lock();let s=!1,a=this._startBatchChange(),l=[],c=[],d=!0,u=!1;try{const h=this._processSpecialMutation(e);if(h)return s=h.changedDOM,h.restoreCaret||(i=null),void(d=!1!==h.saveChange);for(let t=0,n=e.length;t<n;++t)s=this._processOneMutationSummary(e[t],l)||s}catch(e){t.logger.error("While analyzing mutation summary",e)}finally{u=Boolean(l&&l.length);try{i&&i.collapsed&&(o?this._selection.gotoBookmark(o,{}):t.rangy.dom.isAncestorOf(this.rootElement,i.startContainer,!0)?this._selection.setStart(i.startContainer,!0,i.startOffset):u=!0);const e=this._getCurrentRange(),s=this._getNodeTrackingContext(e.commonAncestorContainer,!1);s.isTracking&&s.changeId===(null===(n=this._lastChange)||void 0===n?void 0:n.id)&&this._monitorCaretInInsertedElement(s),u&&t.trackerUtils.createBackspaceGuard(this.rootElement,e=>{this._cleanupSelection(this._getCurrentRange(!0)),e.backspace?1===c.length?this._selection.setStartBefore(c[0],!0):this._selection.nudgeLeft(null,this._getNodeSelectionScheme("noSelfNoParentNoBR")):e.del?this._selection.nudgeRight(null,this._getNodeSelectionScheme("noSelfNoParentNoBR")):this._selection.normalize(this._getNodeSelectionScheme("withSelfNoParent"),"outdent"===r)})}catch(e){t.logger.error("onMutationSummary: while restoring range "+e)}this._endBatchChange(a),this._editTransaction.unlockAndFinish(),d||(this._lastChange=null)}}_processOneMutationSummary(e,r){let i,o,s,a=!1;const l=this.rootElement&&this.rootElement.ownerDocument;if(!l)return!1;let c=e.added||[];c.forEach(e=>{this._isValidFLITENode(e)||this.removeFLITETracking(e)});const d=this._restoreDeletedHierarchy(e.removed,e);if(c=this._restoreAddedHierarchy(c),this._handleIdenticalChanges(c,d,e))return t.logger.debug("Identical change, ignoring"),!1;const u=e.reparented||[];for(let n=0,c=d.length;n<c;++n)o=d[n],this._shouldRestoreNode(o,e.getOldParentNode(o))&&(t.domUtils.isAncestorAmong(r,o)?r.push(o):(s=e.getOldParentNode(o),s&&s.ownerDocument===l&&this._restoreAndMarkDeletedNode(o,s,e.getOldPreviousSibling(o))&&(a=!0,r.push(o),u.length&&1===o.nodeType&&(i=o.querySelectorAll("*"),i&&i.length&&(r=r.concat([].slice.apply(i)))))));a=this._restoreReparented(e,r)||a,r.forEach(e=>{this._removeHostArtifacts(e),this._cleanupLINode(n(e))});for(let t=0,n=c.length;t<n;++t)a=this._tryToTrackAddedNode(c[t],{nodesToIgnore:e.reparented})||a;return a}_restoreReparented(t,n){let r,i,o=!1;const s=t.reparented&&this._restoreDeletedHierarchy(t.reparented,t)||[];for(let a=0,l=s.length;a<l;++a)r=s[a],i=t.getOldParentNode(r),i&&n.indexOf(i)>=0&&(this._restoreIntoLI(r,i,t.getOldPreviousSibling(r))||e.utils.dom.insertAfter(r,t.getOldPreviousSibling(r),i),o=!0);return o}_handleDeleteMutationWithSelector(t,n){const r=n.selector,i=[];let o=!1;for(let s of t){s.removed.filter(t=>1===t.nodeType&&i.indexOf(t)<0&&e.utils.dom.matchesSelector(t,r)).forEach(e=>{n.cleanup&&n.cleanup(e),i.push(e);const t=s.getOldParentNode(e),r=s.getOldPreviousSibling(e);o=this._restoreAndMarkDeletedNode(e,t,r)||o})}return o}_handleDeleteMutationWithMarkers(n,r){const i=e.utils.strings.toStringArray(r.markers);if(0===i.length)return t.logger.warn("deleted mutation: no element selector"),!1;const o=[];let s=!1;const a=this._$element;for(let e of n){e.removed.filter(e=>1===e.nodeType&&e.getAttribute("data-flite-marker-target")&&o.indexOf(e)<0).forEach(n=>{o.push(n);const r=n.getAttribute("data-flite-marker-target"),l=i.indexOf(r);l<0?t.logger.warn(`handle deleted mutation: marker ${r} not registered`):i.splice(l,1);const c=e.getOldParentNode(n),d=a.find(`span[data-flite-marker-id='${r}']`);d.length?(s=this._restoreAndMarkDeletedNode(n,c,d[0])||s,d.remove()):t.logger.warn(`No marker found for marked node ${n.nodeName} with id ${r}`)})}return s}_handleDeleteMutation(e,n){return n.selector?this._handleDeleteMutationWithSelector(e,n):n.markers?this._handleDeleteMutationWithMarkers(e,n):(t.logger.warn("handle Delete mutation: neither element nor markers found"),!1)}_processFootnoteInsertion(n,r){const i=[];let o=!1;r=r||{noteSelector:void 0,markerSelector:void 0,headerSelector:void 0};for(let e of n)i.push.apply(i,e.added);const s=[];try{i.forEach(t=>{r.markerSelector&&e.utils.dom.matchesSelector(t,r.markerSelector)?(this._markupInsertedNodes([t],null),o=!0,r.callback&&r.callback(t)):(r.noteSelector&&e.utils.dom.matchesSelector(t,r.noteSelector)||r.headerSelector&&e.utils.dom.matchesSelector(t,r.headerSelector))&&s.push(t)});const t=[];return s.forEach(n=>{e.utils.dom.forAllTextChildren(n,e=>{t.push(e)})}),t.length&&this._markupInsertedNodes(t,null),Boolean(s.length)||o}catch(e){return t.logger.error("process footnote insertion",e),!1}}_processSpecialMutation(e){const n={changedDOM:!1,restoreCaret:!1,type:""},r=n.type=this._lastMutationContext.popType(),i=this._lastMutationContext.data;switch(r){case"table-properties":break;case"insert-footnote":n.changedDOM=n.restoreCaret=this._processFootnoteInsertion(e,i);break;case"delete":n.changedDOM=n.restoreCaret=this._handleDeleteMutation(e,i);break;case"insert-element":this._handleInsertedElement(e,i)===o.InsertedDiscard&&(n.saveChange=!1),n.restoreCaret=!0;break;case"add-style":this._handleAddedStyle(e,i);break;case"remove-style":this._handleRemovedStyle(e,i);break;case"paste-raw":this._updateAfterRawPaste(e);break;case"paste":this._updateAfterPaste(e);break;case"insert-list":this._handleInsertedList(e,i)&&(n.changedDOM=!0);break;case"remove-list":this._loadFromDom();break;case"enter":n.changedDOM=this._handleEnterMutation(e);break;case"delete-br":const s=this._handleDeleteBreak(e);s.handled&&(n.changedDOM=!0,n.restoreCaret=s.restoreCaret);break;case"delete-table-cell":case"delete-table-col":case"delete-table-row":case"delete-table":case"insert-table-row":case"insert-table-cell":case"insert-table-col":n.changedDOM=this._processOneMutationSummary(e[0],[]),n.restoreCaret=!1;break;default:t.logger.debug("Unknown mutation type "+r)}return t.logger.debug("Processed special mutation",r),n}_restoreDeletedListItemFromContext(r,i){const o=i[0],{list:s,li:a}=t.trackerUtils.findMatchingListElement(r,o.added),l=e.utils.dom.isDescendantOf(r.list,this.rootElement)&&r.list,d=l||s;if(!d)return this._restoreList(o)||this._processOneMutationSummary(o,[]);if(r.li.innerHTML=r.liContent,e.utils.dom.insertNodeAt(r.li,d,r.index),this._addDeleteTracking(r.li,{move:c.None,containerOnly:!0,trackContent:!1}),a&&!l){return a.previousSibling.appendChild(d),n(a).remove(),!0}const u=(o.reparented||[]).slice();a||o.added.forEach(t=>{t===d||e.utils.dom.isDescendantOf(t,d)?e.utils.dom.isEmptyTextNode(t)&&u.push(t):u.push(t)}),n(u).remove();const h=d.ownerDocument;n(d).find("li:empty").each((e,t)=>{t.appendChild(h.createElement("BR"))})}_handleDeletedListItem(e,r){const i=e[0];if(this._restoreList(i))return;const o=this.rootElement&&this.rootElement.ownerDocument,s=i.added,a=this._restoreDeletedHierarchy(i.removed,i);let l,c=[];a.forEach(e=>{if(!this._shouldRestoreNode(e,i.getOldParentNode(e)))return;if(t.domUtils.isAncestorAmong(c,e))return void c.push(e);const n=i.getOldParentNode(e);n&&n.ownerDocument===o&&this._restoreAndMarkDeletedNode(e,n,i.getOldPreviousSibling(e))&&"LI"===e.nodeName&&(l=e)}),l=l||function(e){for(let t=e.length-1;t>=0;--t)if("LI"===e[t].nodeName)return e[t];return null}(e[0].removed),l&&(s.forEach(e=>{l.insertBefore(e,l.firstChild)}),this._restoreReparented(i,i.removed),n(l.parentNode).find("li").each((e,t)=>{this._cleanupLINode(n(t))}))}_handleInsertedElement(n,r){const i=n[0];if(!i||!r)return o.None;const{selector:s,cleanup:a}=r;if(!s)return t.logger.error("insert mutation: neither all nor selector are set"),o.None;const l=i.added,c=i.removed.concat(i.reparented||[]);let d=o.InsertedKeep;for(let t,n=0;n<l.length;++n)t=l[n],1===t.nodeType&&e.utils.dom.matchesSelector(t,String(s))&&("TABLE"===t.nodeName&&(d=o.InsertedDiscard),this._tryToTrackAddedNode(t,{nodesToIgnore:c}),a&&a(t));return d}_handleAddedStyle(e,t){let n,r;if(t&&t.element&&(n=e[0])){const e=n.added;for(let n=0;n<e.length;++n)r=e[n],1===r.nodeType&&(r.nodeName.toLowerCase(),t.element)}}_handleRemovedStyle(e,t){let n,r;if(t&&t.element&&(n=e[0])){const e=n.removed;for(let n=0;n<e.length;++n)r=e[n],1===r.nodeType&&(r.nodeName.toLowerCase(),t.element)}}_handleDeleteBreak(e){const t={handled:!1,restoreCaret:!0};if(1!==e.length)return t;let n,r,i;const o=e[0],s=o.removed,a=[],l=this.rootElement&&this.rootElement.ownerDocument;for(let e=0;e<s.length;++e)if(n=s[e],n.nodeName in v){const e=o.getOldParentNode(n);e&&e.ownerDocument===l&&this._restoreAndMarkDeletedNode(n,e,o.getOldPreviousSibling(n))&&(a.push(n),t.handled=!0,"P"===n.nodeName?r=n:"LI"===n.nodeName&&(i=n))}return this._restoreReparented(o,a),(i||r)&&(this._collapseAfter(i?n:r,!1),t.restoreCaret=!1),t}_updateAfterRawPaste(e){this._editTransaction.trackerChanged()}_updateAfterPaste(e){const n=t.flitePluginUtils.trackerAttributes.fliteHandled;let r=!1;for(let t=0,i=e.length;t<i;++t){const i=e[t].added;let o;for(let e=0,t=i.length;e<t;++e)o=i[e],1===o.nodeType&&o.removeAttribute(n),this._isValidFLITENode(o)&&(r=!0,this._finalizeTrackedNode(o),this._fixAddedChildren(o))}r&&this._editTransaction.trackerChanged()}_fixAddedChildren(t){if(t&&1===t.nodeType&&e.utils.dom.matchesSelector(t,"TD,LI")){n(t).find(`span.${this._insertClassName}>br`).each((e,t)=>{this._replaceNodeWithContent(n(t.parentNode))})}}_handleInsertedList(t,n){if(1!==t.length)return!1;const r=t[0],i=r.reparented||[],o=r.added,{selector:a,cleanup:l}=n,c=o.concat(i);let d,u=!1;const h=[];for(let t=0,n=o.length;t<n;++t)d=o[t],"LI"!==d.nodeName||a&&!e.utils.dom.matchesSelector(d,a)?d.nodeName in y&&h.push(d):(u=this._tryToTrackAddedNode(o[t],{force:!0,nodesToIgnore:c,trackChildren:s.DONT_TRACK})||u,l&&l(d));if(h.length)for(let t=0,n=i.length;t<n;++t)d=i[t],"LI"===d.nodeName&&h.indexOf(d.parentNode)>=0&&(!a||e.utils.dom.matchesSelector(d,a))&&(u=this._tryToTrackAddedNode(i[t],{force:!0,trackChildren:s.DONT_TRACK})||u,l&&l(d));return u}_handleSpellcheckMutation(t){if(!((null==t?void 0:t.length)>0))return!1;const n=t=>{const n=[],r=t&&t.length;if(!r)return n;for(let i=0;i<r;++i){const r=t[i];r&&3===r.nodeType&&!e.utils.dom.isEmptyTextNode(r)&&n.push(r)}return n},r=[],i=[];for(const e of t){const t=e.target;A.isSpellcheckerNode(t)?r.push.apply(r,n(e.removedNodes)):1===t.nodeType&&i.push.apply(i,n(e.addedNodes))}return this._markupInsertedNodes(i,null),!1}_handleEnterMutation(t){if(1!==t.length)return!1;const n=t[0],r=this.host.getNewLineNodeName();if(!r)return!1;const i=n.added,o=i.concat(n.reparented||[]);let s,a=!1;const l=t=>{const n=1===t.nodeType&&t.getAttribute("data-flite-block-id");return!!n&&(t.removeAttribute("data-flite-block-id"),e.utils.dom.getNodeIndex(t)===parseInt(n))};for(let e=i.length-1;e>=0;--e)s=i[e],l(s)||s.nodeName!==r&&"LI"!==s.nodeName&&"BR"!==s.nodeName||(a=!0,this._tryToTrackAddedNode(s,{force:!0,nodesToIgnore:o}));return this._removeBogusTracking(i),a}_removeBogusTracking(t){let r;const i=`${this._insertSelector}:not(.flite-container-only),${this._deleteSelector}:not(.flite-container-only)`;for(let o=0;o<t.length;++o)if(r=t[o],e.utils.dom.matchesSelector(r,i)){let t=!0;for(let n=r.lastChild;n&&t;n=n.previousSibling)(3!==n.nodeType||e.utils.dom.isEmptyTextNode(n))&&(1!==n.nodeType||"BR"===n.nodeName&&n.getAttribute("data-mce-bogus"))||(t=!1);t&&this._replaceNodeWithContent(n(r))}}_handleIdenticalChanges(e,r,i){const o=e.length,s=r.length,a=o-s;if(a<-1||a>1)return!1;let l,c;o>s?(l=e.slice(),c=r.slice()):(l=r,c=e);let d,u,h,f=null;const g=[];for(let e=0;e<l.length;++e){d=l[e],h=!1;for(let e=0;e<c.length&&!h;++e)u=c[e],3===d.nodeType?3===u.nodeType&&d.data===u.data&&(h=!0):1===d.nodeType&&1===u.nodeType&&u.nodeName===d.nodeName&&d.innerHTML===u.innerHTML&&(h=!0),h&&(g.push({n1:d,n2:u}),c.splice(e,1));if(!h){if(t.domUtils.getNodeCharacterLength(d)||f)return!1;f=d}}g.forEach(e=>{e.n1.parentNode&&!e.n2.parentNode?e.n1.parentNode.replaceChild(e.n2,e.n1):e.n2.parentNode&&!e.n1.parentNode&&e.n2.parentNode.replaceChild(e.n1,e.n2)});const p=g.length>0;if(p&&l===r&&f&&!n(f).is(":empty")){const e=i.getOldParentNode(f);e&&this._restoreAndMarkDeletedNode(f,e,i.getOldPreviousSibling(f))}return p}_restoreIntoLI(t,n,r){if("LI"!==n.nodeName)return!1;if(r&&r.parentNode===n)return e.utils.dom.insertAfter(t,r,n),!0;for(let e=n.firstChild;e;e=e.nextSibling)if("BR"===e.nodeName)return n.insertBefore(t,e),!0;return n.appendChild(t),!0}_shouldRestoreNode(e,r){if(1!==e.nodeType)return!0;if(this._params.nodeClassifier.classifyNode(e,this.rootElement,!1,!0)===t.NodeClassifier.CONTENT_ONLY){const t=n(e);return t.find(this._insertSelector).filter((e,t)=>this._isCurrentSessionNode(t)).remove(),!t.is(":empty")}return!this._getNodeTrackingContext(e).isCurrent}_tryToTrackAddedNode(e,n){if(this._shouldIgnoreNode(e,!0))return!1;const r=n.ctx||this._getNodeTrackingContext(e);let i=!0;return r.isTracking?n.force||r.isInsert&&!r.isCurrent?this._createTrackedNode(e,{type:"insertType",changeId:null,ignoredNodes:n.nodesToIgnore||[],containerOnly:!1,trackChildren:s.DONT_TRACK}):i=!1:this._createTrackedNode(e,{type:"insertType",changeId:null,containerOnly:t.domUtils.isBlockElement(e),trackChildren:void 0!==n.trackChildren?n.trackChildren:A.shouldTrackChildren(e),ignoredNodes:n.nodesToIgnore||[]}),this._fixAddedChildren(e),i}_monitorCaretInInsertedElement(e){const r=e.changeId,i=e.trackingNode;if(!r||!i)return void t.logger.warn("_monitorCaretInInsertedElement: No node or no change id in node");const o=n(this.rootElement.ownerDocument);o.off("selectionchange.flite"),o.on("selectionchange.flite",()=>{var e;const n=this._getCurrentRange(),s=(null===(e=this._lastChange)||void 0===e?void 0:e.id)===r;if(s&&(null==n?void 0:n.collapsed)){if(this._getNodeTrackingContext(n.commonAncestorContainer,!1).trackingNode===i)return void t.logger.debug("selection still in tracked container")}t.logger.debug("selection has moved out of the tracked container"),o.off("selectionchange.flite"),s&&(this._lastChange=null)})}_restoreAddedHierarchy(t){let n,r,i;if(!t||(n=t.length)<2)return t;const o=[],s=[];let a;for(let a=0;a<n;++a)i=t[a],3===i.nodeType&&e.utils.strings.isEmptyString(i.nodeValue)||(r=i.parentNode,r&&t.indexOf(r)<0&&(1===i.nodeType&&i.getAttribute("data-flite-inserting")?s.push(i):o.push(i)));return a=s.length?s:o,a}_restoreDeletedHierarchy(e,t){if(!(null==e?void 0:e.length))return[];e=e.slice();const n=t=>{for(let n=e.length-1;n>=0;--n)if(e[n]===t)return n;return-1};let r,i,o,s,a;for(let o=0;o<e.length;++o)r=e[o],i=t.getOldParentNode(r),i&&(i!==r.parentNode?(s=n(i),s>o&&(e.splice(s,1),e.splice(o,0,i),--o)):(e.splice(o,1),o--));for(let i=0;i<e.length;++i)r=e[i],o=t.getOldPreviousSibling(r),o&&(a=n(o),a>i&&(e.splice(a,1),e.splice(i,0,o),--i));if(t.li_restored_)return e;t.li_restored_=1;const l=(e,n)=>{if(n>=e.length-1)return;let r,i,o=e[n];if(1!==o.nodeType)return l(e,n+1);for(let s=n+1;s<e.length;++s)r=e[s],t.getOldParentNode(r)===o&&(l(e,n+1),i=t.getOldPreviousSibling(r),i&&i.parentNode!==o&&(i=null),o.insertBefore(r,i&&i.nextSibling),e.splice(s,1),s--)};return l(e,0),e}_createMutationObservers(e){if(!this._mutationSummary){const e={callbacks:{withContext:this._onMutationSummary.bind(this)},rootNode:this.rootElement,oldPreviousSibling:!0,observeOwnChanges:!1,mutationFilter:this._filterMutations,nodeFilter:e=>!this._shouldIgnoreNode(e,!1,!0),queries:[]};e.mutationFilter=e.mutationFilter.bind(this),e.queries.push({element:"*",classAttribute:!1}),this._mutationSummary=new t.MutationSummary(e,!1)}e&&(this._mutationSummary.setCallback("withContext"),this._mutationSummary.reconnect())}_momentarilyRemoveTrackingInRange(e){let n=Date.now()%1e6;const r={},i="data-flite-class";e.getNodes(null,e=>{const t=this._getNodeTrackingContext(e);if(!t.isTracking)return!1;const o=t.trackingNode;let s=A.getNodeAttributes(o),a=o.className,l=String(n++);return r[l]={attributes:s,className:a},this.removeFLITETracking(o),o.setAttribute(i,l),t.isDelete&&o.setAttribute(this.attributes.isDeleteNode,"1"),!0}),setTimeout(()=>{this._$element.find(`[${i}]`).each((e,n)=>{const o=n.getAttribute(i),s=r[o]||{};o?(Object.keys(s.attributes||{}).forEach(e=>{n.setAttribute(e,s.attributes[e])}),n.setAttribute("class",s.className||""),n.removeAttribute(i),n.removeAttribute(this.attributes.isDeleteNode)):t.logger.warn("missing save data for node")})},10)}_isOpaqueNode(e){return this._params.nodeClassifier.classifyNode(e,this.rootElement,!1,!0)===t.NodeClassifier.NODE_ONLY}_isOpaqueNodeOrParent(e){return this._params.nodeClassifier.classifyNode(e,this.rootElement,!1,!1)===t.NodeClassifier.NODE_ONLY}_restoreList(r){const i=r.added,o=r.removed,s=this.host.getNewLineNodeName(),a=s?1:0,l=i&&i.length,c=o&&o.length;if(l<a||!c)return!1;let d,u,h,f,g=0;for(let e=0;e<c;++e){if(d=o[e],!u&&b.test(d.nodeName)){if(u=d,h=this._getNodeTrackingContext(u),h.isInsert&&h.isCurrent)return!1;break}"LI"===d.nodeName&&0===d.children.length&&(t.trackerUtils.findInArray(r.reparented,e=>r.getOldParentNode(e)===d)||++g)}if(!u&&1!==g)return!1;let p=0,m=0;for(let e=i.length-1;e>=0;--e)d=i[e],1===d.nodeType&&(d.nodeName===s?++p:u&&d.nodeName===u.nodeName&&++m);if(p===a&&1===g&&!u)return!1;if(p<a)return!1;if(f=r.getOldParentNode(u),!this._shouldRestoreNode(u,f))return!0;this._restoreDeletedHierarchy(r.removed,r);const v=r.getOldPreviousSibling(u);e.utils.dom.insertAfter(u,v,f),this._removeHostArtifacts(u),m?this._addDeleteTracking(u.firstChild,{trackingContext:h,containerOnly:!0}):this._addDeleteTracking(u,{trackingContext:h,containerOnly:!0,trackContent:!0});const y=[u].concat(n(u).find("*").toArray());for(let e=r.added.length-1;e>=0;--e)d=r.added[e],f=d.parentNode,f&&f.removeChild(d);return this._restoreReparented(r,y),!0}_filterMutations(e){if(!e||!e.length)return[];return this._lastMutationContext.peekType()?this._filterMutationsInContext(e):this._filterBackgroundMutations(e)}_filterMutationsInContext(e){if(this.host.shouldIgnoreMutations(e)!==r.OK)return[];const t=[];for(let n of e)"childList"===n.type&&(this._shouldIgnoreMutationNodeList(n.addedNodes)!==r.OK&&this._shouldIgnoreMutationNodeList(n.removedNodes)!==r.OK||t.push(n));return t}_filterBackgroundMutations(e){return t.logger.debug("Mutations received with no context"),[]}_shouldIgnoreMutationNodeList(e){if(!e||!e.length)return r.IGNORE;let t;for(let n=e.length-1;n>=0;--n)if(t=e[n],!this._shouldIgnoreNode(t,!0))return r.OK;return r.IGNORE}_shouldIgnoreNode(n,r,i=!1){const o=n&&n.nodeType;if(1!==o&&3!==o)return!0;if(r&&3===o&&e.utils.strings.isEmptyString(n.nodeValue))return!0;if(n.style&&"none"===n.style.display)return!0;const s=this._params.nodeClassifier.classifyNode(n,this.rootElement,r,!1);return s===t.NodeClassifier.IGNORE||s===t.NodeClassifier.CONTENT_ONLY&&i}_findNextNodeToDelete(e){const n=this._getNodeAtCaret({range:e,lookBack:!1,forDelete:!0}),r=n.node;if("BR"===(null==r?void 0:r.nodeName)){const n=r.parentElement;if(n&&"BODY"!==n.nodeName&&t.domUtils.isBlockElement(n)&&r===n.lastChild){const t=e.cloneRange();return t.collapseAt(r,!1),this._findNextNodeToDelete(t)}}return this._shouldIgnoreNode(r,!0)?null:(n.isText&&n.node!==e.commonAncestorContainer&&((e=e.cloneRange()).setStart(n.node,n.offset),e.collapse(!0)),{node:r,offset:n.offset,isText:n.isText,tagName:null==r?void 0:r.nodeName,range:e})}_findPreviousNodeToDelete(e){const n=this._getNodeAtCaret({range:e,lookBack:!0,forDelete:!0});let r=n.node;if(!r)return null;if("BR"===(null==r?void 0:r.nodeName)){const e=r.parentElement;e&&"BODY"!==e.nodeName&&r===e.firstChild&&r===e.lastChild&&t.domUtils.isBlockElement(e)&&(r=e)}return this._shouldIgnoreNode(r,!0)?null:(n.isText&&n.node!==e.commonAncestorContainer&&((e=e.cloneRange()).setStart(n.node,n.offset+1),e.collapse(!0)),{node:r,offset:n.offset,tagName:r.tagName||"",isText:n.isText,range:e})}_isCurrentSession(e){const t=this.sessionId;return!t||!!e&&e===t}_getNodeTrackingContext(r,i=!0){const o={isTracking:!1,isCurrentUser:!1,isCurrentSession:!0,isCurrent:!1,trackingNode:null,isDelete:!1,isInsert:!1,changeId:null,tracksContent:!1,referenceNode:r};if(!r)return o;let s;const a=n(r);if(1===r.nodeType?(s=a.is(this._fliteSelector)&&r,s||!1!==i||(s=a.closest(this._fliteSelector)[0])):3===r.nodeType&&(s=n(r).closest(this._fliteTextSelector)[0],o.tracksContent=Boolean(s),s||!1!==i||(s=a.parents(this._fliteSelector)[0])),!s)return o;const l=this.getChangeForNode(s,!1);return l?(o.isTracking=!0,s===r&&e.utils.dom.matchesSelector(s,this._fliteTextSelector)&&(o.tracksContent=!0),o.isCurrentUser=l.userid===String(this.currentUser.id),o.trackingNode=s,o.isDelete=e.utils.dom.matchesSelector(s,this._deleteSelector),o.isInsert=!o.isDelete,o.changeId=l.id,o.isCurrentSession=this._isCurrentSession(l.sessionId),o.isCurrent=o.isCurrentSession&&o.isCurrentUser,o):(t.logger.debug("getNodeTrackingContext found tracking markup but now change for id "+s.getAttribute(this.attributes.changeId)),this.removeFLITETracking(s),o)}_removeHostArtifacts(e){e&&1===e.nodeType&&n(e).find("[data-cke-bookmark],[data-cke-hidden-sel]").remove()}_removeFLITEArtifacts(t,r,i=!0){if(!r||!r.length)return;const o=this.setIgnoreMutations(!0);let s=!1;const a=t&&this._selection.getBookmark(this.host.getCaretSelectors());try{this._restoreAllTextContent(r),r.find("span[data-flite-wrapper-change]").remove(),r.find("[class='']").each((e,t)=>{t.removeAttribute("class")}),r.find(["span",this._insertSelector,":empty,span",this._deleteSelector,":empty"].join("")).each((e,t)=>{t.parentNode&&t.parentNode.removeChild(t)}),i||r.find(N).each((e,t)=>{t.parentNode&&t.parentNode.removeChild(t)}),r.find("tr>br,ul>br,ol>br").remove(),h.forEach(e=>r.find(e).remove());const t=function(r,i){1===i.nodeType?n(i).contents().each(t):3===i.nodeType&&e.utils.dom.isEmptyTextNode(i)&&i.parentNode.removeChild(i)};t(0,r[0]),s=r.is(this._$element)&&this._removeUnusedChangesets()}finally{this.setIgnoreMutations(o),a&&this._selection.gotoBookmark(a),s&&this._editTransaction.trackerChanged()}}_removeUnusedChangesets(){let e=this._$element;if(!e)return!1;let t=!1;const n=e.find(this._fliteSelector),r=this.attributes.changeId,i=n.toArray().reduce((e,t)=>{const n=t.getAttribute&&t.getAttribute(r);return n&&(e[n]=1),e},{});return this._changes.items.forEach(e=>{i[e.id]||(this._changes.removeItem(e),t=!0)}),t}_testChangeSetForRemoval(n){t.logger.debug(`Test changeset ${n} for removal`);if(!this.getChangeForId(n))return!1;const r=this.getNodesForChange(n);let i;for(let n=r.length-1;n>=0;--n)if(i=r[n],!e.utils.dom.matchesSelector(i,this._fliteTextSelector)||!t.domUtils.hasNoTextOrStubContent(i))return!1;return this._changes.removeById(n),r.remove(),!0}_createMonitorChangeId(){const e=new Set;return this._timeoutClient.createTimer("changeset",{autoDispose:!1,timeoutMSecs:1,callback:()=>{let n=!1;try{e.forEach(e=>{n=this._testChangeSetForRemoval(e)||n})}catch(e){t.logger.error("monitor change id: "+e)}finally{e.clear(),n&&this._editTransaction.trackerChanged().finish()}}}),t=>{e.add(t),this._timeoutClient.startTimer("changeset")}}_isValidFLITENode(e){if(!e||1!==e.nodeType)return!1;const t=n(e);return Boolean((t.hasClass(this._deleteClassName)||t.hasClass(this._insertClassName))&&t.attr(this.attributes.changeId)&&t.attr(this.attributes.userId))}_replaceNodeWithContent(r){const i=r[0],o=null==i?void 0:i.parentNode;if(!o||1!==i.nodeType)return;let s=!1,a=r.contents();if(!a.length)return void r.remove();i.nodeName in m&&A.isVirtuallyEmpty(a)?this._preserveBookmarks(r).remove():("LI"===i.nodeName&&o.nodeName in p&&(s=!0,i===i.parentNode.firstChild&&i.parentNode!==this.rootElement?(r.parent().before(a),this._removeNode(i)):i.previousSibling?(n(i.previousSibling).append(a),this._removeNode(i)):s=!1),s||(this.host.preserveWhiteSpace()&&(e.utils.dom.forAllTextChildren(i,t.domUtils.preserveWhiteSpaces),a=r.contents()),r.replaceWith(a)))}_getNodeAtCaret(n){const r=n.range||this._getCurrentRange();let i=null==r?void 0:r.startContainer;const o={node:null,isText:!1,offset:0};let s=!1;const a=!0===n.lookBack,l=Boolean(n.forDelete),c=!1===n.lookBack;if(!i||!r.collapsed)return o;const d=!c&&!a;let u=!0,h=A.getEmptyBlock(r.commonAncestorContainer,r.startOffset);if(h){if(l)return o.node=h,o;u=!1}else if(3===i.nodeType){const t=i;if(s=(d||a)&&0===r.startOffset||(d||c)&&r.startOffset>=t.length,(e.utils.strings.isEmptyString(t.data)||s)&&(h=t),d||!s)return o.node=t,o.isText=!0,o.offset=a?r.startOffset-1:r.startOffset,o;h=i}else{if(1!==i.nodeType)return o;{const e=i,n=r.startOffset?e.childNodes[r.startOffset-1]:null,s=r.startOffset<e.childNodes.length?e.childNodes[r.startOffset]:null;let l;if(d)return o.node=s||n||e,o;if(a?(l=n,h=s):c&&(l=s,h=n),l&&!h){const e=this._params.nodeClassifier.classifyNode(l,this.rootElement,!0,!0);if(e===t.NodeClassifier.NODE_ONLY?o.node=this.host.findTargetNode(l):e===t.NodeClassifier.NODE_AND_CONTENT||e===t.NodeClassifier.CONTENT_ONLY?t.domUtils.isInlineElement(l)&&(o.node=a?t.domUtils.getLastSelectableChild(l,this._getNodeSelectionScheme("leftNeighborForDelete",!1)):t.domUtils.getFirstSelectableChild(l,this._getNodeSelectionScheme("rightNeighborForDelete",!1))):o.node=l,o.node)return(o.isText=3===o.node.nodeType)&&(o.offset=Math.max(a?o.node.length-1:0,0)),o}}}let f=a?this._getNodeOnLeft({anchor:h,forDelete:l}):this._getNodeOnRight({anchor:h,forDelete:l,allowInSelf:u});return f?(o.node=f,o.isText=3===f.nodeType,o.isText&&a&&(o.offset=Math.max(0,f.length-1)),o):o}_isDeletableElement(r,i=!1){if(!r)return!1;if(3===r.nodeType&&!e.utils.dom.isEmptyTextNode(r))return!0;if(1!==r.nodeType)return!1;if(A.isBogus(r))return!1;const o=n(r);let s;for(let e=0,n=O.length;e<n;++e)if(s=O[e],o.is(s.selector)){if(s.type===S.Always)return!0;if(s.type===S.NotEmpty)return i||!t.domUtils.hasNoTextOrStubContent(r)}return!1}_onRangeChanged(e){this.host.setHostRange(e.nativeRange)}_markInlines(){this._$element&&this._$element.find(C).each((e,t)=>{t.setAttribute("data-flite-empty-inline","1")})}_cleanupInlines(){if(!this._$element)return;let e,t=n("");for(;e=this._$element.find(C),e.length&&!e.is(t);)t=e,e.each((e,t)=>{t.getAttribute("data-flite-empty-inline")||n(t).remove(),t.removeAttribute("data-flite-empty-inline")})}_unlistenToMutations(){this._mutationListenRequestCount>0&&--this._mutationListenRequestCount,0===this._mutationListenRequestCount&&this._mutationSummary&&this._mutationSummary.disconnect()}_newMutationSummary(){const n={callbacks:{withContext:this._onMutationSummary.bind(this)},rootNode:this.rootElement,oldPreviousSibling:!0,observeOwnChanges:!1,mutationFilter:e.utils.yes,nodeFilter:e.utils.yes,queries:[]};return n.queries.push({element:"*",classAttribute:!1}),new t.MutationSummary(n,!1)}_trackReplacedText(t,n,r){this._editTransaction.textChanged().setIsUpdate();const i=t.parentNode;for(let o=0;o<n.length;o++){const s=n[o];if(3===s.nodeType&&!s.parentNode&&!e.utils.dom.isEmptyTextNode(s)){i.insertBefore(s,t);const e=this._markNodeAsDeleted(s,r,!0);this._hideTextContent(e)}}this._markupInsertedNodes([t],null)}_trackReplacedTextNew(t){const{target:r,removed:i,changeId:o}=t;this._editTransaction.textChanged();const s=r.parentNode,a=this.rootElement.ownerDocument,l=this._params.highlightSelector,c=[],d=[];let u=0,h="";for(let r=0;r<i.length;r++){const o=i[r],f=n(o);if(o.ownerDocument===a&&!o.parentNode&&f.is(l)){const n={node:f,seq:Number(f.data("flite-seq")),txt:f.data("flite-text"),group:f.data("mceIndex")};if(n.seq&&!e.utils.strings.isEmptyString(n.txt)){d.push(n);t.summary.getOldParentNode(f[0])===s&&(h=n.group,u=Math.max(n.seq,u),c.push(n))}}}if(!u)return this._trackReplacedText(r,i,o);d.sort((e,t)=>e.seq-t.seq);const f=[];for(let e=0;e<d.length;e++){const t=d[e];if(!(t.seq<=u||t.group===h))break;f.push(t.txt),t.node.removeData(["flite-seq","flite-text"])}if(f.length){const e=r.ownerDocument.createTextNode(f.join(""));s.insertBefore(e,r);const t=this._markNodeAsDeleted(e,o,!0);this._hideTextContent(t)}this._markupInsertedNodes([r],null)}_tryToTrackChildReplace(t,n,r){if(3!==(null==t?void 0:t.nodeType))return;const i=n.getOldParentNode(t);e.utils.dom.matchesSelector(i,this._params.highlightSelector)&&this._trackReplacedTextNew({target:t,removed:n.removed,changeId:r,summary:n})}_markHighlightNodes(t){const r=this._params.highlightSelector;t.added.filter(t=>e.utils.dom.matchesSelector(t,r)).sort(e.utils.dom.compareNodePosition).forEach((e,t)=>n(e).data("flite-seq",t+1).data("flite-text",e.textContent))}_onReplaceTextChildrenMutation(n){this._replacerMutationSummary=this._replacerMutationSummary||this._newMutationSummary();const r=this._replacerMutationSummary.createSummaries(n,!1)[0],i=null==r?void 0:r.reparented;if(!(null==i?void 0:i.length)||!r.removed.length)return this._markHighlightNodes(r);const o=this._startBatchChange();try{const t=i.length>1?i.slice().sort(e.utils.dom.compareNodePosition):i;for(let e=0;e<t.length;e++)this._tryToTrackChildReplace(t[e],r,o.id)}catch(e){t.logger.error("While processing replace mutation",e)}finally{this._endBatchChange(o)}}_hideTextContent(e){const t=this._getNodeTrackingContext(e);if(!t.tracksContent||t.trackingNode.getAttribute(this.attributes.fliteTextContent))return;const n=t.trackingNode.innerHTML;t.trackingNode.setAttribute(this.attributes.fliteTextContent,encodeURIComponent(n)),t.trackingNode.innerHTML=A.createReplacementText(n)}_restoreHiddenContent(e){const n=e.getAttribute(this.attributes.fliteTextContent)||"";t.logger.debug("restoring hidden content",n),e.removeAttribute(this.attributes.fliteTextContent),e.innerHTML=decodeURIComponent(n)}_getUserStyleSheet(t,n){if(!t)return null;const r=this._users[t];return r?(!r.styleLoader&&n&&this._env.document&&(r.styleLoader=new e.utils.CSSLoader(this._env.document)),r.styleLoader):null}_validateUserStyle(e){const t=(e=e||{}).delete||{},r=e.insert||{},i=e.common||{},o=n.extend(!0,{},i,t),s=n.extend(!0,{},i,r);return o["background-color"]||(o["background-color"]=this._getNextBackgroundColor("delete")+" !important"),s["background-color"]||(s["background-color"]=this._getNextBackgroundColor("insert")+" !important"),{delete:o,insert:s}}_getNextBackgroundColor(t){const n="insert"===t;let r,i=n?this._params.backgroundColors.insert:this._params.backgroundColors.delete,o=n?this._insColorIndex:this._delColorIndex,s=i.length;if(o<s)r=i[o];else{const t=Math.floor(o/s),n=o%s;r=e.utils.intensifyColor(i[n],.1*t*(t%2?1:-1))}return n?this._insColorIndex++:this._delColorIndex++,r}_resetBackgroundColors(){this._insColorIndex=0,this._delColorIndex=0}_addUser(e){if(!e)return t.logger.warn("null user or no user id");const n=e&&e.id&&String(e.id),r=n&&this._users[n],i=r&&r.styleLoader;i&&i.dispose();const o={userId:e.id,styleLoader:null};this._users[n]=o,this.setUserStyle(e.id,e.style)}_forAllUsers(e){const t=this.host.users.getAllUsers(),n=Object.keys(t);for(let t of n){let n=this._users[t];if(n||(this._users[t]=n={userId:t,styleLoader:null}),!1===e(n))break}Object.keys(this._users).forEach(e=>{var n;e in t||(null===(n=this._users[e].styleLoader)||void 0===n||n.dispose(),delete this._users[e])})}_getNodeOnRight({anchor:e,forDelete:n=!1,allowInSelf:r=!0}){const i=A.getEmptyBlock(e);return i&&(e=i,r=!1),t.domUtils.rightNeighbor(e,this._getNodeSelectionScheme(n?"rightNeighborForDelete":"rightNeighborForSelect",r))}_getNodeOnLeft({anchor:e,forDelete:n=!1,allowInSelf:r=!0}){const i=A.getEmptyBlock(e);if(i){if(n)return i;e=i}let o=t.domUtils.leftNeighbor(e,this._getNodeSelectionScheme(n?"leftNeighborForDelete":"leftNeighborForSelect",r));if(o){o=this._params.nodeClassifier.getAncestorOfClass(o,this.rootElement,t.NodeClassifier.NODE_ONLY,!0)||o}return o}_collapseBefore(e){const n=this._selection,r=this._getNodeOnLeft({anchor:e});return r&&("BR"===r.nodeName&&!r.nextSibling||t.domUtils.isBlockElement(r.nextSibling)?n.collapseAtStart(r):n.collapseAtEnd(r)),n}_collapseAfter(e,t){const n={anchor:e,allowInSelf:t},r=this._selection,i=this._getNodeOnRight(n);return i&&this._selection.collapseAtStart(i),r}_getNodeSelectionScheme(e,t=!0){return Object.assign(Object.assign({},this._deleteOptions[e]),{root:this.rootElement,querySelf:t})}}};Object.assign(t,L)}(window.LOOPINDEX),Object.defineProperty(s,"__esModule",{value:!0}),function(e){const t=null==e?void 0:e.FLITE,n=null==e?void 0:e.$;if(!t||!n)throw new Error("Cannot initialize froala FLITE plugin without FLITE globals");let r;!function(e){e[e.OK=0]="OK",e[e.IGNORE=1]="IGNORE",e[e.IGNORE_ALL=2]="IGNORE_ALL"}(r||(r={}));const i=e.utils.createCISet("mceinsertlink","mcefocus","mcetoggleformat","removeformat","mceapplytextcolor","mceremovetextcolor","justifyright","justifyleft","justifycenter","justifyfull","bold","underline","italic","indent","outdent","annotate"),o=e.utils.createCISet("mceinsertcontent"),s=e.utils.createCISet("removeformat"),a=e.utils.createCISet("undo","redo"),l=e.utils.createCIMap(["mcetabledelete","delete-table"],["mcetabledeletecol","delete-table-col"],["mcetabledeleterow","delete-table-row"],["mcetableinsertrowafter","insert-table-row"],["mcetableinsertcolafter","insert-table-col"],["mcetableinsertrowbefore","insert-table-row"],["mcetableinsertcolbefore","insert-table-col"]),c=e.utils.createCISet("insertunorderedlist","insertorderedlist"),d=e.utils.createCISet("delete","delete-table"),u=window.tinymce.PluginManager;function h(e,t){return e.options&&(e.options.get,1)?e.options.get(t):e.settings?e.settings[t]:"function"==typeof e.getParam?e.getParam(t):null}function f(e,r,i){if(!r||!(null==i?void 0:i.length))return;const o=i.map(e=>e.command),s=new RegExp(`\\b${r}\\b(:?[^\\-]|$)`,"g");function a(i){const a=h(e,i);return!!a&&(n.isArray(a)?a.forEach((e,t)=>{if(!e)return;const i=typeof e;"string"===i&&s.test(e)?a[t]=e.replace(r,o.join(" ")):"object"===i&&s.test(e.name)&&(!e.items||n.isArray(e.items)&&!e.items.length)&&(e.items=o.slice())}):"string"==typeof a&&s.test(a)&&function(e,n,r){if(e.options&&(e.options.set,1))e.options.set(n,r);else{if(e.settings)return e.settings[n]=r;t.logger.warn("no way to change editor setting "+n)}}(e,i,a.replace(r,o.join(" "))),!0)}a("toolbar");for(let e=1;e<10;++e)a("toolbar"+e)}const g=10*parseInt(window.tinymce.majorVersion)+.1*parseInt(window.tinymce.minorVersion);u.add("flite",(function(e,t){!function(e){if(g<60)return;e.options.register("flite",{processor:()=>!0,default:{}})}(e);const n=new N(e,t),r=h(e,"flite");return n.initPlugin(e,r),n}));const p={[t.Commands.TOGGLE_TRACKING]:'<svg class="flite-button" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n    <defs>\n        <path d="M12.4341333,0.546133333 L10.7914667,2.12906667 C10.6250667,2.288 10.6250667,2.54506667 10.7914667,2.70506667 L10.7914667,2.70506667 L13.1797333,5.008 C13.3450667,5.16586667 13.6128,5.16586667 13.7770667,5.008 L13.7770667,5.008 L15.4197333,3.42506667 C15.584,3.26506667 15.584,3.008 15.4197333,2.84906667 L15.4197333,2.84906667 L13.0304,0.546133333 C12.9482667,0.4672 12.8394667,0.426666667 12.7317333,0.426666667 L12.7317333,0.426666667 C12.624,0.426666667 12.5162667,0.4672 12.4341333,0.546133333 L12.4341333,0.546133333 Z" id="path-1"></path>\n    </defs>\n    <g id="pencil_24x24" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n        <g id="Group" transform="translate(2.000000, 3.000000)" fill="#C2C2C2" fill-rule="nonzero">\n            <polygon id="Path" points="13.4 0 13.4 1.4 2.66453526e-15 1.4 2.66453526e-15 0"></polygon>\n            <polygon id="Path" points="20.4 12 20.4 13.4 3.55271368e-15 13.4 3.55271368e-15 12"></polygon>\n            <polygon id="Path" points="20.4 16 20.4 17.4 3.55271368e-15 17.4 3.55271368e-15 16"></polygon>\n            <polygon id="Path" points="20.4 4 20.4 5.4 3.55271368e-15 5.4 3.55271368e-15 4"></polygon>\n            <polygon id="Path" points="7.4 8 7.4 9.4 1.77635684e-15 9.4 1.77635684e-15 8"></polygon>\n        </g>\n        <g id="Group" transform="translate(4.000000, 4.000000)">\n            <path d="M12.6087467,0.42976 C12.4903467,0.444693333 12.38048,0.49696 12.29728,0.58336 L1.00874667,11.8740267 C0.93728,11.9454933 0.888213333,12.03616 0.865813333,12.13536 L0.19488,15.1518933 C0.157546667,15.3268267 0.211946667,15.5092267 0.33888,15.6350933 C0.465813333,15.76096 0.648213333,15.8132267 0.823146667,15.77376 L3.83328,15.10816 C3.93248,15.0868267 4.02314667,15.03776 4.09568,14.9662933 L15.3895467,3.67029333 C15.48768,3.57109333 15.5442133,3.43776 15.5442133,3.29802667 C15.5442133,3.16042667 15.48768,3.02709333 15.3895467,2.92789333 L13.0386133,0.58336 C12.9266133,0.46816 12.76768,0.411626667 12.6087467,0.42976 L12.6087467,0.42976 Z" id="Path" fill="#3F4447"></path>\n            <polygon id="Path" fill="#FFFFFF" points="11.2455467 3.11349333 12.8487467 4.72736 4.23648 13.3406933 2.62901333 11.73216"></polygon>\n            <polygon id="Path" fill="#FF0000" points="12.66848 1.69056 14.2770133 3.29802667 13.59008 3.98602667 11.9815467 2.37749333"></polygon>\n            <polygon id="Path" fill="#13C203" points="1.88554667 12.4734933 3.50048 14.07776 3.46314667 14.1150933 1.39488 14.57376 1.85354667 12.50656"></polygon>\n            <mask id="mask-2" fill="white">\n                <use xlink:href="#path-1"></use>\n            </mask>\n            <g id="Clip-5"></g>\n        </g>\n    </g>\n</svg>',[t.Commands.TOGGLE_SHOW]:'<svg  class="flite-button" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n\t\t<g id="color_6" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n\t\t\t<g id="Group" transform="translate(2.000000, 3.000000)" fill-rule="nonzero">\n\t\t\t\t<polygon id="Path" fill="#13C203" points="13.4 0 13.4 1.4 2.66453526e-15 1.4 2.66453526e-15 0"></polygon>\n\t\t\t\t<polygon id="Path" fill="#C2C2C2" points="20.4 12 20.4 13.4 3.55271368e-15 13.4 3.55271368e-15 12"></polygon>\n\t\t\t\t<polygon id="Path" fill="#C2C2C2" points="20.4 16 20.4 17.4 3.55271368e-15 17.4 3.55271368e-15 16"></polygon>\n\t\t\t\t<polygon id="Path" fill="#C2C2C2" points="20.4 4 20.4 5.4 3.55271368e-15 5.4 3.55271368e-15 4"></polygon>\n\t\t\t\t<polygon id="Path" fill="#FF0000" points="7.4 8 7.4 9.4 1.77635684e-15 9.4 1.77635684e-15 8"></polygon>\n\t\t\t</g>\n\t\t\t<ellipse id="Oval" fill="#FFFFFF" cx="12" cy="12" rx="7" ry="5"></ellipse>\n\t\t\t<path d="M19.9670523,11.863471 C19.1182252,8.35605707 15.2062838,6 12.0849167,6 C8.94741535,6 4.86920709,8.40790823 4.03294767,11.863471 L4,12 L4.03294767,12.136529 C4.86920709,15.5920918 8.94741535,18 12.0849167,18 C15.2062838,18 19.1182252,15.6439429 19.9670523,12.136529 L20,12 L19.9670523,11.863471 Z M12.0849167,16.9359321 C9.34261756,16.9359321 5.80295085,14.915975 5.00456427,12 C5.80295085,9.08402499 9.34261756,7.06406789 12.0849167,7.06406789 C14.7482433,7.06406789 18.1997665,9.08402499 18.9954357,12 C18.1997665,14.915975 14.7482433,16.9359321 12.0849167,16.9359321 Z M12.127375,8.83894433 C10.490691,8.83894433 9.1641227,10.2959993 9.1641227,12.0932575 C9.1641227,13.8905157 10.4908608,15.3475706 12.127375,15.3475706 C13.7638892,15.3475706 15.0906273,13.8907022 15.0906273,12.0932575 C15.0906273,10.2958127 13.764059,8.83894433 12.127375,8.83894433 Z" id="Shape-Copy-11" fill="#464646" fill-rule="nonzero"></path>\n\t\t</g>\n\t</svg>',[t.Commands.ACCEPT_ALL]:'<svg class="flite-button" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n\t\t<g id="color_1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n\t\t\t<g id="Group" transform="translate(2.000000, 3.000000)" fill="#C2C2C2" fill-rule="nonzero">\n\t\t\t\t<polygon id="Path" points="13.4 0 13.4 1.4 2.66453526e-15 1.4 2.66453526e-15 0"></polygon>\n\t\t\t\t<polygon id="Path" points="20.4 12 20.4 13.4 3.55271368e-15 13.4 3.55271368e-15 12"></polygon>\n\t\t\t\t<polygon id="Path" points="20.4 16 20.4 17.4 3.55271368e-15 17.4 3.55271368e-15 16"></polygon>\n\t\t\t\t<polygon id="Path" points="20.4 4 20.4 5.4 3.55271368e-15 5.4 3.55271368e-15 4"></polygon>\n\t\t\t\t<polygon id="Path" points="7.4 8 7.4 9.4 1.77635684e-15 9.4 1.77635684e-15 8"></polygon>\n\t\t\t</g>\n\t\t\t<polygon id="Path-2-Copy" fill="#13C203" fill-rule="nonzero" points="20.6573212 4 22 5.46411673 8.66976357 20 2 12.7269929 3.34267879 11.2628761 8.66976357 17.0717665"></polygon>\n\t\t</g>\n\t</svg>',[t.Commands.REJECT_ALL]:'<svg class="flite-button" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n\t\t<g id="color_2" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n\t\t\t<g id="Group" transform="translate(2.000000, 3.000000)" fill="#C2C2C2" fill-rule="nonzero">\n\t\t\t\t<polygon id="Path" points="13.4 0 13.4 1.4 2.66453526e-15 1.4 2.66453526e-15 0"></polygon>\n\t\t\t\t<polygon id="Path" points="20.4 12 20.4 13.4 3.55271368e-15 13.4 3.55271368e-15 12"></polygon>\n\t\t\t\t<polygon id="Path" points="20.4 16 20.4 17.4 3.55271368e-15 17.4 3.55271368e-15 16"></polygon>\n\t\t\t\t<polygon id="Path" points="20.4 4 20.4 5.4 3.55271368e-15 5.4 3.55271368e-15 4"></polygon>\n\t\t\t\t<polygon id="Path" points="7.4 8 7.4 9.4 1.77635684e-15 9.4 1.77635684e-15 8"></polygon>\n\t\t\t</g>\n\t\t\t<path d="M12,10.7692308 L18.7692308,4 L20,5.23076923 L13.2307692,12 L20,18.7692308 L18.7692308,20 L12,13.2307692 L5.23076923,20 L4,18.7692308 L10.7692308,12 L4,5.23076923 L5.23076923,4 L12,10.7692308 Z" id="Rectangle-Copy-13" fill="#FF0000"></path>\n\t\t</g>\n\t</svg>',[t.Commands.ACCEPT_ONE]:'<svg class="flite-button" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n\t\t<g id="color_3" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n\t\t\t<g id="Group" transform="translate(2.000000, 3.000000)" fill="#C2C2C2" fill-rule="nonzero">\n\t\t\t\t<polygon id="Path" points="13.4 0 13.4 1.4 2.66453526e-15 1.4 2.66453526e-15 0"></polygon>\n\t\t\t\t<polygon id="Path" points="20.4 12 20.4 13.4 3.55271368e-15 13.4 3.55271368e-15 12"></polygon>\n\t\t\t\t<polygon id="Path" points="20.4 16 20.4 17.4 3.55271368e-15 17.4 3.55271368e-15 16"></polygon>\n\t\t\t\t<polygon id="Path" points="20.4 4 20.4 5.4 3.55271368e-15 5.4 3.55271368e-15 4"></polygon>\n\t\t\t\t<polygon id="Path" points="7.4 8 7.4 9.4 1.77635684e-15 9.4 1.77635684e-15 8"></polygon>\n\t\t\t</g>\n\t\t\t<polygon id="Path" fill="#13C203" fill-rule="nonzero" points="21.2068642 11.5757359 22.5095983 12.87847 13.3638043 22.0242641 8.57573593 17.2361957 9.87847004 15.9334616 13.3638043 19.4187959"></polygon>\n\t\t</g>\n\t</svg>',[t.Commands.REJECT_ONE]:'<svg class="flite-button" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n\t\t<g id="color_4" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n\t\t\t<g id="Group" transform="translate(2.000000, 3.000000)" fill="#C2C2C2" fill-rule="nonzero">\n\t\t\t\t<polygon id="Path" points="13.4 0 13.4 1.4 2.66453526e-15 1.4 2.66453526e-15 0"></polygon>\n\t\t\t\t<polygon id="Path" points="20.4 12 20.4 13.4 3.55271368e-15 13.4 3.55271368e-15 12"></polygon>\n\t\t\t\t<polygon id="Path" points="20.4 16 20.4 17.4 3.55271368e-15 17.4 3.55271368e-15 16"></polygon>\n\t\t\t\t<polygon id="Path" points="20.4 4 20.4 5.4 3.55271368e-15 5.4 3.55271368e-15 4"></polygon>\n\t\t\t\t<polygon id="Path" points="7.4 8 7.4 9.4 1.77635684e-15 9.4 1.77635684e-15 8"></polygon>\n\t\t\t</g>\n\t\t\t<polygon id="Path" fill="#FF0000" fill-rule="nonzero" points="20.8615385 11.5757359 22.0242641 12.7384615 17.9627256 16.8 22.0242641 20.8615385 20.8615385 22.0242641 16.8 17.9627256 12.7384615 22.0242641 11.5757359 20.8615385 15.6372744 16.8 11.5757359 12.7384615 12.7384615 11.5757359 16.8 15.6372744"></polygon>\n\t\t</g>\n\t</svg>'},m="[data-footnote-id],section.footnotes,\n.mce-match-marker,.mce-annotation,span.mce-spellcheck,\n[data-mce-type='bookmark'],.mce-resizehandle,span#__caret,\n:not(BR,.mce-spellchecker-word,.mce-spellchecker-annotation,[data-mce-type='format-caret'])[data-mce-bogus],"+t.flitePluginUtils.fliteArtifactsSelector,v={spellCheckerSelector:".mce-spellchecker-word",trackedSelectors:"",opaqueSelectors:"sup.mce-footnote",ignoreSelectors:m,stylePrefix:"ice-cts"},y=new RegExp("(?:^|s)(?:"+t.flitePluginUtils.deleteClass+"|"+t.flitePluginUtils.insertClass+")(?:s|$)");function C(e){const t=e;return t&&t.className&&y.test(t.className)}function _(t){if(!t||!t.length)return[];let n=[];return t.forEach((function(t){n=n.concat(function t(n){let r;if(1===n.nodeType){const e=n.childNodes;for(let i=0;i<e.length;++i)if(r=e[i],t(r),C(r)){for(;r.firstChild;)n.insertBefore(r.firstChild,r);n.removeChild(r)}}return C(n)?e.$.makeArray(n.childNodes):[n]}(t))})),n}class N{constructor(e,t){this._path=t,this._domLoaded=!1,this._editor=null,this._removeBindings=[],this._fliteCommandNames=[],this._buttons={},this.savedEditorFireMethod=null,this._isMouseDownInEditor=!1,this._cutEventHandlestatus=void 0,this._editor=e,this._useXML="xhtml"===h(this._editor,"element_format")}initPlugin(e,n){this._editor=e,t.flitePluginUtils.initFLITEPlugin(this,n,window.tinymce.util.I18n.getCode()),this.timeoutClient.createTimer("ready",{callback:this._onReady.bind(this),timeoutMSecs:100,autoDispose:!1,repeatCount:9999,maxTimeSecs:7})}init(n,r){const o=this._config;if(!t.flitePluginUtils.validateKey())return;this._initUI(n,r),this._domLoaded=!1,e.utils.strings.toStringArray(o.ignoreCommands).forEach(e=>i.add(e)),n.once("init",()=>setTimeout(()=>{this._onEditorLoaded()},1)),this._testNonEditable=function(t){const n=h(t,"noneditable_editable_class")||".mceEditable",r=h(t,"noneditable_noneditable_class")||".mceNonEditable";return function(t,i){for(;t&&t!==i;t=t.parentNode){if(e.utils.dom.matchesSelector(t,r))return!0;if(e.utils.dom.matchesSelector(t,n))return!1}return!1}}(n);const s=()=>{this._isMouseDownInEditor=!1};this.isInline()&&n.on("focus",()=>{this.refreshCommands()});const a=this._onSwitchMode.bind(this);n.on("SwitchMode",a),window.addEventListener("blur",s),n.on("remove",()=>{window.removeEventListener("blur",s),n.off("SwitchMode",a),this._dispose()})}get path(){return this._path}transactUndo(e){try{this._editor.undoManager.add(),this._editor.undoManager.ignore(e),this._editor.undoManager.add()}catch(e){}}saveUndo(t){e.tinymce.saveUndo(this._editor,t)}_dispose(){if(this._editor)try{this._releaseEventBindings(),this.disposePlugin(),this._editor=null}catch(e){t.logger.error("while destroying editor",e)}finally{this._editor=null}}logEditorEvents(t){e.utils.pluginUtils.logEditorEvents({plugin:this,editor:this._editor,exclude:["keydown","focus","blur","mouse.*","ResizeWindow","ResizeContent","ResolveName","TableSelectionClear","GetSelectionRange","NodeChange","VisualAid","scroll.*","execcommand","beforeexeccommand","dirty","mousemove"],method:g>=60?"dispatch":"fire",log:t})}logEditorCommands(e){this._config.logCommands=Boolean(e)}isInline(){return Boolean(this._editor&&this._editor.inline)}revealEditorNode(t){"function"==typeof(t&&t.scrollIntoView)?t.scrollIntoView({block:"center",inline:"nearest",behavior:"smooth"}):e.utils.scrollToElement(t,{direction:"both",duration:100})}getBody(){return this._editor.getBody()}findTargetNode(e){return e}getSelectedNode(e){const t=this._editor.selection,n=null==t?void 0:t.getRng(!0),r=null==n?void 0:n.commonAncestorContainer;if(3===(null==r?void 0:r.nodeType))return r;if(!t)return this.tracker.getSelectedNode();return t.isCollapsed()?t.getStart():t.getNode()}_getUIButtonRecord(e){var t;return null!==(t=this._buttons[e])&&void 0!==t?t:this._buttons[e]={active:void 0,button:void 0,command:e,enabled:!1}}_initUI(n,r){const i=this._config,o=i.commands.reduce((e,t)=>(e[t.command]=t,e),{}),s=(t,r)=>{if(n.addCommand(t.command,t.callback,this),!r)return;const i={tooltip:this.getLocalizedString(t.title),image:e.utils.joinPath(this._path,"icons",t.command+".png"),cmd:t.command,onPostRender:e=>{const n=this._getUIButtonRecord(t.command);n.button=e.control,this.setCommandsState(t.command,n.enabled,n.active)}};n.addButton(t.command,i),!1!==t.trackingOnly&&this._fliteCommandNames.push(t.command)},a=(e,r)=>{const i=n;if(i.addCommand(e.command,e.callback,this),!r)return;if(e.iconName){const n=p[e.command];n?i.ui.registry.addIcon(e.iconName,n):t.logger.warn("Missing svg icon data for command "+e.command)}const o={tooltip:this.getLocalizedString(e.title),disabled:!1,icon:e.iconName,onAction:()=>{this._editor.execCommand(e.command,null)},onSetup:t=>{const n=this._getUIButtonRecord(e.command);n.button=t,this.setCommandsState(e.command,n.enabled,n.active)}};i.ui.registry.addToggleButton(e.command,o),!1!==e.trackingOnly&&this._fliteCommandNames.push(e.command)},l={[t.Commands.TOGGLE_TRACKING]:{callback:this.onToggleTracking,undo:!1,trackingOnly:!1},[t.Commands.TOGGLE_SHOW]:{callback:this.onToggleShow,undo:!1,trackingOnly:!1},[t.Commands.ACCEPT_ALL]:{callback:this.onAcceptAll,undo:!0,trackingOnly:!0},[t.Commands.REJECT_ALL]:{undo:!0,callback:this.onRejectAll,trackingOnly:!0},[t.Commands.ACCEPT_ONE]:{undo:!0,callback:this.onAcceptOne,contextAction:this.acceptChange,trackingOnly:!0},[t.Commands.REJECT_ONE]:{undo:!0,callback:this.onRejectOne,contextAction:this.rejectChange,trackingOnly:!0}},c=t.flitePluginUtils.getCommands(l).map(e=>Object.assign(Object.assign({},e),{svg:p[e.command],iconName:e.command.replace(/[^a-z]/g,"")}));[{command:t.Commands.TOGGLE_TRACKING,callback:this.onToggleTracking,title:"TOGGLE_TRACKING",trackingOnly:!1},{command:t.Commands.TOGGLE_SHOW,callback:this.onToggleShow,title:"TOGGLE_SHOW"},{command:t.Commands.ACCEPT_ALL,callback:this.onAcceptAll,title:"ACCEPT_ALL"},{command:t.Commands.REJECT_ALL,callback:this.onRejectAll,title:"REJECT_ALL"},{command:t.Commands.ACCEPT_ONE,callback:this.onAcceptOne,contextAction:this.acceptChange,title:"ACCEPT_ONE"},{command:t.Commands.REJECT_ONE,callback:this.onRejectOne,contextAction:this.rejectChange,title:"REJECT_ONE"}].map(e=>Object.assign(Object.assign({},e),{svg:p[e.command],iconName:e.command.replace(/[^a-z]/g,"")}));let d;f(n,"flite",i.commands),g>=50?(d=a,this._disableButton=(e,t)=>{e.setEnabled?e.setEnabled(!t):e.setDisabled(t)},this._activateButton=(e,t)=>{e&&e.setActive&&e.setActive(t)}):(d=s,this._disableButton=(e,t)=>{e.disabled(t)},this._activateButton=(e,t)=>{e&&e.active&&e.active(t)});const u=e=>()=>{const t=this._getUIButtonRecord(e);return Boolean(t.enabled)};c.forEach(e=>{const t=o[e.command],r={callback:e.callback,command:e.command,title:this.getLocalizedString((null==t?void 0:t.title)||e.title),iconName:e.iconName};n.addQueryStateHandler(e.command,u(e.command)),d(r,Boolean(t))}),this._setupContextMenu(n,c)}_uninit(){}setCommandsState(e,t,n){"string"==typeof e&&(e=[e]);const r="boolean"==typeof n;let i;for(let o=e.length-1;o>=0;--o){const s=this._getUIButtonRecord(e[o]);s.enabled=t,s.active=n,(i=s.button)&&(this._disableButton(i,!t),r&&this._activateButton(i,n))}}_onSelectionChanged(){if("none"!==this.trackingState.mode){const e=this.tracker.hasChanges(),t={hasChanges:e,changeId:e?this.tracker.getNodeChangeId(this.getSelectedNode(!0)):null};this.trackingState.update(t)}}get editor(){return this._editor}_finalizeConfiguration(e){return g>=50&&e.pageUrls.push("css/editor-tinymce.css"),e}_onSwitchMode(e){this.trackingState.update({readonly:"design"!==e.mode})}get editorMode(){return this._editor?this._editor.readonly?"readonly":"design":""}fireEvent(e,t=null){return this._editor&&this._editor.fire(e,t)}cleanupAfterAcceptReject(){const e=n(this.getBody()),r=this.tracker.setIgnoreMutations(!0),i=e.find("span."+t.flitePluginUtils.insertClass+":empty,span."+t.flitePluginUtils.deleteClass+":empty");try{if(i.remove(),0===e.html().length){const t=this._getDocument().createElement("BR");e.prepend(t),this._editor.selection.select(t),this._editor.selection.collapse()}}catch(e){t.logger.error("cleanupAfterAcceptReject:",e)}finally{this.tracker.setIgnoreMutations(r)}g>=50&&this.tracker.ignoreNextMutation("TMCE5 safeguard after accept/reject"),this.onSelectionChanged()}processConfig(e){return g<60?e||{}:"boolean"!=typeof e.handlePaste?n.extend({},e,{handlePaste:!1}):e||{}}_bindEditorEvents(e){!1===this._config.handlePaste||this._editor.plugins.paste||this._editor.plugins.powerpaste||this._addEventBinding("paste",e=>{const t=this.trackingState.mode;if("none"===t)return;if("readonly"===t)return void this.tracker.prepareForInsertion();const n=e.clipboardData;if(!n)return;const r=n.getData("text/html")||n.getData("text/plain");return r?(e.preventDefault(),e.stopPropagation(),this._editor.insertContent(r)):void 0}),this._addEventBinding(t.Events.REJECT,()=>{this._editor.execCommand("mceUpdateFootnotes")}),this._addEventBinding(t.Events.ACCEPT,()=>{this._editor.execCommand("mceUpdateFootnotes")}),this._addEventBinding("cut",e=>{const n=t.flitePluginUtils.tryHandleClipboardEvent(this,e);return this._cutEventHandlestatus=!n,this.timeoutClient.setTimer(()=>{this._cutEventHandlestatus=void 0},50),!n}),this._addEventBinding("MouseDown",()=>{this._isMouseDownInEditor=!0}),this._addEventBinding("MouseUp",()=>{this._isMouseDownInEditor=!1}),this._addEventBinding("Blur",()=>{this._isMouseDownInEditor=!1}),this._addEventBinding("PreProcess",this._onPreProcessForSave),this._addEventBinding("keydown",e=>{if(!e||"none"===this.trackingState.mode||this.spellingStack)return t.logger.debug("plugin won't handle keydown event"),!0;return this.tracker.handleEvent(e,this.trackingState.mode,this._config.readonlyInsertPolicy)},!1,!0),this._monitorEditorDialogs(),this._addEventBinding("ListMutation",e=>{var t;const n=null===(t=this.tracker)||void 0===t?void 0:t.getMutationContext(),r=n&&"none"!==n;this.tracker&&!r&&this.tracker.ignoreNextMutation("list mutation")}),this._addEventBinding("click",this.onSelectionChanged),this._addEventBinding("SpellcheckEnd",()=>{this.tracker.ignoreNextMutation("spell check end")}),this._addEventBinding("SpellcheckStart",()=>{this.tracker.ignoreNextMutation("spell check start")}),this._addEventBinding("selectionChange",this.onSelectionChanged),this._addEventBinding("keypress",this._onKeyPress),this._addEventBinding("ExecCommand",this._onAfterCommand),this._addEventBinding("BeforeExecCommand",this._onBeforeCommand),this._addEventBinding("BeforeAddUndo",this._onBeforeAddUndo),this._addEventBinding("BeforeSetContent",this._onBeforeSetContent),this._addEventBinding("SetContent",this._onSetContent),this._addEventBinding("PastePreProcess",this._onPreProcessPaste),this._addEventBinding("GetContent",this._onGetContent),this._addEventBinding("NodeChange",this.onSelectionChanged),this._bindFormatting(this._editor)}_bindFormatting(e){if(g<49){const t=e.formatter.apply;e.formatter.apply=(...n)=>{this.tracker&&this.tracker.ignoreNextMutation("apply formatting"),t.apply(e.formatter,n)}}}_onPreProcessForSave(e){const t=null==e?void 0:e.node;t&&this._config.preserveWhiteSpace&&this.tracker.preserveWhiteSpace(t)}_setPluginFeatures(e){const n=null==e?void 0:e.schema;if("function"!=typeof(null==n?void 0:n.getElementRule))return;const r=e.schema.getElementRule("span"),i=Object.assign({},(null==r?void 0:r.attributes)||{});if(0===Object.keys(i).length)return;const o=t.flitePluginUtils.trackerAttributes;Object.keys(o).map(e=>o[e]).concat(["class","id","title"]).forEach(e=>{i[e]||(i[e]={})});const s=`span[${Object.keys(i).join("|")}]`;e.schema.addValidElements(s)}isCutKeystroke(e){return!1}_onKeyPress(e){this.isCutKeystroke(e.keyCode)&&e.stopPropagation()}_getDocument(){return this.getBody().ownerDocument}_onReady(){const e=this._config.maxDocumentReadyWaitSeconds&&this.timeoutClient.elapsed("ready")>=1e3*this._config.maxDocumentReadyWaitSeconds;this._domLoaded&&t.rangy.isInitialized(e)?(this.timeoutClient.stopTimer("ready"),this._afterReady()):this.timeoutClient.startTimer("ready")}getHostRange(){return this._editor.selection.getRng(!0)||null}setHostRange(e){let t=this._editor&&this._editor.selection;t&&t.setRng(e)}_afterReady(){var e;const n=this._editor,r=this.getBody();t.trackerUtils.markFLITEBody(r);try{this.tracker.reload(r),this.trackingState.update({readonly:this._editor.readonly,hasUser:Boolean(this.users.getCurrentUser(!1)),wysiwyg:!this._editor.readonly,hasChanges:this.tracker.hasChanges()}),this.toggleShow(this.isVisible,!1),"always"===this._config.sessionPolicy&&this.startNewSession(),this.setLanguage(null===(e=window.tinymce.util.I18n)||void 0===e?void 0:e.getCode()).then(()=>{this.refreshCommands(),n.fire(t.Events.INIT,{flite:this})})}catch(n){t.logger.error("FLITE plugin init:",n)}}getTrackerOptions(){var n;return{copyBehavior:this._config.copyBehavior,highlightSelector:".mce-match-marker",keyboardMap:null===(n=this._spellTrigger)||void 0===n?void 0:n.parent(),spellingOverride:this._config.spellingOverride,timezoneOffset:this._config.timezoneOffset||0,handleCut:!1,changeGroupTime:1e3,deletableSelectors:this._config.deletableSelectors,opaqueSelectors:this._config.opaqueSelectors,backgroundColors:{delete:e.utils.strings.toStringArray(this._config.backgroundColors.delete),insert:e.utils.strings.toStringArray(this._config.backgroundColors.insert)},changeTypes:{insertType:{className:t.flitePluginUtils.insertClass,action:"Inserted"},deleteType:{className:t.flitePluginUtils.deleteClass,action:"Deleted"}},classes:void 0,nodeClassifier:(new t.NodeClassifier).addPatterns(t.NodeClassifier.NODE_AND_CONTENT,v.trackedSelectors).addPatterns(t.NodeClassifier.IGNORE,v.ignoreSelectors).addPatterns(t.NodeClassifier.CONTENT_ONLY,v.spellCheckerSelector).addPatterns(t.NodeClassifier.IGNORE,this._config.ignoreSelectors).addPatterns(t.NodeClassifier.NODE_ONLY,v.opaqueSelectors),stylePrefix:v.stylePrefix,_changeData:void 0}}onLocaleChanged(){t.logger.debug("locale changed to "+this.localizer.locale)}_onPreProcessPaste(t){const n=this._getDocument(),r=n&&n.createElement("div");return r&&(r.innerHTML=t.content,this.tracker.getCleanDOM(r,{removeDeleted:this._config.removeDeleteOnPaste}),t.content=e.utils.dom.elementToHtml({el:r,xml:this._useXML,withRoot:!1})),t.content}_onGetContent(e){"string"==typeof e.content&&(e.content=t.flitePluginUtils.postProcessData(this,e.content,this._useXML))}_onEditorLoaded(){if(this._domLoaded)return;this._domLoaded=!0;const e=this._getDocument();this.compositionTracker.attach(e.body),this._bindEditorEvents(this._editor),this._setPluginFeatures(this._editor),this.loadDocumentStyles(e),this._onReady()}_setupContextMenu5(n,r){const i=this._config.contextMenu;if(!(null==i?void 0:i.length))return;const o=r.filter(e=>i.indexOf(e.command)>=0);if(o.length<1)return void t.logger.warn("Context menu contains unknown commands "+i);const s=o.map(e=>e.command),a=e.utils.strings.toMap(o,"cmd","*");n.ui.registry.addContextMenu("flite",{update:e=>{if(!this.isTracking)return"";const n=this.tracker.getNodeChangeId(e);this.trackingState.update({changeId:n});const r=t.flitePluginUtils.getCommandsStatus(this,s),i=[];return Object.keys(r).forEach(t=>{const n=r[t],o=a[t];o&&(null==n?void 0:n.enabled)&&i.push({text:this.getLocalizedString(o.title||o.name),icon:o.iconName,onAction:()=>{(o.contextAction||o.callback).call(this,e)}})}),i}})}getNewLineNodeName(){const e=String(this._editor&&this._editor.getParam("forced_root_block","P")||"P").toUpperCase();return N.NEWLINE_MAP[e]||e}_onBeforeAddUndo(e){var n;let r=!1;if(this.allowSaveUndo()){const i=null===(n=e.level)||void 0===n?void 0:n.content;if(!(null==i?void 0:i.length))return;(i.indexOf('data-flite-block-id="')>0||i.indexOf(t.flitePluginUtils.trackerAttributes.stubNode+'="')>0)&&(r=!0)}else this.allowSaveUndo(!0);if(r)return e.preventDefault(),!1}_onBeforeCommand(e){const n=(e.command||"").toLowerCase();if(s.has(n))return this._saveFLITEClasses();const r=this.trackingState.mode;if(!this._editor||"none"===r)return;if(this._config.logCommands&&!/focus/.test(n)&&t.logger.debug("before command:",n,e),i.has(n))return;const d="full"===r;if("delete"===n){const n=this._cutEventHandlestatus;if(void 0!==n)return!1===n&&e.stopImmediatePropagation(),this._cutEventHandlestatus=void 0,n;if("enter"!==this.tracker.getMutationContext()){if(t.flitePluginUtils.tryHandleClipboardEvent(this,e))return e.stopImmediatePropagation(),!1}}else if(d&&c.has(n)){const t=this.tracker.tryToTrackListStatusRemoval({isBullet:"insertunorderedlist"===n,isBulk:!0,trackTypeChange:this._config.trackListTypeChange});if(t.handled)return e.stopImmediatePropagation(),!1;t.mutation&&this.tracker.setMutationContext(t.mutation,{selector:t.selector,cleanup:t.cleanup})}else if(o.has(n))d?this._processInsert(e):this.tracker.prepareForInsertion();else if(a.has(n)){const e=this._editor.selection.getBookmark(2);this._editor.once("ExecCommand",t=>{a.has(null==t?void 0:t.command)&&function(e,t){const n=e=>{var t;return 1===(null===(t=null==e?void 0:e.start)||void 0===t?void 0:t.length)&&0===e.start[0]};try{if(n(t))return!1;if(!n(e.selection.getBookmark(2)))return!1;const r=e.getDoc(),i=e.dom.getRoot(),o=t.start,s=o.length-1,a=r.createRange();for(let e=s,t=i;e>=0;--e){const n=o[e],r=t.childNodes[n];if(!r)break;if(3===r.nodeType){const t=0===e?0:o[e-1];a.setStart(r,Math.min(t,r.length));break}if("BR"===r.nodeName){a.setStart(t,Math.max(0,n-1));break}if(1!==r.nodeType)break;a.setStart(t,Math.max(n,0)),t=r}a.startContainer===r&&0===a.startOffset||(a.collapse(!0),e.selection.setRng(a))}catch(e){return!1}}(this._editor,e)}),this.muteSessionPolicy()}else if(d){const e=l.get(n);e&&this.tracker.setMutationContext(e)}}_onAfterCommand(e){const t=(e.command||"").toLowerCase();if(s.has(t))return this._restoreFLITEClasses();this._editor&&"none"!==this.trackingState.mode&&a.has(t)&&this.restoreSessionPolicy()}_onBeforeSetContent(e){if(!this._isOverridingCommand&&this._config.trackApiInsert&&!e.paste)return e.selection?this._onSelectionSetContent(e):void("html"===e.format&&e.content&&(e.content=this._processContent(e.content)))}_processContent(e){const r=this._getDocument().createElement("div"),i=n(r);i.html(e);try{t.flitePluginUtils.replaceInsDel(this,r,"ins[data-cid]",!0),t.flitePluginUtils.replaceInsDel(this,r,"del[data-cid]",!1),t.flitePluginUtils.presrveWhitespace(r)}catch(e){t.logger.error("processContent:",e)}return i.html()}_onSelectionSetContent(e){if(this.tracker.getMutationContext()in d)return;const r=this.trackingState.mode,i=e.content||"";if(i&&!(i.indexOf('data-mce-type="bookmark"')>0)&&(this.tracker.prepareForInsertion(),"readonly"!==r&&"full"===r&&"html"===e.format))try{const e=n(i);1===e.length&&this.tracker.setMutationContext("insert-element",{selector:t.domUtils.getElementSelector(e[0])})}catch(e){t.logger.error("selection set content",e)}}_onSetContent(e){if(e.selection)return this._onBeforeSetContent(e);const n=this.getBody();this.isTracking&&"always"===this._config.sessionPolicy&&this.startNewSession(),this.tracker.reload(t.trackerUtils.isFLITEBody(n)?null:n)}_saveFLITEClasses(){this.tracker.getTrackedNodes().each((e,t)=>{const n=t.className;n&&t.setAttribute("data-flite-saved-class",n)})}_restoreFLITEClasses(){n(this.getBody()).find("[data-flite-saved-class]").each((e,t)=>{const n=t.getAttribute("data-flite-saved-class");t.removeAttribute("data-flite-saved-class"),n&&t.setAttribute("class",n)})}_processInsert(e){if(e.value&&!this.spellingStack&&!this._isOverridingCommand&&this._shouldProcessInsert()){this._isOverridingCommand=!0;try{const t="string"==typeof e.value?e.value:e.value.content;if("string"==typeof t){const n=this._classifyInsert(t);if(n.mutation)n.content&&(t===e.value?e.value=n.content:e.value.content=n.content),this.tracker.setMutationContext(n.mutation,n.mutationData);else{e.preventDefault(),e.stopImmediatePropagation(),this.tracker.setMutationContext("paste");const n=this._processInsertedHtml(t);e.target.insertContent(n)}}}catch(e){t.logger.error("while inserting content",e)}finally{this._isOverridingCommand=!1}}}_shouldProcessInsert(){if(window.document.querySelector(".tox-autocompleter"))return!1;const e=this.getBody(),t=e&&e.ownerDocument;return Boolean(t&&!t.querySelector(".tox-autocompleter"))}_classifyInsert(e){const t={mutation:null},r="mce-footnote";if(!((null==e?void 0:e.indexOf(r))>=0))return t;try{const t=n(e),i="sup."+r;if(t.is(i))return{mutation:"insert-footnote",mutationData:{markerSelector:i,headerSelector:"",noteSelector:""}}}catch(e){}return t}_prepareNodesForPaste(e){if(!e||!e.length)return null;let t=null;return e.length&&(e=_(e),t=this.isTracking?this.tracker.processInsertedNodes(e,{deleteSelection:!0,markup:!0}):e),t}_processInsertedHtml(t){const n=this._getDocument().createElement("div");n.innerHTML=t;const r=this.tracker.getCleanDOM(n,{removeDeleted:this._config.removeDeleteOnPaste});if(!r.innerHTML)return t;e.utils.dom.normalizeNode(r);const i=e.$.makeArray(r.childNodes),o=this._prepareNodesForPaste(i);if(o&&o.length)try{return o.map((function(e){return 3===e.nodeType?e.data:e.outerHTML})).join("")}catch(e){return t}}_addEventBinding(e,t,n=!0,r){const i=n?t.bind(this):t;this._removeBindings.push({event:e,context:this._editor.on(e,i,r),callback:i})}_releaseEventBindings(){const e=this._removeBindings.filter(Boolean);let t;this._removeBindings=[];for(let n=e.length-1;n>=0;--n)try{t=e[n],t&&t.context&&t.context.off(t.event,t.callback)}catch(e){}}_setupContextMenu(e,n){g>=50?this._setupContextMenu5(e,n):this._addEventBinding("contextmenu",(e,n)=>{t.logger.debug("context menu")},!1)}_shouldIgnoreNode(e){if(e&&1===e.nodeType){const t=e.className||"";if(t.indexOf("mce-match-marker")>=0)return r.IGNORE_ALL;if(t.indexOf("mce-annotation")>=0)return r.IGNORE_ALL}return r.OK}shouldIgnoreDeletedNode(e){return this._testNonEditable(e,this._editor.getElement())}getRelatedNodes(t,r){if(1!==(null==r?void 0:r.nodeType))return[];if("delete"===t){if(!e.utils.dom.matchesSelector(r,"sup.mce-footnote"))return[];const t=n(r).find("[data-mce-href]");if(!t.length)return[];const i=t.attr("data-mce-href");if(!i)return[];return n(this.getBody()).find(""+i).toArray().map(e=>this.findTargetNode(e))}return[]}shouldIgnoreMutations(e){return r.OK}getCaretSelectors(){return N.CARET_SELECTORS}_shouldIgnoreMutationCollection(e,t){let n,i,o;const s={};let a;for(let t=0,r=e.length;t<r&&(!i||!o);++t)n=e[t],a=1===n.addedNodes.length&&n.addedNodes[0],a&&1===a.nodeType&&"bookmark"===a.getAttribute("data-mce-type")&&(i=a,s[t]=1),a=1===n.removedNodes.length&&n.removedNodes[0],a&&1===a.nodeType&&"bookmark"===a.getAttribute("data-mce-type")&&(o=a,s[t]=1);if(!i||!o)return t;let l=0;for(let r=0,c=e.length;r<c;++r)if(!(r in s)&&(n=e[r],n.nextSibling!==i&&n.nextSibling!==o)){if(n.removedNodes.length)return t;if(a=n.addedNodes[0],a&&3!==a.nodeType)return t;l++}return l<2?r.IGNORE_ALL:t}shouldIgnoreMutation(e,t){const n=e[t];if(!n)return r.IGNORE;if(this.spellingStack)return r.IGNORE_ALL;const i=n.addedNodes;let o;for(let t=0;i&&t<i.length;++t)if(o=this._shouldIgnoreNode(i[t]),o===r.IGNORE&&(o=this._shouldIgnoreMutationCollection(e,o)),o!==r.OK)return o;const s=n.removedNodes;for(let t=0;s&&t<s.length;++t)if(o=this._shouldIgnoreNode(s[t]),o===r.IGNORE&&(o=this._shouldIgnoreMutationCollection(e,o)),o!==r.OK)return o;return r.OK}_monitorEditorDialogs(){let e=null,t=0;this._addEventBinding("CloseWindow",()=>{t&&(t--,0===t&&(this.tracker.toggleListenToCharacterChanges(!1),null!==e&&(this.tracker.setIgnoreMutations(e),e=null)))}),this._addEventBinding("OpenWindow",e=>{if(t++,this.isTracking&&function(e){var t;const n=e&&"function"==typeof e.getData&&e.getData();return!!(null==n?void 0:n.hasOwnProperty("findtext"))||"Find and replace"===(null===(t=e.settings)||void 0===t?void 0:t.title)}(e&&(e.dialog||e.win))){const e=g<60?"replace":"replace-t6";this.tracker.toggleListenToCharacterChanges({count:-1,hideText:!this._config.allowFindDeletedText,type:e})}})}preserveWhiteSpace(){return!1!==this._config.preserveWhiteSpace}isEditorArtifact(t){return e.utils.dom.matchesSelector(t,m)}isBogusInsertPosition(e){return e&&"SPAN"===e.nodeName&&null!==e.getAttribute("data-mce-bogus")}isPassThroughNode(e){return this._isPassThroughNode||(this._isPassThroughNode=t.flitePluginUtils.createSpellCheckerTest(this,".mce-spellcheck,.mce-spellchecker-word")),this._isPassThroughNode(e)}getHostNativeRange(){return this.getHostRange()}beforeDelete(e){return this.beforeInsert(e)}beforeInsert(r){if(!r.collapsed)return r;const i="[data-mce-type='format-caret']";let o=t.domUtils.getNode(r.commonAncestorContainer,i,this.getBody());if(!o&&1===r.startContainer.nodeType){o=[r.startContainer.childNodes[r.startOffset],r.startContainer.childNodes[r.startOffset-1]].filter(Boolean).filter(t=>e.utils.dom.matchesSelector(t,i))[0]}if(!o)return r;const s=n(o);return r.setStartBefore(o),r.collapse(!0),s.is(":empty")?s.remove():s.replaceWith(s.contents()),r}getIMECompositionState(){return this.compositionTracker.isComposing?2:0}}N.NEWLINE_MAP={FALSE:"BR",TRUE:"P"},N.CARET_SELECTORS={ignoreSelector:".mce-match-marker,.mce-annotation,[data-mce-type='bookmark'],.mce-resizehandle,span#__caret,\n\t\t\t:not(BR,.mce-spellchecker-word,.mce-spellchecker-annotation)[data-mce-bogus],.tippy-popper,.tippy-tooltip,.tippy-content,.tippy-arrow",elementSelector:"BR,IMG"};class b{constructor(e,t,n){this.callback=n,this.id=String(b.nextId++),b._guards[this.id]=this;const r=o=>{t&&t!==o.command||(delete b._guards[this.id],e.off("ExecCommand",r),i&&(clearTimeout(i),i=null),n())};e.on("ExecCommand",r);let i=setTimeout(()=>{i=null,e.off("ExecCommand",r),delete b._guards[this.id]},1)}}b._guards={},b.nextId=0}(window.LOOPINDEX)}()}]);